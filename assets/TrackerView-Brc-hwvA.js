var mt=Object.defineProperty;var xt=(r,t,e)=>t in r?mt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var ut=(r,t,e)=>(xt(r,typeof t!="symbol"?t+"":t,e),e),nt=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var Le=(r,t,e)=>(nt(r,t,"read from private field"),e?e.call(r):t.get(r)),st=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},it=(r,t,e,n)=>(nt(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e);var at=(r,t,e)=>(nt(r,t,"access private method"),e);import{o as openBlock,c as createElementBlock,a as createBaseVNode,n as normalizeClass,t as toDisplayString,f as defineComponent,g as ref,i as useDataStore,j as computed,k as watch,l as watchEffect,m as onMounted,b as resolveComponent,d as createTextVNode,e as createVNode,w as withCtx,p as withDirectives,v as vShow,h as createCommentVNode,F as Fragment,r as renderList,q as unref,s as pushScopeId,x as popScopeId,_ as _export_sfc}from"./index-5XIIPwwI.js";import{g as getAugmentedNamespace,a as getDefaultExportFromCjs,c as commonjsGlobal,_ as _sfc_main$2}from"./ArcanistIcon.vue_vue_type_script_setup_true_name_ArcanistIcon_lang-mTPhg4rV.js";import{u as usePullsRecordStore}from"./pullsRecordStore-cqEE5shC.js";const bitMethods={getBit(r){return this.data[getSlot(r)]&1<<getShift(r)?1:0},setBit(r){this.data[getSlot(r)]|=1<<getShift(r)},clearBit(r){this.data[getSlot(r)]&=~(1<<getShift(r))},toggleBit(r){this.data[getSlot(r)]^=1<<getShift(r)},getBitXY(r,t){return r>=this.width||t>=this.height?0:this.getBit(t*this.width+r)},setBitXY(r,t){this.setBit(t*this.width+r)},clearBitXY(r,t){this.clearBit(t*this.width+r)},toggleBitXY(r,t){this.toggleBit(t*this.width+r)}};function getSlot(r){return r>>3}function getShift(r){return 7-(r&7)}function setBitMethods(r){for(const t in bitMethods)r.prototype[t]=bitMethods[t]}function checkProcessable(r,t={}){let{bitDepth:e,alpha:n,colorModel:s,components:a,channels:o}=t;if(typeof r!="string"||r.length===0)throw new TypeError("processName must be a string");if(e&&(Array.isArray(e)||(e=[e]),!e.includes(this.bitDepth)))throw new TypeError(`The process: ${r} can only be applied if bit depth is in: ${e}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${r} can only be applied if alpha is in: ${n}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.colorModel)))throw new TypeError(`The process: ${r} can only be applied if color model is in: ${s}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.components))){let l=`The process: ${r} can only be applied if the number of components is in: ${a}`;throw a.length===1&&a[0]===1?new TypeError(`${l}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(l)}if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.channels)))throw new TypeError(`The process: ${r} can only be applied if the number of channels is in: ${o}`)}function createBlob(r,t){r=r||[],t=t||{},typeof t=="string"&&(t={type:t});try{return new Blob(r,t)}catch(a){if(a.name!=="TypeError")throw a;for(var e=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,n=new e,s=0;s<r.length;s+=1)n.append(r[s]);return n.getBlob(t.type)}}function dataURLToBlob(r){var t=r.match(/data:([^;]+)/)[1],e=r.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(e));return createBlob([n],{type:t})}function canvasToBlob(r,t,e){return typeof r.toBlob=="function"?new Promise(function(n){r.toBlob(n,t,e)}):Promise.resolve(dataURLToBlob(r.toDataURL(t,e)))}function binaryStringToArrayBuffer(r){for(var t=r.length,e=new ArrayBuffer(t),n=new Uint8Array(e),s=-1;++s<t;)n[s]=r.charCodeAt(s);return e}(function(r){if(r.TextEncoder&&r.TextDecoder)return!1;function t(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let a=0;const o=n.length;let l=0,c=Math.max(32,o+(o>>1)+7),h=new Uint8Array(c>>3<<3);for(;a<o;){let f=n.charCodeAt(a++);if(f>=55296&&f<=56319){if(a<o){const u=n.charCodeAt(a);(u&64512)===56320&&(++a,f=((f&1023)<<10)+(u&1023)+65536)}if(f>=55296&&f<=56319)continue}if(l+4>h.length){c+=8,c*=1+a/n.length*2,c=c>>3<<3;const u=new Uint8Array(c);u.set(h),h=u}if(f&4294967168)if(!(f&4294965248))h[l++]=f>>6&31|192;else if(!(f&4294901760))h[l++]=f>>12&15|224,h[l++]=f>>6&63|128;else if(!(f&4292870144))h[l++]=f>>18&7|240,h[l++]=f>>12&63|128,h[l++]=f>>6&63|128;else continue;else{h[l++]=f;continue}h[l++]=f&63|128}return h.slice(0,l)};function e(n="utf-8",s={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(e.prototype,"fatal",{value:!1}),Object.defineProperty(e.prototype,"ignoreBOM",{value:!1}),e.prototype.decode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const a=new Uint8Array(n);let o=0;const l=a.length,c=[];for(;o<l;){const h=a[o++];if(h===0)break;if(!(h&128))c.push(h);else if((h&224)===192){const f=a[o++]&63;c.push((h&31)<<6|f)}else if((h&240)===224){const f=a[o++]&63,u=a[o++]&63;c.push((h&31)<<12|f<<6|u)}else if((h&248)===240){const f=a[o++]&63,u=a[o++]&63,d=a[o++]&63;let g=(h&7)<<18|f<<12|u<<6|d;g>65535&&(g-=65536,c.push(g>>>10&1023|55296),g=56320|g&1023),c.push(g)}}return String.fromCharCode.apply(null,c)},r.TextEncoder=t,r.TextDecoder=e})(typeof window<"u"?window:typeof self<"u"?self:void 0);function decode$5(r,t="utf8"){return new TextDecoder(t).decode(r)}const encoder$1=new TextEncoder;function encode$3(r){return encoder$1.encode(r)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const r=new Uint8Array(4),t=new Uint32Array(r.buffer);return!((t[0]=1)&r[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class dt{constructor(t=defaultByteLength$1,e={}){let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const s=e.offset?e.offset>>>0:0,a=t.byteLength-s;let o=s;(ArrayBuffer.isView(t)||t instanceof dt)&&(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+s),t=t.buffer),n?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,a),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const n=typedArrays[e].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,a=this.buffer.slice(s,s+n);if(this.littleEndian===hostBigEndian&&e!=="uint8"&&e!=="int8"){const l=new Uint8Array(this.buffer.slice(s,s+n));l.reverse();const c=new typedArrays[e](l.buffer);return this.offset+=n,c.reverse(),c}const o=new typedArrays[e](a);return this.offset+=n,o}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let n=0;n<t;n++)e+=this.readChar();return e}readUtf8(t=1){return decode$5(this.readBytes(t))}decodeText(t=1,e="utf-8"){return decode$5(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(encode$3(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$5=getAugmentedNamespace(IOBuffer$5);var constants$4={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$5,constants$3=constants$4,tableLeft=[];for(let r=0;r<=8;r++)tableLeft.push(255<<r);class BMPEncoder extends IOBuffer$3{constructor(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const e=Math.floor((this.bitDepth*this.width+31)/32)*4,n=Math.ceil(this.bitDepth*this.width/8),s=e-n,a=this.bitDepth*this.width%8,o=a===0?0:8-a,l=e*this.height;let c,h,f=0,u=0,d=8;t.mark(),h=this.readUint8();for(let g=this.height-1;g>=0;g--){const p=g===0;t.reset(),t.skip(g*e);for(let x=0;x<n;x++){const y=x===n-1;u<=o&&y?(t.writeByte(h<<u),(o===0||o===u)&&!p&&(c=h,h=this.readByte())):u===0?(c=h,h=this.readUint8(),t.writeByte(c)):(c=h,h=this.readUint8(),t.writeByte(c<<u&tableLeft[u]|h>>d)),y&&(f+=a||0,t.skip(s),u=f%8,d=8-u)}}e>n&&(t.reset(),t.skip(l-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const e=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$3.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(e).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$3.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$3.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$2=function(t){return new Encoder(t).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(r){let t=r.length;for(;--t>=0;)r[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(r,t,e,n,s){this.static_tree=r,this.extra_bits=t,this.extra_base=e,this.elems=n,this.max_length=s,this.has_stree=r&&r.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(r,t){this.dyn_tree=r,this.max_code=0,this.stat_desc=t}const d_code=r=>r<256?_dist_code[r]:_dist_code[256+(r>>>7)],put_short=(r,t)=>{r.pending_buf[r.pending++]=t&255,r.pending_buf[r.pending++]=t>>>8&255},send_bits=(r,t,e)=>{r.bi_valid>Buf_size-e?(r.bi_buf|=t<<r.bi_valid&65535,put_short(r,r.bi_buf),r.bi_buf=t>>Buf_size-r.bi_valid,r.bi_valid+=e-Buf_size):(r.bi_buf|=t<<r.bi_valid&65535,r.bi_valid+=e)},send_code=(r,t,e)=>{send_bits(r,e[t*2],e[t*2+1])},bi_reverse=(r,t)=>{let e=0;do e|=r&1,r>>>=1,e<<=1;while(--t>0);return e>>>1},bi_flush=r=>{r.bi_valid===16?(put_short(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},gen_bitlen=(r,t)=>{const e=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let h,f,u,d,g,p,x=0;for(d=0;d<=MAX_BITS$1;d++)r.bl_count[d]=0;for(e[r.heap[r.heap_max]*2+1]=0,h=r.heap_max+1;h<HEAP_SIZE$1;h++)f=r.heap[h],d=e[e[f*2+1]*2+1]+1,d>c&&(d=c,x++),e[f*2+1]=d,!(f>n)&&(r.bl_count[d]++,g=0,f>=l&&(g=o[f-l]),p=e[f*2],r.opt_len+=p*(d+g),a&&(r.static_len+=p*(s[f*2+1]+g)));if(x!==0){do{for(d=c-1;r.bl_count[d]===0;)d--;r.bl_count[d]--,r.bl_count[d+1]+=2,r.bl_count[c]--,x-=2}while(x>0);for(d=c;d!==0;d--)for(f=r.bl_count[d];f!==0;)u=r.heap[--h],!(u>n)&&(e[u*2+1]!==d&&(r.opt_len+=(d-e[u*2+1])*e[u*2],e[u*2+1]=d),f--)}},gen_codes=(r,t,e)=>{const n=new Array(MAX_BITS$1+1);let s=0,a,o;for(a=1;a<=MAX_BITS$1;a++)s=s+e[a-1]<<1,n[a]=s;for(o=0;o<=t;o++){let l=r[o*2+1];l!==0&&(r[o*2]=bi_reverse(n[l]++,l))}},tr_static_init=()=>{let r,t,e,n,s;const a=new Array(MAX_BITS$1+1);for(e=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=e,r=0;r<1<<extra_lbits[n];r++)_length_code[e++]=n;for(_length_code[e-1]=n,s=0,n=0;n<16;n++)for(base_dist[n]=s,r=0;r<1<<extra_dbits[n];r++)_dist_code[s++]=n;for(s>>=7;n<D_CODES$1;n++)for(base_dist[n]=s<<7,r=0;r<1<<extra_dbits[n]-7;r++)_dist_code[256+s++]=n;for(t=0;t<=MAX_BITS$1;t++)a[t]=0;for(r=0;r<=143;)static_ltree[r*2+1]=8,r++,a[8]++;for(;r<=255;)static_ltree[r*2+1]=9,r++,a[9]++;for(;r<=279;)static_ltree[r*2+1]=7,r++,a[7]++;for(;r<=287;)static_ltree[r*2+1]=8,r++,a[8]++;for(gen_codes(static_ltree,L_CODES$1+1,a),r=0;r<D_CODES$1;r++)static_dtree[r*2+1]=5,static_dtree[r*2]=bi_reverse(r,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=r=>{let t;for(t=0;t<L_CODES$1;t++)r.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)r.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)r.bl_tree[t*2]=0;r.dyn_ltree[END_BLOCK*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},bi_windup=r=>{r.bi_valid>8?put_short(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},smaller=(r,t,e,n)=>{const s=t*2,a=e*2;return r[s]<r[a]||r[s]===r[a]&&n[t]<=n[e]},pqdownheap=(r,t,e)=>{const n=r.heap[e];let s=e<<1;for(;s<=r.heap_len&&(s<r.heap_len&&smaller(t,r.heap[s+1],r.heap[s],r.depth)&&s++,!smaller(t,n,r.heap[s],r.depth));)r.heap[e]=r.heap[s],e=s,s<<=1;r.heap[e]=n},compress_block=(r,t,e)=>{let n,s,a=0,o,l;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+a++]&255,n+=(r.pending_buf[r.sym_buf+a++]&255)<<8,s=r.pending_buf[r.sym_buf+a++],n===0?send_code(r,s,t):(o=_length_code[s],send_code(r,o+LITERALS$1+1,t),l=extra_lbits[o],l!==0&&(s-=base_length[o],send_bits(r,s,l)),n--,o=d_code(n),send_code(r,o,e),l=extra_dbits[o],l!==0&&(n-=base_dist[o],send_bits(r,n,l)));while(a<r.sym_next);send_code(r,END_BLOCK,t)},build_tree=(r,t)=>{const e=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,a=t.stat_desc.elems;let o,l,c=-1,h;for(r.heap_len=0,r.heap_max=HEAP_SIZE$1,o=0;o<a;o++)e[o*2]!==0?(r.heap[++r.heap_len]=c=o,r.depth[o]=0):e[o*2+1]=0;for(;r.heap_len<2;)h=r.heap[++r.heap_len]=c<2?++c:0,e[h*2]=1,r.depth[h]=0,r.opt_len--,s&&(r.static_len-=n[h*2+1]);for(t.max_code=c,o=r.heap_len>>1;o>=1;o--)pqdownheap(r,e,o);h=a;do o=r.heap[1],r.heap[1]=r.heap[r.heap_len--],pqdownheap(r,e,1),l=r.heap[1],r.heap[--r.heap_max]=o,r.heap[--r.heap_max]=l,e[h*2]=e[o*2]+e[l*2],r.depth[h]=(r.depth[o]>=r.depth[l]?r.depth[o]:r.depth[l])+1,e[o*2+1]=e[l*2+1]=h,r.heap[1]=h++,pqdownheap(r,e,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],gen_bitlen(r,t),gen_codes(e,c,r.bl_count)},scan_tree=(r,t,e)=>{let n,s=-1,a,o=t[0*2+1],l=0,c=7,h=4;for(o===0&&(c=138,h=3),t[(e+1)*2+1]=65535,n=0;n<=e;n++)a=o,o=t[(n+1)*2+1],!(++l<c&&a===o)&&(l<h?r.bl_tree[a*2]+=l:a!==0?(a!==s&&r.bl_tree[a*2]++,r.bl_tree[REP_3_6*2]++):l<=10?r.bl_tree[REPZ_3_10*2]++:r.bl_tree[REPZ_11_138*2]++,l=0,s=a,o===0?(c=138,h=3):a===o?(c=6,h=3):(c=7,h=4))},send_tree=(r,t,e)=>{let n,s=-1,a,o=t[0*2+1],l=0,c=7,h=4;for(o===0&&(c=138,h=3),n=0;n<=e;n++)if(a=o,o=t[(n+1)*2+1],!(++l<c&&a===o)){if(l<h)do send_code(r,a,r.bl_tree);while(--l!==0);else a!==0?(a!==s&&(send_code(r,a,r.bl_tree),l--),send_code(r,REP_3_6,r.bl_tree),send_bits(r,l-3,2)):l<=10?(send_code(r,REPZ_3_10,r.bl_tree),send_bits(r,l-3,3)):(send_code(r,REPZ_11_138,r.bl_tree),send_bits(r,l-11,7));l=0,s=a,o===0?(c=138,h=3):a===o?(c=6,h=3):(c=7,h=4)}},build_bl_tree=r=>{let t;for(scan_tree(r,r.dyn_ltree,r.l_desc.max_code),scan_tree(r,r.dyn_dtree,r.d_desc.max_code),build_tree(r,r.bl_desc),t=BL_CODES$1-1;t>=3&&r.bl_tree[bl_order[t]*2+1]===0;t--);return r.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(r,t,e,n)=>{let s;for(send_bits(r,t-257,5),send_bits(r,e-1,5),send_bits(r,n-4,4),s=0;s<n;s++)send_bits(r,r.bl_tree[bl_order[s]*2+1],3);send_tree(r,r.dyn_ltree,t-1),send_tree(r,r.dyn_dtree,e-1)},detect_data_type=r=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&r.dyn_ltree[e*2]!==0)return Z_BINARY;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return Z_TEXT;for(e=32;e<LITERALS$1;e++)if(r.dyn_ltree[e*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=r=>{static_init_done||(tr_static_init(),static_init_done=!0),r.l_desc=new TreeDesc(r.dyn_ltree,static_l_desc),r.d_desc=new TreeDesc(r.dyn_dtree,static_d_desc),r.bl_desc=new TreeDesc(r.bl_tree,static_bl_desc),r.bi_buf=0,r.bi_valid=0,init_block(r)},_tr_stored_block$1=(r,t,e,n)=>{send_bits(r,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(r),put_short(r,e),put_short(r,~e),e&&r.pending_buf.set(r.window.subarray(t,t+e),r.pending),r.pending+=e},_tr_align$1=r=>{send_bits(r,STATIC_TREES<<1,3),send_code(r,END_BLOCK,static_ltree),bi_flush(r)},_tr_flush_block$1=(r,t,e,n)=>{let s,a,o=0;r.level>0?(r.strm.data_type===Z_UNKNOWN$1&&(r.strm.data_type=detect_data_type(r)),build_tree(r,r.l_desc),build_tree(r,r.d_desc),o=build_bl_tree(r),s=r.opt_len+3+7>>>3,a=r.static_len+3+7>>>3,a<=s&&(s=a)):s=a=e+5,e+4<=s&&t!==-1?_tr_stored_block$1(r,t,e,n):r.strategy===Z_FIXED$1||a===s?(send_bits(r,(STATIC_TREES<<1)+(n?1:0),3),compress_block(r,static_ltree,static_dtree)):(send_bits(r,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(r,r.l_desc.max_code+1,r.d_desc.max_code+1,o+1),compress_block(r,r.dyn_ltree,r.dyn_dtree)),init_block(r),n&&bi_windup(r)},_tr_tally$1=(r,t,e)=>(r.pending_buf[r.sym_buf+r.sym_next++]=t,r.pending_buf[r.sym_buf+r.sym_next++]=t>>8,r.pending_buf[r.sym_buf+r.sym_next++]=e,t===0?r.dyn_ltree[e*2]++:(r.matches++,t--,r.dyn_ltree[(_length_code[e]+LITERALS$1+1)*2]++,r.dyn_dtree[d_code(t)*2]++),r.sym_next===r.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(r,t,e,n)=>{let s=r&65535|0,a=r>>>16&65535|0,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do s=s+t[n++]|0,a=a+s|0;while(--o);s%=65521,a%=65521}return s|a<<16|0};var adler32_1=adler32;const makeTable=()=>{let r,t=[];for(var e=0;e<256;e++){r=e;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;t[e]=r}return t},crcTable$1=new Uint32Array(makeTable()),crc32=(r,t,e,n)=>{const s=crcTable$1,a=n+e;r^=-1;for(let o=n;o<a;o++)r=r>>>8^s[(r^t[o])&255];return r^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(r,t)=>(r.msg=messages[t],t),rank=r=>r*2-(r>4?9:0),zero=r=>{let t=r.length;for(;--t>=0;)r[t]=0},slide_hash=r=>{let t,e,n,s=r.w_size;t=r.hash_size,n=t;do e=r.head[--n],r.head[n]=e>=s?e-s:0;while(--t);t=s,n=t;do e=r.prev[--n],r.prev[n]=e>=s?e-s:0;while(--t)};let HASH_ZLIB=(r,t,e)=>(t<<r.hash_shift^e)&r.hash_mask,HASH=HASH_ZLIB;const flush_pending=r=>{const t=r.state;let e=t.pending;e>r.avail_out&&(e=r.avail_out),e!==0&&(r.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),r.next_out),r.next_out+=e,t.pending_out+=e,r.total_out+=e,r.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},flush_block_only=(r,t)=>{_tr_flush_block(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,t),r.block_start=r.strstart,flush_pending(r.strm)},put_byte=(r,t)=>{r.pending_buf[r.pending++]=t},putShortMSB=(r,t)=>{r.pending_buf[r.pending++]=t>>>8&255,r.pending_buf[r.pending++]=t&255},read_buf=(r,t,e,n)=>{let s=r.avail_in;return s>n&&(s=n),s===0?0:(r.avail_in-=s,t.set(r.input.subarray(r.next_in,r.next_in+s),e),r.state.wrap===1?r.adler=adler32_1(r.adler,t,s,e):r.state.wrap===2&&(r.adler=crc32_1(r.adler,t,s,e)),r.next_in+=s,r.total_in+=s,s)},longest_match=(r,t)=>{let e=r.max_chain_length,n=r.strstart,s,a,o=r.prev_length,l=r.nice_match;const c=r.strstart>r.w_size-MIN_LOOKAHEAD?r.strstart-(r.w_size-MIN_LOOKAHEAD):0,h=r.window,f=r.w_mask,u=r.prev,d=r.strstart+MAX_MATCH;let g=h[n+o-1],p=h[n+o];r.prev_length>=r.good_match&&(e>>=2),l>r.lookahead&&(l=r.lookahead);do if(s=t,!(h[s+o]!==p||h[s+o-1]!==g||h[s]!==h[n]||h[++s]!==h[n+1])){n+=2,s++;do;while(h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&n<d);if(a=MAX_MATCH-(d-n),n=d-MAX_MATCH,a>o){if(r.match_start=t,o=a,a>=l)break;g=h[n+o-1],p=h[n+o]}}while((t=u[t&f])>c&&--e!==0);return o<=r.lookahead?o:r.lookahead},fill_window=r=>{const t=r.w_size;let e,n,s;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=t+(t-MIN_LOOKAHEAD)&&(r.window.set(r.window.subarray(t,t+t-n),0),r.match_start-=t,r.strstart-=t,r.block_start-=t,r.insert>r.strstart&&(r.insert=r.strstart),slide_hash(r),n+=t),r.strm.avail_in===0)break;if(e=read_buf(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=e,r.lookahead+r.insert>=MIN_MATCH)for(s=r.strstart-r.insert,r.ins_h=r.window[s],r.ins_h=HASH(r,r.ins_h,r.window[s+1]);r.insert&&(r.ins_h=HASH(r,r.ins_h,r.window[s+MIN_MATCH-1]),r.prev[s&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=s,s++,r.insert--,!(r.lookahead+r.insert<MIN_MATCH)););}while(r.lookahead<MIN_LOOKAHEAD&&r.strm.avail_in!==0)},deflate_stored=(r,t)=>{let e=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,s,a,o=0,l=r.strm.avail_in;do{if(n=65535,a=r.bi_valid+42>>3,r.strm.avail_out<a||(a=r.strm.avail_out-a,s=r.strstart-r.block_start,n>s+r.strm.avail_in&&(n=s+r.strm.avail_in),n>a&&(n=a),n<e&&(n===0&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||n!==s+r.strm.avail_in)))break;o=t===Z_FINISH$3&&n===s+r.strm.avail_in?1:0,_tr_stored_block(r,0,0,o),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,flush_pending(r.strm),s&&(s>n&&(s=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+s),r.strm.next_out),r.strm.next_out+=s,r.strm.avail_out-=s,r.strm.total_out+=s,r.block_start+=s,n-=s),n&&(read_buf(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(o===0);return l-=r.strm.avail_in,l&&(l>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=l&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-l,r.strm.next_in),r.strstart),r.strstart+=l,r.insert+=l>r.w_size-r.insert?r.w_size-r.insert:l),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),o?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&r.strm.avail_in===0&&r.strstart===r.block_start?BS_BLOCK_DONE:(a=r.window_size-r.strstart,r.strm.avail_in>a&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,a+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),a>r.strm.avail_in&&(a=r.strm.avail_in),a&&(read_buf(r.strm,r.window,r.strstart,a),r.strstart+=a,r.insert+=a>r.w_size-r.insert?r.w_size-r.insert:a),r.high_water<r.strstart&&(r.high_water=r.strstart),a=r.bi_valid+42>>3,a=r.pending_buf_size-a>65535?65535:r.pending_buf_size-a,e=a>r.w_size?r.w_size:a,s=r.strstart-r.block_start,(s>=e||(s||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&r.strm.avail_in===0&&s<=a)&&(n=s>a?a:s,o=t===Z_FINISH$3&&r.strm.avail_in===0&&n===s?1:0,_tr_stored_block(r,r.block_start,n,o),r.block_start+=n,flush_pending(r.strm)),o?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(r,t)=>{let e,n;for(;;){if(r.lookahead<MIN_LOOKAHEAD){if(fill_window(r),r.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(e=0,r.lookahead>=MIN_MATCH&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),e!==0&&r.strstart-e<=r.w_size-MIN_LOOKAHEAD&&(r.match_length=longest_match(r,e)),r.match_length>=MIN_MATCH)if(n=_tr_tally(r,r.strstart-r.match_start,r.match_length-MIN_MATCH),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=MIN_MATCH){r.match_length--;do r.strstart++,r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+1]);else n=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=r.strstart<MIN_MATCH-1?r.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(r,t)=>{let e,n,s;for(;;){if(r.lookahead<MIN_LOOKAHEAD){if(fill_window(r),r.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(e=0,r.lookahead>=MIN_MATCH&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=MIN_MATCH-1,e!==0&&r.prev_length<r.max_lazy_match&&r.strstart-e<=r.w_size-MIN_LOOKAHEAD&&(r.match_length=longest_match(r,e),r.match_length<=5&&(r.strategy===Z_FILTERED||r.match_length===MIN_MATCH&&r.strstart-r.match_start>4096)&&(r.match_length=MIN_MATCH-1)),r.prev_length>=MIN_MATCH&&r.match_length<=r.prev_length){s=r.strstart+r.lookahead-MIN_MATCH,n=_tr_tally(r,r.strstart-1-r.prev_match,r.prev_length-MIN_MATCH),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=s&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=MIN_MATCH-1,r.strstart++,n&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}else if(r.match_available){if(n=_tr_tally(r,0,r.window[r.strstart-1]),n&&flush_block_only(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return BS_NEED_MORE}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=_tr_tally(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<MIN_MATCH-1?r.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(r,t)=>{let e,n,s,a;const o=r.window;for(;;){if(r.lookahead<=MAX_MATCH){if(fill_window(r),r.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=MIN_MATCH&&r.strstart>0&&(s=r.strstart-1,n=o[s],n===o[++s]&&n===o[++s]&&n===o[++s])){a=r.strstart+MAX_MATCH;do;while(n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&s<a);r.match_length=MAX_MATCH-(a-s),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=MIN_MATCH?(e=_tr_tally(r,1,r.match_length-MIN_MATCH),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(e=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),e&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=0,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(r,t)=>{let e;for(;;){if(r.lookahead===0&&(fill_window(r),r.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(r.match_length=0,e=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,e&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=0,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(r,t,e,n,s){this.good_length=r,this.max_lazy=t,this.nice_length=e,this.max_chain=n,this.func=s}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=r=>{r.window_size=2*r.w_size,zero(r.head),r.max_lazy_match=configuration_table[r.level].max_lazy,r.good_match=configuration_table[r.level].good_length,r.nice_match=configuration_table[r.level].nice_length,r.max_chain_length=configuration_table[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,r.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=r=>{if(!r)return 1;const t=r.state;return!t||t.strm!==r||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=r=>{if(deflateStateCheck(r))return err(r,Z_STREAM_ERROR$2);r.total_in=r.total_out=0,r.data_type=Z_UNKNOWN;const t=r.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,r.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=r=>{const t=deflateResetKeep(r);return t===Z_OK$3&&lm_init(r.state),t},deflateSetHeader=(r,t)=>deflateStateCheck(r)||r.state.wrap!==2?Z_STREAM_ERROR$2:(r.state.gzhead=t,Z_OK$3),deflateInit2=(r,t,e,n,s,a)=>{if(!r)return Z_STREAM_ERROR$2;let o=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>MAX_MEM_LEVEL||e!==Z_DEFLATED$2||n<8||n>15||t<0||t>9||a<0||a>Z_FIXED||n===8&&o!==1)return err(r,Z_STREAM_ERROR$2);n===8&&(n=9);const l=new DeflateState;return r.state=l,l.strm=r,l.status=INIT_STATE,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+MIN_MATCH-1)/MIN_MATCH),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=t,l.strategy=a,l.method=e,deflateReset(r)},deflateInit=(r,t)=>deflateInit2(r,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(r,t)=>{if(deflateStateCheck(r)||t>Z_BLOCK$1||t<0)return r?err(r,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const e=r.state;if(!r.output||r.avail_in!==0&&!r.input||e.status===FINISH_STATE&&t!==Z_FINISH$3)return err(r,r.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=e.last_flush;if(e.last_flush=t,e.pending!==0){if(flush_pending(r),r.avail_out===0)return e.last_flush=-1,Z_OK$3}else if(r.avail_in===0&&rank(t)<=rank(n)&&t!==Z_FINISH$3)return err(r,Z_BUF_ERROR$1);if(e.status===FINISH_STATE&&r.avail_in!==0)return err(r,Z_BUF_ERROR$1);if(e.status===INIT_STATE&&e.wrap===0&&(e.status=BUSY_STATE),e.status===INIT_STATE){let s=Z_DEFLATED$2+(e.w_bits-8<<4)<<8,a=-1;if(e.strategy>=Z_HUFFMAN_ONLY||e.level<2?a=0:e.level<6?a=1:e.level===6?a=2:a=3,s|=a<<6,e.strstart!==0&&(s|=PRESET_DICT),s+=31-s%31,putShortMSB(e,s),e.strstart!==0&&(putShortMSB(e,r.adler>>>16),putShortMSB(e,r.adler&65535)),r.adler=1,e.status=BUSY_STATE,flush_pending(r),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(e.status===GZIP_STATE){if(r.adler=0,put_byte(e,31),put_byte(e,139),put_byte(e,8),e.gzhead)put_byte(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),put_byte(e,e.gzhead.time&255),put_byte(e,e.gzhead.time>>8&255),put_byte(e,e.gzhead.time>>16&255),put_byte(e,e.gzhead.time>>24&255),put_byte(e,e.level===9?2:e.strategy>=Z_HUFFMAN_ONLY||e.level<2?4:0),put_byte(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(put_byte(e,e.gzhead.extra.length&255),put_byte(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(r.adler=crc32_1(r.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=EXTRA_STATE;else if(put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,e.level===9?2:e.strategy>=Z_HUFFMAN_ONLY||e.level<2?4:0),put_byte(e,OS_CODE),e.status=BUSY_STATE,flush_pending(r),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(e.status===EXTRA_STATE){if(e.gzhead.extra){let s=e.pending,a=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+a>e.pending_buf_size;){let l=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+l),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(r.adler=crc32_1(r.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=l,flush_pending(r),e.pending!==0)return e.last_flush=-1,Z_OK$3;s=0,a-=l}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending+=a,e.gzhead.hcrc&&e.pending>s&&(r.adler=crc32_1(r.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=NAME_STATE}if(e.status===NAME_STATE){if(e.gzhead.name){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(r.adler=crc32_1(r.adler,e.pending_buf,e.pending-s,s)),flush_pending(r),e.pending!==0)return e.last_flush=-1,Z_OK$3;s=0}e.gzindex<e.gzhead.name.length?a=e.gzhead.name.charCodeAt(e.gzindex++)&255:a=0,put_byte(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(r.adler=crc32_1(r.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=COMMENT_STATE}if(e.status===COMMENT_STATE){if(e.gzhead.comment){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(r.adler=crc32_1(r.adler,e.pending_buf,e.pending-s,s)),flush_pending(r),e.pending!==0)return e.last_flush=-1,Z_OK$3;s=0}e.gzindex<e.gzhead.comment.length?a=e.gzhead.comment.charCodeAt(e.gzindex++)&255:a=0,put_byte(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(r.adler=crc32_1(r.adler,e.pending_buf,e.pending-s,s))}e.status=HCRC_STATE}if(e.status===HCRC_STATE){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(flush_pending(r),e.pending!==0))return e.last_flush=-1,Z_OK$3;put_byte(e,r.adler&255),put_byte(e,r.adler>>8&255),r.adler=0}if(e.status=BUSY_STATE,flush_pending(r),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(r.avail_in!==0||e.lookahead!==0||t!==Z_NO_FLUSH$2&&e.status!==FINISH_STATE){let s=e.level===0?deflate_stored(e,t):e.strategy===Z_HUFFMAN_ONLY?deflate_huff(e,t):e.strategy===Z_RLE?deflate_rle(e,t):configuration_table[e.level].func(e,t);if((s===BS_FINISH_STARTED||s===BS_FINISH_DONE)&&(e.status=FINISH_STATE),s===BS_NEED_MORE||s===BS_FINISH_STARTED)return r.avail_out===0&&(e.last_flush=-1),Z_OK$3;if(s===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(e):t!==Z_BLOCK$1&&(_tr_stored_block(e,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),flush_pending(r),r.avail_out===0))return e.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:e.wrap<=0?Z_STREAM_END$3:(e.wrap===2?(put_byte(e,r.adler&255),put_byte(e,r.adler>>8&255),put_byte(e,r.adler>>16&255),put_byte(e,r.adler>>24&255),put_byte(e,r.total_in&255),put_byte(e,r.total_in>>8&255),put_byte(e,r.total_in>>16&255),put_byte(e,r.total_in>>24&255)):(putShortMSB(e,r.adler>>>16),putShortMSB(e,r.adler&65535)),flush_pending(r),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=r=>{if(deflateStateCheck(r))return Z_STREAM_ERROR$2;const t=r.state.status;return r.state=null,t===BUSY_STATE?err(r,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(r,t)=>{let e=t.length;if(deflateStateCheck(r))return Z_STREAM_ERROR$2;const n=r.state,s=n.wrap;if(s===2||s===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(s===1&&(r.adler=adler32_1(r.adler,t,e,0)),n.wrap=0,e>=n.w_size){s===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(t.subarray(e-n.w_size,e),0),t=c,e=n.w_size}const a=r.avail_in,o=r.next_in,l=r.input;for(r.avail_in=e,r.next_in=0,r.input=t,fill_window(n);n.lookahead>=MIN_MATCH;){let c=n.strstart,h=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[c+MIN_MATCH-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--h);n.strstart=c,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,r.next_in=o,r.input=l,r.avail_in=a,n.wrap=s,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);var assign=function(r){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)_has(e,n)&&(r[n]=e[n])}}return r},flattenChunks=r=>{let t=0;for(let n=0,s=r.length;n<s;n++)t+=r[n].length;const e=new Uint8Array(t);for(let n=0,s=0,a=r.length;n<a;n++){let o=r[n];e.set(o,s),s+=o.length}return e},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let r=0;r<256;r++)_utf8len[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let t,e,n,s,a,o=r.length,l=0;for(s=0;s<o;s++)e=r.charCodeAt(s),(e&64512)===55296&&s+1<o&&(n=r.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(l),a=0,s=0;a<l;s++)e=r.charCodeAt(s),(e&64512)===55296&&s+1<o&&(n=r.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),e<128?t[a++]=e:e<2048?(t[a++]=192|e>>>6,t[a++]=128|e&63):e<65536?(t[a++]=224|e>>>12,t[a++]=128|e>>>6&63,t[a++]=128|e&63):(t[a++]=240|e>>>18,t[a++]=128|e>>>12&63,t[a++]=128|e>>>6&63,t[a++]=128|e&63);return t};const buf2binstring=(r,t)=>{if(t<65534&&r.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,r.length===t?r:r.subarray(0,t));let e="";for(let n=0;n<t;n++)e+=String.fromCharCode(r[n]);return e};var buf2string=(r,t)=>{const e=t||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,t));let n,s;const a=new Array(e*2);for(s=0,n=0;n<e;){let o=r[n++];if(o<128){a[s++]=o;continue}let l=_utf8len[o];if(l>4){a[s++]=65533,n+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&n<e;)o=o<<6|r[n++]&63,l--;if(l>1){a[s++]=65533;continue}o<65536?a[s++]=o:(o-=65536,a[s++]=55296|o>>10&1023,a[s++]=56320|o&1023)}return buf2binstring(a,s)},utf8border=(r,t)=>{t=t||r.length,t>r.length&&(t=r.length);let e=t-1;for(;e>=0&&(r[e]&192)===128;)e--;return e<0||e===0?t:e+_utf8len[r[e]]>t?e:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(r){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},r||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let e=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Z_OK$2)throw new Error(messages[e]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=strings.string2buf(t.dictionary):toString$1$1.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,e=deflate_1$2.deflateSetDictionary(this.strm,n),e!==Z_OK$2)throw new Error(messages[e]);this._dict_set=!0}}Deflate$1.prototype.push=function(r,t){const e=this.strm,n=this.options.chunkSize;let s,a;if(this.ended)return!1;for(t===~~t?a=t:a=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof r=="string"?e.input=strings.string2buf(r):toString$1$1.call(r)==="[object ArrayBuffer]"?e.input=new Uint8Array(r):e.input=r,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(a===Z_SYNC_FLUSH||a===Z_FULL_FLUSH)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(s=deflate_1$2.deflate(e,a),s===Z_STREAM_END$2)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=deflate_1$2.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Z_OK$2;if(e.avail_out===0){this.onData(e.output);continue}if(a>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(r){this.chunks.push(r)};Deflate$1.prototype.onEnd=function(r){r===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function deflate$1(r,t){const e=new Deflate$1(t);if(e.push(r,!0),e.err)throw e.msg||messages[e.err];return e.result}function deflateRaw$1(r,t){return t=t||{},t.raw=!0,deflate$1(r,t)}function gzip$1(r,t){return t=t||{},t.gzip=!0,deflate$1(r,t)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(t,e){let n,s,a,o,l,c,h,f,u,d,g,p,x,y,m,A,b,_,M,T,D,E,S,w;const v=t.state;n=t.next_in,S=t.input,s=n+(t.avail_in-5),a=t.next_out,w=t.output,o=a-(e-t.avail_out),l=a+(t.avail_out-257),c=v.dmax,h=v.wsize,f=v.whave,u=v.wnext,d=v.window,g=v.hold,p=v.bits,x=v.lencode,y=v.distcode,m=(1<<v.lenbits)-1,A=(1<<v.distbits)-1;e:do{p<15&&(g+=S[n++]<<p,p+=8,g+=S[n++]<<p,p+=8),b=x[g&m];t:for(;;){if(_=b>>>24,g>>>=_,p-=_,_=b>>>16&255,_===0)w[a++]=b&65535;else if(_&16){M=b&65535,_&=15,_&&(p<_&&(g+=S[n++]<<p,p+=8),M+=g&(1<<_)-1,g>>>=_,p-=_),p<15&&(g+=S[n++]<<p,p+=8,g+=S[n++]<<p,p+=8),b=y[g&A];r:for(;;){if(_=b>>>24,g>>>=_,p-=_,_=b>>>16&255,_&16){if(T=b&65535,_&=15,p<_&&(g+=S[n++]<<p,p+=8,p<_&&(g+=S[n++]<<p,p+=8)),T+=g&(1<<_)-1,T>c){t.msg="invalid distance too far back",v.mode=BAD$1;break e}if(g>>>=_,p-=_,_=a-o,T>_){if(_=T-_,_>f&&v.sane){t.msg="invalid distance too far back",v.mode=BAD$1;break e}if(D=0,E=d,u===0){if(D+=h-_,_<M){M-=_;do w[a++]=d[D++];while(--_);D=a-T,E=w}}else if(u<_){if(D+=h+u-_,_-=u,_<M){M-=_;do w[a++]=d[D++];while(--_);if(D=0,u<M){_=u,M-=_;do w[a++]=d[D++];while(--_);D=a-T,E=w}}}else if(D+=u-_,_<M){M-=_;do w[a++]=d[D++];while(--_);D=a-T,E=w}for(;M>2;)w[a++]=E[D++],w[a++]=E[D++],w[a++]=E[D++],M-=3;M&&(w[a++]=E[D++],M>1&&(w[a++]=E[D++]))}else{D=a-T;do w[a++]=w[D++],w[a++]=w[D++],w[a++]=w[D++],M-=3;while(M>2);M&&(w[a++]=w[D++],M>1&&(w[a++]=w[D++]))}}else if(_&64){t.msg="invalid distance code",v.mode=BAD$1;break e}else{b=y[(b&65535)+(g&(1<<_)-1)];continue r}break}}else if(_&64)if(_&32){v.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",v.mode=BAD$1;break e}else{b=x[(b&65535)+(g&(1<<_)-1)];continue t}break}}while(n<s&&a<l);M=p>>3,n-=M,p-=M<<3,g&=(1<<p)-1,t.next_in=n,t.next_out=a,t.avail_in=n<s?5+(s-n):5-(n-s),t.avail_out=a<l?257+(l-a):257-(a-l),v.hold=g,v.bits=p};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(r,t,e,n,s,a,o,l)=>{const c=l.bits;let h=0,f=0,u=0,d=0,g=0,p=0,x=0,y=0,m=0,A=0,b,_,M,T,D,E=null,S;const w=new Uint16Array(MAXBITS+1),v=new Uint16Array(MAXBITS+1);let k=null,I,L,F;for(h=0;h<=MAXBITS;h++)w[h]=0;for(f=0;f<n;f++)w[t[e+f]]++;for(g=c,d=MAXBITS;d>=1&&w[d]===0;d--);if(g>d&&(g=d),d===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,l.bits=1,0;for(u=1;u<d&&w[u]===0;u++);for(g<u&&(g=u),y=1,h=1;h<=MAXBITS;h++)if(y<<=1,y-=w[h],y<0)return-1;if(y>0&&(r===CODES$1||d!==1))return-1;for(v[1]=0,h=1;h<MAXBITS;h++)v[h+1]=v[h]+w[h];for(f=0;f<n;f++)t[e+f]!==0&&(o[v[t[e+f]]++]=f);if(r===CODES$1?(E=k=o,S=20):r===LENS$1?(E=lbase,k=lext,S=257):(E=dbase,k=dext,S=0),A=0,f=0,h=u,D=a,p=g,x=0,M=-1,m=1<<g,T=m-1,r===LENS$1&&m>ENOUGH_LENS$1||r===DISTS$1&&m>ENOUGH_DISTS$1)return 1;for(;;){I=h-x,o[f]+1<S?(L=0,F=o[f]):o[f]>=S?(L=k[o[f]-S],F=E[o[f]-S]):(L=96,F=0),b=1<<h-x,_=1<<p,u=_;do _-=b,s[D+(A>>x)+_]=I<<24|L<<16|F|0;while(_!==0);for(b=1<<h-1;A&b;)b>>=1;if(b!==0?(A&=b-1,A+=b):A=0,f++,--w[h]===0){if(h===d)break;h=t[e+o[f]]}if(h>g&&(A&T)!==M){for(x===0&&(x=g),D+=u,p=h-x,y=1<<p;p+x<d&&(y-=w[p+x],!(y<=0));)p++,y<<=1;if(m+=1<<p,r===LENS$1&&m>ENOUGH_LENS$1||r===DISTS$1&&m>ENOUGH_DISTS$1)return 1;M=A&T,s[M]=g<<24|p<<16|D-a|0}}return A!==0&&(s[D+A]=h-x<<24|64<<16|0),l.bits=g,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=r=>{if(!r)return 1;const t=r.state;return!t||t.strm!==r||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=r=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const t=r.state;return r.total_in=r.total_out=t.total=0,r.msg="",t.wrap&&(r.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=r=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const t=r.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(r)},inflateReset2=(r,t)=>{let e;if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const n=r.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=e,n.wbits=t,inflateReset(r))},inflateInit2=(r,t)=>{if(!r)return Z_STREAM_ERROR$1;const e=new InflateState;r.state=e,e.strm=r,e.window=null,e.mode=HEAD;const n=inflateReset2(r,t);return n!==Z_OK$1&&(r.state=null),n},inflateInit=r=>inflateInit2(r,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=r=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)r.lens[t++]=8;for(;t<256;)r.lens[t++]=9;for(;t<280;)r.lens[t++]=7;for(;t<288;)r.lens[t++]=8;for(inftrees(LENS,r.lens,0,288,lenfix,0,r.work,{bits:9}),t=0;t<32;)r.lens[t++]=5;inftrees(DISTS,r.lens,0,32,distfix,0,r.work,{bits:5}),virgin=!1}r.lencode=lenfix,r.lenbits=9,r.distcode=distfix,r.distbits=5},updatewindow=(r,t,e,n)=>{let s;const a=r.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>n&&(s=n),a.window.set(t.subarray(e-n,e-n+s),a.wnext),n-=s,n?(a.window.set(t.subarray(e-n,e),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},inflate$2=(r,t)=>{let e,n,s,a,o,l,c,h,f,u,d,g,p,x,y=0,m,A,b,_,M,T,D,E;const S=new Uint8Array(4);let w,v;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(r)||!r.output||!r.input&&r.avail_in!==0)return Z_STREAM_ERROR$1;e=r.state,e.mode===TYPE&&(e.mode=TYPEDO),o=r.next_out,s=r.output,c=r.avail_out,a=r.next_in,n=r.input,l=r.avail_in,h=e.hold,f=e.bits,u=l,d=c,E=Z_OK$1;e:for(;;)switch(e.mode){case HEAD:if(e.wrap===0){e.mode=TYPEDO;break}for(;f<16;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(e.wrap&2&&h===35615){e.wbits===0&&(e.wbits=15),e.check=0,S[0]=h&255,S[1]=h>>>8&255,e.check=crc32_1(e.check,S,2,0),h=0,f=0,e.mode=FLAGS;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((h&255)<<8)+(h>>8))%31){r.msg="incorrect header check",e.mode=BAD;break}if((h&15)!==Z_DEFLATED){r.msg="unknown compression method",e.mode=BAD;break}if(h>>>=4,f-=4,D=(h&15)+8,e.wbits===0&&(e.wbits=D),D>15||D>e.wbits){r.msg="invalid window size",e.mode=BAD;break}e.dmax=1<<e.wbits,e.flags=0,r.adler=e.check=1,e.mode=h&512?DICTID:TYPE,h=0,f=0;break;case FLAGS:for(;f<16;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(e.flags=h,(e.flags&255)!==Z_DEFLATED){r.msg="unknown compression method",e.mode=BAD;break}if(e.flags&57344){r.msg="unknown header flags set",e.mode=BAD;break}e.head&&(e.head.text=h>>8&1),e.flags&512&&e.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,e.check=crc32_1(e.check,S,2,0)),h=0,f=0,e.mode=TIME;case TIME:for(;f<32;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}e.head&&(e.head.time=h),e.flags&512&&e.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,S[2]=h>>>16&255,S[3]=h>>>24&255,e.check=crc32_1(e.check,S,4,0)),h=0,f=0,e.mode=OS;case OS:for(;f<16;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}e.head&&(e.head.xflags=h&255,e.head.os=h>>8),e.flags&512&&e.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,e.check=crc32_1(e.check,S,2,0)),h=0,f=0,e.mode=EXLEN;case EXLEN:if(e.flags&1024){for(;f<16;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}e.length=h,e.head&&(e.head.extra_len=h),e.flags&512&&e.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,e.check=crc32_1(e.check,S,2,0)),h=0,f=0}else e.head&&(e.head.extra=null);e.mode=EXTRA;case EXTRA:if(e.flags&1024&&(g=e.length,g>l&&(g=l),g&&(e.head&&(D=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(a,a+g),D)),e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,n,g,a)),l-=g,a+=g,e.length-=g),e.length))break e;e.length=0,e.mode=NAME;case NAME:if(e.flags&2048){if(l===0)break e;g=0;do D=n[a+g++],e.head&&D&&e.length<65536&&(e.head.name+=String.fromCharCode(D));while(D&&g<l);if(e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,n,g,a)),l-=g,a+=g,D)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=COMMENT;case COMMENT:if(e.flags&4096){if(l===0)break e;g=0;do D=n[a+g++],e.head&&D&&e.length<65536&&(e.head.comment+=String.fromCharCode(D));while(D&&g<l);if(e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,n,g,a)),l-=g,a+=g,D)break e}else e.head&&(e.head.comment=null);e.mode=HCRC;case HCRC:if(e.flags&512){for(;f<16;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(e.wrap&4&&h!==(e.check&65535)){r.msg="header crc mismatch",e.mode=BAD;break}h=0,f=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),r.adler=e.check=0,e.mode=TYPE;break;case DICTID:for(;f<32;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}r.adler=e.check=zswap32(h),h=0,f=0,e.mode=DICT;case DICT:if(e.havedict===0)return r.next_out=o,r.avail_out=c,r.next_in=a,r.avail_in=l,e.hold=h,e.bits=f,Z_NEED_DICT$1;r.adler=e.check=1,e.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(e.last){h>>>=f&7,f-=f&7,e.mode=CHECK;break}for(;f<3;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}switch(e.last=h&1,h>>>=1,f-=1,h&3){case 0:e.mode=STORED;break;case 1:if(fixedtables(e),e.mode=LEN_,t===Z_TREES){h>>>=2,f-=2;break e}break;case 2:e.mode=TABLE;break;case 3:r.msg="invalid block type",e.mode=BAD}h>>>=2,f-=2;break;case STORED:for(h>>>=f&7,f-=f&7;f<32;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if((h&65535)!==(h>>>16^65535)){r.msg="invalid stored block lengths",e.mode=BAD;break}if(e.length=h&65535,h=0,f=0,e.mode=COPY_,t===Z_TREES)break e;case COPY_:e.mode=COPY;case COPY:if(g=e.length,g){if(g>l&&(g=l),g>c&&(g=c),g===0)break e;s.set(n.subarray(a,a+g),o),l-=g,a+=g,c-=g,o+=g,e.length-=g;break}e.mode=TYPE;break;case TABLE:for(;f<14;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(e.nlen=(h&31)+257,h>>>=5,f-=5,e.ndist=(h&31)+1,h>>>=5,f-=5,e.ncode=(h&15)+4,h>>>=4,f-=4,e.nlen>286||e.ndist>30){r.msg="too many length or distance symbols",e.mode=BAD;break}e.have=0,e.mode=LENLENS;case LENLENS:for(;e.have<e.ncode;){for(;f<3;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}e.lens[k[e.have++]]=h&7,h>>>=3,f-=3}for(;e.have<19;)e.lens[k[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,w={bits:e.lenbits},E=inftrees(CODES,e.lens,0,19,e.lencode,0,e.work,w),e.lenbits=w.bits,E){r.msg="invalid code lengths set",e.mode=BAD;break}e.have=0,e.mode=CODELENS;case CODELENS:for(;e.have<e.nlen+e.ndist;){for(;y=e.lencode[h&(1<<e.lenbits)-1],m=y>>>24,A=y>>>16&255,b=y&65535,!(m<=f);){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(b<16)h>>>=m,f-=m,e.lens[e.have++]=b;else{if(b===16){for(v=m+2;f<v;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(h>>>=m,f-=m,e.have===0){r.msg="invalid bit length repeat",e.mode=BAD;break}D=e.lens[e.have-1],g=3+(h&3),h>>>=2,f-=2}else if(b===17){for(v=m+3;f<v;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}h>>>=m,f-=m,D=0,g=3+(h&7),h>>>=3,f-=3}else{for(v=m+7;f<v;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}h>>>=m,f-=m,D=0,g=11+(h&127),h>>>=7,f-=7}if(e.have+g>e.nlen+e.ndist){r.msg="invalid bit length repeat",e.mode=BAD;break}for(;g--;)e.lens[e.have++]=D}}if(e.mode===BAD)break;if(e.lens[256]===0){r.msg="invalid code -- missing end-of-block",e.mode=BAD;break}if(e.lenbits=9,w={bits:e.lenbits},E=inftrees(LENS,e.lens,0,e.nlen,e.lencode,0,e.work,w),e.lenbits=w.bits,E){r.msg="invalid literal/lengths set",e.mode=BAD;break}if(e.distbits=6,e.distcode=e.distdyn,w={bits:e.distbits},E=inftrees(DISTS,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,w),e.distbits=w.bits,E){r.msg="invalid distances set",e.mode=BAD;break}if(e.mode=LEN_,t===Z_TREES)break e;case LEN_:e.mode=LEN;case LEN:if(l>=6&&c>=258){r.next_out=o,r.avail_out=c,r.next_in=a,r.avail_in=l,e.hold=h,e.bits=f,inffast(r,d),o=r.next_out,s=r.output,c=r.avail_out,a=r.next_in,n=r.input,l=r.avail_in,h=e.hold,f=e.bits,e.mode===TYPE&&(e.back=-1);break}for(e.back=0;y=e.lencode[h&(1<<e.lenbits)-1],m=y>>>24,A=y>>>16&255,b=y&65535,!(m<=f);){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(A&&!(A&240)){for(_=m,M=A,T=b;y=e.lencode[T+((h&(1<<_+M)-1)>>_)],m=y>>>24,A=y>>>16&255,b=y&65535,!(_+m<=f);){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}h>>>=_,f-=_,e.back+=_}if(h>>>=m,f-=m,e.back+=m,e.length=b,A===0){e.mode=LIT;break}if(A&32){e.back=-1,e.mode=TYPE;break}if(A&64){r.msg="invalid literal/length code",e.mode=BAD;break}e.extra=A&15,e.mode=LENEXT;case LENEXT:if(e.extra){for(v=e.extra;f<v;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}e.length+=h&(1<<e.extra)-1,h>>>=e.extra,f-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=DIST;case DIST:for(;y=e.distcode[h&(1<<e.distbits)-1],m=y>>>24,A=y>>>16&255,b=y&65535,!(m<=f);){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(!(A&240)){for(_=m,M=A,T=b;y=e.distcode[T+((h&(1<<_+M)-1)>>_)],m=y>>>24,A=y>>>16&255,b=y&65535,!(_+m<=f);){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}h>>>=_,f-=_,e.back+=_}if(h>>>=m,f-=m,e.back+=m,A&64){r.msg="invalid distance code",e.mode=BAD;break}e.offset=b,e.extra=A&15,e.mode=DISTEXT;case DISTEXT:if(e.extra){for(v=e.extra;f<v;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}e.offset+=h&(1<<e.extra)-1,h>>>=e.extra,f-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){r.msg="invalid distance too far back",e.mode=BAD;break}e.mode=MATCH;case MATCH:if(c===0)break e;if(g=d-c,e.offset>g){if(g=e.offset-g,g>e.whave&&e.sane){r.msg="invalid distance too far back",e.mode=BAD;break}g>e.wnext?(g-=e.wnext,p=e.wsize-g):p=e.wnext-g,g>e.length&&(g=e.length),x=e.window}else x=s,p=o-e.offset,g=e.length;g>c&&(g=c),c-=g,e.length-=g;do s[o++]=x[p++];while(--g);e.length===0&&(e.mode=LEN);break;case LIT:if(c===0)break e;s[o++]=e.length,c--,e.mode=LEN;break;case CHECK:if(e.wrap){for(;f<32;){if(l===0)break e;l--,h|=n[a++]<<f,f+=8}if(d-=c,r.total_out+=d,e.total+=d,e.wrap&4&&d&&(r.adler=e.check=e.flags?crc32_1(e.check,s,d,o-d):adler32_1(e.check,s,d,o-d)),d=c,e.wrap&4&&(e.flags?h:zswap32(h))!==e.check){r.msg="incorrect data check",e.mode=BAD;break}h=0,f=0}e.mode=LENGTH;case LENGTH:if(e.wrap&&e.flags){for(;f<32;){if(l===0)break e;l--,h+=n[a++]<<f,f+=8}if(e.wrap&4&&h!==(e.total&4294967295)){r.msg="incorrect length check",e.mode=BAD;break}h=0,f=0}e.mode=DONE;case DONE:E=Z_STREAM_END$1;break e;case BAD:E=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return r.next_out=o,r.avail_out=c,r.next_in=a,r.avail_in=l,e.hold=h,e.bits=f,(e.wsize||d!==r.avail_out&&e.mode<BAD&&(e.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(r,r.output,r.next_out,d-r.avail_out),u-=r.avail_in,d-=r.avail_out,r.total_in+=u,r.total_out+=d,e.total+=d,e.wrap&4&&d&&(r.adler=e.check=e.flags?crc32_1(e.check,s,d,r.next_out-d):adler32_1(e.check,s,d,r.next_out-d)),r.data_type=e.bits+(e.last?64:0)+(e.mode===TYPE?128:0)+(e.mode===LEN_||e.mode===COPY_?256:0),(u===0&&d===0||t===Z_FINISH$1)&&E===Z_OK$1&&(E=Z_BUF_ERROR),E},inflateEnd=r=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;let t=r.state;return t.window&&(t.window=null),r.state=null,Z_OK$1},inflateGetHeader=(r,t)=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const e=r.state;return e.wrap&2?(e.head=t,t.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(r,t)=>{const e=t.length;let n,s,a;return inflateStateCheck(r)||(n=r.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(s=1,s=adler32_1(s,t,e,0),s!==n.check)?Z_DATA_ERROR$1:(a=updatewindow(r,t,e,e),a?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(r){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(r&&r.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let e=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(e!==Z_OK)throw new Error(messages[e]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString$2.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),e!==Z_OK)))throw new Error(messages[e])}Inflate$1.prototype.push=function(r,t){const e=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let a,o,l;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(r)==="[object ArrayBuffer]"?e.input=new Uint8Array(r):e.input=r,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),a=inflate_1$2.inflate(e,o),a===Z_NEED_DICT&&s&&(a=inflate_1$2.inflateSetDictionary(e,s),a===Z_OK?a=inflate_1$2.inflate(e,o):a===Z_DATA_ERROR&&(a=Z_NEED_DICT));e.avail_in>0&&a===Z_STREAM_END&&e.state.wrap>0&&r[e.next_in]!==0;)inflate_1$2.inflateReset(e),a=inflate_1$2.inflate(e,o);switch(a){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(a),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||a===Z_STREAM_END))if(this.options.to==="string"){let c=strings.utf8border(e.output,e.next_out),h=e.next_out-c,f=strings.buf2string(e.output,c);e.next_out=h,e.avail_out=n-h,h&&e.output.set(e.output.subarray(c,c+h),0),this.onData(f)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===Z_OK&&l===0)){if(a===Z_STREAM_END)return a=inflate_1$2.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(r){this.chunks.push(r)};Inflate$1.prototype.onEnd=function(r){r===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function inflate$1(r,t){const e=new Inflate$1(t);if(e.push(r),e.err)throw e.msg||messages[e.err];return e.result}function inflateRaw$1(r,t){return t=t||{},t.raw=!0,inflate$1(r,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let r=0;r<256;r++){let t=r;for(let e=0;e<8;e++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable[r]=t}const initialCrc=4294967295;function updateCrc(r,t,e){let n=r;for(let s=0;s<e;s++)n=crcTable[(n^t[s])&255]^n>>>8;return n}function crc(r,t){return(updateCrc(initialCrc,r,t)^initialCrc)>>>0}var ColorType;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.GREYSCALE=0]="GREYSCALE",r[r.TRUECOLOUR=2]="TRUECOLOUR",r[r.INDEXED_COLOUR=3]="INDEXED_COLOUR",r[r.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",r[r.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.NO_INTERLACE=0]="NO_INTERLACE",r[r.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(t,e={}){super(t);const{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=ColorType.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const s=this.readUint32(),a=t+4,o=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-a-4,a),a);if(o!==s)throw new Error(`CRC mismatch for chunk ${e}. Expected ${s}, found ${o}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const e=this.readUint8();this._colorType=e;let n;switch(e){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const e=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let s=0;s<e;s++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){switch(this._colorType){case ColorType.GREYSCALE:case ColorType.TRUECOLOUR:{if(t%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let e=0;e<t/2;e++)this._transparency[e]=this.readUint16();break}case ColorType.INDEXED_COLOUR:{if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const n=this.readByte();this._palette[e].push(n)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){let e="",n;for(;(n=this.readChar())!==NULL;)e+=n;const s=this.readUint8();if(s!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const a=this.readBytes(t-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:inflate_1(a)}}decodetEXt(t){let e="",n;for(;(n=this.readChar())!==NULL;)e+=n;this._png.text[e]=this.readChars(t-e.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:e,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const e=this._png.height,n=this._png.channels*this._png.depth/8,s=this._png.width*n,a=new Uint8Array(this._png.height*s);let o=empty,l=0,c,h;for(let f=0;f<e;f++){switch(c=t.subarray(l+1,l+1+s),h=a.subarray(f*s,(f+1)*s),t[l]){case 0:unfilterNone(c,h,s);break;case 1:unfilterSub(c,h,s,n);break;case 2:unfilterUp(c,h,o,s);break;case 3:unfilterAverage(c,h,o,s,n);break;case 4:unfilterPaeth(c,h,o,s,n);break;default:throw new Error(`Unsupported filter: ${t[l]}`)}o=h,l+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),this._png.depth===16){const f=new Uint16Array(a.buffer);if(osIsLittleEndian)for(let u=0;u<f.length;u++)f[u]=swap16(f[u]);this._png.data=f}else this._png.data=a}}function unfilterNone(r,t,e){for(let n=0;n<e;n++)t[n]=r[n]}function unfilterSub(r,t,e,n){let s=0;for(;s<n;s++)t[s]=r[s];for(;s<e;s++)t[s]=r[s]+t[s-n]&255}function unfilterUp(r,t,e,n){let s=0;if(e.length===0)for(;s<n;s++)t[s]=r[s];else for(;s<n;s++)t[s]=r[s]+e[s]&255}function unfilterAverage(r,t,e,n,s){let a=0;if(e.length===0){for(;a<s;a++)t[a]=r[a];for(;a<n;a++)t[a]=r[a]+(t[a-s]>>1)&255}else{for(;a<s;a++)t[a]=r[a]+(e[a]>>1)&255;for(;a<n;a++)t[a]=r[a]+(t[a-s]+e[a]>>1)&255}}function unfilterPaeth(r,t,e,n,s){let a=0;if(e.length===0){for(;a<s;a++)t[a]=r[a];for(;a<n;a++)t[a]=r[a]+t[a-s]&255}else{for(;a<s;a++)t[a]=r[a]+e[a]&255;for(;a<n;a++)t[a]=r[a]+paethPredictor(t[a-s],e[a],e[a-s])&255}}function paethPredictor(r,t,e){const n=r+t-e,s=Math.abs(n-r),a=Math.abs(n-t),o=Math.abs(n-e);return s<=a&&s<=o?r:a<=o?t:e}function swap16(r){return(r&255)<<8|r>>8&255}function checkBitDepth(r){if(r!==1&&r!==2&&r!==4&&r!==8&&r!==16)throw new Error(`invalid bit depth: ${r}`);return r}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(t,e={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions={...defaultZlibOptions,...e.zlib},this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:e,channels:n,depth:s,data:a}=this._png,o=n*t,l=new IOBuffer$4().setBigEndian();let c=0;for(let u=0;u<e;u++)if(l.writeByte(0),s===8)c=writeDataBytes(a,l,o,c);else if(s===16)c=writeDataUint16(a,l,o,c);else throw new Error("unreachable");const h=l.toArray(),f=deflate_1(h,this._zlibOptions);this.encodeIDAT(f)}_checkData(t){const{colorType:e,channels:n,depth:s}=getColorType(t),a={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:n,data:t.data,depth:s,text:{}};this._colorType=e;const o=a.width*a.height*n;if(a.data.length!==o)throw new RangeError(`wrong data size. Found ${a.data.length}, expected ${o}`);return a}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(r,t){if(Number.isInteger(r)&&r>0)return r;throw new TypeError(`${t} must be a positive integer`)}function getColorType(r){const{channels:t=4,depth:e=8}=r;if(t!==4&&t!==3&&t!==2&&t!==1)throw new RangeError(`unsupported number of channels: ${t}`);if(e!==8&&e!==16)throw new RangeError(`unsupported bit depth: ${e}`);const n={channels:t,depth:e,colorType:ColorType.UNKNOWN};switch(t){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(r,t,e,n){for(let s=0;s<e;s++)t.writeByte(r[n++]);return n}function writeDataUint16(r,t,e,n){for(let s=0;s<e;s++)t.writeUint16(r[n++]);return n}var ResolutionUnitSpecifier;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(r,t){return new PngDecoder(r,t).decode()}function encodePng$1(r,t){return new PngEncoder(r,t).encode()}var encoder={exports:{}};(function(r){function t(n){var s=Math.floor,a=new Array(64),o=new Array(64),l=new Array(64),c=new Array(64),h,f,u,d,g=new Array(65535),p=new Array(65535),x=new Array(64),y=new Array(64),m=[],A=0,b=7,_=new Array(64),M=new Array(64),T=new Array(64),D=new Array(256),E=new Array(2048),S,w=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],v=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],L=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],F=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Z=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],G=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function P(V){for(var oe=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],le=0;le<64;le++){var ce=s((oe[le]*V+50)/100);ce<1?ce=1:ce>255&&(ce=255),a[w[le]]=ce}for(var K=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Me=0;Me<64;Me++){var _e=s((K[Me]*V+50)/100);_e<1?_e=1:_e>255&&(_e=255),o[w[Me]]=_e}for(var te=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ne=0,fe=0;fe<8;fe++)for(var re=0;re<8;re++)l[ne]=1/(a[w[ne]]*te[fe]*te[re]*8),c[ne]=1/(o[w[ne]]*te[fe]*te[re]*8),ne++}function C(V,oe){for(var le=0,ce=0,K=new Array,Me=1;Me<=16;Me++){for(var _e=1;_e<=V[Me];_e++)K[oe[ce]]=[],K[oe[ce]][0]=le,K[oe[ce]][1]=Me,ce++,le++;le*=2}return K}function Y(){h=C(v,k),f=C(F,Z),u=C(I,L),d=C(W,G)}function j(){for(var V=1,oe=2,le=1;le<=15;le++){for(var ce=V;ce<oe;ce++)p[32767+ce]=le,g[32767+ce]=[],g[32767+ce][1]=le,g[32767+ce][0]=ce;for(var K=-(oe-1);K<=-V;K++)p[32767+K]=le,g[32767+K]=[],g[32767+K][1]=le,g[32767+K][0]=oe-1+K;V<<=1,oe<<=1}}function R(){for(var V=0;V<256;V++)E[V]=19595*V,E[V+256>>0]=38470*V,E[V+512>>0]=7471*V+32768,E[V+768>>0]=-11059*V,E[V+1024>>0]=-21709*V,E[V+1280>>0]=32768*V+8421375,E[V+1536>>0]=-27439*V,E[V+1792>>0]=-5329*V}function N(V){for(var oe=V[0],le=V[1]-1;le>=0;)oe&1<<le&&(A|=1<<b),le--,b--,b<0&&(A==255?(U(255),U(0)):U(A),b=7,A=0)}function U(V){m.push(V)}function z(V){U(V>>8&255),U(V&255)}function H(V,oe){var le,ce,K,Me,_e,te,ne,fe,re=0,me,ye=8,de=64;for(me=0;me<ye;++me){le=V[re],ce=V[re+1],K=V[re+2],Me=V[re+3],_e=V[re+4],te=V[re+5],ne=V[re+6],fe=V[re+7];var ve=le+fe,be=le-fe,Ee=ce+ne,$e=ce-ne,Ae=K+te,Fe=K-te,Ze=Me+_e,Ke=Me-_e,Pe=ve+Ze,ze=ve-Ze,Ye=Ee+Ae,Ue=Ee-Ae;V[re]=Pe+Ye,V[re+4]=Pe-Ye;var Ge=(Ue+ze)*.707106781;V[re+2]=ze+Ge,V[re+6]=ze-Ge,Pe=Ke+Fe,Ye=Fe+$e,Ue=$e+be;var He=(Pe-Ue)*.382683433,$=.5411961*Pe+He,B=1.306562965*Ue+He,O=Ye*.707106781,X=be+O,Q=be-O;V[re+5]=Q+$,V[re+3]=Q-$,V[re+1]=X+B,V[re+7]=X-B,re+=8}for(re=0,me=0;me<ye;++me){le=V[re],ce=V[re+8],K=V[re+16],Me=V[re+24],_e=V[re+32],te=V[re+40],ne=V[re+48],fe=V[re+56];var ie=le+fe,ke=le-fe,Se=ce+ne,De=ce-ne,Be=K+te,Qe=K-te,Ie=Me+_e,Xe=Me-_e,Re=ie+Ie,Oe=ie-Ie,Ce=Se+Be,je=Se-Be;V[re]=Re+Ce,V[re+32]=Re-Ce;var qe=(je+Oe)*.707106781;V[re+16]=Oe+qe,V[re+48]=Oe-qe,Re=Xe+Qe,Ce=Qe+De,je=De+ke;var Ve=(Re-je)*.382683433,tt=.5411961*Re+Ve,lt=1.306562965*je+Ve,ht=Ce*.707106781,ct=ke+ht,ft=ke-ht;V[re+40]=ft+tt,V[re+24]=ft-tt,V[re+8]=ct+lt,V[re+56]=ct-lt,re++}var rt;for(me=0;me<de;++me)rt=V[me]*oe[me],x[me]=rt>0?rt+.5|0:rt-.5|0;return x}function ee(){z(65504),z(16),U(74),U(70),U(73),U(70),U(0),U(1),U(1),U(0),z(1),z(1),U(0),U(0)}function se(V){if(V){z(65505),V[0]===69&&V[1]===120&&V[2]===105&&V[3]===102?z(V.length+2):(z(V.length+5+2),U(69),U(120),U(105),U(102),U(0));for(var oe=0;oe<V.length;oe++)U(V[oe])}}function ae(V,oe){z(65472),z(17),U(8),z(oe),z(V),U(3),U(1),U(17),U(0),U(2),U(17),U(1),U(3),U(17),U(1)}function he(){z(65499),z(132),U(0);for(var V=0;V<64;V++)U(a[V]);U(1);for(var oe=0;oe<64;oe++)U(o[oe])}function we(){z(65476),z(418),U(0);for(var V=0;V<16;V++)U(v[V+1]);for(var oe=0;oe<=11;oe++)U(k[oe]);U(16);for(var le=0;le<16;le++)U(I[le+1]);for(var ce=0;ce<=161;ce++)U(L[ce]);U(1);for(var K=0;K<16;K++)U(F[K+1]);for(var Me=0;Me<=11;Me++)U(Z[Me]);U(17);for(var _e=0;_e<16;_e++)U(W[_e+1]);for(var te=0;te<=161;te++)U(G[te])}function ge(V){typeof V>"u"||V.constructor!==Array||V.forEach(oe=>{if(typeof oe=="string"){z(65534);var le=oe.length;z(le+2);var ce;for(ce=0;ce<le;ce++)U(oe.charCodeAt(ce))}})}function J(){z(65498),z(12),U(3),U(1),U(0),U(2),U(17),U(3),U(17),U(0),U(63),U(0)}function q(V,oe,le,ce,K){for(var Me=K[0],_e=K[240],te,ne=16,fe=63,re=64,me=H(V,oe),ye=0;ye<re;++ye)y[w[ye]]=me[ye];var de=y[0]-le;le=y[0],de==0?N(ce[0]):(te=32767+de,N(ce[p[te]]),N(g[te]));for(var ve=63;ve>0&&y[ve]==0;ve--);if(ve==0)return N(Me),le;for(var be=1,Ee;be<=ve;){for(var $e=be;y[be]==0&&be<=ve;++be);var Ae=be-$e;if(Ae>=ne){Ee=Ae>>4;for(var Fe=1;Fe<=Ee;++Fe)N(_e);Ae=Ae&15}te=32767+y[be],N(K[(Ae<<4)+p[te]]),N(g[te]),be++}return ve!=fe&&N(Me),le}function xe(){for(var V=String.fromCharCode,oe=0;oe<256;oe++)D[oe]=V(oe)}this.encode=function(V,oe){new Date().getTime(),oe&&ue(oe),m=new Array,A=0,b=7,z(65496),ee(),ge(V.comments),se(V.exifBuffer),he(),ae(V.width,V.height),we(),J();var le=0,ce=0,K=0;A=0,b=7,this.encode.displayName="_encode_";for(var Me=V.data,_e=V.width,te=V.height,ne=_e*4,fe,re=0,me,ye,de,ve,be,Ee,$e,Ae;re<te;){for(fe=0;fe<ne;){for(ve=ne*re+fe,be=ve,Ee=-1,$e=0,Ae=0;Ae<64;Ae++)$e=Ae>>3,Ee=(Ae&7)*4,be=ve+$e*ne+Ee,re+$e>=te&&(be-=ne*(re+1+$e-te)),fe+Ee>=ne&&(be-=fe+Ee-ne+4),me=Me[be++],ye=Me[be++],de=Me[be++],_[Ae]=(E[me]+E[ye+256>>0]+E[de+512>>0]>>16)-128,M[Ae]=(E[me+768>>0]+E[ye+1024>>0]+E[de+1280>>0]>>16)-128,T[Ae]=(E[me+1280>>0]+E[ye+1536>>0]+E[de+1792>>0]>>16)-128;le=q(_,l,le,h,u),ce=q(M,c,ce,f,d),K=q(T,c,K,f,d),fe+=32}re+=8}if(b>=0){var Fe=[];Fe[1]=b+1,Fe[0]=(1<<b+1)-1,N(Fe)}return z(65497),Buffer.from(m)};function ue(V){if(V<=0&&(V=1),V>100&&(V=100),S!=V){var oe=0;V<50?oe=Math.floor(5e3/V):oe=Math.floor(200-V*2),P(oe),S=V}}function pe(){var V=new Date().getTime();n||(n=50),xe(),Y(),j(),R(),ue(n),new Date().getTime()-V}pe()}r.exports=e;function e(n,s){typeof s>"u"&&(s=50);var a=new t(s),o=a.encode(n,s);return{data:o,width:n.width,height:n.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(r){var t=function(){var s=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),a=4017,o=799,l=3406,c=2276,h=1567,f=3784,u=5793,d=2896;function g(){}function p(M,T){for(var D=0,E=[],S,w,v=16;v>0&&!M[v-1];)v--;E.push({children:[],index:0});var k=E[0],I;for(S=0;S<v;S++){for(w=0;w<M[S];w++){for(k=E.pop(),k.children[k.index]=T[D];k.index>0;){if(E.length===0)throw new Error("Could not recreate Huffman Table");k=E.pop()}for(k.index++,E.push(k);E.length<=S;)E.push(I={children:[],index:0}),k.children[k.index]=I.children,k=I;D++}S+1<v&&(E.push(I={children:[],index:0}),k.children[k.index]=I.children,k=I)}return E[0].children}function x(M,T,D,E,S,w,v,k,I,L){D.precision,D.samplesPerLine,D.scanLines;var F=D.mcusPerLine,Z=D.progressive;D.maxH,D.maxV;var W=T,G=0,P=0;function C(){if(P>0)return P--,G>>P&1;if(G=M[T++],G==255){var te=M[T++];if(te)throw new Error("unexpected marker: "+(G<<8|te).toString(16))}return P=7,G>>>7}function Y(te){for(var ne=te,fe;(fe=C())!==null;){if(ne=ne[fe],typeof ne=="number")return ne;if(typeof ne!="object")throw new Error("invalid huffman sequence")}return null}function j(te){for(var ne=0;te>0;){var fe=C();if(fe===null)return;ne=ne<<1|fe,te--}return ne}function R(te){var ne=j(te);return ne>=1<<te-1?ne:ne+(-1<<te)+1}function N(te,ne){var fe=Y(te.huffmanTableDC),re=fe===0?0:R(fe);ne[0]=te.pred+=re;for(var me=1;me<64;){var ye=Y(te.huffmanTableAC),de=ye&15,ve=ye>>4;if(de===0){if(ve<15)break;me+=16;continue}me+=ve;var be=s[me];ne[be]=R(de),me++}}function U(te,ne){var fe=Y(te.huffmanTableDC),re=fe===0?0:R(fe)<<I;ne[0]=te.pred+=re}function z(te,ne){ne[0]|=C()<<I}var H=0;function ee(te,ne){if(H>0){H--;return}for(var fe=w,re=v;fe<=re;){var me=Y(te.huffmanTableAC),ye=me&15,de=me>>4;if(ye===0){if(de<15){H=j(de)+(1<<de)-1;break}fe+=16;continue}fe+=de;var ve=s[fe];ne[ve]=R(ye)*(1<<I),fe++}}var se=0,ae;function he(te,ne){for(var fe=w,re=v,me=0;fe<=re;){var ye=s[fe],de=ne[ye]<0?-1:1;switch(se){case 0:var ve=Y(te.huffmanTableAC),be=ve&15,me=ve>>4;if(be===0)me<15?(H=j(me)+(1<<me),se=4):(me=16,se=1);else{if(be!==1)throw new Error("invalid ACn encoding");ae=R(be),se=me?2:3}continue;case 1:case 2:ne[ye]?ne[ye]+=(C()<<I)*de:(me--,me===0&&(se=se==2?3:0));break;case 3:ne[ye]?ne[ye]+=(C()<<I)*de:(ne[ye]=ae<<I,se=0);break;case 4:ne[ye]&&(ne[ye]+=(C()<<I)*de);break}fe++}se===4&&(H--,H===0&&(se=0))}function we(te,ne,fe,re,me){var ye=fe/F|0,de=fe%F,ve=ye*te.v+re,be=de*te.h+me;te.blocks[ve]===void 0&&L.tolerantDecoding||ne(te,te.blocks[ve][be])}function ge(te,ne,fe){var re=fe/te.blocksPerLine|0,me=fe%te.blocksPerLine;te.blocks[re]===void 0&&L.tolerantDecoding||ne(te,te.blocks[re][me])}var J=E.length,q,xe,ue,pe,V,oe;Z?w===0?oe=k===0?U:z:oe=k===0?ee:he:oe=N;var le=0,ce,K;J==1?K=E[0].blocksPerLine*E[0].blocksPerColumn:K=F*D.mcusPerColumn,S||(S=K);for(var Me,_e;le<K;){for(xe=0;xe<J;xe++)E[xe].pred=0;if(H=0,J==1)for(q=E[0],V=0;V<S;V++)ge(q,oe,le),le++;else for(V=0;V<S;V++){for(xe=0;xe<J;xe++)for(q=E[xe],Me=q.h,_e=q.v,ue=0;ue<_e;ue++)for(pe=0;pe<Me;pe++)we(q,oe,le,ue,pe);if(le++,le===K)break}if(le===K)do{if(M[T]===255&&M[T+1]!==0)break;T+=1}while(T<M.length-2);if(P=0,ce=M[T]<<8|M[T+1],ce<65280)throw new Error("marker was not found");if(ce>=65488&&ce<=65495)T+=2;else break}return T-W}function y(M,T){var D=[],E=T.blocksPerLine,S=T.blocksPerColumn,w=E<<3,v=new Int32Array(64),k=new Uint8Array(64);function I(j,R,N){var U=T.quantizationTable,z,H,ee,se,ae,he,we,ge,J,q=N,xe;for(xe=0;xe<64;xe++)q[xe]=j[xe]*U[xe];for(xe=0;xe<8;++xe){var ue=8*xe;if(q[1+ue]==0&&q[2+ue]==0&&q[3+ue]==0&&q[4+ue]==0&&q[5+ue]==0&&q[6+ue]==0&&q[7+ue]==0){J=u*q[0+ue]+512>>10,q[0+ue]=J,q[1+ue]=J,q[2+ue]=J,q[3+ue]=J,q[4+ue]=J,q[5+ue]=J,q[6+ue]=J,q[7+ue]=J;continue}z=u*q[0+ue]+128>>8,H=u*q[4+ue]+128>>8,ee=q[2+ue],se=q[6+ue],ae=d*(q[1+ue]-q[7+ue])+128>>8,ge=d*(q[1+ue]+q[7+ue])+128>>8,he=q[3+ue]<<4,we=q[5+ue]<<4,J=z-H+1>>1,z=z+H+1>>1,H=J,J=ee*f+se*h+128>>8,ee=ee*h-se*f+128>>8,se=J,J=ae-we+1>>1,ae=ae+we+1>>1,we=J,J=ge+he+1>>1,he=ge-he+1>>1,ge=J,J=z-se+1>>1,z=z+se+1>>1,se=J,J=H-ee+1>>1,H=H+ee+1>>1,ee=J,J=ae*c+ge*l+2048>>12,ae=ae*l-ge*c+2048>>12,ge=J,J=he*o+we*a+2048>>12,he=he*a-we*o+2048>>12,we=J,q[0+ue]=z+ge,q[7+ue]=z-ge,q[1+ue]=H+we,q[6+ue]=H-we,q[2+ue]=ee+he,q[5+ue]=ee-he,q[3+ue]=se+ae,q[4+ue]=se-ae}for(xe=0;xe<8;++xe){var pe=xe;if(q[8+pe]==0&&q[16+pe]==0&&q[24+pe]==0&&q[32+pe]==0&&q[40+pe]==0&&q[48+pe]==0&&q[56+pe]==0){J=u*N[xe+0]+8192>>14,q[0+pe]=J,q[8+pe]=J,q[16+pe]=J,q[24+pe]=J,q[32+pe]=J,q[40+pe]=J,q[48+pe]=J,q[56+pe]=J;continue}z=u*q[0+pe]+2048>>12,H=u*q[32+pe]+2048>>12,ee=q[16+pe],se=q[48+pe],ae=d*(q[8+pe]-q[56+pe])+2048>>12,ge=d*(q[8+pe]+q[56+pe])+2048>>12,he=q[24+pe],we=q[40+pe],J=z-H+1>>1,z=z+H+1>>1,H=J,J=ee*f+se*h+2048>>12,ee=ee*h-se*f+2048>>12,se=J,J=ae-we+1>>1,ae=ae+we+1>>1,we=J,J=ge+he+1>>1,he=ge-he+1>>1,ge=J,J=z-se+1>>1,z=z+se+1>>1,se=J,J=H-ee+1>>1,H=H+ee+1>>1,ee=J,J=ae*c+ge*l+2048>>12,ae=ae*l-ge*c+2048>>12,ge=J,J=he*o+we*a+2048>>12,he=he*a-we*o+2048>>12,we=J,q[0+pe]=z+ge,q[56+pe]=z-ge,q[8+pe]=H+we,q[48+pe]=H-we,q[16+pe]=ee+he,q[40+pe]=ee-he,q[24+pe]=se+ae,q[32+pe]=se-ae}for(xe=0;xe<64;++xe){var V=128+(q[xe]+8>>4);R[xe]=V<0?0:V>255?255:V}}_(w*S*8);for(var L,F,Z=0;Z<S;Z++){var W=Z<<3;for(L=0;L<8;L++)D.push(new Uint8Array(w));for(var G=0;G<E;G++){I(T.blocks[Z][G],k,v);var P=0,C=G<<3;for(F=0;F<8;F++){var Y=D[W+F];for(L=0;L<8;L++)Y[C+L]=k[P++]}}}return D}function m(M){return M<0?0:M>255?255:M}g.prototype={load:function(T){var D=new XMLHttpRequest;D.open("GET",T,!0),D.responseType="arraybuffer",D.onload=(function(){var E=new Uint8Array(D.response||D.mozResponseArrayBuffer);this.parse(E),this.onload&&this.onload()}).bind(this),D.send(null)},parse:function(T){var D=this.opts.maxResolutionInMP*1e3*1e3,E=0;T.length;function S(){var de=T[E]<<8|T[E+1];return E+=2,de}function w(){var de=S(),ve=T.subarray(E,E+de-2);return E+=ve.length,ve}function v(de){var ve=1,be=1,Ee,$e;for($e in de.components)de.components.hasOwnProperty($e)&&(Ee=de.components[$e],ve<Ee.h&&(ve=Ee.h),be<Ee.v&&(be=Ee.v));var Ae=Math.ceil(de.samplesPerLine/8/ve),Fe=Math.ceil(de.scanLines/8/be);for($e in de.components)if(de.components.hasOwnProperty($e)){Ee=de.components[$e];var Ze=Math.ceil(Math.ceil(de.samplesPerLine/8)*Ee.h/ve),Ke=Math.ceil(Math.ceil(de.scanLines/8)*Ee.v/be),Pe=Ae*Ee.h,ze=Fe*Ee.v,Ye=ze*Pe,Ue=[];_(Ye*256);for(var Ge=0;Ge<ze;Ge++){for(var He=[],$=0;$<Pe;$++)He.push(new Int32Array(64));Ue.push(He)}Ee.blocksPerLine=Ze,Ee.blocksPerColumn=Ke,Ee.blocks=Ue}de.maxH=ve,de.maxV=be,de.mcusPerLine=Ae,de.mcusPerColumn=Fe}var k=null,I=null,L,F,Z=[],W=[],G=[],P=[],C=S(),Y=-1;if(this.comments=[],C!=65496)throw new Error("SOI not found");for(C=S();C!=65497;){var j,R;switch(C){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var N=w();if(C===65534){var U=String.fromCharCode.apply(null,N);this.comments.push(U)}C===65504&&N[0]===74&&N[1]===70&&N[2]===73&&N[3]===70&&N[4]===0&&(k={version:{major:N[5],minor:N[6]},densityUnits:N[7],xDensity:N[8]<<8|N[9],yDensity:N[10]<<8|N[11],thumbWidth:N[12],thumbHeight:N[13],thumbData:N.subarray(14,14+3*N[12]*N[13])}),C===65505&&N[0]===69&&N[1]===120&&N[2]===105&&N[3]===102&&N[4]===0&&(this.exifBuffer=N.subarray(5,N.length)),C===65518&&N[0]===65&&N[1]===100&&N[2]===111&&N[3]===98&&N[4]===101&&N[5]===0&&(I={version:N[6],flags0:N[7]<<8|N[8],flags1:N[9]<<8|N[10],transformCode:N[11]});break;case 65499:for(var z=S(),H=z+E-2;E<H;){var ee=T[E++];_(256);var se=new Int32Array(64);if(ee>>4)if(ee>>4===1)for(R=0;R<64;R++){var ae=s[R];se[ae]=S()}else throw new Error("DQT: invalid table spec");else for(R=0;R<64;R++){var ae=s[R];se[ae]=T[E++]}Z[ee&15]=se}break;case 65472:case 65473:case 65474:S(),L={},L.extended=C===65473,L.progressive=C===65474,L.precision=T[E++],L.scanLines=S(),L.samplesPerLine=S(),L.components={},L.componentsOrder=[];var he=L.scanLines*L.samplesPerLine;if(he>D){var we=Math.ceil((he-D)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${we}MP`)}var ge=T[E++],J;for(j=0;j<ge;j++){J=T[E];var q=T[E+1]>>4,xe=T[E+1]&15,ue=T[E+2];if(q<=0||xe<=0)throw new Error("Invalid sampling factor, expected values above 0");L.componentsOrder.push(J),L.components[J]={h:q,v:xe,quantizationIdx:ue},E+=3}v(L),W.push(L);break;case 65476:var pe=S();for(j=2;j<pe;){var V=T[E++],oe=new Uint8Array(16),le=0;for(R=0;R<16;R++,E++)le+=oe[R]=T[E];_(16+le);var ce=new Uint8Array(le);for(R=0;R<le;R++,E++)ce[R]=T[E];j+=17+le,(V>>4?G:P)[V&15]=p(oe,ce)}break;case 65501:S(),F=S();break;case 65500:S(),S();break;case 65498:S();var K=T[E++],Me=[],_e;for(j=0;j<K;j++){_e=L.components[T[E++]];var te=T[E++];_e.huffmanTableDC=P[te>>4],_e.huffmanTableAC=G[te&15],Me.push(_e)}var ne=T[E++],fe=T[E++],re=T[E++],me=x(T,E,L,Me,F,ne,fe,re>>4,re&15,this.opts);E+=me;break;case 65535:T[E]!==255&&E--;break;default:if(T[E-3]==255&&T[E-2]>=192&&T[E-2]<=254){E-=3;break}else if(C===224||C==225){if(Y!==-1)throw new Error(`first unknown JPEG marker at offset ${Y.toString(16)}, second unknown JPEG marker ${C.toString(16)} at offset ${(E-1).toString(16)}`);Y=E-1;const de=S();if(T[E+de-2]===255){E+=de-2;break}}throw new Error("unknown JPEG marker "+C.toString(16))}C=S()}if(W.length!=1)throw new Error("only single frame JPEGs supported");for(var j=0;j<W.length;j++){var ye=W[j].components;for(var R in ye)ye[R].quantizationTable=Z[ye[R].quantizationIdx],delete ye[R].quantizationIdx}this.width=L.samplesPerLine,this.height=L.scanLines,this.jfif=k,this.adobe=I,this.components=[];for(var j=0;j<L.componentsOrder.length;j++){var _e=L.components[L.componentsOrder[j]];this.components.push({lines:y(L,_e),scaleX:_e.h/L.maxH,scaleY:_e.v/L.maxV})}},getData:function(T,D){var E=this.width/T,S=this.height/D,w,v,k,I,L,F,Z,W,G,P,C=0,Y,j,R,N,U,z,H,ee,se,ae,he,we=T*D*this.components.length;_(we);var ge=new Uint8Array(we);switch(this.components.length){case 1:for(w=this.components[0],P=0;P<D;P++)for(L=w.lines[0|P*w.scaleY*S],G=0;G<T;G++)Y=L[0|G*w.scaleX*E],ge[C++]=Y;break;case 2:for(w=this.components[0],v=this.components[1],P=0;P<D;P++)for(L=w.lines[0|P*w.scaleY*S],F=v.lines[0|P*v.scaleY*S],G=0;G<T;G++)Y=L[0|G*w.scaleX*E],ge[C++]=Y,Y=F[0|G*v.scaleX*E],ge[C++]=Y;break;case 3:for(he=!0,this.adobe&&this.adobe.transformCode?he=!0:typeof this.opts.colorTransform<"u"&&(he=!!this.opts.colorTransform),w=this.components[0],v=this.components[1],k=this.components[2],P=0;P<D;P++)for(L=w.lines[0|P*w.scaleY*S],F=v.lines[0|P*v.scaleY*S],Z=k.lines[0|P*k.scaleY*S],G=0;G<T;G++)he?(Y=L[0|G*w.scaleX*E],j=F[0|G*v.scaleX*E],R=Z[0|G*k.scaleX*E],ee=m(Y+1.402*(R-128)),se=m(Y-.3441363*(j-128)-.71413636*(R-128)),ae=m(Y+1.772*(j-128))):(ee=L[0|G*w.scaleX*E],se=F[0|G*v.scaleX*E],ae=Z[0|G*k.scaleX*E]),ge[C++]=ee,ge[C++]=se,ge[C++]=ae;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(he=!1,this.adobe&&this.adobe.transformCode?he=!0:typeof this.opts.colorTransform<"u"&&(he=!!this.opts.colorTransform),w=this.components[0],v=this.components[1],k=this.components[2],I=this.components[3],P=0;P<D;P++)for(L=w.lines[0|P*w.scaleY*S],F=v.lines[0|P*v.scaleY*S],Z=k.lines[0|P*k.scaleY*S],W=I.lines[0|P*I.scaleY*S],G=0;G<T;G++)he?(Y=L[0|G*w.scaleX*E],j=F[0|G*v.scaleX*E],R=Z[0|G*k.scaleX*E],N=W[0|G*I.scaleX*E],U=255-m(Y+1.402*(R-128)),z=255-m(Y-.3441363*(j-128)-.71413636*(R-128)),H=255-m(Y+1.772*(j-128))):(U=L[0|G*w.scaleX*E],z=F[0|G*v.scaleX*E],H=Z[0|G*k.scaleX*E],N=W[0|G*I.scaleX*E]),ge[C++]=255-U,ge[C++]=255-z,ge[C++]=255-H,ge[C++]=255-N;break;default:throw new Error("Unsupported color mode")}return ge},copyToImageData:function(T,D){var E=T.width,S=T.height,w=T.data,v=this.getData(E,S),k=0,I=0,L,F,Z,W,G,P,C,Y,j;switch(this.components.length){case 1:for(F=0;F<S;F++)for(L=0;L<E;L++)Z=v[k++],w[I++]=Z,w[I++]=Z,w[I++]=Z,D&&(w[I++]=255);break;case 3:for(F=0;F<S;F++)for(L=0;L<E;L++)C=v[k++],Y=v[k++],j=v[k++],w[I++]=C,w[I++]=Y,w[I++]=j,D&&(w[I++]=255);break;case 4:for(F=0;F<S;F++)for(L=0;L<E;L++)G=v[k++],P=v[k++],Z=v[k++],W=v[k++],C=255-m(G*(1-W/255)+W),Y=255-m(P*(1-W/255)+W),j=255-m(Z*(1-W/255)+W),w[I++]=C,w[I++]=Y,w[I++]=j,D&&(w[I++]=255);break;default:throw new Error("Unsupported color mode")}}};var A=0,b=0;function _(M=0){var T=A+M;if(T>b){var D=Math.ceil((T-b)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${D}MB`)}A=T}return g.resetMaxMemoryUsage=function(M){A=0,b=M},g.getBytesAllocated=function(){return A},g.requestMemoryAllocation=_,g}();r.exports=e;function e(n,s={}){var a={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},o={...a,...s},l=new Uint8Array(n),c=new t;c.opts=o,t.resetMaxMemoryUsage(o.maxMemoryUsageInMB*1024*1024),c.parse(l);var h=o.formatAsRGBA?4:3,f=c.width*c.height*h;try{t.requestMemoryAllocation(f);var u={width:c.width,height:c.height,exifBuffer:c.exifBuffer,data:o.useTArray?new Uint8Array(f):Buffer.alloc(f)};c.comments.length>0&&(u.comments=c.comments)}catch(d){throw d instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+f):d instanceof ReferenceError&&d.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):d}return c.copyToImageData(u,o.formatAsRGBA),u}})(decoder);var decoderExports=decoder.exports,encode$1=encoderExports,decode$4=decoderExports,jpegJs={encode:encode$1,decode:decode$4};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let r=0;r<chars.length;r++)lookup[chars.charCodeAt(r)]=r;function encode(r){let t,e=r.length,n="";for(t=0;t<e;t+=3)n+=chars[r[t]>>2],n+=chars[(r[t]&3)<<4|r[t+1]>>4],n+=chars[(r[t+1]&15)<<2|r[t+2]>>6],n+=chars[r[t+2]&63];return e%3===2?n=`${n.substring(0,n.length-1)}=`:e%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$3(r){let t=r.length*.75,e=r.length,n=0,s,a,o,l;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);const c=new Uint8Array(t);for(let h=0;h<e;h+=4)s=lookup[r.charCodeAt(h)],a=lookup[r.charCodeAt(h+1)],o=lookup[r.charCodeAt(h+2)],l=lookup[r.charCodeAt(h+3)],c[n++]=s<<2|a>>4,c[n++]=(a&15)<<4|o>>2,c[n++]=(o&3)<<6|l&63;return c}function toBase64URL(r,t){const e=encode(r);return`data:${t};base64,${e}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(r,t){let e=self.document.createElement("canvas");return e.width=r,e.height=t,e}function fetchBinary(r,{withCredentials:t=!1}={}){return new Promise(function(e,n){let s=new self.XMLHttpRequest;s.open("GET",r,!0),s.responseType="arraybuffer",s.withCredentials=t,s.onload=function(a){this.status!==200?n(a):e(this.response)},s.onerror=n,s.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(r){return r.includes("/")||(r=`image/${r}`),r}function encodeJpeg(r,t={}){const e={width:r.width,height:r.height,data:r.getRGBAData()};return jpegJs.encode(e,t.quality).data}function encodePng(r,t){const e={width:r.width,height:r.height,channels:r.channels,depth:r.bitDepth,data:r.data};return(e.depth===1||e.depth===32)&&(e.depth=8,e.channels=4,e.data=r.getRGBAData()),encodePng$1(e,t)}const exportMethods={save(r,t={}){const{useCanvas:e=!1,encoder:n=void 0}=t;let{format:s}=t;if(!s){const a=/\.(?<format>[a-zA-Z]+)$/.exec(r);a&&(s=a.groups.format.toLowerCase())}if(!s)throw new Error("file format not provided");return new Promise((a,o)=>{let l,c;switch(s.toLowerCase()){case"png":{e?l=this.getCanvas().pngStream():c=encodePng(this,n);break}case"jpg":case"jpeg":e?l=this.getCanvas().jpegStream():c=encodeJpeg(this,n);break;case"bmp":c=encode$2(this,n);break;default:throw new RangeError(`invalid output format: ${s}`)}if(l){let h=createWriteStream();h.on("finish",a),h.on("error",o),l.pipe(h)}else c&&writeFile()})},toDataURL(r="image/png",t={}){typeof r=="object"&&(t=r,r="image/png");const{useCanvas:e=!1,encoder:n=void 0}=t;r=getType(r);function s(a,o){const l=a(o,n);return toBase64URL(l,r)}return r==="image/bmp"?s(encode$2,this):r==="image/png"&&!e?s(encodePng,this):r==="image/jpeg"&&!e?s(encodeJpeg,this):this.getCanvas().toDataURL(r)},toBuffer(r={}){const{format:t="png",encoder:e=void 0}=r;switch(t.toLowerCase()){case"png":return encodePng(this,e);case"jpeg":case"jpg":return encodeJpeg(this,e);case"bmp":return encode$2(this,e);default:throw new RangeError(`invalid output format: ${t}`)}},toBase64(r="image/png",t={}){if(t.async)return this.toDataURL(r,t).then(function(e){return e.substring(e.indexOf(",")+1)});{const e=this.toDataURL(r,t);return e.substring(e.indexOf(",")+1)}},toBlob(r="image/png",t=.8){return canvasToBlob(this.getCanvas(),r,t)},getCanvas(){const r=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let t=createCanvas(this.width,this.height);return t.getContext("2d").putImageData(r,0,0),t}};function setExportMethods(r){for(const t in exportMethods)r.prototype[t]=exportMethods[t]}var hasOwn$1={exports:{}};const name$1="has-own",version$2="1.0.1",description$1="A safer .hasOwnProperty() - hasOwn(name, obj)",main$1="index.js",scripts$1={test:"make test"},author$1="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license$1="MIT",repository$1={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage$1="https://github.com/aheckmann/has-own/",devDependencies$1={mocha:"^6.2.2"},require$$0$4={name:name$1,version:version$2,description:description$1,main:main$1,scripts:scripts$1,author:author$1,license:license$1,repository:repository$1,homepage:homepage$1,devDependencies:devDependencies$1};(function(r,t){var e=Object.prototype.hasOwnProperty;r.exports=t=function(s,a){return e.call(a,s)},t.version=require$$0$4.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports;const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(r,t,e={}){let{inPlace:n=!1,returnThis:s=!0,partialArgs:a=[]}=e;return n?Image.prototype[r]=function(...o){this.computed=null;let l=t.apply(this,[...a,...o]);return s?this:l}:Image.prototype[r]=function(...o){return t.apply(this,[...a,...o])},Image}function extendProperty(r,t,e={}){let{partialArgs:n=[]}=e;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(r,this.computed))return this.computed[r];let s=t.apply(this,n);return this.computed[r]=s,s},Object.defineProperty(Image.prototype,r,computedPropertyDescriptor$1),Image}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(r={}){const{clamped:t}=r;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const e=this.width*this.height*4;let n=t?new Uint8ClampedArray(e):new Uint8Array(e);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(r,t){for(let e=0;e<r.size;e++){const n=r.getBit(e);t[e*4]=n*255,t[e*4+1]=n*255,t[e*4+2]=n*255}}function fillDataFromGrey32(r,t){const e=r.min[0],s=r.max[0]-e;for(let a=0;a<r.size;a++){const o=Math.floor(255*(r.data[a]-e)/s);t[a*4]=o,t[a*4+1]=o,t[a*4+2]=o}}function fillDataFromRGB32(r,t){const e=Math.min(...r.min),s=Math.max(...r.max)-e;for(let a=0;a<r.size;a++){const o=Math.floor(255*(r.data[a*3]-e)/s),l=Math.floor(255*(r.data[a*3+1]-e)/s),c=Math.floor(255*(r.data[a*3+2]-e)/s);t[a*4]=o,t[a*4+1]=l,t[a*4+2]=c}}function fillDataFromGrey(r,t){for(let e=0;e<r.size;e++)t[e*4]=r.data[e*r.channels]>>>r.bitDepth-8,t[e*4+1]=r.data[e*r.channels]>>>r.bitDepth-8,t[e*4+2]=r.data[e*r.channels]>>>r.bitDepth-8}function fillDataFromRGB(r,t){for(let e=0;e<r.size;e++)t[e*4]=r.data[e*r.channels]>>>r.bitDepth-8,t[e*4+1]=r.data[e*r.channels+1]>>>r.bitDepth-8,t[e*4+2]=r.data[e*r.channels+2]>>>r.bitDepth-8}function copyAlpha(r,t){for(let e=0;e<r.size;e++)t[e*4+3]=r.data[e*r.channels+r.components]>>r.bitDepth-8}function fillAlpha(r,t){for(let e=0;e<r.size;e++)t[e*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(r){const t=kinds[r];if(!t)throw new RangeError(`invalid image kind: ${r}`);return t}const validBitDepth=[1,8,16,32];function verifyKindDefinition(r){const{components:t,alpha:e,bitDepth:n,colorModel:s}=r;if(!Number.isInteger(t)||t<=0)throw new RangeError(`invalid components: ${t}. Must be a positive integer`);if(e!==0&&e!==1&&typeof e!="boolean")throw new TypeError(`invalid alpha: ${e}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[s])throw new RangeError(`invalid colorModel: ${s}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(r,t,e){let n=t*r;return e===1&&(n=Math.ceil(n/8)),n}function createPixelArray(r,t,e,n,s,a){const o=n*r;let l;switch(s){case 1:l=new Uint8Array(Math.ceil(o/8));break;case 8:l=new Uint8Array(o);break;case 16:l=new Uint16Array(o);break;case 32:l=new Float32Array(o);break;default:throw new Error(`Cannot create pixel array for bit depth ${s}`)}if(e)for(let c=t;c<l.length;c+=n)l[c]=a;return l}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(t,e){e=e||{},t===void 0&&(t=defaultByteLength),typeof t=="number"&&(t=new ArrayBuffer(t));let n=t.byteLength;const s=e.offset?e.offset>>>0:0;t.buffer&&(n=t.byteLength-s,t.byteLength!==t.buffer.byteLength?t=t.buffer.slice(t.byteOffset+s,t.byteOffset+t.byteLength):s?t=t.buffer.slice(s):t=t.buffer),this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength,this._mark=0}available(t){return t===void 0&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){t===void 0&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){const e=this._increment+this._increment;this._increment=e;const n=this.length+e,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);for(var e=new Uint8Array(t),n=0;n<t;n++)e[n]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){t===void 0&&(t=1),charArray.length=t;for(var e=0;e<t;e++)charArray[e]=this.readChar();return charArray.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const e=tags$1[this.kind].tagsById;for(var t of this.fields.keys())e[t]&&(this._map[e[t]]=this.fields.get(t))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,e=dateTimeRegex$1.exec(this.dateTime);return t.setFullYear(e[1],e[2]-1,e[3]),t.setHours(e[4],e[5],e[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(r){return typeof r=="number"?[r]:r}var tiffIfd=TiffIfd$1,ifdValue={},types$2=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(r,t){return types$2.get(r)[0]*t};ifdValue.readData=function(r,t,e){return types$2.get(t)[1](r,e)};function readByte$1(r,t){if(t===1)return r.readUint8();for(var e=new Uint8Array(t),n=0;n<t;n++)e[n]=r.readUint8();return e}function readASCII$1(r,t){for(var e=[],n="",s=0;s<t;s++){var a=String.fromCharCode(r.readUint8());a==="\0"?(e.push(n),n=""):n+=a}return e.length===1?e[0]:e}function readShort$1(r,t){if(t===1)return r.readUint16();for(var e=new Uint16Array(t),n=0;n<t;n++)e[n]=r.readUint16();return e}function readLong$1(r,t){if(t===1)return r.readUint32();for(var e=new Uint32Array(t),n=0;n<t;n++)e[n]=r.readUint32();return e}function readRational$1(r,t){if(t===1)return r.readUint32()/r.readUint32();for(var e=new Array(t),n=0;n<t;n++)e[n]=r.readUint32()/r.readUint32();return e}function readSByte$1(r,t){if(t===1)return r.readInt8();for(var e=new Int8Array(t),n=0;n<t;n++)e[n]=r.readInt8();return e}function readSShort$1(r,t){if(t===1)return r.readInt16();for(var e=new Int16Array(t),n=0;n<t;n++)e[n]=r.readInt16();return e}function readSLong$1(r,t){if(t===1)return r.readInt32();for(var e=new Int32Array(t),n=0;n<t;n++)e[n]=r.readInt32();return e}function readSRational$1(r,t){if(t===1)return r.readInt32()/r.readInt32();for(var e=new Array(t),n=0;n<t;n++)e[n]=r.readInt32()/r.readInt32();return e}function readFloat$1(r,t){if(t===1)return r.readFloat32();for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=r.readFloat32();return e}function readDouble$1(r,t){if(t===1)return r.readFloat64();for(var e=new Float64Array(t),n=0;n<t;n++)e[n]=r.readFloat64();return e}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$h={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(t,e){super(t,e),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions$h,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t)),t.onlyFirst)return e[0];return e}decodeHeader(){let t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+t.toString(16));if(t=this.readUint16(),t!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){this.seek(this._nextIFD);var e;t.kind?e=new IFD$1(t.kind):e=new TiffIFD;const n=this.readUint16();for(var s=0;s<n;s++)this.decodeIFDEntry(e);return t.ignoreImageData||this.decodeImageData(e),this._nextIFD=this.readUint32(),e}decodeIFDEntry(t){const e=this.offset,n=this.readUint16(),s=this.readUint16(),a=this.readUint32();if(s<1||s>12){this.skip(4);return}IFDValue.getByteLength(s,a)>4&&this.seek(this.readUint32());const l=IFDValue.readData(this,s,a);if(t.fields.set(n,l),n===34665||n===34853){let c=this.offset,h;n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,t[h]=this.decodeIFD({kind:h,ignoreImageData:!0}),this.offset=c}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;switch(e&&e!==1&&unsupported$1("orientation",e),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported$1("image type",t.type);break}}readStripData(t){const e=t.width,n=t.height,s=validateBitDepth(t.bitsPerSample),a=t.sampleFormat;let o=e*n;const l=getDataArray$1(o,1,s,a),c=t.compression,f=t.rowsPerStrip*e,u=t.stripOffsets,d=t.stripByteCounts;for(var g=0,p=0;p<u.length;p++){var x=this.getStripData(c,u[p],d[p]),y=o>f?f:o;o-=y,s===8?g=fill8bit$1(l,x,g,y):s===16?g=fill16bit$1(l,x,g,y,this.isLittleEndian()):s===32&&a===3?g=fillFloat32$1(l,x,g,y,this.isLittleEndian()):unsupported$1("bitDepth",s)}t.data=l}getStripData(t,e,n){switch(t){case 1:return new DataView(this.buffer,e,n);case 2:case 32773:return unsupported$1("Compression",t);default:throw new Error("invalid compression: "+t)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(r,t,e,n){return e===8?new Uint8Array(r*t):e===16?new Uint16Array(r*t):e===32&&n===3?new Float32Array(r*t):unsupported$1("bit depth / sample format",e+" / "+n)}function fill8bit$1(r,t,e,n){for(var s=0;s<n;s++)r[e++]=t.getUint8(s);return e}function fill16bit$1(r,t,e,n,s){for(var a=0;a<n*2;a+=2)r[e++]=t.getUint16(a,s);return e}function fillFloat32$1(r,t,e,n,s){for(var a=0;a<n*4;a+=4)r[e++]=t.getFloat32(a,s);return e}function unsupported$1(r,t){throw new Error("Unsupported "+r+": "+t)}function validateBitDepth(r){if(r.length){const e=r;r=e[0];for(var t=0;t<e.length;t++)e[t]!==r&&unsupported$1("bit depth",e)}return r}const TIFFDecoder$1=tiffDecoder;var decode$2=function(t,e){return new TIFFDecoder$1(t,e).decode(e)};src$4.decode=decode$2;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$1(r){const t=new IOBuffer(r),e={};if(t.setBigEndian(),t.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(t.readUint16()===65505){t.readUint16();const a=t.readBytes(6);if(a[0]===69&&a[1]===120&&a[2]===105&&a[3]===102&&a[4]===0&&a[5]===0){const o=tiff.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});e.exif=o}}return e}var decode_1=decode$1,decode=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=r=>[...r].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(r,t=0){let e=r[t],n=1,s=0;for(;++s<8;)n*=256,e+=r[t+s]*n;return e}const fileType=r=>{if(!(r instanceof Uint8Array||r instanceof ArrayBuffer||Buffer.isBuffer(r)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof r}\``);const t=r instanceof Uint8Array?r:new Uint8Array(r);if(!(t&&t.length>1))return null;const e=(s,a)=>{a=Object.assign({offset:0},a);for(let o=0;o<s.length;o++)if(a.mask){if(s[o]!==(a.mask[o]&t[o+a.offset]))return!1}else if(s[o]!==t[o+a.offset])return!1;return!0},n=(s,a)=>e(toBytes(s),a);if(e([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(e([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(e([71,73,70]))return{ext:"gif",mime:"image/gif"};if(e([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(e([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((e([73,73,42,0])||e([77,77,0,42]))&&e([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(e([73,73,42,0])||e([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(e([66,77]))return{ext:"bmp",mime:"image/bmp"};if(e([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(e([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(e([80,75,3,4])){if(e([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(e(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const s=(c,h=0)=>c.findIndex((f,u,d)=>u>=h&&d[u]===80&&d[u+1]===75&&d[u+2]===3&&d[u+3]===4);let a=0,o=!1,l=null;do{const c=a+30;if(o||(o=e(oxmlContentTypes,{offset:c})||e(oxmlRels,{offset:c})),l||(n("word/",{offset:c})?l={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:c})?l={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:c})&&(l={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),o&&l)return l;a=s(t,c)}while(a>=0);if(l)return l}if(e([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(e([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(e([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(e([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(e([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(e([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(e([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(e([51,103,112,53])||e([0,0,0])&&e([102,116,121,112],{offset:4})&&(e([109,112,52,49],{offset:8})||e([109,112,52,50],{offset:8})||e([105,115,111,109],{offset:8})||e([105,115,111,50],{offset:8})||e([109,109,112,52],{offset:8})||e([77,52,86],{offset:8})||e([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(e([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(e([26,69,223,163])){const s=t.subarray(4,4100),a=s.findIndex((o,l,c)=>c[l]===66&&c[l+1]===130);if(a!==-1){const o=a+3,l=c=>[...c].every((h,f)=>s[o+f]===h.charCodeAt(0));if(l("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(l("webm"))return{ext:"webm",mime:"video/webm"}}}if(e([0,0,0,20,102,116,121,112,113,116,32,32])||e([102,114,101,101],{offset:4})||e([102,116,121,112,113,116,32,32],{offset:4})||e([109,100,97,116],{offset:4})||e([109,111,111,118],{offset:4})||e([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(e([82,73,70,70])){if(e([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(e([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(e([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(e([48,38,178,117,142,102,207,17,166,217])){let s=30;do{const a=readUInt64LE(t,s+16);if(e([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:s})){if(e([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:s+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(e([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:s+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}s+=a}while(s+24<=t.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(e([0,0,1,186])||e([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(e([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let s=0;s<2&&s<t.length-16;s++){if(e([73,68,51],{offset:s})||e([255,226],{offset:s,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(e([255,228],{offset:s,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(e([255,248],{offset:s,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(e([255,240],{offset:s,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(e([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(e([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(e([79,103,103,83]))return e([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:e([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:e([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:e([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:e([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(e([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(e([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(e([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(e([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(e([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(e([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((t[0]===67||t[0]===70)&&e([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(e([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(e([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(e([119,79,70,70])&&(e([0,1,0,0],{offset:4})||e([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(e([119,79,70,50])&&(e([0,1,0,0],{offset:4})||e([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(e([76,80],{offset:34})&&(e([0,0,1],{offset:8})||e([1,0,2],{offset:8})||e([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(e([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(e([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(e([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(e([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(e([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(e([37,33]))return{ext:"ps",mime:"application/postscript"};if(e([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(e([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(e([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(e([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(e([77,83,67,70])||e([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(e([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(e([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(e([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(e([31,160])||e([31,157]))return{ext:"Z",mime:"application/x-compress"};if(e([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(e([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(e([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(e([71],{offset:4})&&(e([71],{offset:192})||e([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(e([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(e([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(e([0,0,0,12,106,80,32,32,13,10,135,10])){if(e([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(e([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(e([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(e([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(e([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(e([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(e([102,116,121,112],{offset:4})){if(e([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(e([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(e([104,101,105,99],{offset:8})||e([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(e([104,101,118,99],{offset:8})||e([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return e([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:e([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:e([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:e([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:e([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:e([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:e([212,195,178,161])||e([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const r=new stream.PassThrough,t=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{r.fileType=fileType(t)}catch(e){reject(e)}readableStream.unshift(t),stream.pipeline?resolve(stream.pipeline(readableStream,r,()=>{})):resolve(readableStream.pipe(r))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=r=>{const t=fileType(r);return imageExts.has(t&&t.ext)?t:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports;const imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(r){if(r.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=r.rowsPerStrip*r.width*r.samplesPerPixel*(r.bitsPerSample/8);return new Array(r.stripOffsets.length).fill(t)}function applyHorizontalDifferencing8Bit(r,t,e){let n=0;for(;n<r.length;){for(let s=e;s<t*e;s+=e)for(let a=0;a<e;a++)r[n+s+a]=r[n+s+a]+r[n+s-(e-a)]&255;n+=t*e}}function applyHorizontalDifferencing16Bit(r,t,e){let n=0;for(;n<r.length;){for(let s=e;s<t*e;s+=e)for(let a=0;a<e;a++)r[n+s+a]=r[n+s+a]+r[n+s-(e-a)]&65535;n+=t*e}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let r in tagsById$2)tagsByName$2[tagsById$2[r]]=Number(r);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let r in tagsById$1)tagsByName$1[tagsById$1[r]]=Number(r);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let r in tagsById)tagsByName[tagsById[r]]=Number(r);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags[this.kind].tagsById;for(let e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}let types$1=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(r,t){const e=types$1.get(r);if(!e)throw new Error(`type not found: ${r}`);return e[0]*t}function readData(r,t,e){const n=types$1.get(t);if(!n)throw new Error(`type not found: ${t}`);return n[1](r,e)}function readByte(r,t){if(t===1)return r.readUint8();let e=new Uint8Array(t);for(let n=0;n<t;n++)e[n]=r.readUint8();return e}function readASCII(r,t){let e=[],n="";for(let s=0;s<t;s++){let a=String.fromCharCode(r.readUint8());a==="\0"?(e.push(n),n=""):n+=a}return e.length===1?e[0]:e}function readShort(r,t){if(t===1)return r.readUint16();let e=new Uint16Array(t);for(let n=0;n<t;n++)e[n]=r.readUint16();return e}function readLong(r,t){if(t===1)return r.readUint32();let e=new Uint32Array(t);for(let n=0;n<t;n++)e[n]=r.readUint32();return e}function readRational(r,t){if(t===1)return r.readUint32()/r.readUint32();let e=new Array(t);for(let n=0;n<t;n++)e[n]=r.readUint32()/r.readUint32();return e}function readSByte(r,t){if(t===1)return r.readInt8();let e=new Int8Array(t);for(let n=0;n<t;n++)e[n]=r.readInt8();return e}function readSShort(r,t){if(t===1)return r.readInt16();let e=new Int16Array(t);for(let n=0;n<t;n++)e[n]=r.readInt16();return e}function readSLong(r,t){if(t===1)return r.readInt32();let e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.readInt32();return e}function readSRational(r,t){if(t===1)return r.readInt32()/r.readInt32();let e=new Array(t);for(let n=0;n<t;n++)e[n]=r.readInt32()/r.readInt32();return e}function readFloat(r,t){if(t===1)return r.readFloat32();let e=new Float32Array(t);for(let n=0;n<t;n++)e[n]=r.readFloat32();return e}function readDouble(r,t){if(t===1)return r.readFloat64();let e=new Float64Array(t);for(let n=0;n<t;n++)e[n]=r.readFloat64();return e}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let t=0;t<256;t++)stringTable.push([t]);const r=[];for(let t=256;t<4096;t++)stringTable.push(r)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new IOBuffer$4(t.byteLength),this.initializeTable()}decode(){let t=0,e=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const s=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(s),this.addStringToTable(s),e=t}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(stringTable[this.tableLength++]=t,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function decompressLzw(r){return new LzwDecoder(r).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,e=dateTimeRegex.exec(this.dateTime);if(e===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const n=[];for(let s=0;s<t;s++)n.push([e[s],e[s+t],e[s+2*t]]);return n}}function alwaysArray(r){return typeof r=="number"?[r]:r}function decompressZlib(r){const t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),e=inflate_1(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}const defaultOptions$g={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw unsupported("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$g,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t,!0)),t.onlyFirst)return[e[0]];return e}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,e){this.seek(this._nextIFD);let n;if(e)n=new TiffIfd;else{if(!t.kind)throw new Error("kind is missing");n=new IFD(t.kind)}const s=this.readUint16();for(let a=0;a<s;a++)this.decodeIFDEntry(n);if(!t.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(t){const e=this.offset,n=this.readUint16(),s=this.readUint16(),a=this.readUint32();if(s<1||s>12){this.skip(4);return}getByteLength(s,a)>4&&this.seek(this.readUint32());const l=readData(this,s,a);if(t.fields.set(n,l),n===34665||n===34853){let c=this.offset,h="exif";n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,t[h]=this.decodeIFD({kind:h,ignoreImageData:!0},!1),this.offset=c}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;if(e&&e!==1)throw unsupported("orientation",e);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.type===0){const n=t.bitsPerSample,s=Math.pow(2,n)-1;for(let a=0;a<t.data.length;a++)t.data[a]=s-t.data[a]}}readStripData(t){const e=t.width,n=t.height,s=t.bitsPerSample,a=t.sampleFormat,o=e*n*t.samplesPerPixel,l=getDataArray(o,s,a),h=t.rowsPerStrip*e*t.samplesPerPixel,f=t.stripOffsets,u=t.stripByteCounts||guessStripByteCounts(t);let d=o,g=0;for(let p=0;p<f.length;p++){let x=new DataView(this.buffer,this.byteOffset+f[p],u[p]),y=d>h?h:d;d-=y;let m=x;switch(t.compression){case 1:break;case 5:{m=decompressLzw(x);break}case 8:{m=decompressZlib(x);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",t.compression)}g=this.fillUncompressed(s,a,l,m,g,y)}t.data=l}fillUncompressed(t,e,n,s,a,o){if(t===8)return fill8bit(n,s,a,o);if(t===16)return fill16bit(n,s,a,o,this.isLittleEndian());if(t===32&&e===3)return fillFloat32(n,s,a,o,this.isLittleEndian());throw unsupported("bitDepth",t)}applyPredictor(t){const e=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(e===8)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else if(e===16)applyHorizontalDifferencing16Bit(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${e}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:e,components:n,maxSampleValue:s}=t;for(let a=0;a<e.length;a+=n){const o=e[a+n-1];for(let l=0;l<n-1;l++)e[a+l]=Math.round(e[a+l]*s/o)}}}}function getDataArray(r,t,e){if(t===8)return new Uint8Array(r);if(t===16)return new Uint16Array(r);if(t===32&&e===3)return new Float32Array(r);throw unsupported("bit depth / sample format",`${t} / ${e}`)}function fill8bit(r,t,e,n){for(let s=0;s<n;s++)r[e++]=t.getUint8(s);return e}function fill16bit(r,t,e,n,s){for(let a=0;a<n*2;a+=2)r[e++]=t.getUint16(a,s);return e}function fillFloat32(r,t,e,n,s){for(let a=0;a<n*4;a+=4)r[e++]=t.getFloat32(a,s);return e}function unsupported(r,t){return new Error(`Unsupported ${r}: ${t}`)}function decodeTIFF(r,t){return new TIFFDecoder(r).decode(t)}function matchAndCrop(r={}){let{algorithm:t="matchToPrevious",ignoreBorder:e=[0,0]}=r;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=t==="matchToPrevious",s=this[0],a=[];a[0]={position:[0,0],image:this[0]};let o=[0,0];for(let d=1;d<this.length;d++){let g=s.getBestMatch(this[d],{border:e});a[d]={position:[g[0]+o[0],g[1]+o[1]],image:this[d]},n&&(o[0]+=g[0],o[1]+=g[1],s=this[d])}let l=0,c=0,h=0,f=0;for(let d=0;d<a.length;d++){let g=a[d];g.position[0]>l&&(l=g.position[0]),g.position[0]<c&&(c=g.position[0]),g.position[1]>h&&(h=g.position[1]),g.position[1]<f&&(f=g.position[1])}c=0-c,f=0-f;for(let d=0;d<a.length;d++){let g=a[d];g.crop=g.image.crop({x:l-g.position[0],y:h-g.position[1],width:s.width-c-l,height:s.height-f-h})}let u=[];for(let d=0;d<a.length;d++)u[d]=a[d].crop;return new Stack(u)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].min;for(let t=1;t<this.length;t++)for(let e=0;e<r.length;e++)r[e]=Math.min(r[e],this[t].min[e]);return r}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].max;for(let t=1;t<this.length;t++)for(let e=0;e<r.length;e++)r[e]=Math.max(r[e],this[t].max[e]);return r}function median$2(r){let t=r.reduce((o,l)=>o+l);if(t===0)throw new Error("unreachable");let e=0,n=0,s=t/2,a;for(;;){if(r[e]>0){if(a!==void 0)return(a+e)/2;if(n+=r[e],n>s)return e;n===s&&(a=e)}e++}}function mean$2(r){let t=0,e=0;for(let n=0;n<r.length;n++)t+=r[n],e+=r[n]*n;return t===0?0:e/t}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let r=this.getHistograms({maxSlots:this[0].maxValue+1}),t=new Array(r.length);for(let e=0;e<r.length;e++){let n=r[e];t[e]=median$2(n)}return t}function histogram(r){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistogram(r);for(let e=1;e<this.length;e++){let n=this[e].getHistogram(r);for(let s=0;s<t.length;s++)t[s]+=n[s]}return t}function histograms(r){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistograms(r),e=t[0].length;for(let n=1;n<this.length;n++){let s=this[n].getHistograms(r);for(let a=0;a<t.length;a++)for(let o=0;o<e;o++)t[a][o]+=s[a][o]}return t}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let r=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let s=this[n];for(let a=0;a<this[0].data.length;a++)r[a]+=s.data[a]}let t=Image.createFrom(this[0]),e=t.data;for(let n=0;n<this[0].data.length;n++)e[n]=r[n]/this.length;return t}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let r=Image.createFrom(this[0]);r.data.fill(0);for(const t of this)for(let e=0;e<r.data.length;e++)r.data[e]=Math.max(t.data[e],r.data[e]);return r}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let r=Image.createFrom(this[0]);r.data.fill(r.maxValue);for(const t of this)for(let e=0;e<r.data.length;e++)r.data[e]=Math.min(t.data[e],r.data[e]);return r}function extend$2(r){r.extendMethod("matchAndCrop",matchAndCrop),r.extendMethod("getMin",min$2),r.extendMethod("getMax",max$2),r.extendMethod("getMedian",median$1),r.extendMethod("getHistogram",histogram),r.extendMethod("getHistograms",histograms),r.extendMethod("getAverage",averageImage),r.extendMethod("getAverageImage",averageImage),r.extendMethod("getMaxImage",maxImage),r.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let e=0;e<t.length;e++)this[e]=t[e]}else typeof t=="number"?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image.load)).then(e=>new Stack(e))}static extendMethod(t,e,n={}){let{inPlace:s=!1,returnThis:a=!0,partialArgs:o=[]}=n;return s?Stack.prototype[t]=function(...l){this.computed=null;let c=e.apply(this,[...o,...l]);return a?this:c}:Stack.prototype[t]=function(...l){return e.apply(this,[...o,...l])},Stack}static extendProperty(t,e,n={}){let{partialArgs:s=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let a=e.apply(this,s);return this.computed[t]=a,a},Object.defineProperty(Stack.prototype,t,computedPropertyDescriptor),Stack}checkProcessable(t,e={}){if(typeof t!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,e);for(let n=1;n<this.length;n++){if((e.sameSize===void 0||e.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((e.sameSize===void 0||e.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((e.sameAlpha===void 0||e.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((e.sameBitDepth===void 0||e.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((e.sameColorModel===void 0||e.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((e.sameNumberChannels===void 0||e.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(r,t){if(typeof r!="function")throw new TypeError(`${r} is not a function`);let e=new Stack(this.length);for(let n=0;n<this.length;n++)e[n]=r.call(t,this[n],n,this);return e});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(r,t){if(typeof r=="string")return loadURL(r,t);if(r instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(r),void 0,t&&t.ignorePalette));if(r.buffer)return Promise.resolve(loadBinary(r,void 0,t&&t.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(r,t,e){const n=imageType$1(r);if(n)switch(n.mime){case"image/png":return loadPNG(r);case"image/jpeg":return loadJPEG(r);case"image/tiff":return loadTIFF(r,e);default:return loadGeneric(s(n.mime))}return loadGeneric(s("application/octet-stream"));function s(a){return t||toBase64URL(r,a)}}function loadURL(r,t){const e=r.slice(0,64).match(isDataURL);let n;return e!==null?n=Promise.resolve(decode$3(r.slice(e[0].length))):n=fetchBinary(r,t),n.then(s=>{const a=new Uint8Array(s);return loadBinary(a,e?r:void 0,t&&t.ignorePalette)})}function loadPNG(r){const t=decodePng(r);let e=t.channels,n,s=0;return e===2||e===4?(n=e-1,s=1):n=e,t.palette?loadPNGFromPalette(t):new Image(t.width,t.height,t.data,{components:n,alpha:s,bitDepth:t.depth})}function loadPNGFromPalette(r){const t=r.width*r.height,e=r.palette[0].length,n=new Uint8Array(t*e),s=8/r.depth,a=r.depth<8?s:1,o=parseInt("1".repeat(r.depth),2),l=e===4;let c=0;for(let h=0;h<t;h++){const f=Math.floor(h/a);let u=r.data[f];r.depth<8&&(u=u>>>r.depth*(s-1-h%s)&o);const d=r.palette[u];n[c++]=d[0],n[c++]=d[1],n[c++]=d[2],l&&(n[c++]=d[3])}return new Image(r.width,r.height,n,{components:3,alpha:l,bitDepth:8})}function loadJPEG(r){const t=decode(r);let e;t.exif&&(e=getMetadata(t.exif));const n=jpegJs.decode(r,{useTArray:!0,maxMemoryUsageInMB:1024});let s=new Image(n.width,n.height,n.data,{meta:e});if(e&&e.tiff.tags.Orientation){const a=e.tiff.tags.Orientation;a>2&&(s=s.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[a])),[2,4,5,7].includes(a)&&(s=s.flipX())}return s}function loadTIFF(r,t){let e=decodeTIFF(r);return e.length===1?getImageFromIFD(e[0],t):new Stack(e.map(function(n){return getImageFromIFD(n,t)}))}function getMetadata(r){const t={tiff:{fields:r.fields,tags:r.map}};return r.exif&&(t.exif=r.exif),r.gps&&(t.gps=r.gps),t}function getImageFromIFD(r,t){if(!t&&r.type===3){const e=new Uint16Array(3*r.width*r.height),n=r.palette;let s=0;for(let a=0;a<r.data.length;a++){const o=r.data[a],l=n[o];e[s++]=l[0],e[s++]=l[1],e[s++]=l[2]}return new Image(r.width,r.height,e,{components:3,alpha:r.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(r)})}else return new Image(r.width,r.height,r.data,{components:r.type===2?3:1,alpha:r.alpha,colorModel:r.type===2?RGB$1:GREY$1,bitDepth:r.bitsPerSample.length?r.bitsPerSample[0]:r.bitsPerSample,meta:getMetadata(r)})}function loadGeneric(r,t){return t=t||{},new Promise(function(e,n){let s=new DOMImage;s.onload=function(){let a=s.width,o=s.height,c=createCanvas(a,o).getContext("2d");c.drawImage(s,0,0,a,o);let h=c.getImageData(0,0,a,o).data;e(new Image(a,o,h,t))},s.onerror=function(){n(new Error(`Could not load ${r}`))},s.src=r})}const valueMethods={getValueXY(r,t,e){return this.data[(t*this.width+r)*this.channels+e]},setValueXY(r,t,e,n){return this.data[(t*this.width+r)*this.channels+e]=n,this.computed=null,this},getValue(r,t){return this.data[r*this.channels+t]},setValue(r,t,e){return this.data[r*this.channels+t]=e,this.computed=null,this},getPixelXY(r,t){return this.getPixel(t*this.width+r)},setPixelXY(r,t,e){return this.setPixel(t*this.width+r,e)},getPixel(r){const t=new Array(this.channels),e=r*this.channels;for(let n=0;n<this.channels;n++)t[n]=this.data[e+n];return t},setPixel(r,t){const e=r*this.channels;for(let n=0;n<t.length;n++)this.data[e+n]=t[n];return this.computed=null,this}};function setValueMethods(r){for(const t in valueMethods)r.prototype[t]=valueMethods[t]}function getImageParameters(r){return{width:r.width,height:r.height,components:r.components,alpha:r.alpha,colorModel:r.colorModel,bitDepth:r.bitDepth}}function getOutputImage(r,t,e,n={}){const{out:s}=t;if(s===void 0)return n.copy?r.clone():Image.createFrom(r,e);{if(!Image.isImage(s))throw new TypeError("out must be an Image object");const a=Object.assign(getImageParameters(r),e);for(const o in a)if(s[o]!==a[o])throw new RangeError(`cannot use out. Its ${o} must be "${a[o]}" (found "${s[o]}")`);return s}}function getOutputImageOrInPlace(r,t,e){if(t.inPlace!==void 0&&typeof t.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(t.inPlace){if(t.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return r}return getOutputImage(r,t,null,e)}function abs(r={}){this.checkProcessable("abs",{bitDepth:[32]});const t=getOutputImageOrInPlace(this,r);return absolute(this,t),t}function absolute(r,t){for(let e=0;e<r.data.length;e++)t.data[e]=Math.abs(r.data[e])}function copyAlphaChannel(r,t){if(r.alpha===1&&t.alpha===1)for(let e=0;e<r.size;e++)t.data[e*t.channels+t.components]=r.data[e*r.channels+r.components]}function invert(r={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const t=getOutputImageOrInPlace(this,r);return this.bitDepth===1?invertBinary(this,t):(invertColor(this,t),this!==t&&copyAlphaChannel(this,t)),t}function invertBinary(r,t){for(let e=0;e<r.data.length;e++)t.data[e]=~r.data[e]}function invertColor(r,t){for(let e=0;e<r.data.length;e+=r.channels)for(let n=0;n<r.components;n++)t.data[e+n]=r.maxValue-r.data[e+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let r=0;r<this.height;r++){let t=r*this.width*this.channels;for(let e=0;e<Math.floor(this.width/2);e++){let n=e*this.channels+t,s=(this.width-e-1)*this.channels+t;for(let a=0;a<this.channels;a++){let o=this.data[n+a];this.data[n+a]=this.data[s+a],this.data[s+a]=o}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let r=0;r<Math.floor(this.height/2);r++)for(let t=0;t<this.width;t++){let e=t*this.channels+r*this.width*this.channels,n=t*this.channels+(this.height-1-r)*this.channels*this.width;for(let s=0;s<this.channels;s++){let a=this.data[e+s];this.data[e+s]=this.data[n+s],this.data[n+s]=a}}return this}function blurFilter(r={}){const{radius:t=1}=r;if(t<1)throw new Error("radius must be greater than 1");const e=2*t+1,n=new Array(e);for(let s=0;s<e;s++){n[s]=new Array(e);for(let a=0;a<e;a++)n[s][a]=1/(e*e)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(r){(function(){function t(s){for(var a=0,o=s.length-1,l=void 0,c=void 0,h=void 0,f=n(a,o);;){if(o<=a)return s[f];if(o==a+1)return s[a]>s[o]&&e(s,a,o),s[f];for(l=n(a,o),s[l]>s[o]&&e(s,l,o),s[a]>s[o]&&e(s,a,o),s[l]>s[a]&&e(s,l,a),e(s,l,a+1),c=a+1,h=o;;){do c++;while(s[a]>s[c]);do h--;while(s[h]>s[a]);if(h<c)break;e(s,c,h)}e(s,a,h),h<=f&&(a=c),h>=f&&(o=h-1)}}var e=function(a,o,l){var c;return c=[a[l],a[o]],a[o]=c[0],a[l]=c[1],c},n=function(a,o){return~~((a+o)/2)};r.exports?r.exports=t:window.median=t})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports;const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(r,t={}){let{channels:e,allowAlpha:n,defaultAlpha:s}=t;return typeof n!="boolean"&&(n=!0),typeof e>"u"?allChannels(r,s):validateChannels(r,e,n)}function allChannels(r,t){let e=t?r.channels:r.components,n=new Array(e);for(let s=0;s<e;s++)n[s]=s;return n}function validateChannels(r,t,e){Array.isArray(t)||(t=[t]);for(let n=0;n<t.length;n++)t[n]=validateChannel(r,t[n],e);return t}function validateChannel(r,t,e=!0){if(t===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${r.channels}`);if(typeof t=="string"){switch(r.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(t))switch(t){case"r":t=0;break;case"g":t=1;break;case"b":t=2;break}break;case HSL:if("hsl".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"l":t=2;break}break;case HSV:if("hsv".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"v":t=2;break}break;case CMYK$1:if("cmyk".includes(t))switch(t){case"c":t=0;break;case"m":t=1;break;case"y":t=2;break;case"k":t=3;break}break;default:throw new Error(`Unexpected color model: ${r.colorModel}`)}if(t==="a"){if(!r.alpha)throw new Error("validateChannel : the image does not contain alpha channel");t=r.components}if(typeof t=="string")throw new Error(`validateChannel : undefined channel: ${t}`)}if(t>=r.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${r.channels}`);if(!e&&t>=r.components)throw new RangeError("validateChannel : alpha channel may not be selected");return t}function medianFilter(r={}){let{radius:t=1,border:e="copy",channels:n}=r;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),t<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let s=t,a=t,o=Image.createFrom(this),l=(s*2+1)*(a*2+1),c=new Array(l);for(let h=0;h<n.length;h++){let f=n[h];for(let u=a;u<this.height-a;u++)for(let d=s;d<this.width-s;d++){let g=0;for(let x=-a;x<=a;x++)for(let y=-s;y<=s;y++){let m=((u+x)*this.width+d+y)*this.channels+f;c[g++]=this.data[m]}let p=(u*this.width+d)*this.channels+f;o.data[p]=quickSelectMedian(c)}}if(this.alpha&&!n.includes(this.channels))for(let h=this.components;h<this.data.length;h=h+this.channels)o.data[h]=this.data[h];return o.setBorder({size:[s,a],algorithm:e}),o}function gaussianFilter(r={}){let{radius:t=1,sigma:e,channels:n,border:s="copy"}=r;this.checkProcessable("gaussian",{bitDepth:[8,16]});const a=getKernel(t,e);return this.convolution([a,a],{border:s,channels:n,algorithm:"separable"})}function getKernel(r,t){const e=r*2+1,n=new Array(e),s=t||((e-1)*.5-1)*.3+.8,a=-.5/(s*s);let o=0;for(let l=0;l<e;l++){const c=l-r,h=Math.exp(a*c*c);n[l]=h,o+=h}for(let l=0;l<e;l++)n[l]/=o;return n}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(r){(function(){var t;t=r;var e={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+e.release+", released "+e.date};for(var n=0,s=null,a=null,o={init:function(h){if(h!==0&&!(h&h-1))n=h,o._initArray(),o._makeBitReversalTable(),o._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(h,f){o.fft(h,f,1)},ifft1d:function(h,f){var u=1/n;o.fft(h,f,-1);for(var d=0;d<n;d++)h[d]*=u,f[d]*=u},bt1d:function(h,f){o.fft(h,f,-1)},fft2d:function(h,f){for(var u=[],d=[],g=0,p=0;p<n;p++){g=p*n;for(var x=0;x<n;x++)u[x]=h[x+g],d[x]=f[x+g];o.fft1d(u,d);for(var y=0;y<n;y++)h[y+g]=u[y],f[y+g]=d[y]}for(var m=0;m<n;m++){for(var A=0;A<n;A++)g=m+A*n,u[A]=h[g],d[A]=f[g];o.fft1d(u,d);for(var b=0;b<n;b++)g=m+b*n,h[g]=u[b],f[g]=d[b]}},ifft2d:function(h,f){for(var u=[],d=[],g=0,p=0;p<n;p++){g=p*n;for(var x=0;x<n;x++)u[x]=h[x+g],d[x]=f[x+g];o.ifft1d(u,d);for(var y=0;y<n;y++)h[y+g]=u[y],f[y+g]=d[y]}for(var m=0;m<n;m++){for(var A=0;A<n;A++)g=m+A*n,u[A]=h[g],d[A]=f[g];o.ifft1d(u,d);for(var b=0;b<n;b++)g=m+b*n,h[g]=u[b],f[g]=d[b]}},fft:function(h,f,u){for(var d,g,p,x,y,m,A,b,_,M=n>>2,T=0;T<n;T++)x=s[T],T<x&&(y=h[T],h[T]=h[x],h[x]=y,y=f[T],f[T]=f[x],f[x]=y);for(var D=1;D<n;D<<=1){g=0,d=n/(D<<1);for(var E=0;E<D;E++){m=a[g+M],A=u*a[g];for(var S=E;S<n;S+=D<<1)p=S+D,b=m*h[p]+A*f[p],_=m*f[p]-A*h[p],h[p]=h[S]-b,h[S]+=b,f[p]=f[S]-_,f[S]+=_;g+=d}}},_initArray:function(){typeof Uint32Array<"u"?s=new Uint32Array(n):s=[],typeof Float64Array<"u"?a=new Float64Array(n*1.25):a=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var h=0,f=0,u=0;for(s[0]=0;++h<n;){for(u=n>>1;u<=f;)f-=u,u>>=1;f+=u,s[h]=f}},_makeCosSinTable:function(){var h=n>>1,f=n>>2,u=n>>3,d=h+f,g=Math.sin(Math.PI/n),p=2*g*g,x=Math.sqrt(p*(2-p)),y=a[f]=1,m=a[0]=0;g=2*p;for(var A=1;A<u;A++)y-=p,p+=g*y,m+=x,x-=g*m,a[A]=m,a[f-A]=y;u!==0&&(a[u]=Math.sqrt(.5));for(var b=0;b<f;b++)a[h-b]=a[b];for(var _=0;_<d;_++)a[_+h]=-a[_]}},l=["init","fft1d","ifft1d","fft2d","ifft2d"],c=0;c<l.length;c++)t[l[c]]=o[l[c]];return t.bt=o.bt1d,t.fft=o.fft1d,t.ifft=o.ifft1d,t}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(r,t,e){var n=new Array(t*e),s=t/2,a=(e-1)*2;FFT$1.init(s);for(var o={re:new Array(s),im:new Array(s)},l=0;l<e;l++){for(var c=s-1;c>=0;c--)o.re[c]=r[c*2*e+l],o.im[c]=r[(c*2+1)*e+l];FFT$1.bt(o.re,o.im);for(var c=s-1;c>=0;c--)n[c*2*e+l]=o.re[c],n[(c*2+1)*e+l]=o.im[c]}var h=new Array(s*a);FFT$1.init(a);for(var f={re:new Array(a),im:new Array(a)},u=a*s,c=0;c<t;c+=2){f.re[0]=n[c*e],f.im[0]=n[(c+1)*e];for(var l=1;l<e;l++)f.re[l]=n[c*e+l],f.im[l]=n[(c+1)*e+l],f.re[a-l]=n[c*e+l],f.im[a-l]=-n[(c+1)*e+l];FFT$1.bt(f.re,f.im);for(var d=c/2*a,l=a-1;l>=0;l--)h[d+l]=f.re[l]/u}return h},fft2DArray:function(r,t,e,n){Object.assign({},{inplace:!0});var s=e/2+1,a=t*2,o=new Array(a*s);FFT$1.init(e);for(var l={re:new Array(e),im:new Array(e)},c={re:new Array(e),im:new Array(e)},h={re:new Array(e),im:new Array(e)},f,u,d,g,p,x=0;x<t/2;x++){f=x*2*e,l.re=r.slice(f,f+e),f=(x*2+1)*e,l.im=r.slice(f,f+e),FFT$1.fft1d(l.re,l.im),this.reconstructTwoRealFFT(l,c,h),u=x*4*s,d=(x*4+1)*s,g=(x*4+2)*s,p=(x*4+3)*s;for(var y=s-1;y>=0;y--)o[u+y]=c.re[y],o[d+y]=c.im[y],o[g+y]=h.re[y],o[p+y]=h.im[y]}c=null,h=null;var m=new Array(a*s);FFT$1.init(t);for(var A={re:new Array(t),im:new Array(t)},b=s-1;b>=0;b--){for(var x=t-1;x>=0;x--)A.re[x]=o[x*2*s+b],A.im[x]=o[(x*2+1)*s+b],isNaN(A.re[x])&&(A.re[x]=0),isNaN(A.im[x])&&(A.im[x]=0);FFT$1.fft1d(A.re,A.im);for(var x=t-1;x>=0;x--)m[x*2*s+b]=A.re[x],m[(x*2+1)*s+b]=A.im[x]}return m},reconstructTwoRealFFT:function(r,t,e){var n=r.re.length;t.re[0]=r.re[0],t.im[0]=0,e.re[0]=r.im[0],e.im[0]=0;for(var s,a,o,l,c,h=n/2;h>0;h--)c=n-h,s=.5*(r.re[h]-r.re[c]),a=.5*(r.re[h]+r.re[c]),o=.5*(r.im[h]-r.im[c]),l=.5*(r.im[h]+r.im[c]),t.re[h]=a,t.im[h]=o,t.re[c]=a,t.im[c]=-o,e.re[h]=l,e.im[h]=-s,e.re[c]=l,e.im[c]=s},convolute2DI:function(r,t,e,n){for(var s,a,o=0;o<e/2;o++)for(var l=0;l<n;l++)s=r[o*2*n+l]*t[o*2*n+l]-r[(o*2+1)*n+l]*t[(o*2+1)*n+l],a=r[o*2*n+l]*t[(o*2+1)*n+l]+r[(o*2+1)*n+l]*t[o*2*n+l],r[o*2*n+l]=s,r[(o*2+1)*n+l]=a},convolute:function(r,t,e,n,s){for(var a=new Array(n*e),o=0;o<e*n;o++)a[o]=r[o];a=this.fft2DArray(a,e,n);for(var l=t.length,c=t[0].length,h=new Array(n*e),o=0;o<n*e;o++)h[o]=0;for(var f,u,d=Math.floor((l-1)/2),g=Math.floor((c-1)/2),p=0;p<l;p++){f=(p-d+e)%e;for(var x=0;x<c;x++)u=(x-g+n)%n,h[f*n+u]=t[p][x]}h=this.fft2DArray(h,e,n);var y=e*2,m=n/2+1;return this.convolute2DI(a,h,y,m),this.ifft2DArray(a,y,m)},toRadix2:function(r,t,e){var n,s,a,o,l=e,c=t;if(!(e!==0&&!(e&e-1))){for(l=0;e>>++l;);l=1<<l}if(!(t!==0&&!(t&t-1))){for(c=0;t>>++c;);c=1<<c}if(c==t&&l==e)return{data:r,rows:t,cols:e};var h=new Array(c*l),f=Math.floor((c-t)/2)-t,u=Math.floor((l-e)/2)-e;for(n=0;n<c;n++)for(a=n*l,o=(n-f)%t*e,s=0;s<l;s++)h[a+s]=r[o+(s-u)%e];return{data:h,rows:c,cols:l}},crop:function(r,t,e,n,s,a){if(t==n&&e==s)return r;Object.assign({},a);var o=new Array(s*n),l=Math.floor((t-n)/2),c=Math.floor((e-s)/2),h,f,u,d;for(u=0;u<n;u++)for(h=u*s,f=(u+l)*e,d=0;d<s;d++)o[h+d]=r[f+(d+c)];return o}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(r,t,e){var n=matrix2Array(r),s=n.data,a=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},e),o,l;if(a.rows&&a.cols)o=a.rows,l=a.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var c=a.divisor,h,f,u=t.length,d=t[0].length;if(a.normalize)for(c=0,h=0;h<u;h++)for(f=0;f<d;f++)c+=t[h][f];if(c===0)throw new RangeError("convolution: The divisor is equal to zero");var g=FFTUtils.toRadix2(s,o,l),p=FFTUtils.convolute(g.data,t,g.rows,g.cols);if(p=FFTUtils.crop(p,g.rows,g.cols,o,l),c!=0&&c!=1)for(h=0;h<p.length;h++)p[h]/=c;return p}function convolutionDirect(r,t,e){var n=matrix2Array(r),s=n.data,a=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},e),o,l;if(a.rows&&a.cols)o=a.rows,l=a.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var c=a.divisor,h=t.length,f=t[0].length,u,d,g,p,x,y,m,A,b;if(a.normalize)for(c=0,u=0;u<h;u++)for(d=0;d<f;d++)c+=t[u][d];if(c===0)throw new RangeError("convolution: The divisor is equal to zero");var _=new Array(o*l),M=Math.floor(h/2),T=Math.floor(f/2);for(p=0;p<o;p++)for(g=0;g<l;g++){for(y=0,d=0;d<h;d++)for(u=0;u<f;u++)m=t[h-d-1][f-u-1],A=(p+d-M+o)%o,b=(g+u-T+l)%l,x=A*l+b,y+=s[x]*m;x=p*l+g,_[x]=y/c}return _}function LoG(r,t,e){var n=1e3;e&&e.factor&&(n=e.factor);var s=new Array(t),a,o,l,c;n*=-1;var h=(t-1)/2,f=2*r*r;for(a=0;a<t;a++)for(s[a]=new Array(t),c=(a-h)*(a-h),o=0;o<t;o++)l=-((o-h)*(o-h)+c)/f,s[a][o]=Math.round(n*(1+l)*Math.exp(l));return s}function matrix2Array(r){var t=r,e,n;if(typeof r[0]!="number"){e=r.length,n=r[0].length,t=new Array(e*n);for(var s=0;s<e;s++)for(var a=0;a<n;a++)t[s*n+a]=r[s][a]}else{var o=Math.sqrt(r.length);Number.isInteger(o)&&(e=o,n=o)}return{data:t,rows:e,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(r){return!(typeof r!="number"||r!==r||r===1/0||r===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(r){return typeof r=="number"&&isFinite$1(r)&&Math.floor(r)===r};const isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(r){let t,e;if(Array.isArray(r))if(Array.isArray(r[0])){if(!(r.length&1)||!(r[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");t=Math.floor(r.length/2),e=Math.floor(r[0].length/2)}else{let n=Math.sqrt(r.length);if(isInteger$1(n))e=t=Math.floor(Math.sqrt(r.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let s=new Array(n);for(let a=0;a<n;a++){s[a]=new Array(n);for(let o=0;o<n;o++)s[a][o]=r[a*n+o]}r=s}else throw new Error(`validateKernel: Invalid Kernel: ${r}`);return{kernel:r,kWidth:e,kHeight:t}}function clamp(r,t){return Math.round(Math.min(Math.max(r,0),t.maxValue))}function directConvolution(r,t,e){if(e===void 0){const a=r.length+t.length-1;e=new Array(a)}fill(e);for(var n=0;n<r.length;n++)for(var s=0;s<t.length;s++)e[n+s]+=r[n]*t[s];return e}function fill(r){for(var t=0;t<r.length;t++)r[t]=0}function FFT(r){if(this.size=r|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=r<<1;for(var t=new Array(this.size*2),e=0;e<t.length;e+=2){const c=Math.PI*e/this.size;t[e]=Math.cos(c),t[e+1]=-Math.sin(c)}this.table=t;for(var n=0,s=1;this.size>s;s<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var a=0;a<this._bitrev.length;a++){this._bitrev[a]=0;for(var o=0;o<this._width;o+=2){var l=this._width-o-2;this._bitrev[a]|=(a>>>o&3)<<l}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function r(t,e){for(var n=e||new Array(t.length>>>1),s=0;s<t.length;s+=2)n[s>>>1]=t[s];return n};FFT.prototype.createComplexArray=function r(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t};FFT.prototype.toComplexArray=function r(t,e){for(var n=e||this.createComplexArray(),s=0;s<n.length;s+=2)n[s]=t[s>>>1],n[s+1]=0;return n};FFT.prototype.completeSpectrum=function r(t){for(var e=this._csize,n=e>>>1,s=2;s<n;s+=2)t[e-s]=t[s],t[e-s+1]=-t[s+1]};FFT.prototype.transform=function r(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function r(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function r(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function r(){var t=this._out,e=this._csize,n=this._width,s=1<<n,a=e/s<<1,o,l,c=this._bitrev;if(a===4)for(o=0,l=0;o<e;o+=a,l++){const x=c[l];this._singleTransform2(o,x,s)}else for(o=0,l=0;o<e;o+=a,l++){const x=c[l];this._singleTransform4(o,x,s)}var h=this._inv?-1:1,f=this.table;for(s>>=2;s>=2;s>>=2){a=e/s<<1;var u=a>>>2;for(o=0;o<e;o+=a)for(var d=o+u,g=o,p=0;g<d;g+=2,p+=s){const x=g,y=x+u,m=y+u,A=m+u,b=t[x],_=t[x+1],M=t[y],T=t[y+1],D=t[m],E=t[m+1],S=t[A],w=t[A+1],v=b,k=_,I=f[p],L=h*f[p+1],F=M*I-T*L,Z=M*L+T*I,W=f[2*p],G=h*f[2*p+1],P=D*W-E*G,C=D*G+E*W,Y=f[3*p],j=h*f[3*p+1],R=S*Y-w*j,N=S*j+w*Y,U=v+P,z=k+C,H=v-P,ee=k-C,se=F+R,ae=Z+N,he=h*(F-R),we=h*(Z-N),ge=U+se,J=z+ae,q=U-se,xe=z-ae,ue=H+we,pe=ee-he,V=H-we,oe=ee+he;t[x]=ge,t[x+1]=J,t[y]=ue,t[y+1]=pe,t[m]=q,t[m+1]=xe,t[A]=V,t[A+1]=oe}}};FFT.prototype._singleTransform2=function r(t,e,n){const s=this._out,a=this._data,o=a[e],l=a[e+1],c=a[e+n],h=a[e+n+1],f=o+c,u=l+h,d=o-c,g=l-h;s[t]=f,s[t+1]=u,s[t+2]=d,s[t+3]=g};FFT.prototype._singleTransform4=function r(t,e,n){const s=this._out,a=this._data,o=this._inv?-1:1,l=n*2,c=n*3,h=a[e],f=a[e+1],u=a[e+n],d=a[e+n+1],g=a[e+l],p=a[e+l+1],x=a[e+c],y=a[e+c+1],m=h+g,A=f+p,b=h-g,_=f-p,M=u+x,T=d+y,D=o*(u-x),E=o*(d-y),S=m+M,w=A+T,v=b+E,k=_-D,I=m-M,L=A-T,F=b-E,Z=_+D;s[t]=S,s[t+1]=w,s[t+2]=v,s[t+3]=k,s[t+4]=I,s[t+5]=L,s[t+6]=F,s[t+7]=Z};FFT.prototype._realTransform4=function r(){var t=this._out,e=this._csize,n=this._width,s=1<<n,a=e/s<<1,o,l,c=this._bitrev;if(a===4)for(o=0,l=0;o<e;o+=a,l++){const be=c[l];this._singleRealTransform2(o,be>>>1,s>>>1)}else for(o=0,l=0;o<e;o+=a,l++){const be=c[l];this._singleRealTransform4(o,be>>>1,s>>>1)}var h=this._inv?-1:1,f=this.table;for(s>>=2;s>=2;s>>=2){a=e/s<<1;var u=a>>>1,d=u>>>1,g=d>>>1;for(o=0;o<e;o+=a)for(var p=0,x=0;p<=g;p+=2,x+=s){var y=o+p,m=y+d,A=m+d,b=A+d,_=t[y],M=t[y+1],T=t[m],D=t[m+1],E=t[A],S=t[A+1],w=t[b],v=t[b+1],k=_,I=M,L=f[x],F=h*f[x+1],Z=T*L-D*F,W=T*F+D*L,G=f[2*x],P=h*f[2*x+1],C=E*G-S*P,Y=E*P+S*G,j=f[3*x],R=h*f[3*x+1],N=w*j-v*R,U=w*R+v*j,z=k+C,H=I+Y,ee=k-C,se=I-Y,ae=Z+N,he=W+U,we=h*(Z-N),ge=h*(W-U),J=z+ae,q=H+he,xe=ee+ge,ue=se-we;if(t[y]=J,t[y+1]=q,t[m]=xe,t[m+1]=ue,p===0){var pe=z-ae,V=H-he;t[A]=pe,t[A+1]=V;continue}if(p!==g){var oe=ee,le=-se,ce=z,K=-H,Me=-h*ge,_e=-h*we,te=-h*he,ne=-h*ae,fe=oe+Me,re=le+_e,me=ce+ne,ye=K-te,de=o+d-p,ve=o+u-p;t[de]=fe,t[de+1]=re,t[ve]=me,t[ve+1]=ye}}}};FFT.prototype._singleRealTransform2=function r(t,e,n){const s=this._out,a=this._data,o=a[e],l=a[e+n],c=o+l,h=o-l;s[t]=c,s[t+1]=0,s[t+2]=h,s[t+3]=0};FFT.prototype._singleRealTransform4=function r(t,e,n){const s=this._out,a=this._data,o=this._inv?-1:1,l=n*2,c=n*3,h=a[e],f=a[e+n],u=a[e+l],d=a[e+c],g=h+u,p=h-u,x=f+d,y=o*(f-d),m=g+x,A=p,b=-y,_=g-x,M=p,T=y;s[t]=m,s[t+1]=0,s[t+2]=A,s[t+3]=b,s[t+4]=_,s[t+5]=0,s[t+6]=M,s[t+7]=T};function convolutionSeparable(r,t,e,n){const s=new Array(r.length);let a,o,l,c;c=t[1],l=(c.length-1)/2,o=new Array(e+c.length-1),a=new Array(e);for(let h=0;h<n;h++){for(let f=0;f<e;f++)a[f]=r[h*e+f];directConvolution(a,c,o);for(let f=0;f<e;f++)s[h*e+f]=o[l+f]}c=t[0],l=(c.length-1)/2,o=new Array(n+c.length-1),a=new Array(n);for(let h=0;h<e;h++){for(let f=0;f<n;f++)a[f]=s[f*e+h];directConvolution(a,c,o);for(let f=0;f<n;f++)s[f*e+h]=o[l+f]}return s}var matrix$2={};const toString$1=Object.prototype.toString;function isAnyArray$1(r){const t=toString$1.call(r);return t.endsWith("Array]")&&!t.includes("Big")}const libEsm=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:isAnyArray$1},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(libEsm);function max$1(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray$1(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,n=e===void 0?0:e,s=t.toIndex,a=s===void 0?r.length:s;if(n<0||n>=r.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(a<=n||a>r.length||!Number.isInteger(a))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=r[n],l=n+1;l<a;l++)r[l]>o&&(o=r[l]);return o}function min$1(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray$1(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,n=e===void 0?0:e,s=t.toIndex,a=s===void 0?r.length:s;if(n<0||n>=r.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(a<=n||a>r.length||!Number.isInteger(a))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=r[n],l=n+1;l<a;l++)r[l]<o&&(o=r[l]);return o}function rescale$1(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray$1(r)){if(r.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(t.output!==void 0){if(!isAnyArray$1(t.output))throw new TypeError("output option must be an array if specified");e=t.output}else e=new Array(r.length);var n=min$1(r),s=max$1(r);if(n===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var a=t.min,o=a===void 0?t.autoMinMax?n:0:a,l=t.max,c=l===void 0?t.autoMinMax?s:1:l;if(o>=c)throw new RangeError("min option must be smaller than max option");for(var h=(c-o)/(s-n),f=0;f<r.length;f++)e[f]=(r[f]-n)*h+o;return e}const libEs6=Object.freeze(Object.defineProperty({__proto__:null,default:rescale$1},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(libEs6);Object.defineProperty(matrix$2,"__esModule",{value:!0});var isAnyArray=require$$0$3,rescale=require$$1;const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(r,t={}){const{maxRows:e=15,maxColumns:n=10,maxNumSize:s=8,padMinus:a="auto"}=t;return`${r.constructor.name} {
${indent}[
${indentData}${inspectData(r,e,n,s,a)}
${indent}]
${indent}rows: ${r.rows}
${indent}columns: ${r.columns}
}`}function inspectData(r,t,e,n,s){const{rows:a,columns:o}=r,l=Math.min(a,t),c=Math.min(o,e),h=[];if(s==="auto"){s=!1;e:for(let f=0;f<l;f++)for(let u=0;u<c;u++)if(r.get(f,u)<0){s=!0;break e}}for(let f=0;f<l;f++){let u=[];for(let d=0;d<c;d++)u.push(formatNumber(r.get(f,d),n,s));h.push(`${u.join(" ")}`)}return c!==o&&(h[h.length-1]+=` ... ${o-e} more columns`),l!==a&&h.push(`... ${a-t} more rows`),h.join(`
${indentData}`)}function formatNumber(r,t,e){return(r>=0&&e?` ${formatNumber2(r,t-1)}`:formatNumber2(r,t)).padEnd(t)}function formatNumber2(r,t){let e=r.toString();if(e.length<=t)return e;let n=r.toFixed(t);if(n.length>t&&(n=r.toFixed(Math.max(0,t-(n.length-t)))),n.length<=t&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let s=r.toExponential(t);return s.length>t&&(s=r.toExponential(Math.max(0,t-(s.length-t)))),s.slice(0)}function installMathOperations(r,t){r.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},r.prototype.addS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)+n);return this},r.prototype.addM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)+n.get(s,a));return this},r.add=function(n,s){return new t(n).add(s)},r.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},r.prototype.subS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)-n);return this},r.prototype.subM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)-n.get(s,a));return this},r.sub=function(n,s){return new t(n).sub(s)},r.prototype.subtract=r.prototype.sub,r.prototype.subtractS=r.prototype.subS,r.prototype.subtractM=r.prototype.subM,r.subtract=r.sub,r.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},r.prototype.mulS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)*n);return this},r.prototype.mulM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)*n.get(s,a));return this},r.mul=function(n,s){return new t(n).mul(s)},r.prototype.multiply=r.prototype.mul,r.prototype.multiplyS=r.prototype.mulS,r.prototype.multiplyM=r.prototype.mulM,r.multiply=r.mul,r.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},r.prototype.divS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)/n);return this},r.prototype.divM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)/n.get(s,a));return this},r.div=function(n,s){return new t(n).div(s)},r.prototype.divide=r.prototype.div,r.prototype.divideS=r.prototype.divS,r.prototype.divideM=r.prototype.divM,r.divide=r.div,r.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},r.prototype.modS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)%n);return this},r.prototype.modM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)%n.get(s,a));return this},r.mod=function(n,s){return new t(n).mod(s)},r.prototype.modulus=r.prototype.mod,r.prototype.modulusS=r.prototype.modS,r.prototype.modulusM=r.prototype.modM,r.modulus=r.mod,r.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},r.prototype.andS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)&n);return this},r.prototype.andM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)&n.get(s,a));return this},r.and=function(n,s){return new t(n).and(s)},r.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},r.prototype.orS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)|n);return this},r.prototype.orM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)|n.get(s,a));return this},r.or=function(n,s){return new t(n).or(s)},r.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},r.prototype.xorS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)^n);return this},r.prototype.xorM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)^n.get(s,a));return this},r.xor=function(n,s){return new t(n).xor(s)},r.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},r.prototype.leftShiftS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)<<n);return this},r.prototype.leftShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)<<n.get(s,a));return this},r.leftShift=function(n,s){return new t(n).leftShift(s)},r.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},r.prototype.signPropagatingRightShiftS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>n);return this},r.prototype.signPropagatingRightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>n.get(s,a));return this},r.signPropagatingRightShift=function(n,s){return new t(n).signPropagatingRightShift(s)},r.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},r.prototype.rightShiftS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>>n);return this},r.prototype.rightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>>n.get(s,a));return this},r.rightShift=function(n,s){return new t(n).rightShift(s)},r.prototype.zeroFillRightShift=r.prototype.rightShift,r.prototype.zeroFillRightShiftS=r.prototype.rightShiftS,r.prototype.zeroFillRightShiftM=r.prototype.rightShiftM,r.zeroFillRightShift=r.rightShift,r.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,~this.get(n,s));return this},r.not=function(n){return new t(n).not()},r.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.abs(this.get(n,s)));return this},r.abs=function(n){return new t(n).abs()},r.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.acos(this.get(n,s)));return this},r.acos=function(n){return new t(n).acos()},r.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.acosh(this.get(n,s)));return this},r.acosh=function(n){return new t(n).acosh()},r.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.asin(this.get(n,s)));return this},r.asin=function(n){return new t(n).asin()},r.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.asinh(this.get(n,s)));return this},r.asinh=function(n){return new t(n).asinh()},r.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.atan(this.get(n,s)));return this},r.atan=function(n){return new t(n).atan()},r.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.atanh(this.get(n,s)));return this},r.atanh=function(n){return new t(n).atanh()},r.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.cbrt(this.get(n,s)));return this},r.cbrt=function(n){return new t(n).cbrt()},r.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.ceil(this.get(n,s)));return this},r.ceil=function(n){return new t(n).ceil()},r.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.clz32(this.get(n,s)));return this},r.clz32=function(n){return new t(n).clz32()},r.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.cos(this.get(n,s)));return this},r.cos=function(n){return new t(n).cos()},r.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.cosh(this.get(n,s)));return this},r.cosh=function(n){return new t(n).cosh()},r.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.exp(this.get(n,s)));return this},r.exp=function(n){return new t(n).exp()},r.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.expm1(this.get(n,s)));return this},r.expm1=function(n){return new t(n).expm1()},r.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.floor(this.get(n,s)));return this},r.floor=function(n){return new t(n).floor()},r.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.fround(this.get(n,s)));return this},r.fround=function(n){return new t(n).fround()},r.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log(this.get(n,s)));return this},r.log=function(n){return new t(n).log()},r.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log1p(this.get(n,s)));return this},r.log1p=function(n){return new t(n).log1p()},r.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log10(this.get(n,s)));return this},r.log10=function(n){return new t(n).log10()},r.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log2(this.get(n,s)));return this},r.log2=function(n){return new t(n).log2()},r.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.round(this.get(n,s)));return this},r.round=function(n){return new t(n).round()},r.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sign(this.get(n,s)));return this},r.sign=function(n){return new t(n).sign()},r.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sin(this.get(n,s)));return this},r.sin=function(n){return new t(n).sin()},r.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sinh(this.get(n,s)));return this},r.sinh=function(n){return new t(n).sinh()},r.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sqrt(this.get(n,s)));return this},r.sqrt=function(n){return new t(n).sqrt()},r.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.tan(this.get(n,s)));return this},r.tan=function(n){return new t(n).tan()},r.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.tanh(this.get(n,s)));return this},r.tanh=function(n){return new t(n).tanh()},r.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.trunc(this.get(n,s)));return this},r.trunc=function(n){return new t(n).trunc()},r.pow=function(n,s){return new t(n).pow(s)},r.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},r.prototype.powS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,Math.pow(this.get(s,a),n));return this},r.prototype.powM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,Math.pow(this.get(s,a),n.get(s,a)));return this}}function checkRowIndex(r,t,e){let n=e?r.rows:r.rows-1;if(t<0||t>n)throw new RangeError("Row index out of range")}function checkColumnIndex(r,t,e){let n=e?r.columns:r.columns-1;if(t<0||t>n)throw new RangeError("Column index out of range")}function checkRowVector(r,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==r.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function checkColumnVector(r,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==r.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function checkRowIndices(r,t){if(!isAnyArray.isAnyArray(t))throw new TypeError("row indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=r.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(r,t){if(!isAnyArray.isAnyArray(t))throw new TypeError("column indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=r.columns)throw new RangeError("column indices are out of range")}function checkRange(r,t,e,n,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",t),checkNumber("endRow",e),checkNumber("startColumn",n),checkNumber("endColumn",s),t>e||n>s||t<0||t>=r.rows||e<0||e>=r.rows||n<0||n>=r.columns||s<0||s>=r.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(r,t=0){let e=[];for(let n=0;n<r;n++)e.push(t);return e}function checkNumber(r,t){if(typeof t!="number")throw new TypeError(`${r} must be a number`)}function checkNonEmpty(r){if(r.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(r){let t=newArray$2(r.rows);for(let e=0;e<r.rows;++e)for(let n=0;n<r.columns;++n)t[e]+=r.get(e,n);return t}function sumByColumn(r){let t=newArray$2(r.columns);for(let e=0;e<r.rows;++e)for(let n=0;n<r.columns;++n)t[n]+=r.get(e,n);return t}function sumAll(r){let t=0;for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)t+=r.get(e,n);return t}function productByRow(r){let t=newArray$2(r.rows,1);for(let e=0;e<r.rows;++e)for(let n=0;n<r.columns;++n)t[e]*=r.get(e,n);return t}function productByColumn(r){let t=newArray$2(r.columns,1);for(let e=0;e<r.rows;++e)for(let n=0;n<r.columns;++n)t[n]*=r.get(e,n);return t}function productAll(r){let t=1;for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)t*=r.get(e,n);return t}function varianceByRow(r,t,e){const n=r.rows,s=r.columns,a=[];for(let o=0;o<n;o++){let l=0,c=0,h=0;for(let f=0;f<s;f++)h=r.get(o,f)-e[o],l+=h,c+=h*h;t?a.push((c-l*l/s)/(s-1)):a.push((c-l*l/s)/s)}return a}function varianceByColumn(r,t,e){const n=r.rows,s=r.columns,a=[];for(let o=0;o<s;o++){let l=0,c=0,h=0;for(let f=0;f<n;f++)h=r.get(f,o)-e[o],l+=h,c+=h*h;t?a.push((c-l*l/n)/(n-1)):a.push((c-l*l/n)/n)}return a}function varianceAll(r,t,e){const n=r.rows,s=r.columns,a=n*s;let o=0,l=0,c=0;for(let h=0;h<n;h++)for(let f=0;f<s;f++)c=r.get(h,f)-e,o+=c,l+=c*c;return t?(l-o*o/a)/(a-1):(l-o*o/a)/a}function centerByRow(r,t){for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)r.set(e,n,r.get(e,n)-t[e])}function centerByColumn(r,t){for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)r.set(e,n,r.get(e,n)-t[n])}function centerAll(r,t){for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)r.set(e,n,r.get(e,n)-t)}function getScaleByRow(r){const t=[];for(let e=0;e<r.rows;e++){let n=0;for(let s=0;s<r.columns;s++)n+=Math.pow(r.get(e,s),2)/(r.columns-1);t.push(Math.sqrt(n))}return t}function scaleByRow(r,t){for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)r.set(e,n,r.get(e,n)/t[e])}function getScaleByColumn(r){const t=[];for(let e=0;e<r.columns;e++){let n=0;for(let s=0;s<r.rows;s++)n+=Math.pow(r.get(s,e),2)/(r.rows-1);t.push(Math.sqrt(n))}return t}function scaleByColumn(r,t){for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)r.set(e,n,r.get(e,n)/t[n])}function getScaleAll(r){const t=r.size-1;let e=0;for(let n=0;n<r.columns;n++)for(let s=0;s<r.rows;s++)e+=Math.pow(r.get(s,n),2)/t;return Math.sqrt(e)}function scaleAll(r,t){for(let e=0;e<r.rows;e++)for(let n=0;n<r.columns;n++)r.set(e,n,r.get(e,n)/t)}let AbstractMatrix$1=class Te{static from1DArray(t,e,n){if(t*e!==n.length)throw new RangeError("data length does not match given dimensions");let a=new Matrix$3(t,e);for(let o=0;o<t;o++)for(let l=0;l<e;l++)a.set(o,l,n[o*e+l]);return a}static rowVector(t){let e=new Matrix$3(1,t.length);for(let n=0;n<t.length;n++)e.set(0,n,t[n]);return e}static columnVector(t){let e=new Matrix$3(t.length,1);for(let n=0;n<t.length;n++)e.set(n,0,t[n]);return e}static zeros(t,e){return new Matrix$3(t,e)}static ones(t,e){return new Matrix$3(t,e).fill(1)}static rand(t,e,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=n;let a=new Matrix$3(t,e);for(let o=0;o<t;o++)for(let l=0;l<e;l++)a.set(o,l,s());return a}static randInt(t,e,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:s=0,max:a=1e3,random:o=Math.random}=n;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(a))throw new TypeError("max must be an integer");if(s>=a)throw new RangeError("min must be smaller than max");let l=a-s,c=new Matrix$3(t,e);for(let h=0;h<t;h++)for(let f=0;f<e;f++){let u=s+Math.round(o()*l);c.set(h,f,u)}return c}static eye(t,e,n){e===void 0&&(e=t),n===void 0&&(n=1);let s=Math.min(t,e),a=this.zeros(t,e);for(let o=0;o<s;o++)a.set(o,o,n);return a}static diag(t,e,n){let s=t.length;e===void 0&&(e=s),n===void 0&&(n=e);let a=Math.min(s,e,n),o=this.zeros(e,n);for(let l=0;l<a;l++)o.set(l,l,t[l]);return o}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,s=t.columns,a=new Matrix$3(n,s);for(let o=0;o<n;o++)for(let l=0;l<s;l++)a.set(o,l,Math.min(t.get(o,l),e.get(o,l)));return a}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,s=t.columns,a=new this(n,s);for(let o=0;o<n;o++)for(let l=0;l<s;l++)a.set(o,l,Math.max(t.get(o,l),e.get(o,l)));return a}static checkMatrix(t){return Te.isMatrix(t)?t:new Matrix$3(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.call(this,e,n);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.push(this.get(e,n));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let n=0;n<this.columns;n++)t[e].push(this.get(e,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(this.get(t,t)!==0)return!1;return!0}isEchelonForm(){let t=0,e=0,n=-1,s=!0,a=!1;for(;t<this.rows&&s;){for(e=0,a=!1;e<this.columns&&a===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>n?(a=!0,n=e):(s=!1,a=!0);t++}return s}isReducedEchelonForm(){let t=0,e=0,n=-1,s=!0,a=!1;for(;t<this.rows&&s;){for(e=0,a=!1;e<this.columns&&a===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>n?(a=!0,n=e):(s=!1,a=!0);for(let o=e+1;o<this.rows;o++)this.get(t,o)!==0&&(s=!1);t++}return s}echelonForm(){let t=this.clone(),e=0,n=0;for(;e<t.rows&&n<t.columns;){let s=e;for(let a=e;a<t.rows;a++)t.get(a,n)>t.get(s,n)&&(s=a);if(t.get(s,n)===0)n++;else{t.swapRows(e,s);let a=t.get(e,n);for(let o=n;o<t.columns;o++)t.set(e,o,t.get(e,o)/a);for(let o=e+1;o<t.rows;o++){let l=t.get(o,n)/t.get(e,n);t.set(o,n,0);for(let c=n+1;c<t.columns;c++)t.set(o,c,t.get(o,c)-t.get(e,c)*l)}e++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,n=t.rows,s=n-1;for(;s>=0;)if(t.maxRow(s)===0)s--;else{let a=0,o=!1;for(;a<n&&o===!1;)t.get(s,a)===1?o=!0:a++;for(let l=0;l<s;l++){let c=t.get(l,a);for(let h=a;h<e;h++){let f=t.get(l,h)-c*t.get(s,h);t.set(l,h,f)}}s--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:n=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let s=new Matrix$3(this.rows*e,this.columns*n);for(let a=0;a<e;a++)for(let o=0;o<n;o++)s.setSubMatrix(this,this.rows*a,this.columns*o);return s}fill(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let e=[];for(let n=0;n<this.columns;n++)e.push(this.get(t,n));return e}getRowVector(t){return Matrix$3.rowVector(this.getRow(t))}setRow(t,e){checkRowIndex(this,t),e=checkRowVector(this,e);for(let n=0;n<this.columns;n++)this.set(t,n,e[n]);return this}swapRows(t,e){checkRowIndex(this,t),checkRowIndex(this,e);for(let n=0;n<this.columns;n++){let s=this.get(t,n);this.set(t,n,this.get(e,n)),this.set(e,n,s)}return this}getColumn(t){checkColumnIndex(this,t);let e=[];for(let n=0;n<this.rows;n++)e.push(this.get(n,t));return e}getColumnVector(t){return Matrix$3.columnVector(this.getColumn(t))}setColumn(t,e){checkColumnIndex(this,t),e=checkColumnVector(this,e);for(let n=0;n<this.rows;n++)this.set(n,t,e[n]);return this}swapColumns(t,e){checkColumnIndex(this,t),checkColumnIndex(this,e);for(let n=0;n<this.rows;n++){let s=this.get(n,t);this.set(n,t,this.get(n,e)),this.set(n,e,s)}return this}addRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[n]);return this}subRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[n]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[n]);return this}divRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[n]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[e]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[e]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[e]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[e]);return this}mulRow(t,e){checkRowIndex(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e);return this}mulColumn(t,e){checkColumnIndex(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)>e[n]&&(e[n]=this.get(n,s));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)>e[s]&&(e[s]=this.get(n,s));return e}case void 0:{let e=this.get(0,0);for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)>e&&(e=this.get(n,s));return e}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)>t&&(t=this.get(n,s),e[0]=n,e[1]=s);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)<e[n]&&(e[n]=this.get(n,s));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)<e[s]&&(e[s]=this.get(n,s));return e}case void 0:{let e=this.get(0,0);for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)<e&&(e=this.get(n,s));return e}default:throw new Error(`invalid option: ${t}`)}}minIndex(){checkNonEmpty(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)<t&&(t=this.get(n,s),e[0]=n,e[1]=s);return e}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let e=this.get(t,0),n=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s),n[1]=s);return n}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let e=this.get(t,0),n=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s),n[1]=s);return n}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t));return e}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let e=this.get(0,t),n=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)>e&&(e=this.get(s,t),n[0]=s);return n}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t));return e}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let e=this.get(0,t),n=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)<e&&(e=this.get(s,t),n[0]=s);return n}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let n=0;n<t;n++)e.push(this.get(n,n));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t+=this.get(e,n),this.set(e,n,t);return this}dot(t){Te.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let s=0;s<e.length;s++)n+=e[s]*t[s];return n}mmul(t){t=Matrix$3.checkMatrix(t);let e=this.rows,n=this.columns,s=t.columns,a=new Matrix$3(e,s),o=new Float64Array(n);for(let l=0;l<s;l++){for(let c=0;c<n;c++)o[c]=t.get(c,l);for(let c=0;c<e;c++){let h=0;for(let f=0;f<n;f++)h+=this.get(c,f)*o[f];a.set(c,l,h)}}return a}strassen2x2(t){t=Matrix$3.checkMatrix(t);let e=new Matrix$3(2,2);const n=this.get(0,0),s=t.get(0,0),a=this.get(0,1),o=t.get(0,1),l=this.get(1,0),c=t.get(1,0),h=this.get(1,1),f=t.get(1,1),u=(n+h)*(s+f),d=(l+h)*s,g=n*(o-f),p=h*(c-s),x=(n+a)*f,y=(l-n)*(s+o),m=(a-h)*(c+f),A=u+p-x+m,b=g+x,_=d+p,M=u-d+g+y;return e.set(0,0,A),e.set(0,1,b),e.set(1,0,_),e.set(1,1,M),e}strassen3x3(t){t=Matrix$3.checkMatrix(t);let e=new Matrix$3(3,3);const n=this.get(0,0),s=this.get(0,1),a=this.get(0,2),o=this.get(1,0),l=this.get(1,1),c=this.get(1,2),h=this.get(2,0),f=this.get(2,1),u=this.get(2,2),d=t.get(0,0),g=t.get(0,1),p=t.get(0,2),x=t.get(1,0),y=t.get(1,1),m=t.get(1,2),A=t.get(2,0),b=t.get(2,1),_=t.get(2,2),M=(n+s+a-o-l-f-u)*y,T=(n-o)*(-g+y),D=l*(-d+g+x-y-m-A+_),E=(-n+o+l)*(d-g+y),S=(o+l)*(-d+g),w=n*d,v=(-n+h+f)*(d-p+m),k=(-n+h)*(p-m),I=(h+f)*(-d+p),L=(n+s+a-l-c-h-f)*m,F=f*(-d+p+x-y-m-A+b),Z=(-a+f+u)*(y+A-b),W=(a-u)*(y-b),G=a*A,P=(f+u)*(-A+b),C=(-a+l+c)*(m+A-_),Y=(a-c)*(m-_),j=(l+c)*(-A+_),R=s*x,N=c*b,U=o*p,z=h*g,H=u*_,ee=w+G+R,se=M+E+S+w+Z+G+P,ae=w+v+I+L+G+C+j,he=T+D+E+w+G+C+Y,we=T+E+S+w+N,ge=G+C+Y+j+U,J=w+v+k+F+Z+W+G,q=Z+W+G+P+z,xe=w+v+k+I+H;return e.set(0,0,ee),e.set(0,1,se),e.set(0,2,ae),e.set(1,0,he),e.set(1,1,we),e.set(1,2,ge),e.set(2,0,J),e.set(2,1,q),e.set(2,2,xe),e}mmulStrassen(t){t=Matrix$3.checkMatrix(t);let e=this.clone(),n=e.rows,s=e.columns,a=t.rows,o=t.columns;s!==a&&console.warn(`Multiplying ${n} x ${s} and ${a} x ${o} matrix: dimensions do not match.`);function l(u,d,g){let p=u.rows,x=u.columns;if(p===d&&x===g)return u;{let y=Te.zeros(d,g);return y=y.setSubMatrix(u,0,0),y}}let c=Math.max(n,a),h=Math.max(s,o);e=l(e,c,h),t=l(t,c,h);function f(u,d,g,p){if(g<=512||p<=512)return u.mmul(d);g%2===1&&p%2===1?(u=l(u,g+1,p+1),d=l(d,g+1,p+1)):g%2===1?(u=l(u,g+1,p),d=l(d,g+1,p)):p%2===1&&(u=l(u,g,p+1),d=l(d,g,p+1));let x=parseInt(u.rows/2,10),y=parseInt(u.columns/2,10),m=u.subMatrix(0,x-1,0,y-1),A=d.subMatrix(0,x-1,0,y-1),b=u.subMatrix(0,x-1,y,u.columns-1),_=d.subMatrix(0,x-1,y,d.columns-1),M=u.subMatrix(x,u.rows-1,0,y-1),T=d.subMatrix(x,d.rows-1,0,y-1),D=u.subMatrix(x,u.rows-1,y,u.columns-1),E=d.subMatrix(x,d.rows-1,y,d.columns-1),S=f(Te.add(m,D),Te.add(A,E),x,y),w=f(Te.add(M,D),A,x,y),v=f(m,Te.sub(_,E),x,y),k=f(D,Te.sub(T,A),x,y),I=f(Te.add(m,b),E,x,y),L=f(Te.sub(M,m),Te.add(A,_),x,y),F=f(Te.sub(b,D),Te.add(T,E),x,y),Z=Te.add(S,k);Z.sub(I),Z.add(F);let W=Te.add(v,I),G=Te.add(w,k),P=Te.sub(S,w);P.add(v),P.add(L);let C=Te.zeros(2*Z.rows,2*Z.columns);return C=C.setSubMatrix(Z,0,0),C=C.setSubMatrix(W,Z.rows,0),C=C.setSubMatrix(G,0,Z.columns),C=C.setSubMatrix(P,Z.rows,Z.columns),C.subMatrix(0,g-1,0,p-1)}return f(e,t,c,h)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let s=new Matrix$3(this.rows,this.columns);for(let a=0;a<this.rows;a++){const o=this.getRow(a);o.length>0&&rescale(o,{min:e,max:n,output:o}),s.setRow(a,o)}return s}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let s=new Matrix$3(this.rows,this.columns);for(let a=0;a<this.columns;a++){const o=this.getColumn(a);o.length&&rescale(o,{min:e,max:n,output:o}),s.setColumn(a,o)}return s}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let n=0;n<t;n++){let s=this.get(e,n),a=this.get(e,this.columns-1-n);this.set(e,n,a),this.set(e,this.columns-1-n,s)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let n=0;n<t;n++){let s=this.get(n,e),a=this.get(this.rows-1-n,e);this.set(n,e,a),this.set(this.rows-1-n,e,s)}return this}kroneckerProduct(t){t=Matrix$3.checkMatrix(t);let e=this.rows,n=this.columns,s=t.rows,a=t.columns,o=new Matrix$3(e*s,n*a);for(let l=0;l<e;l++)for(let c=0;c<n;c++)for(let h=0;h<s;h++)for(let f=0;f<a;f++)o.set(s*l+h,a*c+f,this.get(l,c)*t.get(h,f));return o}kroneckerSum(t){if(t=Matrix$3.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,n=t.rows,s=this.kroneckerProduct(Matrix$3.eye(n,n)),a=Matrix$3.eye(e,e).kroneckerProduct(t);return s.add(a)}transpose(){let t=new Matrix$3(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(n,e,this.get(e,n));return t}sortRows(t=compareNumbers){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=compareNumbers){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,n,s){checkRange(this,t,e,n,s);let a=new Matrix$3(e-t+1,s-n+1);for(let o=t;o<=e;o++)for(let l=n;l<=s;l++)a.set(o-t,l-n,this.get(o,l));return a}subMatrixRow(t,e,n){if(e===void 0&&(e=0),n===void 0&&(n=this.columns-1),e>n||e<0||e>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let s=new Matrix$3(t.length,n-e+1);for(let a=0;a<t.length;a++)for(let o=e;o<=n;o++){if(t[a]<0||t[a]>=this.rows)throw new RangeError(`Row index out of range: ${t[a]}`);s.set(a,o-e,this.get(t[a],o))}return s}subMatrixColumn(t,e,n){if(e===void 0&&(e=0),n===void 0&&(n=this.rows-1),e>n||e<0||e>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let s=new Matrix$3(n-e+1,t.length);for(let a=0;a<t.length;a++)for(let o=e;o<=n;o++){if(t[a]<0||t[a]>=this.columns)throw new RangeError(`Column index out of range: ${t[a]}`);s.set(o-e,a,this.get(o,t[a]))}return s}setSubMatrix(t,e,n){if(t=Matrix$3.checkMatrix(t),t.isEmpty())return this;let s=e+t.rows-1,a=n+t.columns-1;checkRange(this,e,s,n,a);for(let o=0;o<t.rows;o++)for(let l=0;l<t.columns;l++)this.set(e+o,n+l,t.get(o,l));return this}selection(t,e){checkRowIndices(this,t),checkColumnIndices(this,e);let n=new Matrix$3(t.length,e.length);for(let s=0;s<t.length;s++){let a=t[s];for(let o=0;o<e.length;o++){let l=e[o];n.set(s,o,this.get(a,l))}}return n}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let n=0;n<t;n++)e+=this.get(n,n);return e}clone(){return this.constructor.copy(this,new Matrix$3(this.rows,this.columns))}static copy(t,e){for(const[n,s,a]of t.entries())e.set(n,s,a);return e}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":{for(let n=0;n<this.rows;n++)e[n]/=this.columns;return e}case"column":{for(let n=0;n<this.columns;n++)e[n]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:s=this.mean(t)}=e;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!isAnyArray.isAnyArray(s))throw new TypeError("mean must be an array");return varianceByRow(this,n,s)}case"column":{if(!isAnyArray.isAnyArray(s))throw new TypeError("mean must be an array");return varianceByColumn(this,n,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,s)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){typeof t=="object"&&(e=t,t=void 0);const n=this.variance(t,e);if(t===void 0)return Math.sqrt(n);for(let s=0;s<n.length;s++)n[s]=Math.sqrt(n[s]);return n}center(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:n=this.mean(t)}=e;switch(t){case"row":{if(!isAnyArray.isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray.isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");let n=e.scale;switch(t){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray.isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray.isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}};AbstractMatrix$1.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix$1.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(r,t){return r-t}function isArrayOfNumbers(r){return r.every(t=>typeof t=="number")}AbstractMatrix$1.random=AbstractMatrix$1.rand;AbstractMatrix$1.randomInt=AbstractMatrix$1.randInt;AbstractMatrix$1.diagonal=AbstractMatrix$1.diag;AbstractMatrix$1.prototype.diagonal=AbstractMatrix$1.prototype.diag;AbstractMatrix$1.identity=AbstractMatrix$1.eye;AbstractMatrix$1.prototype.negate=AbstractMatrix$1.prototype.neg;AbstractMatrix$1.prototype.tensorProduct=AbstractMatrix$1.prototype.kroneckerProduct;var et,ot,We;let Matrix$3=(We=class extends AbstractMatrix$1{constructor(e,n){super();st(this,et);ut(this,"data");if(We.isMatrix(e))at(this,et,ot).call(this,e.rows,e.columns),We.copy(e,this);else if(Number.isInteger(e)&&e>=0)at(this,et,ot).call(this,e,n);else if(isAnyArray.isAnyArray(e)){const s=e;if(e=s.length,n=e?s[0].length:0,typeof n!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let a=0;a<e;a++){if(s[a].length!==n)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(s[a]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(s[a]))}this.rows=e,this.columns=n}else throw new TypeError("First argument must be a positive number or an array")}set(e,n,s){return this.data[e][n]=s,this}get(e,n){return this.data[e][n]}removeRow(e){return checkRowIndex(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,n){return n===void 0&&(n=e,e=this.rows),checkRowIndex(this,e,!0),n=Float64Array.from(checkRowVector(this,n)),this.data.splice(e,0,n),this.rows+=1,this}removeColumn(e){checkColumnIndex(this,e);for(let n=0;n<this.rows;n++){const s=new Float64Array(this.columns-1);for(let a=0;a<e;a++)s[a]=this.data[n][a];for(let a=e+1;a<this.columns;a++)s[a-1]=this.data[n][a];this.data[n]=s}return this.columns-=1,this}addColumn(e,n){typeof n>"u"&&(n=e,e=this.columns),checkColumnIndex(this,e,!0),n=checkColumnVector(this,n);for(let s=0;s<this.rows;s++){const a=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)a[o]=this.data[s][o];for(a[o++]=n[s];o<this.columns+1;o++)a[o]=this.data[s][o-1];this.data[s]=a}return this.columns+=1,this}},et=new WeakSet,ot=function(e,n){if(this.data=[],Number.isInteger(n)&&n>=0)for(let s=0;s<e;s++)this.data.push(new Float64Array(n));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=n},We);installMathOperations(AbstractMatrix$1,Matrix$3);var Ne,Je;let SymmetricMatrix$1=(Je=class extends AbstractMatrix$1{constructor(e){super();st(this,Ne,void 0);if(Matrix$3.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");it(this,Ne,Matrix$3.copy(e,new Matrix$3(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)it(this,Ne,new Matrix$3(e,e));else if(it(this,Ne,new Matrix$3(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return Le(this,Ne).size}get rows(){return Le(this,Ne).rows}get columns(){return Le(this,Ne).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return Matrix$3.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new Je(this.diagonalSize);for(const[n,s,a]of this.upperRightEntries())e.set(n,s,a);return e}toMatrix(){return new Matrix$3(this)}get(e,n){return Le(this,Ne).get(e,n)}set(e,n,s){return Le(this,Ne).set(e,n,s),Le(this,Ne).set(n,e,s),this}removeCross(e){return Le(this,Ne).removeRow(e),Le(this,Ne).removeColumn(e),this}addCross(e,n){n===void 0&&(n=e,e=this.diagonalSize);const s=n.slice();return s.splice(e,1),Le(this,Ne).addRow(e,s),Le(this,Ne).addColumn(e,n),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const n=[];for(const[s,a]of e.entries())a||n.push(s);n.reverse();for(const s of n)this.removeCross(s);return this}toCompact(){const{diagonalSize:e}=this,n=new Array(e*(e+1)/2);for(let s=0,a=0,o=0;o<n.length;o++)n[o]=this.get(a,s),++s>=e&&(s=++a);return n}static fromCompact(e){const n=e.length,s=(Math.sqrt(8*n+1)-1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const a=new Je(s);for(let o=0,l=0,c=0;c<n;c++)a.set(o,l,e[c]),++o>=s&&(o=++l);return a}*upperRightEntries(){for(let e=0,n=0;e<this.diagonalSize;void 0){const s=this.get(e,n);yield[e,n,s],++n>=this.diagonalSize&&(n=++e)}}*upperRightValues(){for(let e=0,n=0;e<this.diagonalSize;void 0)yield this.get(e,n),++n>=this.diagonalSize&&(n=++e)}},Ne=new WeakMap,Je);SymmetricMatrix$1.prototype.klassType="SymmetricMatrix";let DistanceMatrix$1=class gt extends SymmetricMatrix$1{static isDistanceMatrix(t){return SymmetricMatrix$1.isSymmetricMatrix(t)&&t.klassSubType==="DistanceMatrix"}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,e,n){return t===e&&(n=0),super.set(t,e,n)}addCross(t,e){return e===void 0&&(e=t,t=this.diagonalSize),e=e.slice(),e[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new SymmetricMatrix$1(this)}clone(){const t=new gt(this.diagonalSize);for(const[e,n,s]of this.upperRightEntries())e!==n&&t.set(e,n,s);return t}toCompact(){const{diagonalSize:t}=this,e=(t-1)*t/2,n=new Array(e);for(let s=1,a=0,o=0;o<n.length;o++)n[o]=this.get(a,s),++s>=t&&(s=++a+1);return n}static fromCompact(t){const e=t.length,n=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const s=new this(n);for(let a=1,o=0,l=0;l<e;l++)s.set(a,o,t[l]),++a>=n&&(a=++o+1);return s}};DistanceMatrix$1.prototype.klassSubType="DistanceMatrix";class BaseView extends AbstractMatrix$1{constructor(t,e,n){super(),this.matrix=t,this.rows=e,this.columns=n}}let MatrixColumnView$1=class extends BaseView{constructor(t,e){checkColumnIndex(t,e),super(t,t.rows,1),this.column=e}set(t,e,n){return this.matrix.set(t,this.column,n),this}get(t){return this.matrix.get(t,this.column)}},MatrixColumnSelectionView$1=class extends BaseView{constructor(t,e){checkColumnIndices(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,n){return this.matrix.set(t,this.columnIndices[e],n),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}},MatrixFlipColumnView$1=class extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,e,n){return this.matrix.set(t,this.columns-e-1,n),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}},MatrixFlipRowView$1=class extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,e,n){return this.matrix.set(this.rows-t-1,e,n),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}},MatrixRowView$1=class extends BaseView{constructor(t,e){checkRowIndex(t,e),super(t,1,t.columns),this.row=e}set(t,e,n){return this.matrix.set(this.row,e,n),this}get(t,e){return this.matrix.get(this.row,e)}},MatrixRowSelectionView$1=class extends BaseView{constructor(t,e){checkRowIndices(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,n){return this.matrix.set(this.rowIndices[t],e,n),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}},MatrixSelectionView$1=class extends BaseView{constructor(t,e,n){checkRowIndices(t,e),checkColumnIndices(t,n),super(t,e.length,n.length),this.rowIndices=e,this.columnIndices=n}set(t,e,n){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],n),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}},MatrixSubView$1=class extends BaseView{constructor(t,e,n,s,a){checkRange(t,e,n,s,a),super(t,n-e+1,a-s+1),this.startRow=e,this.startColumn=s}set(t,e,n){return this.matrix.set(this.startRow+t,this.startColumn+e,n),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}},MatrixTransposeView$2=class extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,e,n){return this.matrix.set(e,t,n),this}get(t,e){return this.matrix.get(e,t)}},WrapperMatrix1D$1=class extends AbstractMatrix$1{constructor(t,e={}){const{rows:n=1}=e;if(t.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=t.length/n,this.data=t}set(t,e,n){let s=this._calculateIndex(t,e);return this.data[s]=n,this}get(t,e){let n=this._calculateIndex(t,e);return this.data[n]}_calculateIndex(t,e){return t*this.columns+e}},WrapperMatrix2D$1=class extends AbstractMatrix$1{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}};function wrap$1(r,t){if(isAnyArray.isAnyArray(r))return r[0]&&isAnyArray.isAnyArray(r[0])?new WrapperMatrix2D$1(r):new WrapperMatrix1D$1(r,t);throw new Error("the argument is not an array")}let LuDecomposition$1=class{constructor(t){t=WrapperMatrix2D$1.checkMatrix(t);let e=t.clone(),n=e.rows,s=e.columns,a=new Float64Array(n),o=1,l,c,h,f,u,d,g,p,x;for(l=0;l<n;l++)a[l]=l;for(p=new Float64Array(n),c=0;c<s;c++){for(l=0;l<n;l++)p[l]=e.get(l,c);for(l=0;l<n;l++){for(x=Math.min(l,c),u=0,h=0;h<x;h++)u+=e.get(l,h)*p[h];p[l]-=u,e.set(l,c,p[l])}for(f=c,l=c+1;l<n;l++)Math.abs(p[l])>Math.abs(p[f])&&(f=l);if(f!==c){for(h=0;h<s;h++)d=e.get(f,h),e.set(f,h,e.get(c,h)),e.set(c,h,d);g=a[f],a[f]=a[c],a[c]=g,o=-o}if(c<n&&e.get(c,c)!==0)for(l=c+1;l<n;l++)e.set(l,c,e.get(l,c)/e.get(c,c))}this.LU=e,this.pivotVector=a,this.pivotSign=o}isSingular(){let t=this.LU,e=t.columns;for(let n=0;n<e;n++)if(t.get(n,n)===0)return!0;return!1}solve(t){t=Matrix$3.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=t.columns,a=t.subMatrixRow(this.pivotVector,0,s-1),o=e.columns,l,c,h;for(h=0;h<o;h++)for(l=h+1;l<o;l++)for(c=0;c<s;c++)a.set(l,c,a.get(l,c)-a.get(h,c)*e.get(l,h));for(h=o-1;h>=0;h--){for(c=0;c<s;c++)a.set(h,c,a.get(h,c)/e.get(h,h));for(l=0;l<h;l++)for(c=0;c<s;c++)a.set(l,c,a.get(l,c)-a.get(h,c)*e.get(l,h))}return a}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,n=t.columns;for(let s=0;s<n;s++)e*=t.get(s,s);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,s=new Matrix$3(e,n);for(let a=0;a<e;a++)for(let o=0;o<n;o++)a>o?s.set(a,o,t.get(a,o)):a===o?s.set(a,o,1):s.set(a,o,0);return s}get upperTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,s=new Matrix$3(e,n);for(let a=0;a<e;a++)for(let o=0;o<n;o++)a<=o?s.set(a,o,t.get(a,o)):s.set(a,o,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}};function hypotenuse$1(r,t){let e=0;return Math.abs(r)>Math.abs(t)?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):t!==0?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):0}let QrDecomposition$1=class{constructor(t){t=WrapperMatrix2D$1.checkMatrix(t);let e=t.clone(),n=t.rows,s=t.columns,a=new Float64Array(s),o,l,c,h;for(c=0;c<s;c++){let f=0;for(o=c;o<n;o++)f=hypotenuse$1(f,e.get(o,c));if(f!==0){for(e.get(c,c)<0&&(f=-f),o=c;o<n;o++)e.set(o,c,e.get(o,c)/f);for(e.set(c,c,e.get(c,c)+1),l=c+1;l<s;l++){for(h=0,o=c;o<n;o++)h+=e.get(o,c)*e.get(o,l);for(h=-h/e.get(c,c),o=c;o<n;o++)e.set(o,l,e.get(o,l)+h*e.get(o,c))}}a[c]=-f}this.QR=e,this.Rdiag=a}solve(t){t=Matrix$3.checkMatrix(t);let e=this.QR,n=e.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=t.columns,a=t.clone(),o=e.columns,l,c,h,f;for(h=0;h<o;h++)for(c=0;c<s;c++){for(f=0,l=h;l<n;l++)f+=e.get(l,h)*a.get(l,c);for(f=-f/e.get(h,h),l=h;l<n;l++)a.set(l,c,a.get(l,c)+f*e.get(l,h))}for(h=o-1;h>=0;h--){for(c=0;c<s;c++)a.set(h,c,a.get(h,c)/this.Rdiag[h]);for(l=0;l<h;l++)for(c=0;c<s;c++)a.set(l,c,a.get(l,c)-a.get(h,c)*e.get(l,h))}return a.subMatrix(0,o-1,0,s-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,e=t.columns,n=new Matrix$3(e,e),s,a;for(s=0;s<e;s++)for(a=0;a<e;a++)s<a?n.set(s,a,t.get(s,a)):s===a?n.set(s,a,this.Rdiag[s]):n.set(s,a,0);return n}get orthogonalMatrix(){let t=this.QR,e=t.rows,n=t.columns,s=new Matrix$3(e,n),a,o,l,c;for(l=n-1;l>=0;l--){for(a=0;a<e;a++)s.set(a,l,0);for(s.set(l,l,1),o=l;o<n;o++)if(t.get(l,l)!==0){for(c=0,a=l;a<e;a++)c+=t.get(a,l)*s.get(a,o);for(c=-c/t.get(l,l),a=l;a<e;a++)s.set(a,o,s.get(a,o)+c*t.get(a,l))}}return s}},SingularValueDecomposition$1=class{constructor(t,e={}){if(t=WrapperMatrix2D$1.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,s=t.columns;const{computeLeftSingularVectors:a=!0,computeRightSingularVectors:o=!0,autoTranspose:l=!1}=e;let c=!!a,h=!!o,f=!1,u;if(n<s)if(!l)u=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{u=t.transpose(),n=u.rows,s=u.columns,f=!0;let w=c;c=h,h=w}else u=t.clone();let d=Math.min(n,s),g=Math.min(n+1,s),p=new Float64Array(g),x=new Matrix$3(n,d),y=new Matrix$3(s,s),m=new Float64Array(s),A=new Float64Array(n),b=new Float64Array(g);for(let w=0;w<g;w++)b[w]=w;let _=Math.min(n-1,s),M=Math.max(0,Math.min(s-2,n)),T=Math.max(_,M);for(let w=0;w<T;w++){if(w<_){p[w]=0;for(let v=w;v<n;v++)p[w]=hypotenuse$1(p[w],u.get(v,w));if(p[w]!==0){u.get(w,w)<0&&(p[w]=-p[w]);for(let v=w;v<n;v++)u.set(v,w,u.get(v,w)/p[w]);u.set(w,w,u.get(w,w)+1)}p[w]=-p[w]}for(let v=w+1;v<s;v++){if(w<_&&p[w]!==0){let k=0;for(let I=w;I<n;I++)k+=u.get(I,w)*u.get(I,v);k=-k/u.get(w,w);for(let I=w;I<n;I++)u.set(I,v,u.get(I,v)+k*u.get(I,w))}m[v]=u.get(w,v)}if(c&&w<_)for(let v=w;v<n;v++)x.set(v,w,u.get(v,w));if(w<M){m[w]=0;for(let v=w+1;v<s;v++)m[w]=hypotenuse$1(m[w],m[v]);if(m[w]!==0){m[w+1]<0&&(m[w]=0-m[w]);for(let v=w+1;v<s;v++)m[v]/=m[w];m[w+1]+=1}if(m[w]=-m[w],w+1<n&&m[w]!==0){for(let v=w+1;v<n;v++)A[v]=0;for(let v=w+1;v<n;v++)for(let k=w+1;k<s;k++)A[v]+=m[k]*u.get(v,k);for(let v=w+1;v<s;v++){let k=-m[v]/m[w+1];for(let I=w+1;I<n;I++)u.set(I,v,u.get(I,v)+k*A[I])}}if(h)for(let v=w+1;v<s;v++)y.set(v,w,m[v])}}let D=Math.min(s,n+1);if(_<s&&(p[_]=u.get(_,_)),n<D&&(p[D-1]=0),M+1<D&&(m[M]=u.get(M,D-1)),m[D-1]=0,c){for(let w=_;w<d;w++){for(let v=0;v<n;v++)x.set(v,w,0);x.set(w,w,1)}for(let w=_-1;w>=0;w--)if(p[w]!==0){for(let v=w+1;v<d;v++){let k=0;for(let I=w;I<n;I++)k+=x.get(I,w)*x.get(I,v);k=-k/x.get(w,w);for(let I=w;I<n;I++)x.set(I,v,x.get(I,v)+k*x.get(I,w))}for(let v=w;v<n;v++)x.set(v,w,-x.get(v,w));x.set(w,w,1+x.get(w,w));for(let v=0;v<w-1;v++)x.set(v,w,0)}else{for(let v=0;v<n;v++)x.set(v,w,0);x.set(w,w,1)}}if(h)for(let w=s-1;w>=0;w--){if(w<M&&m[w]!==0)for(let v=w+1;v<s;v++){let k=0;for(let I=w+1;I<s;I++)k+=y.get(I,w)*y.get(I,v);k=-k/y.get(w+1,w);for(let I=w+1;I<s;I++)y.set(I,v,y.get(I,v)+k*y.get(I,w))}for(let v=0;v<s;v++)y.set(v,w,0);y.set(w,w,1)}let E=D-1,S=Number.EPSILON;for(;D>0;){let w,v;for(w=D-2;w>=-1&&w!==-1;w--){const k=Number.MIN_VALUE+S*Math.abs(p[w]+Math.abs(p[w+1]));if(Math.abs(m[w])<=k||Number.isNaN(m[w])){m[w]=0;break}}if(w===D-2)v=4;else{let k;for(k=D-1;k>=w&&k!==w;k--){let I=(k!==D?Math.abs(m[k]):0)+(k!==w+1?Math.abs(m[k-1]):0);if(Math.abs(p[k])<=S*I){p[k]=0;break}}k===w?v=3:k===D-1?v=1:(v=2,w=k)}switch(w++,v){case 1:{let k=m[D-2];m[D-2]=0;for(let I=D-2;I>=w;I--){let L=hypotenuse$1(p[I],k),F=p[I]/L,Z=k/L;if(p[I]=L,I!==w&&(k=-Z*m[I-1],m[I-1]=F*m[I-1]),h)for(let W=0;W<s;W++)L=F*y.get(W,I)+Z*y.get(W,D-1),y.set(W,D-1,-Z*y.get(W,I)+F*y.get(W,D-1)),y.set(W,I,L)}break}case 2:{let k=m[w-1];m[w-1]=0;for(let I=w;I<D;I++){let L=hypotenuse$1(p[I],k),F=p[I]/L,Z=k/L;if(p[I]=L,k=-Z*m[I],m[I]=F*m[I],c)for(let W=0;W<n;W++)L=F*x.get(W,I)+Z*x.get(W,w-1),x.set(W,w-1,-Z*x.get(W,I)+F*x.get(W,w-1)),x.set(W,I,L)}break}case 3:{const k=Math.max(Math.abs(p[D-1]),Math.abs(p[D-2]),Math.abs(m[D-2]),Math.abs(p[w]),Math.abs(m[w])),I=p[D-1]/k,L=p[D-2]/k,F=m[D-2]/k,Z=p[w]/k,W=m[w]/k,G=((L+I)*(L-I)+F*F)/2,P=I*F*(I*F);let C=0;(G!==0||P!==0)&&(G<0?C=0-Math.sqrt(G*G+P):C=Math.sqrt(G*G+P),C=P/(G+C));let Y=(Z+I)*(Z-I)+C,j=Z*W;for(let R=w;R<D-1;R++){let N=hypotenuse$1(Y,j);N===0&&(N=Number.MIN_VALUE);let U=Y/N,z=j/N;if(R!==w&&(m[R-1]=N),Y=U*p[R]+z*m[R],m[R]=U*m[R]-z*p[R],j=z*p[R+1],p[R+1]=U*p[R+1],h)for(let H=0;H<s;H++)N=U*y.get(H,R)+z*y.get(H,R+1),y.set(H,R+1,-z*y.get(H,R)+U*y.get(H,R+1)),y.set(H,R,N);if(N=hypotenuse$1(Y,j),N===0&&(N=Number.MIN_VALUE),U=Y/N,z=j/N,p[R]=N,Y=U*m[R]+z*p[R+1],p[R+1]=-z*m[R]+U*p[R+1],j=z*m[R+1],m[R+1]=U*m[R+1],c&&R<n-1)for(let H=0;H<n;H++)N=U*x.get(H,R)+z*x.get(H,R+1),x.set(H,R+1,-z*x.get(H,R)+U*x.get(H,R+1)),x.set(H,R,N)}m[D-2]=Y;break}case 4:{if(p[w]<=0&&(p[w]=p[w]<0?-p[w]:0,h))for(let k=0;k<=E;k++)y.set(k,w,-y.get(k,w));for(;w<E&&!(p[w]>=p[w+1]);){let k=p[w];if(p[w]=p[w+1],p[w+1]=k,h&&w<s-1)for(let I=0;I<s;I++)k=y.get(I,w+1),y.set(I,w+1,y.get(I,w)),y.set(I,w,k);if(c&&w<n-1)for(let I=0;I<n;I++)k=x.get(I,w+1),x.set(I,w+1,x.get(I,w)),x.set(I,w,k);w++}D--;break}}}if(f){let w=y;y=x,x=w}this.m=n,this.n=s,this.s=p,this.U=x,this.V=y}solve(t){let e=t,n=this.threshold,s=this.s.length,a=Matrix$3.zeros(s,s);for(let d=0;d<s;d++)Math.abs(this.s[d])<=n?a.set(d,d,0):a.set(d,d,1/this.s[d]);let o=this.U,l=this.rightSingularVectors,c=l.mmul(a),h=l.rows,f=o.rows,u=Matrix$3.zeros(h,f);for(let d=0;d<h;d++)for(let g=0;g<f;g++){let p=0;for(let x=0;x<s;x++)p+=c.get(d,x)*o.get(g,x);u.set(d,g,p)}return u.mmul(e)}solveForDiagonal(t){return this.solve(Matrix$3.diag(t))}inverse(){let t=this.V,e=this.threshold,n=t.rows,s=t.columns,a=new Matrix$3(n,this.s.length);for(let f=0;f<n;f++)for(let u=0;u<s;u++)Math.abs(this.s[u])>e&&a.set(f,u,t.get(f,u)/this.s[u]);let o=this.U,l=o.rows,c=o.columns,h=new Matrix$3(n,l);for(let f=0;f<n;f++)for(let u=0;u<l;u++){let d=0;for(let g=0;g<c;g++)d+=a.get(f,g)*o.get(u,g);h.set(f,u,d)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,n=this.s;for(let s=0,a=n.length;s<a;s++)n[s]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$3.diag(this.s)}};function inverse$1(r,t=!1){return r=WrapperMatrix2D$1.checkMatrix(r),t?new SingularValueDecomposition$1(r).inverse():solve$1(r,Matrix$3.eye(r.rows))}function solve$1(r,t,e=!1){return r=WrapperMatrix2D$1.checkMatrix(r),t=WrapperMatrix2D$1.checkMatrix(t),e?new SingularValueDecomposition$1(r).solve(t):r.isSquare()?new LuDecomposition$1(r).solve(t):new QrDecomposition$1(r).solve(t)}function determinant$1(r){if(r=Matrix$3.checkMatrix(r),r.isSquare()){if(r.columns===0)return 1;let t,e,n,s;if(r.columns===2)return t=r.get(0,0),e=r.get(0,1),n=r.get(1,0),s=r.get(1,1),t*s-e*n;if(r.columns===3){let a,o,l;return a=new MatrixSelectionView$1(r,[1,2],[1,2]),o=new MatrixSelectionView$1(r,[1,2],[0,2]),l=new MatrixSelectionView$1(r,[1,2],[0,1]),t=r.get(0,0),e=r.get(0,1),n=r.get(0,2),t*determinant$1(a)-e*determinant$1(o)+n*determinant$1(l)}else return new LuDecomposition$1(r).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(r,t){let e=[];for(let n=0;n<r;n++)n!==t&&e.push(n);return e}function dependenciesOneRow(r,t,e,n=1e-9,s=1e-9){if(r>s)return new Array(t.rows+1).fill(0);{let a=t.addRow(e,[0]);for(let o=0;o<a.rows;o++)Math.abs(a.get(o,0))<n&&a.set(o,0,0);return a.to1DArray()}}function linearDependencies$1(r,t={}){const{thresholdValue:e=1e-9,thresholdError:n=1e-9}=t;r=Matrix$3.checkMatrix(r);let s=r.rows,a=new Matrix$3(s,s);for(let o=0;o<s;o++){let l=Matrix$3.columnVector(r.getRow(o)),c=r.subMatrixRow(xrange(s,o)).transpose(),f=new SingularValueDecomposition$1(c).solve(l),u=Matrix$3.sub(l,c.mmul(f)).abs().max();a.setRow(o,dependenciesOneRow(u,f,o,e,n))}return a}function pseudoInverse$1(r,t=Number.EPSILON){if(r=Matrix$3.checkMatrix(r),r.isEmpty())return r.transpose();let e=new SingularValueDecomposition$1(r,{autoTranspose:!0}),n=e.leftSingularVectors,s=e.rightSingularVectors,a=e.diagonal;for(let o=0;o<a.length;o++)Math.abs(a[o])>t?a[o]=1/a[o]:a[o]=0;return s.mmul(Matrix$3.diag(a).mmul(n.transpose()))}function covariance$1(r,t=r,e={}){r=new Matrix$3(r);let n=!1;if(typeof t=="object"&&!Matrix$3.isMatrix(t)&&!isAnyArray.isAnyArray(t)?(e=t,t=r,n=!0):t=new Matrix$3(t),r.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=e;s&&(r=r.center("column"),n||(t=t.center("column")));const a=r.transpose().mmul(t);for(let o=0;o<a.rows;o++)for(let l=0;l<a.columns;l++)a.set(o,l,a.get(o,l)*(1/(r.rows-1)));return a}function correlation$1(r,t=r,e={}){r=new Matrix$3(r);let n=!1;if(typeof t=="object"&&!Matrix$3.isMatrix(t)&&!isAnyArray.isAnyArray(t)?(e=t,t=r,n=!0):t=new Matrix$3(t),r.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:a=!0}=e;s&&(r.center("column"),n||t.center("column")),a&&(r.scale("column"),n||t.scale("column"));const o=r.standardDeviation("column",{unbiased:!0}),l=n?o:t.standardDeviation("column",{unbiased:!0}),c=r.transpose().mmul(t);for(let h=0;h<c.rows;h++)for(let f=0;f<c.columns;f++)c.set(h,f,c.get(h,f)*(1/(o[h]*l[f]))*(1/(r.rows-1)));return c}let EigenvalueDecomposition$1=class{constructor(t,e={}){const{assumeSymmetric:n=!1}=e;if(t=WrapperMatrix2D$1.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let s=t.columns,a=new Matrix$3(s,s),o=new Float64Array(s),l=new Float64Array(s),c=t,h,f,u=!1;if(n?u=!0:u=t.isSymmetric(),u){for(h=0;h<s;h++)for(f=0;f<s;f++)a.set(h,f,c.get(h,f));tred2(s,l,o,a),tql2(s,l,o,a)}else{let d=new Matrix$3(s,s),g=new Float64Array(s);for(f=0;f<s;f++)for(h=0;h<s;h++)d.set(h,f,c.get(h,f));orthes(s,d,g,a),hqr2(s,l,o,a,d)}this.n=s,this.e=l,this.d=o,this.V=a}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,e=this.e,n=this.d,s=new Matrix$3(t,t),a,o;for(a=0;a<t;a++){for(o=0;o<t;o++)s.set(a,o,0);s.set(a,a,n[a]),e[a]>0?s.set(a,a+1,e[a]):e[a]<0&&s.set(a,a-1,e[a])}return s}};function tred2(r,t,e,n){let s,a,o,l,c,h,f,u;for(c=0;c<r;c++)e[c]=n.get(r-1,c);for(l=r-1;l>0;l--){for(u=0,o=0,h=0;h<l;h++)u=u+Math.abs(e[h]);if(u===0)for(t[l]=e[l-1],c=0;c<l;c++)e[c]=n.get(l-1,c),n.set(l,c,0),n.set(c,l,0);else{for(h=0;h<l;h++)e[h]/=u,o+=e[h]*e[h];for(s=e[l-1],a=Math.sqrt(o),s>0&&(a=-a),t[l]=u*a,o=o-s*a,e[l-1]=s-a,c=0;c<l;c++)t[c]=0;for(c=0;c<l;c++){for(s=e[c],n.set(c,l,s),a=t[c]+n.get(c,c)*s,h=c+1;h<=l-1;h++)a+=n.get(h,c)*e[h],t[h]+=n.get(h,c)*s;t[c]=a}for(s=0,c=0;c<l;c++)t[c]/=o,s+=t[c]*e[c];for(f=s/(o+o),c=0;c<l;c++)t[c]-=f*e[c];for(c=0;c<l;c++){for(s=e[c],a=t[c],h=c;h<=l-1;h++)n.set(h,c,n.get(h,c)-(s*t[h]+a*e[h]));e[c]=n.get(l-1,c),n.set(l,c,0)}}e[l]=o}for(l=0;l<r-1;l++){if(n.set(r-1,l,n.get(l,l)),n.set(l,l,1),o=e[l+1],o!==0){for(h=0;h<=l;h++)e[h]=n.get(h,l+1)/o;for(c=0;c<=l;c++){for(a=0,h=0;h<=l;h++)a+=n.get(h,l+1)*n.get(h,c);for(h=0;h<=l;h++)n.set(h,c,n.get(h,c)-a*e[h])}}for(h=0;h<=l;h++)n.set(h,l+1,0)}for(c=0;c<r;c++)e[c]=n.get(r-1,c),n.set(r-1,c,0);n.set(r-1,r-1,1),t[0]=0}function tql2(r,t,e,n){let s,a,o,l,c,h,f,u,d,g,p,x,y,m,A,b;for(o=1;o<r;o++)t[o-1]=t[o];t[r-1]=0;let _=0,M=0,T=Number.EPSILON;for(h=0;h<r;h++){for(M=Math.max(M,Math.abs(e[h])+Math.abs(t[h])),f=h;f<r&&!(Math.abs(t[f])<=T*M);)f++;if(f>h)do{for(s=e[h],u=(e[h+1]-s)/(2*t[h]),d=hypotenuse$1(u,1),u<0&&(d=-d),e[h]=t[h]/(u+d),e[h+1]=t[h]*(u+d),g=e[h+1],a=s-e[h],o=h+2;o<r;o++)e[o]-=a;for(_=_+a,u=e[f],p=1,x=p,y=p,m=t[h+1],A=0,b=0,o=f-1;o>=h;o--)for(y=x,x=p,b=A,s=p*t[o],a=p*u,d=hypotenuse$1(u,t[o]),t[o+1]=A*d,A=t[o]/d,p=u/d,u=p*e[o]-A*s,e[o+1]=a+A*(p*s+A*e[o]),c=0;c<r;c++)a=n.get(c,o+1),n.set(c,o+1,A*n.get(c,o)+p*a),n.set(c,o,p*n.get(c,o)-A*a);u=-A*b*y*m*t[h]/g,t[h]=A*u,e[h]=p*u}while(Math.abs(t[h])>T*M);e[h]=e[h]+_,t[h]=0}for(o=0;o<r-1;o++){for(c=o,u=e[o],l=o+1;l<r;l++)e[l]<u&&(c=l,u=e[l]);if(c!==o)for(e[c]=e[o],e[o]=u,l=0;l<r;l++)u=n.get(l,o),n.set(l,o,n.get(l,c)),n.set(l,c,u)}}function orthes(r,t,e,n){let s=0,a=r-1,o,l,c,h,f,u,d;for(u=s+1;u<=a-1;u++){for(d=0,h=u;h<=a;h++)d=d+Math.abs(t.get(h,u-1));if(d!==0){for(c=0,h=a;h>=u;h--)e[h]=t.get(h,u-1)/d,c+=e[h]*e[h];for(l=Math.sqrt(c),e[u]>0&&(l=-l),c=c-e[u]*l,e[u]=e[u]-l,f=u;f<r;f++){for(o=0,h=a;h>=u;h--)o+=e[h]*t.get(h,f);for(o=o/c,h=u;h<=a;h++)t.set(h,f,t.get(h,f)-o*e[h])}for(h=0;h<=a;h++){for(o=0,f=a;f>=u;f--)o+=e[f]*t.get(h,f);for(o=o/c,f=u;f<=a;f++)t.set(h,f,t.get(h,f)-o*e[f])}e[u]=d*e[u],t.set(u,u-1,d*l)}}for(h=0;h<r;h++)for(f=0;f<r;f++)n.set(h,f,h===f?1:0);for(u=a-1;u>=s+1;u--)if(t.get(u,u-1)!==0){for(h=u+1;h<=a;h++)e[h]=t.get(h,u-1);for(f=u;f<=a;f++){for(l=0,h=u;h<=a;h++)l+=e[h]*n.get(h,f);for(l=l/e[u]/t.get(u,u-1),h=u;h<=a;h++)n.set(h,f,n.get(h,f)+l*e[h])}}}function hqr2(r,t,e,n,s){let a=r-1,o=0,l=r-1,c=Number.EPSILON,h=0,f=0,u=0,d=0,g=0,p=0,x=0,y=0,m,A,b,_,M,T,D,E,S,w,v,k,I,L,F;for(m=0;m<r;m++)for((m<o||m>l)&&(e[m]=s.get(m,m),t[m]=0),A=Math.max(m-1,0);A<r;A++)f=f+Math.abs(s.get(m,A));for(;a>=o;){for(_=a;_>o&&(p=Math.abs(s.get(_-1,_-1))+Math.abs(s.get(_,_)),p===0&&(p=f),!(Math.abs(s.get(_,_-1))<c*p));)_--;if(_===a)s.set(a,a,s.get(a,a)+h),e[a]=s.get(a,a),t[a]=0,a--,y=0;else if(_===a-1){if(D=s.get(a,a-1)*s.get(a-1,a),u=(s.get(a-1,a-1)-s.get(a,a))/2,d=u*u+D,x=Math.sqrt(Math.abs(d)),s.set(a,a,s.get(a,a)+h),s.set(a-1,a-1,s.get(a-1,a-1)+h),E=s.get(a,a),d>=0){for(x=u>=0?u+x:u-x,e[a-1]=E+x,e[a]=e[a-1],x!==0&&(e[a]=E-D/x),t[a-1]=0,t[a]=0,E=s.get(a,a-1),p=Math.abs(E)+Math.abs(x),u=E/p,d=x/p,g=Math.sqrt(u*u+d*d),u=u/g,d=d/g,A=a-1;A<r;A++)x=s.get(a-1,A),s.set(a-1,A,d*x+u*s.get(a,A)),s.set(a,A,d*s.get(a,A)-u*x);for(m=0;m<=a;m++)x=s.get(m,a-1),s.set(m,a-1,d*x+u*s.get(m,a)),s.set(m,a,d*s.get(m,a)-u*x);for(m=o;m<=l;m++)x=n.get(m,a-1),n.set(m,a-1,d*x+u*n.get(m,a)),n.set(m,a,d*n.get(m,a)-u*x)}else e[a-1]=E+u,e[a]=E+u,t[a-1]=x,t[a]=-x;a=a-2,y=0}else{if(E=s.get(a,a),S=0,D=0,_<a&&(S=s.get(a-1,a-1),D=s.get(a,a-1)*s.get(a-1,a)),y===10){for(h+=E,m=o;m<=a;m++)s.set(m,m,s.get(m,m)-E);p=Math.abs(s.get(a,a-1))+Math.abs(s.get(a-1,a-2)),E=S=.75*p,D=-.4375*p*p}if(y===30&&(p=(S-E)/2,p=p*p+D,p>0)){for(p=Math.sqrt(p),S<E&&(p=-p),p=E-D/((S-E)/2+p),m=o;m<=a;m++)s.set(m,m,s.get(m,m)-p);h+=p,E=S=D=.964}for(y=y+1,M=a-2;M>=_&&(x=s.get(M,M),g=E-x,p=S-x,u=(g*p-D)/s.get(M+1,M)+s.get(M,M+1),d=s.get(M+1,M+1)-x-g-p,g=s.get(M+2,M+1),p=Math.abs(u)+Math.abs(d)+Math.abs(g),u=u/p,d=d/p,g=g/p,!(M===_||Math.abs(s.get(M,M-1))*(Math.abs(d)+Math.abs(g))<c*(Math.abs(u)*(Math.abs(s.get(M-1,M-1))+Math.abs(x)+Math.abs(s.get(M+1,M+1))))));)M--;for(m=M+2;m<=a;m++)s.set(m,m-2,0),m>M+2&&s.set(m,m-3,0);for(b=M;b<=a-1&&(L=b!==a-1,b!==M&&(u=s.get(b,b-1),d=s.get(b+1,b-1),g=L?s.get(b+2,b-1):0,E=Math.abs(u)+Math.abs(d)+Math.abs(g),E!==0&&(u=u/E,d=d/E,g=g/E)),E!==0);b++)if(p=Math.sqrt(u*u+d*d+g*g),u<0&&(p=-p),p!==0){for(b!==M?s.set(b,b-1,-p*E):_!==M&&s.set(b,b-1,-s.get(b,b-1)),u=u+p,E=u/p,S=d/p,x=g/p,d=d/u,g=g/u,A=b;A<r;A++)u=s.get(b,A)+d*s.get(b+1,A),L&&(u=u+g*s.get(b+2,A),s.set(b+2,A,s.get(b+2,A)-u*x)),s.set(b,A,s.get(b,A)-u*E),s.set(b+1,A,s.get(b+1,A)-u*S);for(m=0;m<=Math.min(a,b+3);m++)u=E*s.get(m,b)+S*s.get(m,b+1),L&&(u=u+x*s.get(m,b+2),s.set(m,b+2,s.get(m,b+2)-u*g)),s.set(m,b,s.get(m,b)-u),s.set(m,b+1,s.get(m,b+1)-u*d);for(m=o;m<=l;m++)u=E*n.get(m,b)+S*n.get(m,b+1),L&&(u=u+x*n.get(m,b+2),n.set(m,b+2,n.get(m,b+2)-u*g)),n.set(m,b,n.get(m,b)-u),n.set(m,b+1,n.get(m,b+1)-u*d)}}}if(f!==0){for(a=r-1;a>=0;a--)if(u=e[a],d=t[a],d===0)for(_=a,s.set(a,a,1),m=a-1;m>=0;m--){for(D=s.get(m,m)-u,g=0,A=_;A<=a;A++)g=g+s.get(m,A)*s.get(A,a);if(t[m]<0)x=D,p=g;else if(_=m,t[m]===0?s.set(m,a,D!==0?-g/D:-g/(c*f)):(E=s.get(m,m+1),S=s.get(m+1,m),d=(e[m]-u)*(e[m]-u)+t[m]*t[m],T=(E*p-x*g)/d,s.set(m,a,T),s.set(m+1,a,Math.abs(E)>Math.abs(x)?(-g-D*T)/E:(-p-S*T)/x)),T=Math.abs(s.get(m,a)),c*T*T>1)for(A=m;A<=a;A++)s.set(A,a,s.get(A,a)/T)}else if(d<0)for(_=a-1,Math.abs(s.get(a,a-1))>Math.abs(s.get(a-1,a))?(s.set(a-1,a-1,d/s.get(a,a-1)),s.set(a-1,a,-(s.get(a,a)-u)/s.get(a,a-1))):(F=cdiv(0,-s.get(a-1,a),s.get(a-1,a-1)-u,d),s.set(a-1,a-1,F[0]),s.set(a-1,a,F[1])),s.set(a,a-1,0),s.set(a,a,1),m=a-2;m>=0;m--){for(w=0,v=0,A=_;A<=a;A++)w=w+s.get(m,A)*s.get(A,a-1),v=v+s.get(m,A)*s.get(A,a);if(D=s.get(m,m)-u,t[m]<0)x=D,g=w,p=v;else if(_=m,t[m]===0?(F=cdiv(-w,-v,D,d),s.set(m,a-1,F[0]),s.set(m,a,F[1])):(E=s.get(m,m+1),S=s.get(m+1,m),k=(e[m]-u)*(e[m]-u)+t[m]*t[m]-d*d,I=(e[m]-u)*2*d,k===0&&I===0&&(k=c*f*(Math.abs(D)+Math.abs(d)+Math.abs(E)+Math.abs(S)+Math.abs(x))),F=cdiv(E*g-x*w+d*v,E*p-x*v-d*w,k,I),s.set(m,a-1,F[0]),s.set(m,a,F[1]),Math.abs(E)>Math.abs(x)+Math.abs(d)?(s.set(m+1,a-1,(-w-D*s.get(m,a-1)+d*s.get(m,a))/E),s.set(m+1,a,(-v-D*s.get(m,a)-d*s.get(m,a-1))/E)):(F=cdiv(-g-S*s.get(m,a-1),-p-S*s.get(m,a),x,d),s.set(m+1,a-1,F[0]),s.set(m+1,a,F[1]))),T=Math.max(Math.abs(s.get(m,a-1)),Math.abs(s.get(m,a))),c*T*T>1)for(A=m;A<=a;A++)s.set(A,a-1,s.get(A,a-1)/T),s.set(A,a,s.get(A,a)/T)}for(m=0;m<r;m++)if(m<o||m>l)for(A=m;A<r;A++)n.set(m,A,s.get(m,A));for(A=r-1;A>=o;A--)for(m=o;m<=l;m++){for(x=0,b=o;b<=Math.min(A,l);b++)x=x+n.get(m,b)*s.get(b,A);n.set(m,A,x)}}}function cdiv(r,t,e,n){let s,a;return Math.abs(e)>Math.abs(n)?(s=n/e,a=e+s*n,[(r+s*t)/a,(t-s*r)/a]):(s=e/n,a=n+s*e,[(s*r+t)/a,(s*t-r)/a])}let CholeskyDecomposition$1=class{constructor(t){if(t=WrapperMatrix2D$1.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let e=t,n=e.rows,s=new Matrix$3(n,n),a=!0,o,l,c;for(l=0;l<n;l++){let h=0;for(c=0;c<l;c++){let f=0;for(o=0;o<c;o++)f+=s.get(c,o)*s.get(l,o);f=(e.get(l,c)-f)/s.get(c,c),s.set(l,c,f),h=h+f*f}for(h=e.get(l,l)-h,a&=h>0,s.set(l,l,Math.sqrt(Math.max(h,0))),c=l+1;c<n;c++)s.set(l,c,0)}this.L=s,this.positiveDefinite=!!a}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D$1.checkMatrix(t);let e=this.L,n=e.rows;if(t.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=t.columns,a=t.clone(),o,l,c;for(c=0;c<n;c++)for(l=0;l<s;l++){for(o=0;o<c;o++)a.set(c,l,a.get(c,l)-a.get(o,l)*e.get(c,o));a.set(c,l,a.get(c,l)/e.get(c,c))}for(c=n-1;c>=0;c--)for(l=0;l<s;l++){for(o=c+1;o<n;o++)a.set(c,l,a.get(c,l)-a.get(o,l)*e.get(o,c));a.set(c,l,a.get(c,l)/e.get(c,c))}return a}get lowerTriangularMatrix(){return this.L}};class nipals{constructor(t,e={}){t=WrapperMatrix2D$1.checkMatrix(t);let{Y:n}=e;const{scaleScores:s=!1,maxIterations:a=1e3,terminationCriteria:o=1e-10}=e;let l;if(n){if(isAnyArray.isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$3.columnVector(n):n=WrapperMatrix2D$1.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");l=n.getColumnVector(0)}else l=t.getColumnVector(0);let c=1,h,f,u,d;for(let g=0;g<a&&c>o;g++)u=t.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),u=u.div(u.norm()),h=t.mmul(u).div(u.transpose().mmul(u).get(0,0)),g>0&&(c=h.clone().sub(d).pow(2).sum()),d=h.clone(),n?(f=n.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),f=f.div(f.norm()),l=n.mmul(f).div(f.transpose().mmul(f).get(0,0))):l=h;if(n){let g=t.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));g=g.div(g.norm());let p=t.clone().sub(h.clone().mmul(g.transpose())),x=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),y=n.clone().sub(h.clone().mulS(x.get(0,0)).mmul(f.transpose()));this.t=h,this.p=g.transpose(),this.w=u.transpose(),this.q=f,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=p,this.yResidual=y,this.betas=x}else this.w=u.transpose(),this.s=h.transpose().mmul(h).sqrt(),s?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=t.sub(h.mmul(u.transpose()))}}var AbstractMatrix_1=matrix$2.AbstractMatrix=AbstractMatrix$1,CHO$1=matrix$2.CHO=CholeskyDecomposition$1,CholeskyDecomposition_1=matrix$2.CholeskyDecomposition=CholeskyDecomposition$1,DistanceMatrix_1=matrix$2.DistanceMatrix=DistanceMatrix$1,EVD$1=matrix$2.EVD=EigenvalueDecomposition$1,EigenvalueDecomposition_1=matrix$2.EigenvalueDecomposition=EigenvalueDecomposition$1,LU$1=matrix$2.LU=LuDecomposition$1,LuDecomposition_1=matrix$2.LuDecomposition=LuDecomposition$1,Matrix_1=matrix$2.Matrix=Matrix$3,MatrixColumnSelectionView_1=matrix$2.MatrixColumnSelectionView=MatrixColumnSelectionView$1,MatrixColumnView_1=matrix$2.MatrixColumnView=MatrixColumnView$1,MatrixFlipColumnView_1=matrix$2.MatrixFlipColumnView=MatrixFlipColumnView$1,MatrixFlipRowView_1=matrix$2.MatrixFlipRowView=MatrixFlipRowView$1,MatrixRowSelectionView_1=matrix$2.MatrixRowSelectionView=MatrixRowSelectionView$1,MatrixRowView_1=matrix$2.MatrixRowView=MatrixRowView$1,MatrixSelectionView_1=matrix$2.MatrixSelectionView=MatrixSelectionView$1,MatrixSubView_1=matrix$2.MatrixSubView=MatrixSubView$1,MatrixTransposeView_1=matrix$2.MatrixTransposeView=MatrixTransposeView$2,NIPALS$1=matrix$2.NIPALS=nipals,Nipals$1=matrix$2.Nipals=nipals,QR$1=matrix$2.QR=QrDecomposition$1,QrDecomposition_1=matrix$2.QrDecomposition=QrDecomposition$1,SVD$1=matrix$2.SVD=SingularValueDecomposition$1,SingularValueDecomposition_1=matrix$2.SingularValueDecomposition=SingularValueDecomposition$1,SymmetricMatrix_1=matrix$2.SymmetricMatrix=SymmetricMatrix$1,WrapperMatrix1D_1=matrix$2.WrapperMatrix1D=WrapperMatrix1D$1,WrapperMatrix2D_1=matrix$2.WrapperMatrix2D=WrapperMatrix2D$1,correlation_1=matrix$2.correlation=correlation$1,covariance_1=matrix$2.covariance=covariance$1,_default=matrix$2.default=Matrix$3,determinant_1=matrix$2.determinant=determinant$1,inverse_1=matrix$2.inverse=inverse$1,linearDependencies_1=matrix$2.linearDependencies=linearDependencies$1,pseudoInverse_1=matrix$2.pseudoInverse=pseudoInverse$1,solve_1=matrix$2.solve=solve$1,wrap_1=matrix$2.wrap=wrap$1;const AbstractMatrix=AbstractMatrix_1,CHO=CHO$1,CholeskyDecomposition=CholeskyDecomposition_1,DistanceMatrix=DistanceMatrix_1,EVD=EVD$1,EigenvalueDecomposition=EigenvalueDecomposition_1,LU=LU$1,LuDecomposition=LuDecomposition_1,Matrix$2=Matrix_1,MatrixColumnSelectionView=MatrixColumnSelectionView_1,MatrixColumnView=MatrixColumnView_1,MatrixFlipColumnView=MatrixFlipColumnView_1,MatrixFlipRowView=MatrixFlipRowView_1,MatrixRowSelectionView=MatrixRowSelectionView_1,MatrixRowView=MatrixRowView_1,MatrixSelectionView=MatrixSelectionView_1,MatrixSubView=MatrixSubView_1,MatrixTransposeView$1=MatrixTransposeView_1,NIPALS=NIPALS$1,Nipals=Nipals$1,QR=QR$1,QrDecomposition=QrDecomposition_1,SVD=SVD$1,SingularValueDecomposition=SingularValueDecomposition_1,SymmetricMatrix=SymmetricMatrix_1,WrapperMatrix1D=WrapperMatrix1D_1,WrapperMatrix2D=WrapperMatrix2D_1,correlation=correlation_1,covariance=covariance_1,matrix=_default.Matrix?_default.Matrix:Matrix_1,determinant=determinant_1,inverse=inverse_1,linearDependencies=linearDependencies_1,pseudoInverse=pseudoInverse_1,solve=solve_1,wrap=wrap_1,matrix$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,CHO,CholeskyDecomposition,DistanceMatrix,EVD,EigenvalueDecomposition,LU,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS,Nipals,QR,QrDecomposition,SVD,SingularValueDecomposition,SymmetricMatrix,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:matrix,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(r){const t=new SVD(r,{autoTranspose:!0});if(t.rank!==1)return null;const e=Math.sqrt(t.s[0]),n=t.U.to2DArray().map(a=>a[0]*e),s=t.V.to2DArray().map(a=>a[0]*e);return[n,s]}function convolution(r,t={}){let{channels:e,bitDepth:n,normalize:s=!1,divisor:a=1,border:o="copy",algorithm:l="auto"}=t,c={};n&&(c.bitDepth=n);let h=Image.createFrom(this,c);if(e=validateArrayOfChannels(this,e),l!=="separable")({kernel:r}=validateKernel(r));else if(!Array.isArray(r)||r.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(l==="auto"){let _=getSeparatedKernel(r);_!==null?(l="separable",r=_):(r.length>9||r[0].length>9)&&this.width<=4096&&this.height<=4096?l="fft":l="direct"}let f,u;l==="separable"?(f=Math.floor(r[0].length/2),u=Math.floor(r[1].length/2)):(f=Math.floor(r.length/2),u=Math.floor(r[0].length/2));let d=h.isClamped,g=new Array(this.height*this.width),p,x,y,m,A,b;for(m=0;m<e.length;m++){for(A=e[m],y=0;y<this.height;y++)for(x=0;x<this.width;x++)p=y*this.width+x,g[p]=this.data[p*this.channels+A];if(l==="direct")b=src$2.direct(g,r,{rows:this.height,cols:this.width,normalize:s,divisor:a});else if(l==="separable"){if(b=convolutionSeparable(g,r,this.width,this.height),s){a=0;for(let _=0;_<r[0].length;_++)for(let M=0;M<r[1].length;M++)a+=r[0][_]*r[1][M]}if(a!==1)for(let _=0;_<b.length;_++)b[_]/=a}else b=src$2.fft(g,r,{rows:this.height,cols:this.width,normalize:s,divisor:a});for(y=0;y<this.height;y++)for(x=0;x<this.width;x++)p=y*this.width+x,d?h.data[p*this.channels+A]=clamp(b[p],h):h.data[p*this.channels+A]=b[p]}if(this.alpha&&!e.includes(this.channels))for(x=this.components;x<this.data.length;x=x+this.channels)h.data[x]=this.data[x];return o!=="periodic"&&h.setBorder({size:[u,f],algorithm:o}),h}function gradientFilter(r={}){let{direction:t="xy",border:e="copy",kernelX:n,kernelY:s,channels:a,bitDepth:o=this.bitDepth}=r;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),t){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:a,border:e,bitDepth:o});case"y":if(!s)throw new Error("kernelY option is missing");return convolution.call(this,s,{channels:a,border:e,bitDepth:o});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!s)throw new Error("kernelY option is missing");const l=convolution.call(this,n,{channels:a,border:e,bitDepth:32}),c=convolution.call(this,s,{channels:a,border:e,bitDepth:32});return l.hypotenuse(c,{bitDepth:o,channels:a})}default:throw new Error(`Unknown parameter direction: ${t}`)}}function sobelFilter(r){return gradientFilter.call(this,Object.assign({},r,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(r){return gradientFilter.call(this,Object.assign({},r,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(r,t){r=r||0;for(var e=new Array(r),n=0;n<r;n++)e[n]=t;return e}const newArray$1=getDefaultExportFromCjs(newArray_1);function level(r={}){let{algorithm:t="range",channels:e,min:n=this.min,max:s=this.max}=r;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),e=validateArrayOfChannels(this,{channels:e}),e.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((a,o)=>e.includes(o))),Array.isArray(s)&&s.length===this.channels&&(s=s.filter((a,o)=>e.includes(o)))),t){case"range":n<0&&(n=0),s>this.maxValue&&(s=this.maxValue),Array.isArray(n)||(n=newArray$1(e.length,n)),Array.isArray(s)||(s=newArray$1(e.length,s)),processImage(this,n,s,e);break;default:throw new Error(`level: algorithm not implement: ${t}`)}return this}function processImage(r,t,e,n){let s=1e-5,a=new Array(n.length);for(let o=0;o<n.length;o++)t[o]===0&&e[o]===r.maxValue||e[o]===t[o]?a[o]=0:a[o]=(r.maxValue+1-s)/(e[o]-t[o]),t[o]+=(.5-s/2)/a[o];for(let o=0;o<n.length;o++){let l=n[o];if(a[o]!==0)for(let c=0;c<r.data.length;c+=r.channels)r.data[c+l]=Math.min(Math.max(0,(r.data[c+l]-t[o])*a[o]+.5|0),r.maxValue)}}var toString=Object.prototype.toString,isArrayType=function r(t){return toString.call(t).substr(-6,5)==="Array"};const isArray=getDefaultExportFromCjs(isArrayType);function checkNumberArray(r){if(isNaN(r)){if(r instanceof Image)return r.data;if(!isArray(r))throw new Error("checkNumberArray: the value should be either a number, array or Image");return r}else{if(r<=0)throw new Error("checkNumberArray: the value must be greater than 0");return r}}function add(r,t={}){let{channels:e}=t;if(this.checkProcessable("add",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("add: the data size is different");for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]+r[a+s]>>0))}}else for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.min(this.maxValue,this.data[a+s]+r>>0)}return this}function subtract(r,t={}){let{channels:e}=t;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("subtract: the data size is different");for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]-r[a+s]>>0))}}else for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,this.data[a+s]-r>>0)}return this}function subtractImage(r,t={}){let{channels:e,absolute:n=!1}=t;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==r.width||this.height!==r.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==r.alpha||this.bitDepth!==r.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==r.channels)throw new Error("subtractImage: both images must have the same number of channels");let s=this.clone();e=validateArrayOfChannels(this,{channels:e});for(let a=0;a<e.length;a++){let o=e[a];for(let l=o;l<this.data.length;l+=this.channels){let c=this.data[l]-r.data[l];n?s.data[l]=Math.abs(c):s.data[l]=Math.max(c,0)}}return s}function hypotenuse(r,t={}){let{bitDepth:e=this.bitDepth,channels:n}=t;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==r.width||this.height!==r.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==r.alpha||this.bitDepth!==r.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==r.channels)throw new Error("hypotenuse: both images must have the same number of channels");let s=Image.createFrom(this,{bitDepth:e});n=validateArrayOfChannels(this,{channels:n});let a=s.isClamped;for(let o=0;o<n.length;o++){let l=n[o];for(let c=l;c<this.data.length;c+=this.channels){let h=Math.hypot(this.data[c],r.data[c]);a?s.data[c]=Math.min(Math.max(Math.round(h),0),s.maxValue):s.data[c]=h}}return s}function multiply(r,t={}){let{channels:e}=t;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),r<=0)throw new Error("multiply: the value must be greater than 0");if(e=validateArrayOfChannels(this,{channels:e}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("multiply: the data size is different");for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]*r[a+s]>>0))}}else for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.min(this.maxValue,this.data[a+s]*r>>0)}return this}function divide(r,t={}){let{channels:e}=t;if(this.checkProcessable("divide",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("divide: the: the data size is different");for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]/r[a+s]>>0))}}else for(let n=0;n<e.length;n++){let s=e[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.min(this.maxValue,this.data[a+s]/r>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if(typeof t=="number")return this._predict(t);if(isAnyArray$1(t)){const e=[];for(let n=0;n<t.length;n++)e.push(this._predict(t[n]));return e}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,e){if(!isAnyArray$1(t)||!isAnyArray$1(e)||t.length!==e.length)throw new Error("x and y must be arrays of the same length");const n=t.length,s=new Array(n);for(let g=0;g<n;g++)s[g]=this._predict(t[g]);let a=0,o=0,l=0,c=0,h=0,f=0,u=0;for(let g=0;g<n;g++)a+=s[g],o+=e[g],h+=s[g]*s[g],f+=e[g]*e[g],u+=s[g]*e[g],e[g]!==0&&(l+=(e[g]-s[g])*(e[g]-s[g])/e[g]),c+=(e[g]-s[g])*(e[g]-s[g]);const d=(n*u-a*o)/Math.sqrt((n*h-a*a)*(n*f-o*o));return{r:d,r2:d*d,chi2:l,rmsd:Math.sqrt(c/n)}}}const require$$0$2=getAugmentedNamespace(matrix$1);function squaredEuclidean$4(r,t){let e=0;for(let n=0;n<r.length;n++)e+=(r[n]-t[n])*(r[n]-t[n]);return e}function euclidean$2(r,t){return Math.sqrt(squaredEuclidean$4(r,t))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0$1,defaultOptions$f={sigma:1};let GaussianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$f,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const n=squaredEuclidean$3(t,e);return Math.exp(-n/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$e={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$e,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,e){for(var n=0,s=0;s<t.length;s++)n+=t[s]*e[s];return Math.pow(this.scale*n+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$d={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$d,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,e){for(var n=0,s=0;s<t.length;s++)n+=t[s]*e[s];return Math.tanh(this.alpha*n+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$c={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$c,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,e){for(var n=0,s=Math.min(t.length,e.length),a=1;a<=s;++a)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[a-1],a)-Math.pow(e[a-1],a),2)),this.degree);return n}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0$1,defaultOptions$b={sigma:1};let CauchyKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$b,t),this.sigma=t.sigma}compute(t,e){return 1/(1+squaredEuclidean$2(t,e)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0$1,defaultOptions$a={sigma:1};let ExponentialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$a,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const n=euclidean$1(t,e);return Math.exp(-n/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(t,e){for(var n=Math.min(t.length,e.length),s=0,a=0;a<n;++a)s+=Math.min(t[a],e[a]);return s}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0$1,defaultOptions$9={sigma:1};let LaplacianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$9,t),this.sigma=t.sigma}compute(t,e){const n=euclidean(t,e);return Math.exp(-n/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0$1,defaultOptions$8={constant:1};let MultiquadraticKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$8,t),this.constant=t.constant}compute(t,e){return Math.sqrt(squaredEuclidean$1(t,e)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0$1,defaultOptions$7={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$7,t),this.constant=t.constant}compute(t,e){const n=squaredEuclidean(t,e);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$2,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(t,e){if(this.kernelType=t,t!=="linear")if(typeof t=="string"){t=t.toLowerCase();var n=kernelType[t];if(n)this.kernelFunction=new n(e);else throw new Error(`unsupported kernel type: ${t}`)}else if(typeof t=="object"&&typeof t.compute=="function")this.kernelFunction=t;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(t,e){if(t=Matrix$1.checkMatrix(t),e===void 0?e=t:e=Matrix$1.checkMatrix(e),this.kernelType==="linear")return t.mmul(new MatrixTransposeView(e));const n=new Matrix$1(t.rows,e.rows);if(t===e)for(let s=0;s<t.rows;s++)for(let a=s;a<t.rows;a++){const o=this.kernelFunction.compute(t.getRow(s),t.getRow(a));n.set(s,a,o),n.set(a,s,o)}else for(let s=0;s<t.rows;s++)for(let a=0;a<e.rows;a++)n.set(s,a,this.kernelFunction.compute(t.getRow(s),e.getRow(a)));return n}}var kernel=Kernel;const Kernel$1=getDefaultExportFromCjs(kernel),defaultOptions$6={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,e,n){if(super(),t===!0)this.alpha=e.alpha,this.inputs=e.inputs,this.kernelType=e.kernelType,this.kernelOptions=e.kernelOptions,this.kernel=new Kernel$1(e.kernelType,e.kernelOptions);else{t=Matrix$2.checkMatrix(t),n=Object.assign({},defaultOptions$6,n);const s=new Kernel$1(n.kernelType,n.kernelOptions),a=s.compute(t),o=t.rows;a.add(Matrix$2.eye(o,o).mul(n.lambda)),this.alpha=solve(a,e),this.inputs=t,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=s}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if(t.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}function background$1(r,t,e){const n=new KernelRidgeRegression(r,t,e),s=new Array(this.size);for(let l=0;l<this.width;l++)for(let c=0;c<this.height;c++)s[c*this.width+l]=[l,c];const a=n.predict(s),o=Image.createFrom(this);for(let l=0;l<this.size;l++)o.data[l]=Math.min(this.maxValue,Math.max(0,a[l][0]));return o}function dilate(r={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=r;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const a of t)for(const o of a)if(o!==1){n=!1;break e}let s=this;for(let a=0;a<e;a++)if(this.bitDepth===1)if(n){const o=s.clone();s=dilateOnceBinaryOnlyOnes(s,o,t.length,t[0].length)}else{const o=Image.createFrom(s);s=dilateOnceBinary(s,o,t)}else if(n){const o=Image.createFrom(s);s=dilateOnceGreyOnlyOnes(s,o,t.length,t[0].length)}else{const o=Image.createFrom(s);s=dilateOnceGrey(s,o,t)}return s}function dilateOnceGrey(r,t,e){const n=e.length,s=e[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<r.height;l++)for(let c=0;c<r.width;c++){let h=0;for(let f=0;f<s;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-a+c,g=f-o+l;if(d<0||g<0||d>=r.width||g>=r.height)continue;const p=r.getValueXY(d,g,0);p>h&&(h=p)}t.setValueXY(c,l,0,h)}return t}function dilateOnceGreyOnlyOnes(r,t,e,n){const s=(e-1)/2,a=(n-1)/2,o=[];for(let l=0;l<r.width;l++)o.push(0);for(let l=0;l<r.height;l++){for(let c=0;c<r.width;c++){let h=0;for(let f=Math.max(0,l-a);f<Math.min(r.height,l+a+1);f++){const u=r.getValueXY(c,f,0);u>h&&(h=u)}o[c]=h}for(let c=0;c<r.width;c++){let h=0;for(let f=Math.max(0,c-s);f<Math.min(r.width,c+s+1);f++)o[f]>h&&(h=o[f]);t.setValueXY(c,l,0,h)}}return t}function dilateOnceBinary(r,t,e){const n=e.length,s=e[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<r.height;l++)for(let c=0;c<r.width;c++){let h=0;e:for(let f=0;f<s;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-a+c,g=f-o+l;if(g<0||d<0||d>=r.width||g>=r.height)continue;if(r.getBitXY(d,g)===1){h=1;break e}}h===1&&t.setBitXY(c,l)}return t}function dilateOnceBinaryOnlyOnes(r,t,e,n){const s=(e-1)/2,a=(n-1)/2,o=[];for(let l=0;l<r.width;l++)o.push(1);for(let l=0;l<r.height;l++){for(let c=0;c<r.width;c++){o[c]=0;for(let h=Math.max(0,l-a);h<Math.min(r.height,l+a+1);h++)if(r.getBitXY(c,h)===1){o[c]=1;break}}for(let c=0;c<r.width;c++)if(t.getBitXY(c,l)!==1){for(let h=Math.max(0,c-s);h<Math.min(r.width,c+s+1);h++)if(o[h]===1){t.setBitXY(c,l);break}}}return t}function erode(r={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=r;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const a of t)for(const o of a)if(o!==1){n=!1;break e}let s=this;for(let a=0;a<e;a++)if(this.bitDepth===1)if(n){const o=s.clone();s=erodeOnceBinaryOnlyOnes(s,o,t.length,t[0].length)}else{const o=Image.createFrom(s);s=erodeOnceBinary(s,o,t)}else if(n){const o=Image.createFrom(s);s=erodeOnceGreyOnlyOnes(s,o,t.length,t[0].length)}else{const o=Image.createFrom(s);s=erodeOnceGrey(s,o,t)}return s}function erodeOnceGrey(r,t,e){const n=e.length,s=e[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<r.height;l++)for(let c=0;c<r.width;c++){let h=r.maxValue;for(let f=0;f<s;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-a+c,g=f-o+l;if(d<0||g<0||d>=r.width||g>=r.height)continue;const p=r.getValueXY(d,g,0);p<h&&(h=p)}t.setValueXY(c,l,0,h)}return t}function erodeOnceGreyOnlyOnes(r,t,e,n){const s=(e-1)/2,a=(n-1)/2,o=[];for(let l=0;l<r.width;l++)o.push(0);for(let l=0;l<r.height;l++){for(let c=0;c<r.width;c++){let h=r.maxValue;for(let f=Math.max(0,l-a);f<Math.min(r.height,l+a+1);f++){const u=r.getValueXY(c,f,0);u<h&&(h=u)}o[c]=h}for(let c=0;c<r.width;c++){let h=r.maxValue;for(let f=Math.max(0,c-s);f<Math.min(r.width,c+s+1);f++)o[f]<h&&(h=o[f]);t.setValueXY(c,l,0,h)}}return t}function erodeOnceBinary(r,t,e){const n=e.length,s=e[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<r.height;l++)for(let c=0;c<r.width;c++){let h=1;e:for(let f=0;f<s;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-a+c,g=f-o+l;if(g<0||d<0||d>=r.width||g>=r.height)continue;if(r.getBitXY(d,g)===0){h=0;break e}}h===1&&t.setBitXY(c,l)}return t}function erodeOnceBinaryOnlyOnes(r,t,e,n){const s=(e-1)/2,a=(n-1)/2,o=[];for(let l=0;l<r.width;l++)o.push(0);for(let l=0;l<r.height;l++){for(let c=0;c<r.width;c++){o[c]=1;for(let h=Math.max(0,l-a);h<Math.min(r.height,l+a+1);h++)if(r.getBitXY(c,h)===0){o[c]=0;break}}for(let c=0;c<r.width;c++)if(t.getBitXY(c,l)!==0){for(let h=Math.max(0,c-s);h<Math.min(r.width,c+s+1);h++)if(o[h]===0){t.clearBitXY(c,l);break}}}return t}function open(r={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=r;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<e;s++)n=n.erode({kernel:t}),n=n.dilate({kernel:t});return n}function close(r={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=r;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<e;s++)n=n.dilate({kernel:t}).erode({kernel:t});return n}function topHat(r={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=r;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),t.length%2===0||t[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<e;s++)n=n.open({kernel:t}).subtractImage(n,{absolute:!0});return n}function blackHat(r={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=r;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<e;s++)n=n.close({kernel:t}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(r={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=r;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<e;s++){let a=n.dilate({kernel:t}),o=n.erode({kernel:t});n=a.subtractImage(o,{absolute:!0})}return n}function order4Points(r){let t=0,e=0,n=0,s=0,a=r[0][0],o=0;for(let h=1;h<r.length;h++)r[h][0]<a&&(a=r[h][0],o=h);let l=r[(o+1)%r.length][0],c=(o+1)%r.length;for(let h=1;h<r.length;h++)r[h][0]<l&&h!==o&&(l=r[h][0],c=h);return r[c][1]<r[o][1]?(t=r[c],s=r[o],o!==(c+1)%4?(e=r[(c+1)%4],n=r[(c+2)%4]):(e=r[(c+2)%4],n=r[(c+3)%4])):(s=r[c],t=r[o],c!==(o+1)%4?(e=r[(o+1)%4],n=r[(o+2)%4]):(e=r[(o+2)%4],n=r[(o+3)%4])),[t,e,n,s]}function distance2Points(r,t){return Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2))}function crossVect(r,t){return[r[1]*t[2]-r[2]*t[1],r[2]*t[0]-r[0]*t[2],r[0]*t[1]-r[1]*t[0]]}function dotVect(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function computeWidthAndHeigth(r,t,e,n,s,a){let o=Math.max(distance2Points(r,t),distance2Points(n,e)),l=Math.max(distance2Points(r,n),distance2Points(t,e)),c=0,h=0,f=Math.ceil(s/2),u=Math.ceil(a/2),d=o/l,g=[r[0],r[1],1],p=[t[0],t[1],1],x=[n[0],n[1],1],y=[e[0],e[1],1],m=dotVect(crossVect(g,y),x)/dotVect(crossVect(p,y),x),A=dotVect(crossVect(g,y),p)/dotVect(crossVect(x,y),p),b=[m*p[0]-g[0],m*p[1]-g[1],m*p[2]-g[2]],_=[A*x[0]-g[0],A*x[1]-g[1],A*x[2]-g[2]],M=b[0],T=b[1],D=b[2],E=_[0],S=_[1],w=_[2],v=1/(D*w)*(M*E-(M*w+D*E)*f+D*w*f*f+(T*S-(T*w+D*S)*u+D*w*u*u));v>=0?v=Math.sqrt(v):v=Math.sqrt(-v);let k=new Matrix$2([[v,0,f],[0,v,u],[0,0,1]]),I=k.transpose(),L=inverse(I),F=inverse(k),Z=Matrix$2.rowVector(b),W=Matrix$2.rowVector(_),G=Math.sqrt(dotVect(Z.mmul(L).mmul(F).to1DArray(),b)/dotVect(W.mmul(L).mmul(F).to1DArray(),_));return G===0||d===0?(c=Math.ceil(o),h=Math.ceil(l)):G<d?(c=Math.ceil(o),h=Math.ceil(c/G)):(h=Math.ceil(l),c=Math.ceil(G*h)),[c,h]}function projectionPoint(r,t,e,n,s,a,o,l,c,h,f,u){let[d,g]=[(e*r+n*t+s)/(c*r+h*t+1),(a*r+o*t+l)/(c*r+h*t+1)];return f.getValueXY(Math.floor(d),Math.floor(g),u)}function warpingFourPoints(r,t={}){let{calculateRatio:e=!0}=t;if(r.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${r.length} elements`);let[n,s,a,o]=r,l=[n,s,a,o],[c,h,f,u]=order4Points(l),d,g;e?[d,g]=computeWidthAndHeigth(c,h,f,u,this.width,this.height):(d=Math.ceil(Math.max(distance2Points(c,h),distance2Points(u,f))),g=Math.ceil(Math.max(distance2Points(c,u),distance2Points(h,f))));let p=Image.createFrom(this,{width:d,height:g}),[x,y]=c,[m,A]=h,[b,_]=f,[M,T]=u,[D,E]=[0,0],[S,w]=[0,d-1],[v,k]=[g-1,d-1],[I,L]=[g-1,0],F=new Matrix$2([[D,E,1,0,0,0,-D*x,-E*x],[S,w,1,0,0,0,-S*m,-w*m],[v,k,1,0,0,0,-v*b,-E*b],[I,L,1,0,0,0,-I*M,-L*M],[0,0,0,D,E,1,-D*y,-E*y],[0,0,0,S,w,1,-S*A,-w*A],[0,0,0,v,k,1,-v*_,-k*_],[0,0,0,I,L,1,-I*T,-L*T]]),Z=Matrix$2.columnVector([x,m,b,M,y,A,_,T]),G=new SingularValueDecomposition(F).solve(Z),[P,C,Y,j,R,N,U,z]=G.to1DArray(),H=new Matrix$2(g,d);for(let ee=0;ee<this.channels;ee++){for(let se=0;se<g;se++)for(let ae=0;ae<d;ae++)H.set(se,ae,projectionPoint(se,ae,P,C,Y,j,R,N,U,z,this,ee));p.setMatrix(H,{channel:ee})}return p}function crop(r={}){let{x:t=0,y:e=0,width:n=this.width-t,height:s=this.height-e}=r;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),t=Math.round(t),e=Math.round(e),n=Math.round(n),s=Math.round(s),t>this.width-1||e>this.height-1)throw new RangeError(`crop: origin (x:${t}, y:${e}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||s<=0)throw new RangeError(`crop: width and height (width:${n}; height:${s}) must be positive numbers`);if(t<0||e<0)throw new RangeError(`crop: x and y (x:${t}, y:${e}) must be positive numbers`);if(n>this.width-t||s>this.height-e)throw new RangeError(`crop: (x: ${t}, y:${e}, width:${n}, height:${s}) size is out of range`);let a=this;if(this.bitDepth===1){const o=new Image(n,s,{kind:"BINARY",parent:this});a=cropBinary(this,o,t,e,n,s)}else{const o=Image.createFrom(this,{width:n,height:s,position:[t,e]});a=cropDefault(this,o,t,e,n,s)}return a}function cropDefault(r,t,e,n,s,a){let o=s*r.channels,l=n+a,c=0,h=e*r.channels;for(let f=n;f<l;f++){let u=f*r.width*r.channels+h,d=u+o;for(;u<d;u++)t.data[c++]=r.data[u]}return t}function cropBinary(r,t,e,n,s,a){let o=s*r.channels,l=n+a,c=0,h=e*r.channels;for(let f=n;f<l;f++){let u=f*r.width*r.channels+h,d=u+o;for(;u<d;u++)r.getBit(u)&&t.setBit(c),++c}return t}function cropAlpha(r={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:t=this.maxValue}=r;let e=findLeft(this,t,this.components);if(e===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,t,this.components,e),s=findBottom(this,t,this.components,e),a=findRight(this,t,this.components,e,n,s);return this.crop({x:e,y:n,width:a-e+1,height:s-n+1})}function findLeft(r,t,e){for(let n=0;n<r.width;n++)for(let s=0;s<r.height;s++)if(r.getValueXY(n,s,e)>=t)return n;return-1}function findTop(r,t,e,n){for(let s=0;s<r.height;s++)for(let a=n;a<r.width;a++)if(r.getValueXY(a,s,e)>=t)return s;return-1}function findBottom(r,t,e,n){for(let s=r.height-1;s>=0;s--)for(let a=n;a<r.width;a++)if(r.getValueXY(a,s,e)>=t)return s;return-1}function findRight(r,t,e,n,s,a){for(let o=r.width-1;o>=n;o--)for(let l=s;l<=a;l++)if(r.getValueXY(o,l,e)>=t)return o;return-1}function getFactor(r){if(typeof r=="string"){const t=r[r.length-1];r=parseFloat(r),t==="%"&&(r/=100)}return r}function getThreshold$1(r,t){if(!t)throw Error("getThreshold : the maxValue should be specified");if(typeof r=="string"){if(r[r.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(r)/100*t}else{if(typeof r=="number")return r<1?r*t:r;throw Error("getThreshold : the value is not valid")}}function factorDimensions(r,t,e){r=getFactor(r);let n=Math.round(r*t),s=Math.round(r*e);return n<=0&&(n=1),s<=0&&(s=1),{width:n,height:s}}function checkRow(r,t){if(t<0||t>=r.height)throw new RangeError(`row must be included between 0 and ${r.height-1}. Current value: ${t}`)}function checkColumn(r,t){if(t<0||t>=r.width)throw new RangeError(`column must be included between 0 and ${r.width-1}. Current value: ${t}`)}function checkChannel(r,t){if(t<0||t>=r.channels)throw new RangeError(`channel must be included between 0 and ${r.channels-1}. Current value: ${t}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(r){if(typeof r!="string")throw new TypeError("interpolation must be a string");if(r=r.toLowerCase(),!validInterpolations[r])throw new RangeError(`invalid interpolation algorithm: ${r}`);return validInterpolations[r]}function nearestNeighbor(r,t,e){const n=this.width/t,s=this.height/e;if(this.bitDepth>1)for(let a=0;a<t;a++){const o=Math.floor((a+.5)*n);for(let l=0;l<e;l++){const c=Math.floor((l+.5)*s);for(let h=0;h<this.channels;h++)r.setValueXY(a,l,h,this.getValueXY(o,c,h))}}else for(let a=0;a<t;a++){const o=Math.floor((a+.5)*n);for(let l=0;l<e;l++){const c=Math.floor((l+.5)*s);this.getBitXY(o,c)&&r.setBitXY(a,l)}}}function resize(r={}){const{factor:t=1,interpolation:e=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=r,s=checkInterpolation(e);let a=r.width,o=r.height;if(a||(o&&n?a=Math.round(o*(this.width/this.height)):a=this.width),o||(n?o=Math.round(a*(this.height/this.width)):o=this.height),{width:a,height:o}=factorDimensions(t,a,o),a===this.width&&o===this.height){const f=this.clone();return f.position=[0,0],f}let l=Math.round((this.width-a)/2),c=Math.round((this.height-o)/2);const h=Image.createFrom(this,{width:a,height:o,position:[l,c]});switch(s){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,h,a,o);break;default:throw new Error(`unsupported resize interpolation: ${s}`)}return h}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let r=Image.createFrom(this,{colorModel:HSV}),t=0,e=this.data;for(let n=0;n<e.length;n+=this.channels){let s=e[n],a=e[n+1],o=e[n+2],l=Math.min(s,a,o),c=Math.max(s,a,o),h=c-l,f=0,u=c===0?0:h/c,d=c;if(c!==l){switch(c){case s:f=(a-o)/h+(a<o?6:0);break;case a:f=(o-s)/h+2;break;case o:f=(s-a)/h+4;break;default:throw new Error("unreachable")}f/=6}r.data[t++]=f*this.maxValue,r.data[t++]=u*this.maxValue,r.data[t++]=d,this.alpha&&(r.data[t++]=e[n+3])}return r}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let r=Image.createFrom(this,{colorModel:HSL}),t=Math.floor(this.maxValue/2),e=0,n=this.data;for(let s=0;s<n.length;s+=this.channels){let a=n[s],o=n[s+1],l=n[s+2],c=Math.max(a,o,l),h=Math.min(a,o,l),f=0,u=0,d=(c+h)/2;if(c!==h){let g=c-h;switch(u=d>t?g/(2-c-h):g/(c+h),c){case a:f=(o-l)/g+(o<l?6:0);break;case o:f=(l-a)/g+2;break;case l:f=(a-o)/g+4;break;default:throw new Error("unreachable")}f/=6}r.data[e++]=f*this.maxValue,r.data[e++]=u*this.maxValue,r.data[e++]=d,this.alpha&&(r.data[e++]=n[s+3])}return r}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let r=Image.createFrom(this,{components:4,colorModel:CMYK$1}),t=0,e=this.data;for(let n=0;n<e.length;n+=this.channels){let s=e[n],a=e[n+1],o=e[n+2],l=Math.min(this.maxValue-s,this.maxValue-a,this.maxValue-o),c=(this.maxValue-s-l)/(1-l/this.maxValue),h=(this.maxValue-a-l)/(1-l/this.maxValue),f=(this.maxValue-o-l)/(1-l/this.maxValue);r.data[t++]=Math.round(c),r.data[t++]=Math.round(h),r.data[t++]=Math.round(f),r.data[t++]=Math.round(l),this.alpha&&(r.data[t++]=e[n+3])}return r}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(r,t,e){return r*6966+t*23436+e*2366>>15},luma601(r,t,e){return r*9798+t*19235+e*3735>>15},maximum(r,t,e){return Math.max(r,t,e)},minimum(r,t,e){return Math.min(r,t,e)},average(r,t,e){return(r+t+e)/3>>0},minmax(r,t,e){return(Math.max(r,t,e)+Math.min(r,t,e))/2},red(r){return r},green(r,t){return t},blue(r,t,e){return e},cyan(r,t,e,n){let s=methods$1.black(r,t,e,n);return(n.maxValue-r-s)/(1-s/n.maxValue)>>0},magenta(r,t,e,n){let s=methods$1.black(r,t,e,n);return(n.maxValue-t-s)/(1-s/n.maxValue)>>0},yellow(r,t,e,n){let s=methods$1.black(r,t,e,n);return(n.maxValue-e-s)/(1-s/n.maxValue)>>0},black(r,t,e,n){return Math.min(n.maxValue-r,n.maxValue-t,n.maxValue-e)},hue(r,t,e,n){let s=methods$1.min(r,t,e),a=methods$1.max(r,t,e);if(a===s)return 0;let o=0,l=a-s;switch(a){case r:o=(t-e)/l+(t<e?6:0);break;case t:o=(e-r)/l+2;break;case e:o=(r-t)/l+4;break;default:throw new Error("unreachable")}return o/6*n.maxValue>>0},saturation(r,t,e,n){let s=methods$1.min(r,t,e),a=methods$1.max(r,t,e),o=a-s;return a===0?0:o/a*n.maxValue},lightness(r,t,e){let n=methods$1.min(r,t,e);return(methods$1.max(r,t,e)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(r=>{});function grey(r={}){let{algorithm:t="luma709",keepAlpha:e=!1,mergeAlpha:n=!0}=r;if(typeof t!="string"&&typeof t!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(t="red"),e&=this.alpha,n&=this.alpha,e&&(n=!1);let s=getOutputImage(this,r,{components:1,alpha:e,colorModel:GREY$1}),a;if(typeof t=="function")a=t;else if(a=methods$1[t.toLowerCase()],!a)throw new Error(`unsupported grey algorithm: ${t}`);let o=0;for(let l=0;l<this.data.length;l+=this.channels)n?s.data[o++]=clamp(a(this.data[l],this.data[l+1],this.data[l+2],this)*this.data[l+this.components]/this.maxValue,this):(s.data[o++]=clamp(a(this.data[l],this.data[l+1],this.data[l+2],this),this),s.alpha&&(s.data[o++]=this.data[l+this.components]));return s}function huang(r){let t=0;for(let f=0;f<r.length;f++)if(r[f]!==0){t=f;break}let e=r.length-1;for(let f=r.length-1;f>=t;f--)if(r[f]!==0){e=f;break}let n=1/(e-t),s=new Array(r.length),a=0,o=0;for(let f=t;f<r.length;f++)a+=f*r[f],o+=r[f],s[f]=a/o;let l=new Array(r.length);a=o=0;for(let f=e;f>0;f--)a+=f*r[f],o+=r[f],l[f-1]=a/o;let c=-1,h=Number.MAX_VALUE;for(let f=0;f<r.length;f++){let u=0,d;for(let g=0;g<=f;g++)d=1/(1+n*Math.abs(g-s[f])),d<1e-6||d>.999999||(u+=r[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));for(let g=f+1;g<r.length;g++)d=1/(1+n*Math.abs(g-l[f])),d<1e-6||d>.999999||(u+=r[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));u<h&&(h=u,c=f)}return c}function intermodes(r){let t=r.slice(),e=0;for(;!bimodalTest$1(t);){let s=0,a=0,o=t[0];for(let l=0;l<r.length-1;l++)s=a,a=o,o=t[l+1],t[l]=(s+a+o)/3;if(t[r.length-1]=(a+o)/3,e++,e>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let s=1;s<r.length-1;s++)t[s-1]<t[s]&&t[s+1]<t[s]&&(n+=s);return Math.floor(n/2)}function bimodalTest$1(r){let t=!1,e=0;for(let n=1;n<r.length-1;n++)if(r[n-1]<r[n]&&r[n+1]<r[n]&&(e++,e>2))return!1;return e===2&&(t=!0),t}function isodata(r){let t,e,n,s,a=0;for(let o=1;o<r.length;o++)if(r[o]>0){a=o+1;break}for(;;){t=0,n=0;for(let o=0;o<a;o++)n=n+r[o],t=t+r[o]*o;s=0,e=0;for(let o=a+1;o<r.length;o++)e+=r[o],s+=r[o]*o;if(n>0&&e>0&&(t/=n,s/=e,a===Math.round((t+s)/2)))break;if(a++,a>r.length-2)throw new Error("Threshold not found")}return a}function li(r,t){let e,n,s,a,o,l,c,h,f,u,d,g;d=.5,u=0;for(let p=0;p<r.length;p++)u+=p*r[p];u/=t,c=u;do{l=c,e=l+.5|0,n=0,a=0;for(let p=0;p<=e;p++)n+=p*r[p],a+=r[p];h=a===0?0:n/a,s=0,o=0;for(let p=e+1;p<r.length;p++)s+=p*r[p],o+=r[p];f=o===0?0:s/o,g=(h-f)/(Math.log(h)-Math.log(f)),g<-Number.EPSILON?c=g-.5|0:c=g+.5|0}while(Math.abs(c-l)>d);return e}function maxEntropy(r,t){let e=new Array(r.length);for(let d=0;d<r.length;d++)e[d]=r[d]/t;let n=new Array(r.length),s=new Array(r.length);n[0]=e[0],s[0]=1-n[0];for(let d=1;d<r.length;d++)n[d]=n[d-1]+e[d],s[d]=1-n[d];let a=0;for(let d=0;d<r.length;d++)if(Math.abs(n[d])>=Number.EPSILON){a=d;break}let o=r.length-1;for(let d=r.length-1;d>=a;d--)if(Math.abs(s[d])>=Number.EPSILON){o=d;break}let l=-1,c,h=Number.MIN_VALUE,f,u;for(let d=a;d<=o;d++){f=0;for(let g=0;g<=d;g++)r[g]!==0&&(f-=e[g]/n[d]*Math.log(e[g]/n[d]));u=0;for(let g=d+1;g<r.length;g++)r[g]!==0&&(u-=e[g]/s[d]*Math.log(e[g]/s[d]));c=f+u,h<c&&(h=c,l=d)}return l}function mean$1(r,t){let e=0;for(let n=0;n<r.length;n++)e+=n*r[n];return Math.floor(e/t)}function minError(r,t){let e,n=-2,s,a,o,l,c,h,f,u,d,g,p,x=0;for(let y=0;y<r.length;y++)x+=y*r[y];for(x/=t,e=x;e!==n;){let y=sumA(r,e),m=sumA(r,r.length-1),A=sumB(r,e),b=sumB(r,r.length-1),_=sumC(r,e),M=sumC(r,r.length-1);if(s=A/y,a=(b-A)/(m-y),o=y/m,l=(m-y)/m,c=_/y-s*s,h=(M-_)/(m-y)-a*a,f=1/c-1/h,u=s/c-a/h,d=s*s/c-a*a/h+Math.log10(c*(l*l)/(h*(o*o))),g=u*u-f*d,g<0)return e;n=e,p=(u+Math.sqrt(g))/f,isNaN(p)?e=n:e=Math.floor(p)}return e}function sumA(r,t){let e=0;for(let n=0;n<=t;n++)e+=r[n];return e}function sumB(r,t){let e=0;for(let n=0;n<=t;n++)e+=n*r[n];return e}function sumC(r,t){let e=0;for(let n=0;n<=t;n++)e+=n*n*r[n];return e}function minimum(r){if(r.length<2)return 0;let t=0,e=-1,n=-1,s=new Array(r.length);for(let a=0;a<r.length;a++)s[a]=r[a],r[a]>0&&(n=a);for(;!bimodalTest(s);)if(s=smoothed(s),t++,t>1e4)return e;return e=minimumBetweenPeeks(s,n),e}function smoothed(r){let t=new Array(r.length);for(let e=1;e<r.length-1;e++)t[e]=(r[e-1]+r[e]+r[e+1])/3;return t[0]=(r[0]+r[1])/3,t[r.length-1]=(r[r.length-2]+r[r.length-1])/3,t}function minimumBetweenPeeks(r,t){let e;for(let n=1;n<t;n++)if(r[n-1]>r[n]&&r[n+1]>=r[n]){e=n;break}return e}function bimodalTest(r){let t=r.length,e=!1,n=0;for(let s=1;s<t-1;s++)if(r[s-1]<r[s]&&r[s+1]<r[s]&&(n++,n>2))return!1;return n===2&&(e=!0),e}function moments(r,t){let e=1,n=0,s=0,a=0,o=0,l,c,h,f,u,d,g=-1,p=r.length,x=new Array(p);for(let y=0;y<p;y++)x[y]=r[y]/t;for(let y=0;y<p;y++)n+=y*x[y],s+=y*y*x[y],a+=y*y*y*x[y];c=e*s-n*n,h=(-s*s+n*a)/c,f=(e*-a+s*n)/c,u=.5*(-f-Math.sqrt(f*f-4*h)),d=.5*(-f+Math.sqrt(f*f-4*h)),l=(d-n)/(d-u);for(let y=0;y<p;y++)if(o+=x[y],o>l){g=y;break}return g}function otsu(r,t){let e=0,n=0,s=0,a=0,o=0;for(let l=0;l<r.length;l++)o+=l*r[l];for(let l=0;l<r.length;l++){n=n+r[l];const c=t-n;if(n===0||c===0)continue;e=e+l*r[l];const h=(o-e)/c,f=n*c*(e/n-h)*(e/n-h);f>=s&&(a=l,s=f)}return a}function percentile(r){let t=-1,e=.5,n=new Array(r.length),s=partialSum(r,r.length-1),a=1;for(let o=0;o<r.length;o++)n[o]=Math.abs(partialSum(r,o)/s-e),n[o]<a&&(a=n[o],t=o);return t}function partialSum(r,t){let e=0;for(let n=0;n<=t;n++)e+=r[n];return e}function renyiEntropy(r,t){let e,n,s,a=new Array(r.length),o=new Array(r.length),l=new Array(r.length),c=0,h=0,f=0,u=0,d=0,g=0,x=1/(1-.5),m=1/(1-2);for(let M=0;M<r.length;M++)a[M]=r[M]/t;o[0]=a[0],l[0]=1-o[0];for(let M=1;M<r.length;M++)o[M]=o[M-1]+a[M],l[M]=1-o[M];n=0;for(let M=0;M<r.length;M++)if(Math.abs(o[M])>=Number.EPSILON){n=M;break}s=r.length-1;for(let M=r.length-1;M>=n;M--)if(Math.abs(l[M])>=Number.EPSILON){s=M;break}for(let M=n;M<=s;M++){let T=0,D=0,E=0;for(let F=0;F<=M;F++)r[F]!==0&&(T-=a[F]/o[M]*Math.log(a[F]/o[M])),D+=Math.sqrt(a[F]/o[M]),E+=a[F]*a[F]/(o[M]*o[M]);let S=0,w=0,v=0;for(let F=M+1;F<r.length;F++)r[F]!==0&&(S-=a[F]/l[M]*Math.log(a[F]/l[M])),w+=Math.sqrt(a[F]/l[M]),v+=a[F]*a[F]/(l[M]*l[M]);let k=T+S,I=x*(D*w>0?Math.log(D*w):0),L=m*(E*v>0?Math.log(E*v):0);k>u&&(u=k,c=M),I>d&&(d=I,h=M),L>g&&(g=L,f=M)}let A=[c,h,f];A.sort((M,T)=>M-T);let b;Math.abs(A[0]-A[1])<=5?Math.abs(A[1]-A[2])<=5?b=[1,2,1]:b=[0,1,3]:Math.abs(A[1]-A[2])<=5?b=[3,1,0]:b=[1,2,1];let _=o[A[2]]-o[A[0]];return e=Math.round(A[0]*(o[A[0]]+.25*_*b[0])+.25*A[1]*_*b[1]+A[2]*(l[A[2]]+.25*_*b[2])),e}function shanbhag(r,t){let e=new Array(r.length);for(let g=0;g<r.length;g++)e[g]=r[g]/t;let n=new Array(r.length),s=new Array(r.length);n[0]=e[0],s[0]=1-n[0];for(let g=1;g<r.length;g++)n[g]=n[g-1]+e[g],s[g]=1-n[g];let a=0;for(let g=0;g<r.length;g++)if(Math.abs(n[g])>=Number.EPSILON){a=g;break}let o=r.length-1;for(let g=r.length-1;g>=a;g--)if(Math.abs(s[g])>=Number.EPSILON){o=g;break}let l=-1,c=Number.MAX_VALUE,h,f,u,d;for(let g=a;g<=o;g++){u=0,h=.5/n[g];for(let p=1;p<=g;p++)u-=e[p]*Math.log(1-h*n[p-1]);u*=h,d=0,h=.5/s[g];for(let p=g+1;p<r.length;p++)d-=e[p]*Math.log(1-h*s[p]);d*=h,f=Math.abs(u-d),f<c&&(c=f,l=g)}return l}function triangle$1(r){let t=0,e=0,n=0,s=0;for(let u=0;u<r.length;u++)if(r[u]>0){t=u;break}t>0&&t--;for(let u=r.length-1;u>0;u--)if(r[u]>0){s=u;break}s<r.length-1&&s++;for(let u=0;u<r.length;u++)r[u]>e&&(n=u,e=r[u]);let a=!1;if(n-t<s-n){a=!0;let u=0,d=r.length-1;for(;u<d;){let g=r[u];r[u]=r[d],r[d]=g,u++,d--}t=r.length-1-s,n=r.length-1-n}if(t===n)return t;let o,l,c;o=r[n],l=t-n,c=Math.sqrt(o*o+l*l),o/=c,l/=c,c=o*t+l*r[t];let h=t,f=0;for(let u=t+1;u<=n;u++){let d=o*u+l*r[u]-c;d>f&&(h=u,f=d)}if(h--,a){let u=0,d=r.length-1;for(;u<d;){let g=r[u];r[u]=r[d],r[d]=g,u++,d--}return r.length-1-h}else return h}function yen(r,t){let e=new Array(r.length);for(let h=0;h<r.length;h++)e[h]=r[h]/t;let n=new Array(r.length);n[0]=e[0];for(let h=1;h<r.length;h++)n[h]=n[h-1]+e[h];let s=new Array(r.length);s[0]=e[0]*e[0];for(let h=1;h<r.length;h++)s[h]=s[h-1]+e[h]*e[h];let a=new Array(r.length);a[r.length-1]=0;for(let h=r.length-2;h>=0;h--)a[h]=a[h+1]+e[h+1]*e[h+1];let o=-1,l=Number.MIN_VALUE,c;for(let h=0;h<r.length;h++)c=-1*(s[h]*a[h]>0?Math.log(s[h]*a[h]):0)+2*(n[h]*(1-n[h])>0?Math.log(n[h]*(1-n[h])):0),c>l&&(l=c,o=h);return o}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(r=>{names[r]=r});function getThreshold(r={}){let{algorithm:t=names.otsu}=r;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let e=methods[t.toLowerCase()];if(e){let n=this.getHistogram();return e(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${t}`)}const THRESHOLD="threshold";function mask(r={}){let{algorithm:t=THRESHOLD,threshold:e=.5,useAlpha:n=!0,invert:s=!1}=r;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),t===THRESHOLD?e=getThreshold$1(e,this.maxValue):e=getThreshold.call(this,r);let a=new Image(this.width,this.height,{kind:"BINARY",parent:this}),o=0;if(this.alpha&&n)for(let l=0;l<this.data.length;l+=this.channels){let c=this.data[l]+(this.maxValue-this.data[l])*(this.maxValue-this.data[l+1])/this.maxValue;(s&&c<=e||!s&&c>=e)&&a.setBit(o),o++}else for(let l=0;l<this.data.length;l+=this.channels)(s&&this.data[l]<=e||!s&&this.data[l]>=e)&&a.setBit(o),o++;return a}function copyImage(r,t,e,n){let s=r.width,a=r.height,o=t.width,l=r.channels;for(let c=0;c<s;c++)for(let h=0;h<a;h++)for(let f=0;f<l;f++){let u=(h*s+c)*l+f,d=((n+h)*o+e+c)*l+f;t.data[d]=r.data[u]}}function pad(r={}){let{size:t=0,algorithm:e="copy",color:n}=r;if(this.checkProcessable("pad",{bitDepth:[8,16]}),e==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let c=0;c<n.length;c++)n[c]===0&&(n[c]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let s=this.width+t[0]*2,a=this.height+t[1]*2,o=this.channels,l=Image.createFrom(this,{width:s,height:a});copyImage(this,l,t[0],t[1]);for(let c=t[0];c<s-t[0];c++)for(let h=0;h<o;h++){let f=n[h]||l.data[(t[1]*s+c)*o+h];for(let u=0;u<t[1];u++)l.data[(u*s+c)*o+h]=f;f=n[h]||l.data[((a-t[1]-1)*s+c)*o+h];for(let u=a-t[1];u<a;u++)l.data[(u*s+c)*o+h]=f}for(let c=0;c<a;c++)for(let h=0;h<o;h++){let f=n[h]||l.data[(c*s+t[0])*o+h];for(let u=0;u<t[0];u++)l.data[(c*s+u)*o+h]=f;f=n[h]||l.data[(c*s+s-t[0]-1)*o+h];for(let u=s-t[0];u<s;u++)l.data[(c*s+u)*o+h]=f}return l}function colorDepth(r=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(r))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===r)return this.clone();let t=Image.createFrom(this,{bitDepth:r});switch(r){case 8:if(this.bitDepth===1)for(let e=0;e<this.size;e++)this.getBit(e)&&(t.data[e]=255);else for(let e=0;e<this.data.length;e++)t.data[e]=this.data[e]>>8;break;case 16:if(this.bitDepth===1)for(let e=0;e<this.size;e++)this.getBit(e)&&(t.data[e]=65535);else for(let e=0;e<this.data.length;e++)t.data[e]=this.data[e]<<8|this.data[e];break;default:throw new Error("colorDepth conversion unexpected case")}return t}function rotateFree(r,t={}){const{interpolation:e=validInterpolations.nearestneighbor,width:n=this.width,height:s=this.height}=t;if(typeof r!="number")throw new TypeError("degrees must be a number");const a=checkInterpolation(e),o=r*Math.PI/180,l=Math.floor(Math.abs(n*Math.cos(o))+Math.abs(s*Math.sin(o))),c=Math.floor(Math.abs(s*Math.cos(o))+Math.abs(n*Math.sin(o))),h=Math.cos(-o),f=Math.sin(-o);let u=l/2,d=c/2;l%2===0?(u=u-.5,c%2===0?d=d-.5:d=Math.floor(d)):(u=Math.floor(u),c%2===0?d=d-.5:d=Math.floor(d));const g=Math.floor(n/2-u),p=Math.floor(s/2-d);if(this.bitDepth===1){const x=new Image(l,c,{kind:"BINARY",parent:this});switch(a){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,x,g,p,u,d,h,f);case validInterpolations.bilinear:return rotateBinaryBilinear(this,x,g,p,u,d,h,f);default:throw new Error(`unsupported rotate interpolation: ${a}`)}}else{const x=Image.createFrom(this,{width:l,height:c});switch(a){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,x,g,p,u,d,h,f);case validInterpolations.bilinear:return rotateBilinear(this,x,g,p,u,d,h,f);default:throw new Error(`unsupported rotate interpolation: ${a}`)}}}function rotateNearestNeighbor(r,t,e,n,s,a,o,l){for(let c=0;c<t.width;c+=1)for(let h=0;h<t.height;h+=1)for(let f=0;f<r.channels;f++){let u=Math.round((c-s)*o-(h-a)*l+s)+e,d=Math.round((h-a)*o+(c-s)*l+a)+n;u<0||u>=r.width||d<0||d>=r.height?r.alpha===1&&f===r.channels-1?t.setValueXY(c,h,f,0):t.setValueXY(c,h,f,r.maxValue):t.setValueXY(c,h,f,r.getValueXY(u,d,f))}return t}function rotateBinaryNearestNeighbor(r,t,e,n,s,a,o,l){for(let c=0;c<t.width;c+=1)for(let h=0;h<t.height;h+=1){let f=Math.round((c-s)*o-(h-a)*l+s)+e,u=Math.round((h-a)*o+(c-s)*l+a)+n;(f<0||f>=r.width||u<0||u>=r.height||r.getBitXY(f,u))&&t.setBitXY(c,h)}return t}function rotateBilinear(r,t,e,n,s,a,o,l){let c=r.width*r.channels;for(let h=0;h<t.height;h++)for(let f=0;f<t.width;f++){let u=(f-s)*o-(h-a)*l+s+e,d=(h-a)*o+(f-s)*l+a+n,g=u|0,p=d|0,x=u-g,y=d-p;for(let m=0;m<r.channels;m++)if(u<0||u>=r.width||d<0||d>=r.height)r.alpha===1&&m===r.channels-1?t.setValueXY(f,h,m,0):t.setValueXY(f,h,m,r.maxValue);else{let A=(p*r.width+g)*r.channels+m,b=r.data[A],_=r.data[A+r.channels],M=r.data[A+c],T=r.data[A+c+r.channels],D=b+x*(_-b)+y*(M-b)+x*y*(b-_-M+T)|0;t.setValueXY(f,h,m,D)}}return t}function rotateBinaryBilinear(r,t,e,n,s,a,o,l){let c=r.width;for(let h=0;h<t.height;h++)for(let f=0;f<t.width;f++){let u=(f-s)*o-(h-a)*l+s+e,d=(h-a)*o+(f-s)*l+a+n,g=u|0,p=d|0,x=u-g,y=d-p;if(u<0||u>=r.width||d<0||d>=r.height)t.setBitXY(f,h);else{let m=p*r.width+g,A=r.getBit(m),b=r.getBit(m+1),_=r.getBit(m+c),M=r.getBit(m+1+c);(A|x&b-A|y&_-A|x&y&A-b-_+M)>0&&t.setBitXY(f,h)}}return t}function rotate$1(r,t){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof r!="number")throw new TypeError("angle must be a number");switch(r<0&&(r=Math.ceil(-r/360)*360+r),r%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,r,t)}}function rotateLeft(){if(this.bitDepth===1){const r=new Image(this.height,this.width,{kind:"BINARY",parent:this}),t=r.height-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)this.getBitXY(n,e)&&r.setBitXY(e,t-n);return r}else{const r=Image.createFrom(this,{width:this.height,height:this.width}),t=r.height-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)for(let s=0;s<this.channels;s++)r.setValueXY(e,t-n,s,this.getValueXY(n,e,s));return r}}function rotateRight(){if(this.bitDepth===1){const r=new Image(this.height,this.width,{kind:"BINARY",parent:this}),t=r.width-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)this.getBitXY(n,e)&&r.setBitXY(t-e,n);return r}else{const r=Image.createFrom(this,{width:this.height,height:this.width}),t=r.width-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)for(let s=0;s<this.channels;s++)r.setValueXY(t-e,n,s,this.getValueXY(n,e,s));return r}}function rotate180(){if(this.bitDepth===1){const r=new Image(this.width,this.height,{kind:"BINARY",parent:this}),t=r.width-1,e=r.height-1;for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)this.getBitXY(s,n)&&r.setBitXY(t-s,e-n);return r}else{const r=Image.createFrom(this),t=r.width-1,e=r.height-1;for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)for(let a=0;a<this.channels;a++)r.setValueXY(t-s,e-n,a,this.getValueXY(s,n,a));return r}}function insert(r,t={}){const e=getImageParameters(r);this.checkProcessable("insert",e);let{x:n=0,y:s=0}=t;const a=getOutputImageOrInPlace(this,t,{copy:!0}),o=Math.min(a.height,s+r.height),l=Math.min(a.width,n+r.width);if(a.bitDepth===1)for(let c=s;c<o;c++)for(let h=n;h<l;h++)r.getBitXY(h-n,c-s)?a.setBitXY(h,c):a.clearBitXY(h,c);else for(let c=s;c<o;c++)for(let h=n;h<l;h++)a.setPixelXY(h,c,r.getPixelXY(h-n,c-s));return a}function setBorder(r={}){let{size:t=0,algorithm:e="copy",color:n}=r;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),e==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let l=0;l<n.length;l++)n[l]===0&&(n[l]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let s=t[0],a=t[1],o=this.channels;for(let l=s;l<this.width-s;l++)for(let c=0;c<o;c++){let h=n[c]||this.data[(l+this.width*a)*o+c];for(let f=0;f<a;f++)this.data[(f*this.width+l)*o+c]=h;h=n[c]||this.data[(l+this.width*(this.height-a-1))*o+c];for(let f=this.height-a;f<this.height;f++)this.data[(f*this.width+l)*o+c]=h}for(let l=0;l<this.height;l++)for(let c=0;c<o;c++){let h=n[c]||this.data[(l*this.width+s)*o+c];for(let f=0;f<s;f++)this.data[(l*this.width+f)*o+c]=h;h=n[c]||this.data[(l*this.width+this.width-s-1)*o+c];for(let f=this.width-s;f<this.width;f++)this.data[(l*this.width+f)*o+c]=h}return this}function split(r={}){let{preserveAlpha:t=!0}=r;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let e=new Stack,n=this.data;if(this.alpha&&t)for(let s=0;s<this.components;s++){let a=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)a.data[o++]=n[l+s],a.data[o++]=n[l+this.components];e.push(a)}else for(let s=0;s<this.channels;s++){let a=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)a.data[o++]=n[l+s];e.push(a)}return e}function getChannel(r,t={}){let{keepAlpha:e=!1,mergeAlpha:n=!1}=t;e&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),r=validateChannel(this,r);let s=Image.createFrom(this,{components:1,alpha:e,colorModel:GREY$1}),a=0;for(let o=0;o<this.data.length;o+=this.channels)n?s.data[a++]=this.data[o+r]*this.data[o+this.components]/this.maxValue:(s.data[a++]=this.data[o+r],e&&(s.data[a++]=this.data[o+this.components]));return s}function combineChannels(r=defaultCombineMethod,t={}){let{mergeAlpha:e=!1,keepAlpha:n=!1}=t;e&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let s=Image.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),a=0;for(let o=0;o<this.size;o++){let l=r(this.getPixel(o));e?s.data[a++]=l*this.data[o*this.channels+this.components]/this.maxValue:(s.data[a++]=l,n&&(s.data[a++]=this.data[o*this.channels+this.components]))}return s}function defaultCombineMethod(r){return(r[0]+r[1]+r[2])/3}function setChannel(r,t){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),t.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error("Images must have exactly the same width and height");r=validateChannel(this,r);let e=r;for(let n=0;n<t.data.length;n++)this.data[e]=t.data[n],e+=this.channels;return this}function getSimilarity(r,t={}){let{shift:e=[0,0],average:n,channels:s,defaultAlpha:a,normalize:o,border:l=[0,0]}=t;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(l)||(l=[l,l]),s=validateArrayOfChannels(this,{channels:s,defaultAlpha:a}),this.bitDepth!==r.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==r.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==r.colorModel)throw new Error("Both images must have the same colorModel");typeof n>"u"&&(n=!0);let c=Math.max(l[0],-e[0]),h=Math.min(this.width-l[0],this.width-e[0]),f=Math.max(l[1],-e[1]),u=Math.min(this.height-l[1],this.height-e[1]),d=newArray$1(s.length,0);for(let g=0;g<s.length;g++){let p=s[g],x=o?this.sum[p]:Math.max(this.sum[p],r.sum[p]),y=o?r.sum[p]:Math.max(this.sum[p],r.sum[p]);if(x!==0&&y!==0)for(let m=c;m<h;m++)for(let A=f;A<u;A++){let b=m*this.multiplierX+A*this.multiplierY+p,_=b+e[0]*this.multiplierX+e[1]*this.multiplierY;d[g]+=Math.min(this.data[b]/x,r.data[_]/y)}}return n?d.reduce((g,p)=>g+p)/d.length:d}function getPixelsGrid(r={}){let{sampling:t=[10,10],painted:e=!1,mask:n}=r;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(t)||(t=[t,t]);const s=t[0],a=t[1],o=[],l=[],c=this.width/s,h=this.height/a;let f=Math.floor(c/2);for(let d=0;d<s;d++){let g=Math.floor(h/2);for(let p=0;p<a;p++){let x=Math.round(f),y=Math.round(g);(!n||n.getBitXY(x,y))&&(o.push([x,y]),l.push(this.getPixelXY(x,y))),g+=h}f+=c}const u={xyS:o,zS:l};return e&&(u.painted=this.rgba8().paintPoints(o)),u}function Matrix(r,t,e){const n=new Array(r);for(let s=0;s<r;s++)n[s]=new Array(t);if(e)for(let s=0;s<r;s++)for(let a=0;a<t;a++)n[s][a]=e;return n.width=r,n.height=t,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(r,t){let e=this[r][t],n=[r,t];for(let s=Math.max(0,r-1);s<Math.min(this.length,r+2);s++)for(let a=Math.max(0,t-1);a<Math.min(this[0].length,t+2);a++)this[s][a]<e&&(e=this[s][a],n=[s,a]);return{position:n,value:e}};Matrix.prototype.localMax=function(r,t){let e=this[r][t],n=[r,t];for(let s=Math.max(0,r-1);s<Math.min(this.length,r+2);s++)for(let a=Math.max(0,t-1);a<Math.min(this[0].length,t+2);a++)this[s][a]>e&&(e=this[s][a],n=[s,a]);return{position:n,value:e}};Matrix.prototype.localSearch=function(r,t,e){let n=[];for(let s=Math.max(0,r-1);s<Math.min(this.length,r+2);s++)for(let a=Math.max(0,t-1);a<Math.min(this[0].length,t+2);a++)this[s][a]===e&&n.push([s,a]);return n};function getBestMatch(r,t={}){let{border:e}=t;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==r.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==r.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==r.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(r.width,r.height,-1/0),s=Math.floor(r.width/2),a=Math.floor(r.height/2),o=s,l=a,c=!1;for(;!c;){let h=n.localSearch(s,a,-1/0);for(let u=0;u<h.length;u++){let d=h[u],g=this.getSimilarity(r,{border:e,shift:[o-d[0],l-d[1]]});n[d[0]][d[1]]=g}let f=n.localMax(s,a);f.position[0]!==s||f.position[1]!==a?(s=f.position[0],a=f.position[1]):c=!0}return[s-o,a-l]}function getRow(r,t=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,r),checkChannel(this,t);let e=new Array(this.width),n=0,s=r*this.width*this.channels+t,a=s+this.width*this.channels;for(let o=s;o<a;o+=this.channels)e[n++]=this.data[o];return e}function getColumn(r,t=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,r),checkChannel(this,t);let e=new Array(this.height),n=0,s=this.width*this.channels;for(let a=t+r*this.channels;a<this.data.length;a+=s)e[n++]=this.data[a];return e}function getMatrix(r={}){let{channel:t}=r;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}let e=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)e.set(n,s,this.getValueXY(s,n,t));return e}function setMatrix(r,t={}){r=new Matrix$2(r);let{channel:e}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}if(this.width!==r.columns||this.height!==r.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)this.setValueXY(s,n,e,r.get(n,s));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let r=new Array(this.size),t=0;for(let e=0;e<this.data.length;e+=this.channels){let n=new Array(this.components);for(let s=0;s<this.components;s++)n[s]=this.data[e+s];r[t++]=n}return r}function getIntersection(r){let t=this,e=t.getClosestCommonParent(r),n=t.getRelativePosition(e,{defaultFurther:!0}),s=getRelativePositionForAllPixels(t,n),a=r.getRelativePosition(e,{defaultFurther:!0}),o=getRelativePositionForAllPixels(r,a),l=getCommonSurface(s,o),c={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let h=0;h<l.length;h++){let f=l[h],u=[f[0]-n[0],f[1]-n[1]],d=[f[0]-a[0],f[1]-a[1]],g=t.getBitXY(u[0],u[1]),p=r.getBitXY(d[0],d[1]);g===1&&p===1&&c.commonWhitePixels.push(f)}for(let h=0;h<s.length;h++){let f,u;h!==0&&(f=Math.floor(h/t.width),u=h%t.width),t.getBitXY(f,u)===1&&c.whitePixelsMask1.push(s[h])}for(let h=0;h<o.length;h++){let f=0,u=0;h!==0&&(f=Math.floor(h/r.width),u=h%r.width),r.getBitXY(f,u)===1&&c.whitePixelsMask2.push(o[h])}return c}function getRelativePositionForAllPixels(r,t){let e=[];for(let n=0;n<r.height;n++)for(let s=0;s<r.width;s++){let a=[n,s];e.push([a[0]+t[0],a[1]+t[1]])}return e}function getCommonSurface(r,t){let e=0,n=0,s=[];for(;e<r.length&&n<t.length;)r[e][0]===t[n][0]&&r[e][1]===t[n][1]?(s.push(r[e]),e++,n++):r[e][0]<t[n][0]||r[e][0]===t[n][0]&&r[e][1]<t[n][1]?e++:n++;return s}function getClosestCommonParent(r){let t=getDepth(this),e=getDepth(r),n;if(t>=e?n=getFurthestParent(this,t):n=getFurthestParent(r,e),t===0||e===0)return n;let s=this,a=r;for(;t!==e;)if(t>e){if(s=s.parent,s===null)return n;t=t-1}else{if(a=a.parent,a===null)return n;e=e-1}for(;s!==a&&s!==null&&a!==null;)if(s=s.parent,a=a.parent,s===null||a===null)return n;return s!==a?n:s}function getDepth(r){let t=0,e=r;for(;e.parent!=null;)e=e.parent,t++;return t}function getFurthestParent(r,t){let e=r;for(;t>0;)e=e.parent,t=t-1;return e}const defaultOptions$5={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(r,t){r.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),t=Object.assign({},defaultOptions$5,t);const e=r.width,n=r.height,s=r.maxValue,a={sigma:t.gaussianBlur,radius:3},o=r.gaussianFilter(a),l=o.convolution(Gy,convOptions),c=o.convolution(Gx,convOptions),h=c.hypotenuse(l),f=r.constructor,u=new f(e,n,{kind:"GREY",bitDepth:32}),d=new f(e,n,{kind:"GREY",bitDepth:32}),g=new f(e,n,{kind:"GREY"});for(var p=1;p<e-1;p++)for(var x=1;x<n-1;x++){var y=(Math.round(Math.atan2(c.getValueXY(p,x,0),l.getValueXY(p,x,0))*(5/Math.PI))+5)%5;y===0&&(h.getValueXY(p,x,0)<=h.getValueXY(p,x-1,0)||h.getValueXY(p,x,0)<=h.getValueXY(p,x+1,0))||y===1&&(h.getValueXY(p,x,0)<=h.getValueXY(p-1,x+1,0)||h.getValueXY(p,x,0)<=h.getValueXY(p+1,x-1,0))||y===2&&(h.getValueXY(p,x,0)<=h.getValueXY(p-1,x,0)||h.getValueXY(p,x,0)<=h.getValueXY(p+1,x,0))||y===3&&(h.getValueXY(p,x,0)<=h.getValueXY(p-1,x-1,0)||h.getValueXY(p,x,0)<=h.getValueXY(p+1,x+1,0))||u.setValueXY(p,x,0,h.getValueXY(p,x,0))}for(p=0;p<e*n;++p){var m=u.data[p],A=0;m>t.highThreshold&&(A++,g.data[p]=s),m>t.lowThreshold&&A++,d.data[p]=A}var b=[];for(p=1;p<e-1;++p)for(x=1;x<n-1;++x)if(d.getValueXY(p,x,0)===1){e:for(var _=p-1;_<p+2;++_)for(var M=x-1;M<x+2;++M)if(d.getValueXY(_,M,0)===2){b.push([p,x]),g.setValueXY(p,x,0,s);break e}}for(;b.length>0;){var T=[];for(p=0;p<b.length;++p)for(x=-1;x<2;++x)for(_=-1;_<2;++_)if(!(x===0&&_===0)){var D=b[p][0]+x,E=b[p][1]+_;d.getValueXY(D,E,0)===1&&g.getValueXY(D,E,0)===0&&(T.push([D,E]),g.setValueXY(D,E,0,s))}b=T}return g}function cannyEdge(r){return cannyEdgeDetector(this,r)}function extract(r,t={}){let{position:e}=t;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!e&&(e=r.getRelativePosition(this),!e))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image.createFrom(this,{width:r.width,height:r.height,alpha:1,position:e,parent:this});for(let s=0;s<r.width;s++)for(let a=0;a<r.height;a++){for(let o=0;o<this.channels;o++){let l=this.getValueXY(s+e[0],a+e[1],o);n.setValueXY(s,a,o,l)}r.getBitXY(s,a)||n.setValueXY(s,a,this.components,0)}return n}else{let n=Image.createFrom(this,{width:r.width,height:r.height,position:e,parent:this});for(let s=0;s<r.height;s++)for(let a=0;a<r.width;a++)r.getBitXY(a,s)&&this.getBitXY(a+e[0],s+e[1])&&n.setBitXY(a,s);return n}}var fastList={exports:{}};(function(r,t){(function(){function e(s,a,o){this.next=o,o&&(o.prev=this),this.prev=a,a&&(a.next=this),this.data=s}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(s){this._tail=new e(s,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var s=this._tail;return this._tail=s.prev,s.prev&&(s.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),s.data}},unshift:function(s){this._head=new e(s,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var s=this._head;return this._head=s.next,s.next&&(s.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),s.data}},item:function(s){s<0&&(s=this.length+s);for(var a=this._head;s-- >0&&a;)a=a.next;return a?a.data:void 0},slice:function(s,a){if(s||(s=0),a||(a=this.length),a<0&&(a=this.length+a),s<0&&(s=this.length+s),a===s)return[];if(a<s)throw new Error("invalid offset: "+s+","+a+" (length="+this.length+")");for(var o=a-s,l=new Array(o),c=0,h=this._head;s-- >0&&h;)h=h.next;for(;c<o&&h;)l[c++]=h.data,h=h.next;return l},drop:function(){n.call(this)},forEach:function(s,a){for(var o=this._head,l=0,c=this.length;l<c&&o;)s.call(a||this,o.data,l,this),o=o.next,l++},map:function(s,a){var o=new n;return this.forEach(function(l,c,h){o.push(s.call(a||h,l,c,h))}),o},filter:function(s,a){var o=new n;return this.forEach(function(l,c,h){s.call(a||h,l,c,h)&&o.push(l)}),o},reduce:function(s,a,o){var l=0,c=this._head,h=this.length;for(a||(l=1,a=c&&c.data,c=c&&c.next);l<h&&c;)a=s.call(o||this,a,c.data,this),l++,c=c.next;return a}},r.exports=n})()})(fastList);var fastListExports=fastList.exports;const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(r={}){const{x:t=0,y:e=0,inPlace:n=!0}=r,s=n?this:Image.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(t,e))return s;const o=new LinkedList;for(o.push(new Node(t,e));o.length>0;){const l=o.shift();s.setBitXY(l.x,l.y);for(let c=l.x+1;c<this.width&&(!s.getBitXY(c,l.y)&&!this.getBitXY(c,l.y));c++)s.setBitXY(c,l.y),l.y+1<this.height&&!this.getBitXY(c,l.y+1)&&o.push(new Node(c,l.y+1)),l.y-1>=0&&!this.getBitXY(c,l.y-1)&&o.push(new Node(c,l.y-1));for(let c=l.x-1;c>=0&&(!s.getBitXY(c,l.y)&&!this.getBitXY(c,l.y));c++)s.setBitXY(c,l.y),l.y+1<this.height&&!this.getBitXY(c,l.y+1)&&o.push(new Node(c,l.y+1)),l.y-1>=0&&!this.getBitXY(c,l.y-1)&&o.push(new Node(c,l.y-1))}return s}function Node(r,t){this.x=r,this.y=t}function _extends(){return _extends=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r},_extends.apply(this,arguments)}function hsv2rgb(r,t,e){t=t/100,e=e/100;var n=[],s=e*t,a=r/60,o=s*(1-Math.abs(a%2-1)),l=e-s;return a>=0&&a<1?n=[s,o,0]:a>=1&&a<2?n=[o,s,0]:a>=2&&a<3?n=[0,s,o]:r>=3&&a<4?n=[0,o,s]:r>=4&&a<5?n=[o,0,s]:r>=5&&a<=6?n=[s,0,o]:n=[0,0,0],{r:Math.round(255*(n[0]+l)),g:Math.round(255*(n[1]+l)),b:Math.round(255*(n[2]+l))}}function hsl2hsv(r,t,e){return t*=(e<50?e:100-e)/100,{h:r,s:2*t/(e+t)*100,v:e+t}}function hsl2rgb$1(r,t,e){var n=hsl2hsv(r,t,e);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(r){return named(r)||hex3(r)||hex6(r)||rgb(r)||rgba$1(r)||hsl(r)||hsla(r)}function named(r){var t=colors[r.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:100}}function rgb(r){var t=r.match(/rgb\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:100}}}function rgba$1(r){var t=r.match(/rgba\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:e[3]*100}}}function hex6(r){if(r[0]==="#"&&r.length===7)return{r:parseInt(r.slice(1,3),16),g:parseInt(r.slice(3,5),16),b:parseInt(r.slice(5,7),16),a:100}}function hex3(r){if(r[0]==="#"&&r.length===4)return{r:parseInt(r[1]+r[1],16),g:parseInt(r[2]+r[2],16),b:parseInt(r[3]+r[3],16),a:100}}function hsl(r){var t=r.match(/hsl\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */),n=parseInt(e[0],10),s=parseInt(e[1],10),a=parseInt(e[2],10),o=hsl2rgb$1(n,s,a);return _extends({},o,{a:100})}}function hsla(r){var t=r.match(/hsla\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */),n=parseInt(e[0],10),s=parseInt(e[1],10),a=parseInt(e[2],10),o=parseInt(parseFloat(e[3])*100,10),l=hsl2rgb$1(n,s,a);return _extends({},l,{a:o})}}function css2array(r){let t=parse(r);return[t.r,t.g,t.b,Math.round(t.a*255/100)]}function hue2rgb(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*(2/3-e)*6:r}function hsl2rgb(r,t,e){let n,s,a,o,l,c;return t/=100,e/=100,t===0?o=l=c=e*255:(e<=.5?s=e*(t+1):s=e+t-e*t,n=e*2-s,a=r/360,o=hue2rgb(n,s,a+1/3),l=hue2rgb(n,s,a),c=hue2rgb(n,s,a-1/3)),{r:o,g:l,b:c}}function getDistinctColors(r){let t=new Array(r),e=0;for(let n=0;n<360;n+=360/r){e++;let s=hsl2rgb(n,100,30+e%4*15);t[e-1]=[Math.round(s.r*255),Math.round(s.g*255),Math.round(s.b*255)]}return t}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(r){let{color:t,colors:e,randomColors:n,numberColors:s=50}=r;if(t&&!Array.isArray(t)&&(t=css2array(t)),t)return[t];if(e)return e=e.map(function(a){return Array.isArray(a)?a:css2array(a)}),e;if(n){e=new Array(s);for(let a=0;a<s;a++)e[a]=getRandomColor()}return getDistinctColors(s)}function paintLabels(r,t,e={}){let{color:n="blue",colors:s,font:a="12px Helvetica",rotate:o=0}=e;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(r))throw Error("paintLabels: labels must be an array");if(!Array.isArray(t))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),s?s=s.map(function(h){return Array.isArray(h)?h:css2array(h)}):s=[n],r.length!==t.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(a)||(a=[a]),Array.isArray(o)||(o=[o]);let c=this.getCanvas().getContext("2d");for(let h=0;h<r.length;h++){c.save();let f=s[h%s.length];c.fillStyle=`rgba(${f[0]},${f[1]},${f[2]},${f[3]/this.maxValue})`,c.font=a[h%a.length];let u=t[h];c.translate(u[0],u[1]),c.rotate(o[h%o.length]/180*Math.PI),c.fillText(r[h],0,0),c.restore()}return this.data=Uint8Array.from(c.getImageData(0,0,this.width,this.height).data),this}function paintMasks(r,t={}){let{alpha:e=255,labels:n=[],labelsPosition:s=[],labelColor:a="blue",labelFont:o="12px Helvetica"}=t;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let l=getColors(Object.assign({},t,{numberColors:r.length}));Array.isArray(r)||(r=[r]);for(let c=0;c<r.length;c++){let h=r[c],f=l[c%l.length];for(let u=0;u<h.width;u++)for(let d=0;d<h.height;d++)if(h.getBitXY(u,d))for(let g=0;g<Math.min(this.components,f.length);g++)if(e===255)this.setValueXY(u+h.position[0],d+h.position[1],g,f[g]);else{let p=this.getValueXY(u+h.position[0],d+h.position[1],g);p=Math.round((p*(255-e)+f[g]*e)/255),this.setValueXY(u+h.position[0],d+h.position[1],g,p)}}if(Array.isArray(n)&&n.length>0){let h=this.getCanvas().getContext("2d");h.fillStyle=a,h.font=o;for(let f=0;f<Math.min(r.length,n.length);f++){let u=s[f]?s[f]:r[f].position;h.fillText(n[f],u[0],u[1])}this.data=Uint8Array.from(h.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(r,t){let e=new Array(r);for(let n=0;n<r;n++)e[n]=new Array(t).fill(0);return e}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:e="cross",shape:n,size:s,width:a,height:o,filled:l=!0}=t;if(s&&(a=s,o=s),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(a,o,{filled:l});break;case"circle":case"ellipse":this.matrix=ellipse(a,o,{filled:l});break;case"triangle":this.matrix=triangle(a,o,{filled:l});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(e)switch(e.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${e}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,e=[];for(let n=0;n<t.length;n++)for(let s=0;s<t[0].length;s++)t[n][s]&&e.push([s-this.halfWidth,n-this.halfHeight]);return e}getMask(){let t=new Image(this.width,this.height,{kind:BINARY});for(let e=0;e<this.matrix.length;e++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[e][n]&&t.setBitXY(n,e);return t}}function rectangle(r,t,e){const n=zerosMatrix(t,r);if(e.filled)for(let s=0;s<t;s++)for(let a=0;a<r;a++)n[s][a]=1;else{for(let s of[0,t-1])for(let a=0;a<r;a++)n[s][a]=1;for(let s=0;s<t;s++)for(let a of[0,r-1])n[s][a]=1}return n}function ellipse(r,t,e){const n=zerosMatrix(t,r);let s=1-t%2,a=1-r%2,o=Math.floor((r-1)/2),l=Math.floor((t-1)/2),c=o*o,h=l*l;if(e.filled)for(let f=0;f<=l;f++){let u=Math.floor(Math.sqrt(c-c*f*f/h));for(let d=o-u;d<=o;d++)n[l-f][d]=1,n[l+f+s][d]=1,n[l-f][r-d-1]=1,n[l+f+s][r-d-1]=1}else{for(let f=0;f<=l;f++){let u=Math.floor(Math.sqrt(c-c*f*f/h)),d=o-u;n[l-f][d]=1,n[l+f+s][d]=1,n[l-f][r-d-1]=1,n[l+f+s][r-d-1]=1}for(let f=0;f<=o;f++){let u=Math.floor(Math.sqrt(h-h*f*f/c)),d=l-u;n[d][o-f]=1,n[d][o+f+a]=1,n[t-d-1][o-f]=1,n[t-d-1][o+f+a]=1}}return n}function triangle(r,t,e){if(!e.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(t,r);for(let s=0;s<t;s++){let a=Math.floor((1-s/t)*r/2);for(let o=a;o<r-a;o++)n[s][o]=1}return n}function paintPoints(r,t={}){let{shape:e}=t;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:r.length})),s=new Shape(e).getPoints(),a=Math.min(this.channels,n[0].length);for(let o=0;o<r.length;o++){let l=n[o%n.length],c=r[o][0],h=r[o][1];for(let f=0;f<s.length;f++){let u=s[f][0],d=s[f][1];if(c+u>=0&&h+d>=0&&c+u<this.width&&h+d<this.height){let g=(c+u+(h+d)*this.width)*this.channels;for(let p=0;p<a;p++)this.data[g+p]=l[p]}}}return this}function paintPolyline(r,t={}){let{color:e=[this.maxValue,0,0],closed:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let s=Math.min(this.channels,e.length);for(let a=0;a<r.length-1+n;a++){let o=r[a],l=r[(a+1)%r.length],c=l[0]-o[0],h=l[1]-o[1],f=Math.max(Math.abs(c),Math.abs(h)),u=c/f,d=h/f,g=o[0],p=o[1];for(let x=0;x<=f;x++){let y=Math.round(g),m=Math.round(p);if(y>=0&&m>=0&&y<this.width&&m<this.height)if(this.bitDepth===1)this.setBitXY(y,m);else{let A=(y+m*this.width)*this.channels;for(let b=0;b<s;b++)this.data[A+b]=e[b]}g=g+u,p=p+d}}return this}function paintPolylines(r,t={}){let e=Object.assign({},t);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:r.length}));for(let s=0;s<r.length;s++)e.color=n[s%n.length],this.paintPolyline(r[s],e);return this}function paintPolygon(r,t={}){let{color:e=[this.maxValue,0,0],filled:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),t.closed=!0;let s=deleteDouble(r);if(n===!1)return this.paintPolyline(r,t);{let a=Array(this.height);for(let o=0;o<this.height;o++){a[o]=[];for(let l=0;l<this.width;l++)a[o].push(0)}for(let o=0;o<s.length;o++){const l=lineBetweenTwoPoints(s[o],s[(o+1)%s.length]);for(let c=0;c<this.height;c++)for(let h=0;h<this.width;h++)isAtTheRightOfTheLine(h,c,l,this.height)&&(a[c][h]=a[c][h]===0?1:0)}for(let o=0;o<this.height;o++)for(let l=0;l<this.width;l++)if(a[o][l]===1)if(this.bitDepth===1)this.setBitXY(l,o);else{let c=Math.min(this.channels,e.length),h=(l+o*this.width)*this.channels;for(let f=0;f<c;f++)this.data[h+f]=e[f]}return this.paintPolyline(r,t)}}function deleteDouble(r){let t=[];for(let e=0;e<r.length;e++)if(!(r[e][0]===r[(e+1)%r.length][0]&&r[e][1]===r[(e+1)%r.length][1])){if(r[e][0]===r[(e-1+r.length)%r.length][0]&&r[e][1]===r[(e-1+r.length)%r.length][1])continue;if(r[(e+1)%r.length][0]===r[(e-1+r.length)%r.length][0]&&r[(e-1+r.length)%r.length][1]===r[(e+1)%r.length][1])continue;t.push(r[e])}return t}function lineBetweenTwoPoints(r,t){if(r[0]===t[0])return{a:0,b:r[0],vertical:!0};{const e=(t[1]-r[1])/(t[0]-r[0]),n=r[1]-e*r[0];return{a:e,b:n,vertical:!1}}}function isAtTheRightOfTheLine(r,t,e,n){if(e.vertical===!0)return e.b<=r;if(e.a===0)return!1;{const s=(t-e.b)/e.a;return s<r&&s>=0&&s<=n}}function paintPolygons(r,t={}){let e=Object.assign({},t);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:r.length}));for(let s=0;s<r.length;s++)e.color=n[s%n.length],this.paintPolygon(r[s],e);return this}function getHistogram(r={}){let{maxSlots:t=256,channel:e,useAlpha:n=!0}=r;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}return getChannelHistogram.call(this,e,{useAlpha:n,maxSlots:t})}function getHistograms(r={}){const{maxSlots:t=256,useAlpha:e=!0}=r;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(e?this.components:this.channels);for(let s=0;s<n.length;s++)n[s]=getChannelHistogram.call(this,s,{useAlpha:e,maxSlots:t});return n}function getChannelHistogram(r,t){let{useAlpha:e,maxSlots:n}=t;if(this.bitDepth===1){let c=[0,0];for(let h=0;h<this.height;h++)for(let f=0;f<this.width;f++){let u=this.getBitXY(h,f);u===0?c[0]+=1:u===1&&(c[1]+=1)}return c}let s=Math.log2(n);if(!isInteger$1(s))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let a=0;this.bitDepth>s&&(a=this.bitDepth-s);let o=this.data,l=newArray$1(Math.pow(2,Math.min(this.bitDepth,s)),0);if(e&&this.alpha){let c=this.channels-r-1;for(let h=r;h<o.length;h+=this.channels)l[o[h]>>a]+=o[h+c]/this.maxValue}else for(let c=r;c<o.length;c+=this.channels)l[o[c]>>a]++;return l}function getColorHistogram(r={}){let{useAlpha:t=!0,nbSlots:e=512}=r;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(e)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let s=this.bitDepth-n,a=this.data,o=newArray$1(Math.pow(8,n),0),l=Math.pow(2,n*2),c=Math.pow(2,n);for(let h=0;h<a.length;h+=this.channels){let f=(a[h]>>s)*l+(a[h+1]>>s)*c+(a[h+2]>>s);t&&this.alpha?o[f]+=a[h+this.channels-1]/this.maxValue:o[f]++}return o}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let r=newArray$1(this.channels,1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let e=0;e<this.channels;e++)this.data[t+e]<r[e]&&(r[e]=this.data[t+e]);return r}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let r=newArray$1(this.channels,-1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let e=0;e<this.channels;e++)this.data[t+e]>r[e]&&(r[e]=this.data[t+e]);return r}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let r=newArray$1(this.channels,0);for(let t=0;t<this.data.length;t+=this.channels)for(let e=0;e<this.channels;e++)r[e]+=this.data[t+e];return r}function getMoment(r=0,t=0){this.checkProcessable("getMoment",{bitDepth:[1]});let e=0;for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)this.getBitXY(n,s)===1&&(e+=n**r*s**t);return e}function localMaxima(r={}){let{mask:t,region:e=3,removeClosePoints:n=0,invert:s=!1,maxEquals:a=2}=r,o=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),e*=4;let l=s?0:1,c=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],h=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],f=e<=8?1:2,u=[];for(let d=f;d<o.height-f;d++)for(let g=f;g<o.width-f;g++){if(t&&t.getBitXY(g,d)!==l)continue;let p=0,x=0,y=o.data[g+d*o.width];for(let m=0;m<e;m++)s?o.data[g+c[m]+(d+h[m])*o.width]>y&&p++:o.data[g+c[m]+(d+h[m])*o.width]<y&&p++,o.data[g+c[m]+(d+h[m])*o.width]===y&&x++;p+x===e&&x<=a&&u.push([g,d])}if(n>0)for(let d=0;d<u.length;d++)for(let g=d+1;g<u.length;g++)Math.sqrt(Math.pow(u[d][0]-u[g][0],2)+Math.pow(u[d][1]-u[g][1],2))<n&&(u[d][0]=u[d][0]+u[g][0]>>1,u[d][1]=u[d][1]+u[g][1]>>1,u.splice(g,1),g--);return u}function mean(){let r=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(r.length);for(let e=0;e<r.length;e++){let n=r[e];t[e]=mean$2(n)}return t}function median(){let r=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(r.length);for(let e=0;e<r.length;e++){let n=r[e];t[e]=median$2(n)}return t}function points(){this.checkProcessable("points",{bitDepth:[1]});const r=[];for(let t=0;t<this.width;t++)for(let e=0;e<this.height;e++)this.getBitXY(t,e)===1&&r.push([t,e]);return r}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const r=[];for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)if(this.getBitXY(e,t)===1)for(r.push([e,t]),this.getBitXY(e+1,t)!==1?(r.push([e+1,t]),r.push([e+1,t+1]),this.getBitXY(e,t+1)!==1&&r.push([e,t+1])):this.getBitXY(e,t+1)!==1&&(r.push([e,t+1]),r.push([e+1,t+1]));e<this.width-2&&this.getBitXY(e+1,t)===1&&this.getBitXY(e+2,t)===1;)e++;return r}function getRelativePosition(r,t={}){if(this===r)return[0,0];let e=[0,0],n=this;for(;n;){if(n===r)return e;n.position&&(e[0]+=n.position[0],e[1]+=n.position[1]),n=n.parent}return t.defaultFurther?e:!1}function countAlphaPixels(r={}){let{alpha:t=1}=r;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let e=0;if(t!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===t&&e++;return e}else return this.size}function monotoneChainConvexHull$1(r,t={}){const{sorted:e}=t;e||(r=r.slice().sort(byXThenY));const n=r.length,s=new Array(n*2);let a=0;for(let l=0;l<n;l++){const c=r[l];for(;a>=2&&cw(s[a-2],s[a-1],c)<=0;)a--;s[a++]=c}const o=a+1;for(let l=n-2;l>=0;l--){const c=r[l];for(;a>=o&&cw(s[a-2],s[a-1],c)<=0;)a--;s[a++]=c}return s.slice(0,a-1)}function cw(r,t,e){return(t[1]-r[1])*(e[0]-r[0])-(t[0]-r[0])*(e[1]-r[1])}function byXThenY(r,t){return r[0]===t[0]?r[1]-t[1]:r[0]-t[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(r){for(let t=0;t<r.length;t++)r[t][0]=Math.round(r[t][0]),r[t][1]=Math.round(r[t][1]);return r}function difference(r,t){return[r[0]-t[0],r[1]-t[1]]}function normalize(r){let t=Math.sqrt(r[0]**2+r[1]**2);return[r[0]/t,r[1]/t]}function rotate(r,t,e){e===void 0&&(e=new Array(t.length));let n=Math.cos(r),s=Math.sin(r);for(let a=0;a<e.length;++a)e[a]=[n*t[a][0]-s*t[a][1],s*t[a][0]+n*t[a][1]];return e}function perimeter(r){let t=0;for(let e=0;e<r.length;e++){let n=r[e][0],s=r[e][1],a=r[e===r.length-1?0:e+1][0],o=r[e===r.length-1?0:e+1][1];t+=Math.sqrt((a-n)**2+(o-s)**2)}return t}function surface(r){let t=0;for(let e=0;e<r.length;e++){let n=r[e][0],s=r[e===r.length-1?0:e+1][1],a=r[e===r.length-1?0:e+1][0],o=r[e][1];t+=n*s*.5,t-=a*o*.5}return Math.abs(t)}function minMax(r){let t=1/0,e=1/0,n=-1/0,s=-1/0;for(let a=0;a<r.length;a++)r[a][0]<t&&(t=r[a][0]),r[a][0]>n&&(n=r[a][0]),r[a][1]<e&&(e=r[a][1]),r[a][1]>s&&(s=r[a][1]);return[[t,e],[n,s]]}function moveToZeroZero(r,t){t===void 0&&(t=new Array(r.length).fill(0).map(()=>[]));let e=minMax(r),n=e[0][0],s=e[0][1];for(let a=0;a<r.length;a++)t[a][0]=r[a][0]-n,t[a][1]=r[a][1]-s;return t}function minimalBoundingRectangle(r={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=r;if(t.length===0)return[];if(t.length===1)return[t[0],t[0],t[0],t[0]];const e=new Array(t.length);let n=1/0,s=0,a;for(let o=0;o<e.length;o++){let l=getAngle$1(t[o],t[(o+1)%e.length]);rotate(-l,t,e);let c=e[o][0],h=e[o][1],f=e[(o+1)%e.length][0],u=e[(o+1)%e.length][1],d=!0,g=0,p=0,x=0;for(let b=0;b<e.length;b++){let _=e[b][0],M=e[b][1],T=(_-c)/(f-c);d===!0?(d=!1,g=T,p=T):(T<g&&(g=T),T>p&&(p=T));let D=(-(f-c)*M+f*h-u*c)/(f-c);Math.abs(D)>Math.abs(x)&&(x=D)}let y=[c+g*(f-c),h],m=[c+p*(f-c),h],A=Math.abs(x*(g-p)*(f-c));A<n&&(s=l,n=A,a=[y,m,[m[0],m[1]-x],[y[0],y[1]-x]])}return rotate(s,a,a),a}function getAngle$1(r,t){let e=difference(t,r),n=normalize(e),s=Math.acos(n[0]);return n[1]<0?-s:s}function extend$1(r){let t={inPlace:!0};r.extendMethod("invert",invert),r.extendMethod("abs",abs),r.extendMethod("level",level,t),r.extendMethod("add",add,t),r.extendMethod("subtract",subtract,t),r.extendMethod("subtractImage",subtractImage),r.extendMethod("multiply",multiply,t),r.extendMethod("divide",divide,t),r.extendMethod("hypotenuse",hypotenuse),r.extendMethod("background",background$1),r.extendMethod("flipX",flipX),r.extendMethod("flipY",flipY),r.extendMethod("blurFilter",blurFilter),r.extendMethod("medianFilter",medianFilter),r.extendMethod("gaussianFilter",gaussianFilter),r.extendMethod("sobelFilter",sobelFilter),r.extendMethod("gradientFilter",gradientFilter),r.extendMethod("scharrFilter",scharrFilter),r.extendMethod("dilate",dilate),r.extendMethod("erode",erode),r.extendMethod("open",open),r.extendMethod("close",close),r.extendMethod("topHat",topHat),r.extendMethod("blackHat",blackHat),r.extendMethod("morphologicalGradient",morphologicalGradient),r.extendMethod("warpingFourPoints",warpingFourPoints),r.extendMethod("crop",crop),r.extendMethod("cropAlpha",cropAlpha),r.extendMethod("resize",resize).extendMethod("scale",resize),r.extendMethod("hsv",hsv),r.extendMethod("hsl",hsl$1),r.extendMethod("cmyk",cmyk),r.extendMethod("rgba8",rgba8),r.extendMethod("grey",grey).extendMethod("gray",grey),r.extendMethod("mask",mask),r.extendMethod("pad",pad),r.extendMethod("colorDepth",colorDepth),r.extendMethod("setBorder",setBorder,t),r.extendMethod("rotate",rotate$1),r.extendMethod("rotateLeft",rotateLeft),r.extendMethod("rotateRight",rotateRight),r.extendMethod("insert",insert),r.extendMethod("getRow",getRow),r.extendMethod("getColumn",getColumn),r.extendMethod("getMatrix",getMatrix),r.extendMethod("setMatrix",setMatrix),r.extendMethod("getPixelsArray",getPixelsArray),r.extendMethod("getIntersection",getIntersection),r.extendMethod("getClosestCommonParent",getClosestCommonParent),r.extendMethod("getThreshold",getThreshold),r.extendMethod("split",split),r.extendMethod("getChannel",getChannel),r.extendMethod("combineChannels",combineChannels),r.extendMethod("setChannel",setChannel),r.extendMethod("getSimilarity",getSimilarity),r.extendMethod("getPixelsGrid",getPixelsGrid),r.extendMethod("getBestMatch",getBestMatch),r.extendMethod("cannyEdge",cannyEdge),r.extendMethod("convolution",convolution),r.extendMethod("extract",extract),r.extendMethod("floodFill",floodFill),r.extendMethod("paintLabels",paintLabels,t),r.extendMethod("paintMasks",paintMasks,t),r.extendMethod("paintPoints",paintPoints,t),r.extendMethod("paintPolyline",paintPolyline,t),r.extendMethod("paintPolylines",paintPolylines,t),r.extendMethod("paintPolygon",paintPolygon,t),r.extendMethod("paintPolygons",paintPolygons,t),r.extendMethod("countAlphaPixels",countAlphaPixels),r.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),r.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),r.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),r.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),r.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),r.extendMethod("getMin",min).extendProperty("min",min),r.extendMethod("getMax",max).extendProperty("max",max),r.extendMethod("getSum",sum).extendProperty("sum",sum),r.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),r.extendMethod("getLocalMaxima",localMaxima),r.extendMethod("getMedian",median).extendProperty("median",median),r.extendMethod("getMean",mean).extendProperty("mean",mean),r.extendMethod("getPoints",points).extendProperty("points",points),r.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),r.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(commonjsGlobal,function(){function e($){return typeof $=="string"||$ instanceof String}var n=Number.isFinite||window.isFinite;function s($){return n($)}function a($){return $}function o($){var B={};return $.filter(function(O){return B.hasOwnProperty(O)?!1:B[O]=!0})}function l($,B){if(B.length!==$.length)return!1;for(var O=0;O<$.length;O++)if(B[O].compareArray&&!B[O].compareArray($[O])||B[O]!==$[O])return!1;return!0}function c($,B){Object.keys(B).forEach(function(O){$[O]=B[O]})}function h(){for(var $=1,B=0,O=0;O<arguments.length;O++){var X=arguments[O];B=B+d(X),$*=X}return B!==0?u($,B):$}function f($,B){if(B===0)throw new Error("Divide by zero");var O=Math.pow(10,d(B)),X=O/(O*B);return h($,X)}function u($,B){return Math.round($*Math.pow(10,B))/Math.pow(10,B)}function d($){if(!isFinite($))return 0;for(var B=0;$%1!==0;)$*=10,B++;return B}function g(){var $;if(!this)return $=Object.create(g.prototype),g.apply($,arguments),$;$=Error.apply(this,arguments),this.name="QtyError",this.message=$.message,this.stack=$.stack}g.prototype=Object.create(Error.prototype,{constructor:{value:g}});function p($,B){throw new g("Incompatible units: "+$+" and "+B)}var x={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["t","tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"molar_concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"molar_concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules","Joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<electronvolt>":[["eV","electronvolt","electronvolts"],1602176634e-28,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<arcminute>":[["arcmin","arcminute","arcminutes"],Math.PI/10800,"angle",["<radian>"]],"<arcsecond>":[["arcsec","arcsecond","arcseconds"],Math.PI/648e3,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppb>":[["ppb"],1e-9,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-12,"prefix_only",["<1>"]],"<ppq>":[["ppq"],1e-15,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},y=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],m="<1>",A=[m];function b($,B){var O=B[1],X=B[3]||[],Q=B[4]||[];if(!s(O))throw new g($+": Invalid unit definition. 'scalar' must be a number");X.forEach(function(ie){if(x[ie]===void 0)throw new g($+": Invalid unit definition. Unit "+ie+" in 'numerator' is not recognized")}),Q.forEach(function(ie){if(x[ie]===void 0)throw new g($+": Invalid unit definition. Unit "+ie+" in 'denominator' is not recognized")})}var _={},M={},T={},D={},E={};for(var S in x)if(x.hasOwnProperty(S)){var w=x[S];if(w[2]==="prefix"){_[S]=w[1];for(var v=0;v<w[0].length;v++)M[w[0][v]]=S}else{b(S,w),T[S]={scalar:w[1],numerator:w[3],denominator:w[4]};for(var k=0;k<w[0].length;k++)D[w[0][k]]=S}E[S]=w[0][0]}function I($){var B,O=[],X=Object.keys(x);if(typeof $>"u")for(B=0;B<X.length;B++)["","prefix"].indexOf(x[X[B]][2])===-1&&O.push(X[B].substr(1,X[B].length-2));else{if(this.getKinds().indexOf($)===-1)throw new g("Kind not recognized");for(B=0;B<X.length;B++)x[X[B]][2]===$&&O.push(X[B].substr(1,X[B].length-2))}return O.sort(function(Q,ie){return Q.toLowerCase()<ie.toLowerCase()?-1:Q.toLowerCase()>ie.toLowerCase()?1:0})}function L($){if(!D[$])throw new g("Unit not recognized");return x[D[$]][0]}var F=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function Z(){if(this.signature)return this.signature;for(var $=W.call(this),B=0;B<$.length;B++)$[B]*=Math.pow(20,B);return $.reduce(function(O,X){return O+X},0)}function W(){if(!this.isBase())return W.call(this.toBase());for(var $=new Array(F.length),B=0;B<$.length;B++)$[B]=0;for(var O,X,Q=0;Q<this.numerator.length;Q++)(O=x[this.numerator[Q]])&&(X=F.indexOf(O[2]),X>=0&&($[X]=$[X]+1));for(var ie=0;ie<this.denominator.length;ie++)(O=x[this.denominator[ie]])&&(X=F.indexOf(O[2]),X>=0&&($[X]=$[X]-1));return $}var G="[+-]",P="\\d+",C=G+"?"+P,Y="\\."+P,j="(?:"+P+"(?:"+Y+")?)|(?:"+Y+")",R="[Ee]"+C,N="(?:"+j+")(?:"+R+")?",U=G+"?\\s*"+N,z="("+U+")?\\s*([^/]*)(?:/(.+))?",H=new RegExp("^"+z+"$"),ee="\\^|\\*{2}",se="[01234]",ae=new RegExp("([^ \\*\\d]+?)(?:"+ee+")?(-?"+se+"(?![a-zA-Z]))"),he=new RegExp("([^ \\*\\d]+?)(?:"+ee+")?("+se+"(?![a-zA-Z]))");function we($){e($)||($=$.toString()),$=$.trim();var B=H.exec($);if(!B)throw new g($+": Quantity not recognized");var O=B[1];O?(O=O.replace(/\s/g,""),this.scalar=parseFloat(O)):this.scalar=1;for(var X=B[2],Q=B[3],ie,ke,Se;B=ae.exec(X);){if(ie=parseFloat(B[2]),isNaN(ie))throw new g("Unit exponent is not a number");if(ie===0&&!ue.test(B[1]))throw new g("Unit not recognized");ke=B[1]+" ",Se="";for(var De=0;De<Math.abs(ie);De++)Se+=ke;ie>=0?X=X.replace(B[0],Se):(Q=Q?Q+Se:Se,X=X.replace(B[0],""))}for(;B=he.exec(Q);){if(ie=parseFloat(B[2]),isNaN(ie))throw new g("Unit exponent is not a number");if(ie===0&&!ue.test(B[1]))throw new g("Unit not recognized");ke=B[1]+" ",Se="";for(var Be=0;Be<ie;Be++)Se+=ke;Q=Q.replace(B[0],Se)}X&&(this.numerator=oe(X.trim())),Q&&(this.denominator=oe(Q.trim()))}var ge=Object.keys(M).sort(function($,B){return B.length-$.length}).join("|"),J=Object.keys(D).sort(function($,B){return B.length-$.length}).join("|"),q="\\b|$",xe="("+ge+")??("+J+")(?:"+q+")",ue=new RegExp("^\\s*("+xe+"[\\s\\*]*)+$"),pe=new RegExp(xe,"g"),V={};function oe($){var B=V[$];if(B)return B;var O,X=[];if(!ue.test($))throw new g("Unit not recognized");for(;O=pe.exec($);)X.push(O.slice(1));return X=X.map(function(Q){return M[Q[0]]?[M[Q[0]],D[Q[1]]]:[D[Q[1]]]}),X=X.reduce(function(Q,ie){return Q.concat(ie)},[]),X=X.filter(function(Q){return Q}),V[$]=X,X}function le($){if(!e($))throw new g("Argument should be a string");try{return this($)}catch{return null}}function ce($){return $ instanceof K}function K($,B){if(Me.apply(null,arguments),!ce(this))return new K($,B);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=A,this.denominator=A,_e($)?(this.scalar=$.scalar,this.numerator=$.numerator&&$.numerator.length!==0?$.numerator:A,this.denominator=$.denominator&&$.denominator.length!==0?$.denominator:A):B?(we.call(this,B),this.scalar=$):we.call(this,$),this.denominator.join("*").indexOf("temp")>=0)throw new g("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new g("Cannot multiply by temperatures");if(!l(this.denominator,A))throw new g("Cannot divide with temperatures")}if(this.initValue=$,te.call(this),this.isTemperature()&&this.baseScalar<0)throw new g("Temperatures must not be less than absolute zero")}K.prototype={constructor:K};function Me($,B){if(B){if(!(s($)&&e(B)))throw new g("Only number accepted as initialization value when units are explicitly provided")}else if(!(e($)||s($)||ce($)||_e($)))throw new g("Only string, number or quantity accepted as single initialization value")}function _e($){return $&&typeof $=="object"&&$.hasOwnProperty("scalar")}function te(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=Z.call(this);else{var $=this.toBase();this.baseScalar=$.scalar,this.signature=$.signature}}var ne={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function fe(){return o(Object.keys(ne).map(function($){return ne[$]}))}K.prototype.kind=function(){return ne[this.signature.toString()]},c(K.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&l(this.denominator,A)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function re($,B){var O=$.units(),X=B.to(O),Q=K(de(O));return K({scalar:$.scalar-X.scalar,numerator:Q.numerator,denominator:Q.denominator})}function me($,B){var O=B.to(de($.units()));return K({scalar:$.scalar-O.scalar,numerator:$.numerator,denominator:$.denominator})}function ye($,B){var O=B.to(de($.units()));return K({scalar:$.scalar+O.scalar,numerator:$.numerator,denominator:$.denominator})}function de($){if($==="tempK")return"degK";if($==="tempC")return"degC";if($==="tempF")return"degF";if($==="tempR")return"degR";throw new g("Unknown type for temp conversion from: "+$)}function ve($,B){var O=be($),X=B.units(),Q;if(X==="degK")Q=O.scalar;else if(X==="degC")Q=O.scalar;else if(X==="degF")Q=O.scalar*9/5;else if(X==="degR")Q=O.scalar*9/5;else throw new g("Unknown type for degree conversion to: "+X);return K({scalar:Q,numerator:B.numerator,denominator:B.denominator})}function be($){var B=$.units(),O;if(B.match(/(deg)[CFRK]/))O=$.baseScalar;else if(B==="tempK")O=$.scalar;else if(B==="tempC")O=$.scalar;else if(B==="tempF")O=$.scalar*5/9;else if(B==="tempR")O=$.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+B);return K({scalar:O,numerator:["<kelvin>"],denominator:A})}function Ee($,B){var O=B.units(),X;if(O==="tempK")X=$.baseScalar;else if(O==="tempC")X=$.baseScalar-273.15;else if(O==="tempF")X=$.baseScalar*9/5-459.67;else if(O==="tempR")X=$.baseScalar*9/5;else throw new g("Unknown type for temp conversion to: "+O);return K({scalar:X,numerator:B.numerator,denominator:B.denominator})}function $e($){var B=$.units(),O;if(B.match(/(deg)[CFRK]/))O=$.baseScalar;else if(B==="tempK")O=$.scalar;else if(B==="tempC")O=$.scalar+273.15;else if(B==="tempF")O=($.scalar+459.67)*5/9;else if(B==="tempR")O=$.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+B);return K({scalar:O,numerator:["<temp-K>"],denominator:A})}c(K.prototype,{to:function($){var B,O;if($==null)return this;if(!e($))return this.to($.units());if(B=this._conversionCache[$],B)return B;if(O=K($),O.units()===this.units())return this;if(!this.isCompatible(O))this.isInverse(O)?O=this.inverse().to($):p(this.units(),O.units());else if(O.isTemperature())O=Ee(this,O);else if(O.isDegrees())O=ve(this,O);else{var X=f(this.baseScalar,O.baseScalar);O=K({scalar:X,numerator:O.numerator,denominator:O.denominator})}return this._conversionCache[$]=O,O},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return $e(this);var $=Fe[this.units()];return $||($=Ze(this.numerator,this.denominator),Fe[this.units()]=$),$.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new g("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function($){if(e($)&&($=K($)),s($)&&($=K($+" "+this.units())),this.isUnitless()?$.isUnitless()||p(this.units(),$.units()):$=$.to(this.units()),$.scalar===0)throw new g("Divide by zero");var B=h(Math.round(this.scalar/$.scalar),$.scalar);return K(B+this.units())}});function Ae($,B){var O=K($),X=K(B);if(O.eq(X))return a;var Q;return O.isTemperature()?Q=function(ie){return O.mul(ie).to(X).scalar}:Q=function(ie){return ie*O.baseScalar/X.baseScalar},function(ke){var Se,De,Be;if(Array.isArray(ke)){for(De=ke.length,Be=[],Se=0;Se<De;Se++)Be.push(Q(ke[Se]));return Be}else return Q(ke)}}var Fe={};function Ze($,B){for(var O=[],X=[],Q=1,ie,ke=0;ke<$.length;ke++)ie=$[ke],_[ie]?Q=h(Q,_[ie]):T[ie]&&(Q*=T[ie].scalar,T[ie].numerator&&O.push(T[ie].numerator),T[ie].denominator&&X.push(T[ie].denominator));for(var Se=0;Se<B.length;Se++)ie=B[Se],_[ie]?Q/=_[ie]:T[ie]&&(Q/=T[ie].scalar,T[ie].numerator&&X.push(T[ie].numerator),T[ie].denominator&&O.push(T[ie].denominator));return O=O.reduce(function(De,Be){return De.concat(Be)},[]),X=X.reduce(function(De,Be){return De.concat(Be)},[]),K({scalar:Q,numerator:O,denominator:X})}K.parse=le,K.getUnits=I,K.getAliases=L,K.mulSafe=h,K.divSafe=f,K.getKinds=fe,K.swiftConverter=Ae,K.Error=g,c(K.prototype,{add:function($){if(e($)&&($=K($)),this.isCompatible($)||p(this.units(),$.units()),this.isTemperature()&&$.isTemperature())throw new g("Cannot add two temperatures");return this.isTemperature()?ye(this,$):$.isTemperature()?ye($,this):K({scalar:this.scalar+$.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function($){if(e($)&&($=K($)),this.isCompatible($)||p(this.units(),$.units()),this.isTemperature()&&$.isTemperature())return re(this,$);if(this.isTemperature())return me(this,$);if($.isTemperature())throw new g("Cannot subtract a temperature from a differential degree unit");return K({scalar:this.scalar-$.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function($){if(s($))return K({scalar:h(this.scalar,$),numerator:this.numerator,denominator:this.denominator});if(e($)&&($=K($)),(this.isTemperature()||$.isTemperature())&&!(this.isUnitless()||$.isUnitless()))throw new g("Cannot multiply by temperatures");var B=this,O=$;B.isCompatible(O)&&B.signature!==400&&(O=O.to(B));var X=Ke(B.numerator,B.denominator,O.numerator,O.denominator);return K({scalar:h(B.scalar,O.scalar,X[2]),numerator:X[0],denominator:X[1]})},div:function($){if(s($)){if($===0)throw new g("Divide by zero");return K({scalar:this.scalar/$,numerator:this.numerator,denominator:this.denominator})}else e($)&&($=K($));if($.scalar===0)throw new g("Divide by zero");if($.isTemperature())throw new g("Cannot divide with temperatures");if(this.isTemperature()&&!$.isUnitless())throw new g("Cannot divide with temperatures");var B=this,O=$;B.isCompatible(O)&&B.signature!==400&&(O=O.to(B));var X=Ke(B.numerator,B.denominator,O.denominator,O.numerator);return K({scalar:h(B.scalar,X[2])/O.scalar,numerator:X[0],denominator:X[1]})},inverse:function(){if(this.isTemperature())throw new g("Cannot divide with temperatures");if(this.scalar===0)throw new g("Divide by zero");return K({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Ke($,B,O,X){function Q(Re){return Re!==m}$=$.filter(Q),O=O.filter(Q),B=B.filter(Q),X=X.filter(Q);var ie={};function ke(Re,Oe){for(var Ce,je,qe,Ve=0;Ve<Re.length;Ve++)if(_[Re[Ve]]?(Ce=Re[Ve+1],je=Re[Ve],qe=_[je],Ve++):(Ce=Re[Ve],je=null,qe=1),Ce&&Ce!==m)if(ie[Ce]){ie[Ce][0]+=Oe;var tt=ie[Ce][2]?_[ie[Ce][2]]:1;ie[Ce][Oe===1?3:4]*=f(qe,tt)}else ie[Ce]=[Oe,Ce,je,1,1]}ke($,1),ke(B,-1),ke(O,1),ke(X,-1);var Se=[],De=[],Be=1;for(var Qe in ie)if(ie.hasOwnProperty(Qe)){var Ie=ie[Qe],Xe;if(Ie[0]>0)for(Xe=0;Xe<Ie[0];Xe++)Se.push(Ie[2]===null?Ie[1]:[Ie[2],Ie[1]]);else if(Ie[0]<0)for(Xe=0;Xe<-Ie[0];Xe++)De.push(Ie[2]===null?Ie[1]:[Ie[2],Ie[1]]);Be*=f(Ie[3],Ie[4])}return Se.length===0&&(Se=A),De.length===0&&(De=A),Se=Se.reduce(function(Re,Oe){return Re.concat(Oe)},[]),De=De.reduce(function(Re,Oe){return Re.concat(Oe)},[]),[Se,De,Be]}c(K.prototype,{eq:function($){return this.compareTo($)===0},lt:function($){return this.compareTo($)===-1},lte:function($){return this.eq($)||this.lt($)},gt:function($){return this.compareTo($)===1},gte:function($){return this.eq($)||this.gt($)},compareTo:function($){if(e($))return this.compareTo(K($));if(this.isCompatible($)||p(this.units(),$.units()),this.baseScalar<$.baseScalar)return-1;if(this.baseScalar===$.baseScalar)return 0;if(this.baseScalar>$.baseScalar)return 1},same:function($){return this.scalar===$.scalar&&this.units()===$.units()}}),c(K.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function($){return l($,A)})},isCompatible:function($){return e($)?this.isCompatible(K($)):ce($)&&$.signature!==void 0?this.signature===$.signature:!1},isInverse:function($){return this.inverse().isCompatible($)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function($){$!==m&&y.indexOf($)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function Pe(){}Pe.prototype.get=function($){return arguments.length>1&&($=Array.apply(null,arguments)),$.reduce(function(B,O,X){if(B){var Q=B[O];return X===$.length-1?Q?Q.data:void 0:Q}},this)},Pe.prototype.set=function($,B){return arguments.length>2&&($=Array.prototype.slice.call(arguments,0,-1),B=arguments[arguments.length-1]),$.reduce(function(O,X,Q){var ie=O[X];return ie===void 0&&(ie=O[X]={}),Q===$.length-1?(ie.data=B,B):ie},this)};function ze($,B){return($+" "+B).trim()}K.formatter=ze,c(K.prototype,{units:function(){if(this._units!==void 0)return this._units;var $=l(this.numerator,A),B=l(this.denominator,A);if($&&B)return this._units="",this._units;var O=Ue(this.numerator),X=Ue(this.denominator);return this._units=O+(B?"":"/"+X),this._units},toString:function($,B){var O;if(s($))O=this.units(),B=$;else if(e($))O=$;else if(ce($))return this.toPrec($).toString(B);var X=this.to(O),Q=B!==void 0?u(X.scalar,B):X.scalar;return X=(Q+" "+X.units()).trim(),X},format:function($,B){arguments.length===1&&typeof $=="function"&&(B=$,$=void 0),B=B||K.formatter;var O=this.to($);return B.call(this,O.scalar,O.units())}});var Ye=new Pe;function Ue($){var B=Ye.get($);if(B)return B;var O=l($,A);return O?B="1":B=He(Ge($)).join("*"),Ye.set($,B),B}function Ge($){for(var B=[],O,X,Q=0;Q<$.length;Q++)O=$[Q],X=$[Q+1],_[O]?(B.push(E[O]+E[X]),Q++):B.push(E[O]);return B}function He($){var B=$.reduce(function(O,X){var Q=O[X];return Q||O.push(Q=O[X]=[X,0]),Q[1]++,O},[]);return B.map(function(O){return O[0]+(O[1]>1?O[1]:"")})}return K.version="1.8.0",K})})(quantities);var quantitiesExports=quantities.exports;const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(r,t=""){let e=t.split(".");for(let n of e){if(r[n]===void 0)return;r=r[n]}return r}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(r,t,e){var n=r*t,s=SPLITTER*r,a=s-r,o=s-a,l=r-o,c=SPLITTER*t,h=c-t,f=c-h,u=t-f,d=n-o*f,g=d-l*f,p=g-o*u,x=l*u-p;return e?(e[0]=x,e[1]=n,e):[x,n]}var robustSum=linearExpansionSum;function scalarScalar$1(r,t){var e=r+t,n=e-r,s=e-n,a=t-n,o=r-s,l=o+a;return l?[l,e]:[e]}function linearExpansionSum(r,t){var e=r.length|0,n=t.length|0;if(e===1&&n===1)return scalarScalar$1(r[0],t[0]);var s=e+n,a=new Array(s),o=0,l=0,c=0,h=Math.abs,f=r[l],u=h(f),d=t[c],g=h(d),p,x;u<g?(x=f,l+=1,l<e&&(f=r[l],u=h(f))):(x=d,c+=1,c<n&&(d=t[c],g=h(d))),l<e&&u<g||c>=n?(p=f,l+=1,l<e&&(f=r[l],u=h(f))):(p=d,c+=1,c<n&&(d=t[c],g=h(d)));for(var y=p+x,m=y-p,A=x-m,b=A,_=y,M,T,D,E,S;l<e&&c<n;)u<g?(p=f,l+=1,l<e&&(f=r[l],u=h(f))):(p=d,c+=1,c<n&&(d=t[c],g=h(d))),x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),M=_+y,T=M-_,D=M-T,E=y-T,S=_-D,b=S+E,_=M;for(;l<e;)p=f,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),M=_+y,T=M-_,D=M-T,E=y-T,S=_-D,b=S+E,_=M,l+=1,l<e&&(f=r[l]);for(;c<n;)p=d,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),M=_+y,T=M-_,D=M-T,E=y-T,S=_-D,b=S+E,_=M,c+=1,c<n&&(d=t[c]);return b&&(a[o++]=b),_&&(a[o++]=_),o||(a[o++]=0),a.length=o,a}var twoSum$1=fastTwoSum;function fastTwoSum(r,t,e){var n=r+t,s=n-r,a=n-s,o=t-s,l=r-a;return e?(e[0]=l+o,e[1]=n,e):[l+o,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(r,t){var e=r.length;if(e===1){var n=twoProduct(r[0],t);return n[0]?n:[n[1]]}var s=new Array(2*e),a=[.1,.1],o=[.1,.1],l=0;twoProduct(r[0],t,a),a[0]&&(s[l++]=a[0]);for(var c=1;c<e;++c){twoProduct(r[c],t,o);var h=a[1];twoSum(h,o[0],a),a[0]&&(s[l++]=a[0]);var f=o[1],u=a[1],d=f+u,g=d-f,p=u-g;a[1]=d,p&&(s[l++]=p)}return a[1]&&(s[l++]=a[1]),l===0&&(s[l++]=0),s.length=l,s}var robustDiff=robustSubtract;function scalarScalar(r,t){var e=r+t,n=e-r,s=e-n,a=t-n,o=r-s,l=o+a;return l?[l,e]:[e]}function robustSubtract(r,t){var e=r.length|0,n=t.length|0;if(e===1&&n===1)return scalarScalar(r[0],-t[0]);var s=e+n,a=new Array(s),o=0,l=0,c=0,h=Math.abs,f=r[l],u=h(f),d=-t[c],g=h(d),p,x;u<g?(x=f,l+=1,l<e&&(f=r[l],u=h(f))):(x=d,c+=1,c<n&&(d=-t[c],g=h(d))),l<e&&u<g||c>=n?(p=f,l+=1,l<e&&(f=r[l],u=h(f))):(p=d,c+=1,c<n&&(d=-t[c],g=h(d)));for(var y=p+x,m=y-p,A=x-m,b=A,_=y,M,T,D,E,S;l<e&&c<n;)u<g?(p=f,l+=1,l<e&&(f=r[l],u=h(f))):(p=d,c+=1,c<n&&(d=-t[c],g=h(d))),x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),M=_+y,T=M-_,D=M-T,E=y-T,S=_-D,b=S+E,_=M;for(;l<e;)p=f,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),M=_+y,T=M-_,D=M-T,E=y-T,S=_-D,b=S+E,_=M,l+=1,l<e&&(f=r[l]);for(;c<n;)p=d,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),M=_+y,T=M-_,D=M-T,E=y-T,S=_-D,b=S+E,_=M,c+=1,c<n&&(d=-t[c]);return b&&(a[o++]=b),_&&(a[o++]=_),o||(a[o++]=0),a.length=o,a}(function(r){var t=twoProduct_1,e=robustSum,n=robustScale,s=robustDiff,a=5,o=11102230246251565e-32,l=(3+16*o)*o,c=(7+56*o)*o;function h(b,_,M,T){return function(E,S,w){var v=b(b(_(S[1],w[0]),_(-w[1],S[0])),b(_(E[1],S[0]),_(-S[1],E[0]))),k=b(_(E[1],w[0]),_(-w[1],E[0])),I=T(v,k);return I[I.length-1]}}function f(b,_,M,T){return function(E,S,w,v){var k=b(b(M(b(_(w[1],v[0]),_(-v[1],w[0])),S[2]),b(M(b(_(S[1],v[0]),_(-v[1],S[0])),-w[2]),M(b(_(S[1],w[0]),_(-w[1],S[0])),v[2]))),b(M(b(_(S[1],v[0]),_(-v[1],S[0])),E[2]),b(M(b(_(E[1],v[0]),_(-v[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),v[2])))),I=b(b(M(b(_(w[1],v[0]),_(-v[1],w[0])),E[2]),b(M(b(_(E[1],v[0]),_(-v[1],E[0])),-w[2]),M(b(_(E[1],w[0]),_(-w[1],E[0])),v[2]))),b(M(b(_(S[1],w[0]),_(-w[1],S[0])),E[2]),b(M(b(_(E[1],w[0]),_(-w[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),w[2])))),L=T(k,I);return L[L.length-1]}}function u(b,_,M,T){return function(E,S,w,v,k){var I=b(b(b(M(b(M(b(_(v[1],k[0]),_(-k[1],v[0])),w[2]),b(M(b(_(w[1],k[0]),_(-k[1],w[0])),-v[2]),M(b(_(w[1],v[0]),_(-v[1],w[0])),k[2]))),S[3]),b(M(b(M(b(_(v[1],k[0]),_(-k[1],v[0])),S[2]),b(M(b(_(S[1],k[0]),_(-k[1],S[0])),-v[2]),M(b(_(S[1],v[0]),_(-v[1],S[0])),k[2]))),-w[3]),M(b(M(b(_(w[1],k[0]),_(-k[1],w[0])),S[2]),b(M(b(_(S[1],k[0]),_(-k[1],S[0])),-w[2]),M(b(_(S[1],w[0]),_(-w[1],S[0])),k[2]))),v[3]))),b(M(b(M(b(_(w[1],v[0]),_(-v[1],w[0])),S[2]),b(M(b(_(S[1],v[0]),_(-v[1],S[0])),-w[2]),M(b(_(S[1],w[0]),_(-w[1],S[0])),v[2]))),-k[3]),b(M(b(M(b(_(v[1],k[0]),_(-k[1],v[0])),S[2]),b(M(b(_(S[1],k[0]),_(-k[1],S[0])),-v[2]),M(b(_(S[1],v[0]),_(-v[1],S[0])),k[2]))),E[3]),M(b(M(b(_(v[1],k[0]),_(-k[1],v[0])),E[2]),b(M(b(_(E[1],k[0]),_(-k[1],E[0])),-v[2]),M(b(_(E[1],v[0]),_(-v[1],E[0])),k[2]))),-S[3])))),b(b(M(b(M(b(_(S[1],k[0]),_(-k[1],S[0])),E[2]),b(M(b(_(E[1],k[0]),_(-k[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),k[2]))),v[3]),b(M(b(M(b(_(S[1],v[0]),_(-v[1],S[0])),E[2]),b(M(b(_(E[1],v[0]),_(-v[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),v[2]))),-k[3]),M(b(M(b(_(w[1],v[0]),_(-v[1],w[0])),S[2]),b(M(b(_(S[1],v[0]),_(-v[1],S[0])),-w[2]),M(b(_(S[1],w[0]),_(-w[1],S[0])),v[2]))),E[3]))),b(M(b(M(b(_(w[1],v[0]),_(-v[1],w[0])),E[2]),b(M(b(_(E[1],v[0]),_(-v[1],E[0])),-w[2]),M(b(_(E[1],w[0]),_(-w[1],E[0])),v[2]))),-S[3]),b(M(b(M(b(_(S[1],v[0]),_(-v[1],S[0])),E[2]),b(M(b(_(E[1],v[0]),_(-v[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),v[2]))),w[3]),M(b(M(b(_(S[1],w[0]),_(-w[1],S[0])),E[2]),b(M(b(_(E[1],w[0]),_(-w[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),w[2]))),-v[3]))))),L=b(b(b(M(b(M(b(_(v[1],k[0]),_(-k[1],v[0])),w[2]),b(M(b(_(w[1],k[0]),_(-k[1],w[0])),-v[2]),M(b(_(w[1],v[0]),_(-v[1],w[0])),k[2]))),E[3]),M(b(M(b(_(v[1],k[0]),_(-k[1],v[0])),E[2]),b(M(b(_(E[1],k[0]),_(-k[1],E[0])),-v[2]),M(b(_(E[1],v[0]),_(-v[1],E[0])),k[2]))),-w[3])),b(M(b(M(b(_(w[1],k[0]),_(-k[1],w[0])),E[2]),b(M(b(_(E[1],k[0]),_(-k[1],E[0])),-w[2]),M(b(_(E[1],w[0]),_(-w[1],E[0])),k[2]))),v[3]),M(b(M(b(_(w[1],v[0]),_(-v[1],w[0])),E[2]),b(M(b(_(E[1],v[0]),_(-v[1],E[0])),-w[2]),M(b(_(E[1],w[0]),_(-w[1],E[0])),v[2]))),-k[3]))),b(b(M(b(M(b(_(w[1],k[0]),_(-k[1],w[0])),S[2]),b(M(b(_(S[1],k[0]),_(-k[1],S[0])),-w[2]),M(b(_(S[1],w[0]),_(-w[1],S[0])),k[2]))),E[3]),M(b(M(b(_(w[1],k[0]),_(-k[1],w[0])),E[2]),b(M(b(_(E[1],k[0]),_(-k[1],E[0])),-w[2]),M(b(_(E[1],w[0]),_(-w[1],E[0])),k[2]))),-S[3])),b(M(b(M(b(_(S[1],k[0]),_(-k[1],S[0])),E[2]),b(M(b(_(E[1],k[0]),_(-k[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),k[2]))),w[3]),M(b(M(b(_(S[1],w[0]),_(-w[1],S[0])),E[2]),b(M(b(_(E[1],w[0]),_(-w[1],E[0])),-S[2]),M(b(_(E[1],S[0]),_(-S[1],E[0])),w[2]))),-k[3])))),F=T(I,L);return F[F.length-1]}}function d(b){var _=b===3?h:b===4?f:u;return _(e,t,n,s)}var g=d(3),p=d(4),x=[function(){return 0},function(){return 0},function(_,M){return M[0]-_[0]},function(_,M,T){var D=(_[1]-T[1])*(M[0]-T[0]),E=(_[0]-T[0])*(M[1]-T[1]),S=D-E,w;if(D>0){if(E<=0)return S;w=D+E}else if(D<0){if(E>=0)return S;w=-(D+E)}else return S;var v=l*w;return S>=v||S<=-v?S:g(_,M,T)},function(_,M,T,D){var E=_[0]-D[0],S=M[0]-D[0],w=T[0]-D[0],v=_[1]-D[1],k=M[1]-D[1],I=T[1]-D[1],L=_[2]-D[2],F=M[2]-D[2],Z=T[2]-D[2],W=S*I,G=w*k,P=w*v,C=E*I,Y=E*k,j=S*v,R=L*(W-G)+F*(P-C)+Z*(Y-j),N=(Math.abs(W)+Math.abs(G))*Math.abs(L)+(Math.abs(P)+Math.abs(C))*Math.abs(F)+(Math.abs(Y)+Math.abs(j))*Math.abs(Z),U=c*N;return R>U||-R>U?R:p(_,M,T,D)}];function y(b){var _=x[b.length];return _||(_=x[b.length]=d(b.length)),_.apply(void 0,b)}function m(b,_,M,T,D,E,S){return function(v,k,I,L,F){switch(arguments.length){case 0:case 1:return 0;case 2:return T(v,k);case 3:return D(v,k,I);case 4:return E(v,k,I,L);case 5:return S(v,k,I,L,F)}for(var Z=new Array(arguments.length),W=0;W<arguments.length;++W)Z[W]=arguments[W];return b(Z)}}function A(){for(;x.length<=a;)x.push(d(x.length));r.exports=m.apply(void 0,[y].concat(x));for(var b=0;b<=a;++b)r.exports[b]=x[b]}A()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(r,t){for(var e=t[0],n=t[1],s=r.length,a=1,o=s,l=0,c=s-1;l<o;c=l++){var h=r[l],f=r[c],u=h[1],d=f[1];if(d<u){if(d<n&&n<u){var g=orient(h,f,t);if(g===0)return 0;a^=0<g|0}else if(n===u){var p=r[(l+1)%s],x=p[1];if(u<x){var g=orient(h,f,t);if(g===0)return 0;a^=0<g|0}}}else if(u<d){if(u<n&&n<d){var g=orient(h,f,t);if(g===0)return 0;a^=g<0|0}else if(n===u){var p=r[(l+1)%s],x=p[1];if(x<u){var g=orient(h,f,t);if(g===0)return 0;a^=g<0|0}}}else if(n===u){var y=Math.min(h[0],f[0]),m=Math.max(h[0],f[0]);if(l===0){for(;c>0;){var A=(c+s-1)%s,b=r[A];if(b[1]!==n)break;var _=b[0];y=Math.min(y,_),m=Math.max(m,_),c=A}if(c===0)return y<=e&&e<=m?0:1;o=c+1}for(var M=r[(c+s-1)%s][1];l+1<o;){var b=r[l+1];if(b[1]!==n)break;var _=b[0];y=Math.min(y,_),m=Math.max(m,_),l+=1}if(y<=e&&e<=m)return 0;var T=r[(l+1)%s][1];e<y&&M<n!=T<n&&(a^=1)}}return 2*a-1}const robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(r={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=r;if(t.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(t.length===1)return{min:1,max:1,minLine:[t[0],t[0]],maxLine:[t[0],t[0]],aspectRatio:1};const e=new Array(t.length);let n=1/0,s=0,a=[];for(let h=0;h<t.length;h++){let f=getAngle(t[h],t[(h+1)%t.length]);rotate(-f,t,e);let u=0,d=[];for(let g=0;g<t.length;g++){let p=Math.abs(e[h][1]-e[g][1]);p>u&&(u=p,d=[],d.push([e[g][0],e[h][1]],[e[g][0],e[g][1]]))}u<n&&(n=u,s=f,a=d)}rotate(s,a,a);let o=0,l=[],c=0;for(let h=0;h<t.length-1;h++)for(let f=h+1;f<t.length;f++){let u=(t[h][0]-t[f][0])**2+(t[h][1]-t[f][1])**2;u>c&&(c=u,o=Math.sqrt(u),l=[t[h],t[f]])}return{min:n,minLine:a,max:o,maxLine:l,aspectRatio:n/o}}function getAngle(r,t){let e=difference(t,r),n=normalize(e),s=Math.acos(n[0]);return n[1]<0?-s:s}class Roi{constructor(t,e){this.map=t,this.id=e,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:e=1,kind:n=""}=t;let s;switch(n){case"contour":s=this.contourMask;break;case"box":s=this.boxMask;break;case"filled":s=this.filledMask;break;case"center":s=this.centerMask;break;case"mbr":s=this.mbrFilledMask;break;case"hull":s=this.convexHullFilledMask;break;case"hullContour":s=this.convexHullMask;break;case"mbrContour":s=this.mbrMask;break;case"feret":s=this.feretMask;break;default:s=this.mask}return e<1&&(s=s.resize({factor:e}),s.parent=this.mask.parent,s.position[0]+=this.minX,s.position[1]+=this.minY),s}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,e=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let s=0;s<t.length;s++)n.includes(t[s])||(this.computed.externalIDs.push(t[s]),this.computed.externalLengths.push(e[s]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++)this.map.data[e+this.minX+(n+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&n>0&&n<this.height-1?(this.map.data[e-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[e+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[e+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[e+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&t.setBitXY(e,n):t.setBitXY(e,n));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)t.setBitXY(e,0),t.setBitXY(e,this.height-1);for(let e=0;e<this.height;e++)t.setBitXY(0,e),t.setBitXY(this.width-1,e);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++)this.map.data[e+this.minX+(n+this.minY)*this.map.width]===this.id&&t.setBitXY(e,n);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){let s=e+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[s])&&t.setBitXY(e,n)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)this.map.data[n+this.minX+(s+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&s>0&&s<this.height-1?(this.map.data[n-1+this.minX+(s+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(s+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(s-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(s+1+this.minY)*this.map.width]!==this.id)&&(t.push([n,s]),t.push([n+1,s]),t.push([n,s+1]),t.push([n+1,s+1])):(t.push([n,s]),t.push([n+1,s]),t.push([n,s+1]),t.push([n+1,s+1])));const e=monotoneChainConvexHull$1(t);this.computed.convexHull={polyline:e,surface:surface(e),perimeter:perimeter(e)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,e=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=e}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,e=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)robustPointInPolygon$1(t.polyline,[n,s])!==1&&e.setBitXY(n,s);this.computed.convexHullFilledMask=e}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(t.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let e=t[0],n=t[1],s=t[2],a=Math.sqrt((e[0]-n[0])**2+(e[1]-n[1])**2),o=Math.sqrt((s[0]-n[0])**2+(s[1]-n[1])**2);this.computed.mbr={width:a,height:o,elongation:1-a/o,aspectRatio:a/o,surface:a*o,perimeter:(a+o)*2,rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,e=2-Math.sqrt(2);return t.one+t.two*2+t.three*3+t.four*4-e*(t.two+t.three*2+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const e=minMax(t),n=new Image(e[1][0]-e[0][0]+1,e[1][1]-e[0][1]+1,{kind:BINARY,position:[this.minX+e[0][0],this.minY+e[0][1]],parent:this.map.parent});t=moveToZeroZero(t),n.paintPolyline(t,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)robustPointInPolygon$1(e,[n,s])!==1&&t.setBitXY(n,s);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++){let s=(e+this.minY)*this.map.width+n+this.minX;this.map.data[s]===this.id&&t.push([n,e])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t=0,e;const n=this.points;for(let s=0;s<n.length;s++)for(let a=s+1;a<n.length;a++){let o=Math.pow(n[s][0]-n[a][0],2)+Math.pow(n[s][1]-n[a][1],2);o>=t&&(t=o,e=[n[s],n[a]])}this.computed.maxLengthPoints=e}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,e=-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])*180/Math.PI;this.computed.angle=e}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(r){let t=r.map,e=t.data,n=new Set,s=new Map,a=new Set,o=[1,0,-1,0],l=[0,1,0,-1];for(let f=r.minX;f<=r.maxX;f++)for(let u=r.minY;u<=r.maxY;u++){let d=f+u*t.width;if(e[d]===r.id)for(let g=0;g<4;g++){let p=f+o[g],x=u+l[g];if(p>=0&&x>=0&&p<t.width&&x<t.height){let y=p+x*t.width;if(e[y]!==r.id&&!a.has(y)){a.add(y),n.add(e[y]);let m=s.get(e[y]);m?s.set(e[y],++m):s.set(e[y],1)}}}}let c=Array.from(n),h=c.map(function(f){return s.get(f)});return{ids:c,lengths:h}}function getBoxIDs(r){let t=new Set,e=r.map,n=e.data;for(let s of[0,r.height-1])for(let a=0;a<r.width;a++){let o=(s+r.minY)*e.width+a+r.minX;if(a-r.minX>0&&n[o]===r.id&&n[o-1]!==r.id){let l=n[o-1];t.add(l)}if(e.width-a-r.minX>1&&n[o]===r.id&&n[o+1]!==r.id){let l=n[o+1];t.add(l)}}for(let s of[0,r.width-1])for(let a=0;a<r.height;a++){let o=(a+r.minY)*e.width+s+r.minX;if(a-r.minY>0&&n[o]===r.id&&n[o-e.width]!==r.id){let l=n[o-e.width];t.add(l)}if(e.height-a-r.minY>1&&n[o]===r.id&&n[o+e.width]!==r.id){let l=n[o+e.width];t.add(l)}}return Array.from(t)}function getBox(r){let t=0,e=r.map,n=e.data,s=[0];r.height>1&&(s[1]=r.height-1);for(let o of s)for(let l=1;l<r.width-1;l++){let c=(o+r.minY)*e.width+l+r.minX;n[c]===r.id&&t++}let a=[0];r.width>1&&(a[1]=r.width-1);for(let o of a)for(let l=0;l<r.height;l++){let c=(l+r.minY)*e.width+o+r.minX;n[c]===r.id&&t++}return t}function getBorder(r){let t=0,e=r.map,n=e.data;for(let s=1;s<r.width-1;s++)for(let a=1;a<r.height-1;a++){let o=(a+r.minY)*e.width+s+r.minX;n[o]===r.id&&(n[o-1]!==r.id||n[o+1]!==r.id||n[o-e.width]!==r.id||n[o+e.width]!==r.id)&&t++}return t+r.box}function getPerimeterInfo(r){let t=r.map,e=t.data,n=0,s=0,a=0,o=0;for(let l=0;l<r.width;l++)for(let c=0;c<r.height;c++){let h=(c+r.minY)*t.width+l+r.minX;if(e[h]===r.id){let f=0;switch((l===0||r.externalIDs.includes(e[h-1]))&&f++,(l===r.width-1||r.externalIDs.includes(e[h+1]))&&f++,(c===0||r.externalIDs.includes(e[h-t.width]))&&f++,(c===r.height-1||r.externalIDs.includes(e[h+t.width]))&&f++,f){case 1:n++;break;case 2:s++;break;case 3:a++;break;case 4:o++;break}}}return{one:n,two:s,three:a,four:o}}function getExternal(r){let t=0,e=r.map,n=e.data;for(let s=1;s<r.width-1;s++)for(let a=1;a<r.height-1;a++){let o=(a+r.minY)*e.width+s+r.minX;n[o]===r.id&&(r.externalIDs.includes(n[o-1])||r.externalIDs.includes(n[o+1])||r.externalIDs.includes(n[o-e.width])||r.externalIDs.includes(n[o+e.width]))&&t++}return t+r.box}function getHolesInfo(r){let t=0,e=r.map.width,n=r.map.data;for(let s=1;s<r.width-1;s++)for(let a=1;a<r.height-1;a++){let o=(a+r.minY)*e+s+r.minX;r.internalIDs.includes(n[o])&&n[o]!==r.id&&t++}return{number:r.internalIDs.length-1,surface:t}}function getInternalIDs(r){let t=[r.id],e=r.map,n=e.data;if(r.height>2)for(let a=0;a<r.width;a++){let o=r.minY*e.width+a+r.minX;if(t.includes(n[o])){let l=n[o+e.width];!t.includes(l)&&!r.boxIDs.includes(l)&&t.push(l)}}let s=new Array(4);for(let a=1;a<r.width-1;a++)for(let o=1;o<r.height-1;o++){let l=(o+r.minY)*e.width+a+r.minX;if(t.includes(n[l])){s[0]=n[l-1],s[1]=n[l+1],s[2]=n[l-e.width],s[3]=n[l+e.width];for(let c=0;c<4;c++){let h=s[c];!t.includes(h)&&!r.boxIDs.includes(h)&&t.push(h)}}}return t}class RoiLayer{constructor(t,e){this.roiMap=t,this.options=e,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,e={};this.roiMap.positive=0,this.roiMap.negative=0;for(let l=0;l<t.length;l++)t[l]&&!e[t[l]]&&(e[t[l]]=!0,t[l]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let l in e)n[l]=new Roi(this.roiMap,l*1);let s=this.roiMap.width,a=this.roiMap.height;for(let l=0;l<a;l++)for(let c=0;c<s;c++){let h=l*s+c;if(t[h]!==0){const f=t[h],u=n[f];c<u.minX&&(u.minX=c),c>u.maxX&&(u.maxX=c),l<u.minY&&(u.minY=l),l>u.maxY&&(u.maxY=l),u.meanX+=c,u.meanY+=l,u.surface++}}let o=[];for(let l in e)n[l].meanX/=n[l].surface,n[l].meanY/=n[l].surface,o.push(n[l]);return o}}function commonBorderLength(r){let t=r.data,e=[1,0,-1,0],n=[0,1,0,-1],s=r.minMax,a=-s.min,o=s.max+a,l=[];for(let h=0;h<=o;h++)l.push(Object.create(null));for(let h=0;h<r.width;h++)for(let f=0;f<r.height;f++){let u=h+f*r.width,d=t[u];if(d!==0){let g=Object.create(null),p=!1;for(let x=0;x<4;x++){let y=h+e[x],m=f+n[x];if(y>=0&&m>=0&&y<r.width&&m<r.height){let A=t[y+m*r.width];d!==A&&(p=!0,A!==0&&g[A]===void 0&&(g[A]=!0,l[A+a][d]?l[A+a][d]++:l[A+a][d]=1))}else p=!0}p&&(l[d+a][d]?l[d+a][d]++:l[d+a][d]=1)}}let c={};for(let h=0;h<l.length;h++)Object.keys(l[h]).length>0&&(c[h-a]=l[h]);return c}function mergeRoi(r={}){const{algorithm:t="commonBorderLength",minCommonBorderLength:e=5,maxCommonBorderLength:n=100,minCommonBorderRatio:s=.3,maxCommonBorderRatio:a=1}=r;let o=function(y,m,A){return y[A]>=e&&y[A]<=n};typeof t=="function"&&(o=t),t.toLowerCase()==="commonborderratio"&&(o=function(y,m,A){let b=Math.min(y[A]/y[m],1);return b>=s&&b<=a});const l=this,c=l.commonBorderLength;let h={},f={};for(let y of Object.keys(c)){let m=c[y],A=Object.keys(m);for(let b of A)if(b!==y&&o(m,y,b)){let _=b;f[b]&&(_=f[b]);let M=y;if(f[y]&&(M=f[y]),Number(_)!==M){let T=Math.min(_,M),D=Math.max(_,M);if(h[T]||(h[T]={}),h[T][D]=!0,f[D]=T,h[D]){for(let E of Object.keys(h[D]))h[T][E]=!0,f[E]=T;delete h[D]}}}}let u=l.minMax,d=-u.min,g=u.max+d,p=new Array(g+1).fill(0);for(let y of Object.keys(f))p[Number(y)+d]=f[y];let x=l.data;for(let y=0;y<x.length;y++){let m=x[y];if(m!==0){let A=p[m+d];A!==0&&(x[y]=A)}}return l.computed={},l}class RoiMap{constructor(t,e){this.parent=t,this.width=t.width,this.height=t.height,this.data=e,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<t&&(t=this.data[n]),this.data[n]>e&&(e=this.data[n]);return{min:t,max:e}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const e=t[0],n=t.slice(1);for(let s=0;s<this.data.length;s++)n.includes(this.data[s])&&(this.data[s]=e)}rowsInfo(){let t=new Array(this.height),e=0;for(let n=0;n<this.data.length;n+=this.width){let s={row:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=s;let a={},o={},l=[],c=this.data[n],h=0;for(let f=n;f<n+this.width;f++){let u=this.data[f];c!==u&&(c=u,l.push(h),h=0),h++,u>0?(s.positivePixel++,a[u]||(a[u]=!0)):u<0?(s.negativePixel++,o[u]||(o[u]=!0)):s.zeroPixel++}l.push(h),s.medianChange=l.sort((f,u)=>f-u)[Math.floor(l.length/2)],s.positiveRoiIDs=Object.keys(a),s.negativeRoiIDs=Object.keys(o),s.positiveRoi=s.positiveRoiIDs.length,s.negativeRoi=s.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),e=0;for(let n=0;n<this.width;n++){let s={col:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=s;let a={},o={},l=[],c=this.data[n],h=0;for(let f=n;f<n+this.data.length;f+=this.width){let u=this.data[f];c!==u&&(c=u,l.push(h),h=0),h++,u>0?(s.positivePixel++,a[u]||(a[u]=!0)):u<0?(s.negativePixel++,o[u]||(o[u]=!0)):s.zeroPixel++}l.push(h),s.medianChange=l.sort((f,u)=>f-u)[Math.floor(l.length/2)],s.positiveRoiIDs=Object.keys(a),s.negativeRoiIDs=Object.keys(o),s.positiveRoi=s.positiveRoiIDs.length,s.negativeRoi=s.negativeRoiIDs.length}return t}}function fromMask(r,t={}){const{allowCorners:e=!1}=t,n=65535;let s=new Int16Array(r.size),a=0,o=0,l=new Uint16Array(n+1),c=new Uint16Array(n+1);for(let f=0;f<r.width;f++)for(let u=0;u<r.height;u++)s[u*r.width+f]===0&&h(f,u);function h(f,u){let d=0,g=0,p=r.getBitXY(f,u),x=p?++a:--o;if(a>32767||o<-32768)throw new Error("Too many regions of interest");for(l[0]=f,c[0]=u;d<=g;){let y=l[d&n],m=c[d&n];if(s[m*r.width+y]=x,y>0&&s[m*r.width+y-1]===0&&r.getBitXY(y-1,m)===p&&(g++,l[g&n]=y-1,c[g&n]=m,s[m*r.width+y-1]=-32768),m>0&&s[(m-1)*r.width+y]===0&&r.getBitXY(y,m-1)===p&&(g++,l[g&n]=y,c[g&n]=m-1,s[(m-1)*r.width+y]=-32768),y<r.width-1&&s[m*r.width+y+1]===0&&r.getBitXY(y+1,m)===p&&(g++,l[g&n]=y+1,c[g&n]=m,s[m*r.width+y+1]=-32768),m<r.height-1&&s[(m+1)*r.width+y]===0&&r.getBitXY(y,m+1)===p&&(g++,l[g&n]=y,c[g&n]=m+1,s[(m+1)*r.width+y]=-32768),e&&(y>0&&m>0&&s[(m-1)*r.width+y-1]===0&&r.getBitXY(y-1,m-1)===p&&(g++,l[g&n]=y-1,c[g&n]=m-1,s[(m-1)*r.width+y-1]=-32768),y<r.width-1&&m>0&&s[(m-1)*r.width+y+1]===0&&r.getBitXY(y+1,m-1)===p&&(g++,l[g&n]=y+1,c[g&n]=m-1,s[(m-1)*r.width+y+1]=-32768),y>0&&m<r.height-1&&s[(m+1)*r.width+y-1]===0&&r.getBitXY(y-1,m+1)===p&&(g++,l[g&n]=y-1,c[g&n]=m+1,s[(m+1)*r.width+y-1]=-32768),y<r.width-1&&m<r.height-1&&s[(m+1)*r.width+y+1]===0&&r.getBitXY(y+1,m+1)===p&&(g++,l[g&n]=y+1,c[g&n]=m+1,s[(m+1)*r.width+y+1]=-32768)),d++,g-d>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(r,s)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var e=this.nodes.get(t);return e||(e=new DisjointSetNode(t),this.nodes.set(t,e)),e}union(t,e){const n=this.find(t),s=this.find(e);n!==s&&(n.rank<s.rank?n.parent=s:n.rank>s.rank?s.parent=n:(s.parent=n,n.rank++))}find(t){for(var e=t;e.parent!==null;)e=e.parent;for(var n=t;n.parent!==null;){var s=n;n=n.parent,s.parent=e}return e}connected(t,e){return this.find(t)===this.find(e)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(r){this.value=r,this.parent=null,this.rank=0}const DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(r,t={}){const{allowCorners:e=!1}=t;let n=4;e&&(n=8);let s,a,o;if(n===8)s=direction8X,a=direction8Y,o=neighbours8;else if(n===4)s=direction4X,a=direction4Y,o=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const l=r.size,c=r.width,h=r.height,f=new Array(l),u=new Uint32Array(l),d=new DisjointSet$1;let g=1;for(let p=0;p<h;p++)for(let x=0;x<c;x++){const y=x+p*c;if(r.getBit(y)){let m=null;for(let A=0;A<o.length;A++){const b=x+s[A],_=p+a[A];if(b>=0&&_>=0&&b<c&&_<h){const M=b+_*c;let T=f[M];T?(o[A]=T,(!m||o[A].value<m.value)&&(m=o[A])):o[A]=null}}if(!m)f[y]=d.add(g++);else{f[y]=m;for(let A=0;A<o.length;A++)o[A]&&o[A]!==m&&d.union(m,o[A])}}}for(let p=0;p<h;p++)for(let x=0;x<c;x++){const y=x+p*c;r.getBit(y)&&(u[y]=d.find(f[y]).value)}return new RoiMap(r,u)}function fromMaxima(r={}){let{allowCorner:t=!0,onlyTop:e=!1,invert:n=!1}=r,s=this;s.checkProcessable("fromMaxima",{components:[1]});const a=1,o=2;let l=0,c=0,h=new Int16Array(s.size),f=new Int8Array(s.size),u=new Float32Array(s.size),d=1048575,g=new Uint16Array(d+1),p=new Uint16Array(d+1),x=0,y=0,m=new Uint16Array(d+1),A=new Uint16Array(d+1),b=0,_=0;for(M(s);x<y;){let E=g[x&d],S=p[x&d];D(E,S,o),x++}return new RoiMap(s,h);function M({maxima:E=!0}){for(let S=1;S<s.height-1;S++)for(let w=1;w<s.width-1;w++){let v=w+S*s.width;if(f[v]===0){let k=E?s.data[v]:-s.data[w+S*s.width];if(s.data[S*s.width+w-1]>k||s.data[S*s.width+w+1]>k||s.data[(S-1)*s.width+w]>k||s.data[(S+1)*s.width+w]>k||t&&(s.data[(S-1)*s.width+w-1]>k||s.data[(S-1)*s.width+w+1]>k||s.data[(S+1)*s.width+w-1]>k||s.data[(S+1)*s.width+w+1]>k))continue;h[v]=E?++l:--c,T(w,S)||(E?--l:++c)}}}function T(E,S){let w=y;b=0,_=1,m[0]=E,A[0]=S;let v=!0;for(;b<_;){let k=m[b&d],I=A[b&d];v&=D(k,I,a),b++}if(!v){for(let k=0;k<_;k++){let I=m[k&d],F=A[k&d]*s.width+I;h[F]=0}y=w}return v}function D(E,S,w){let v=h[S*s.width+E],k=s.data[S*s.width+E];for(let I=S-1;I<=S+1;I++)for(let L=E-1;L<=E+1;L++){let F=I*s.width+L;if(f[F]===0)switch(f[F]=1,u[F]=s.data[F]-k,w){case a:if(u[F]===0){if(L===0||I===0||L===s.width-1||I===s.height-1)return!1;h[F]=v,m[_&d]=L,A[_&d]=I,_++}else{if(u[F]>0)return!1;e||(h[F]=v,g[y&d]=L,p[y&d]=I,y++)}break;case o:u[F]<=0&&(h[F]=v,g[y&d]=L,p[y&d]=I,y++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(r,t={}){let e=new Shape(t),n=new Int16Array(this.size),s=0,a=e.getPoints();for(let o=0;o<r.length;o++){s++;let l=r[o][0],c=r[o][1];for(let h=0;h<a.length;h++){let f=a[h][0],u=a[h][1];l+f>=0&&c+u>=0&&l+f<this.width&&c+u<this.height&&(n[l+f+(c+u)*this.width]=s)}}return new RoiMap(this,n)}function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(r,t){(function(e){r.exports=e()})(function(){return function e(n,s,a){function o(h,f){if(!s[h]){if(!n[h]){var u=typeof commonjsRequire=="function"&&commonjsRequire;if(!f&&u)return u(h,!0);if(l)return l(h,!0);var d=new Error("Cannot find module '"+h+"'");throw d.code="MODULE_NOT_FOUND",d}var g=s[h]={exports:{}};n[h][0].call(g.exports,function(p){var x=n[h][1][p];return o(x||p)},g,g.exports,e,n,s,a)}return s[h].exports}for(var l=typeof commonjsRequire=="function"&&commonjsRequire,c=0;c<a.length;c++)o(a[c]);return o}({1:[function(e,n,s){var a,o,l,c,h,f=function(d,g){for(var p in g)u.call(g,p)&&(d[p]=g[p]);function x(){this.constructor=d}return x.prototype=g.prototype,d.prototype=new x,d.__super__=g.prototype,d},u={}.hasOwnProperty;a=e("./PriorityQueue/AbstractPriorityQueue"),o=e("./PriorityQueue/ArrayStrategy"),c=e("./PriorityQueue/BinaryHeapStrategy"),l=e("./PriorityQueue/BHeapStrategy"),h=function(d){f(g,d);function g(p){p||(p={}),p.strategy||(p.strategy=c),p.comparator||(p.comparator=function(x,y){return(x||0)-(y||0)}),g.__super__.constructor.call(this,p)}return g}(a),h.ArrayStrategy=o,h.BinaryHeapStrategy=c,h.BHeapStrategy=l,n.exports=h},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,n,s){n.exports=function(){function a(o){var l;if((o!=null?o.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((o!=null?o.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new o.strategy(o),this.length=(o!=null&&(l=o.initialValues)!=null?l.length:void 0)||0}return a.prototype.queue=function(o){this.length++,this.priv.queue(o)},a.prototype.dequeue=function(o){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},a.prototype.peek=function(o){if(!this.length)throw"Empty queue";return this.priv.peek()},a.prototype.clear=function(){return this.length=0,this.priv.clear()},a}()},{}],3:[function(e,n,s){var a;a=function(o,l,c){var h,f,u;for(f=0,h=o.length;f<h;)u=f+h>>>1,c(o[u],l)>=0?f=u+1:h=u;return f},n.exports=function(){function o(l){var c;this.options=l,this.comparator=this.options.comparator,this.data=((c=this.options.initialValues)!=null?c.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return o.prototype.queue=function(l){var c;c=a(this.data,l,this.comparator),this.data.splice(c,0,l)},o.prototype.dequeue=function(){return this.data.pop()},o.prototype.peek=function(){return this.data[this.data.length-1]},o.prototype.clear=function(){this.data.length=0},o}()},{}],4:[function(e,n,s){n.exports=function(){function a(o){var l,c,h,f,u,d,g,p;for(this.comparator=(o!=null?o.comparator:void 0)||function(x,y){return x-y},this.pageSize=(o!=null?o.pageSize:void 0)||512,this.length=0,g=0;1<<g<this.pageSize;)g+=1;if(1<<g!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=g,this._emptyMemoryPageTemplate=l=[],c=0,u=this.pageSize;0<=u?c<u:c>u;0<=u?++c:--c)l.push(null);if(this._memory=[],this._mask=this.pageSize-1,o.initialValues)for(d=o.initialValues,h=0,f=d.length;h<f;h++)p=d[h],this.queue(p)}return a.prototype.queue=function(o){this.length+=1,this._write(this.length,o),this._bubbleUp(this.length,o)},a.prototype.dequeue=function(){var o,l;return o=this._read(1),l=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,l),this._bubbleDown(1,l)),o},a.prototype.peek=function(){return this._read(1)},a.prototype.clear=function(){this.length=0,this._memory.length=0},a.prototype._write=function(o,l){var c;for(c=o>>this._shift;c>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[c][o&this._mask]=l},a.prototype._read=function(o){return this._memory[o>>this._shift][o&this._mask]},a.prototype._bubbleUp=function(o,l){var c,h,f,u;for(c=this.comparator;o>1&&(h=o&this._mask,o<this.pageSize||h>3?f=o&~this._mask|h>>1:h<2?(f=o-this.pageSize>>this._shift,f+=f&~(this._mask>>1),f|=this.pageSize>>1):f=o-2,u=this._read(f),!(c(u,l)<0));)this._write(f,l),this._write(o,u),o=f},a.prototype._bubbleDown=function(o,l){var c,h,f,u,d;for(d=this.comparator;o<this.length;)if(o>this._mask&&!(o&this._mask-1)?c=h=o+2:o&this.pageSize>>1?(c=(o&~this._mask)>>1,c|=o&this._mask>>1,c=c+1<<this._shift,h=c+1):(c=o+(o&this._mask),h=c+1),c!==h&&h<=this.length)if(f=this._read(c),u=this._read(h),d(f,l)<0&&d(f,u)<=0)this._write(c,l),this._write(o,f),o=c;else if(d(u,l)<0)this._write(h,l),this._write(o,u),o=h;else break;else if(c<=this.length)if(f=this._read(c),d(f,l)<0)this._write(c,l),this._write(o,f),o=c;else break;else break},a}()},{}],5:[function(e,n,s){n.exports=function(){function a(o){var l;this.comparator=(o!=null?o.comparator:void 0)||function(c,h){return c-h},this.length=0,this.data=((l=o.initialValues)!=null?l.slice(0):void 0)||[],this._heapify()}return a.prototype._heapify=function(){var o,l,c;if(this.data.length>0)for(o=l=1,c=this.data.length;1<=c?l<c:l>c;o=1<=c?++l:--l)this._bubbleUp(o)},a.prototype.queue=function(o){this.data.push(o),this._bubbleUp(this.data.length-1)},a.prototype.dequeue=function(){var o,l;return l=this.data[0],o=this.data.pop(),this.data.length>0&&(this.data[0]=o,this._bubbleDown(0)),l},a.prototype.peek=function(){return this.data[0]},a.prototype.clear=function(){this.length=0,this.data.length=0},a.prototype._bubbleUp=function(o){for(var l,c;o>0&&(l=o-1>>>1,this.comparator(this.data[o],this.data[l])<0);)c=this.data[l],this.data[l]=this.data[o],this.data[o]=c,o=l},a.prototype._bubbleDown=function(o){var l,c,h,f,u;for(l=this.data.length-1;c=(o<<1)+1,f=c+1,h=o,c<=l&&this.comparator(this.data[c],this.data[h])<0&&(h=c),f<=l&&this.comparator(this.data[f],this.data[h])<0&&(h=f),h!==o;)u=this.data[h],this.data[h]=this.data[o],this.data[o]=u,o=h},a}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports;const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(r={}){let{points:t,mask:e,image:n,fillMaxValue:s=this.maxValue,invert:a=!1}=r,o=n||this;o.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),a=!a,t||(t=o.getLocalMaxima({invert:a,mask:e}));let l=a?0:1,c=new Int16Array(o.size),h=o.width,f=o.height,u=new PriorityQueue({comparator:(d,g)=>d[2]-g[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let d=0;d<t.length;d++){let g=t[d][0]+t[d][1]*h;c[g]=d+1;let p=o.data[g];(a&&p<=s||!a&&p>=s)&&u.queue([t[d][0],t[d][1],p])}for(;u.length>0;){let d=u.dequeue(),g=d[0]+d[1]*h;for(let p=0;p<4;p++){let x=d[0]+dxs[p],y=d[1]+dys[p];if(x>=0&&y>=0&&x<h&&y<f){let m=x+y*h;if(!e||e.getBit(m)===l){let A=o.data[m];(a&&A<=s||!a&&A>=s)&&c[m]===0&&(c[m]=c[g],u.queue([d[0]+dxs[p],d[1]+dys[p],A]))}}}}return new RoiMap(o,c)}class RoiManager{constructor(t,e={}){this._image=t,this._options=e,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let e=Object.assign({},this._options,t),n=fromMaxima.call(this._image,t);this._layers[e.label]=new RoiLayer(n,e)}fromPoints(t,e={}){let n=Object.assign({},this._options,e),s=fromPoints.call(this._image,t,e);return this._layers[n.label]=new RoiLayer(s,n),this}putMap(t,e={}){let n=new RoiMap(this._image,t),s=Object.assign({},this._options,e);return this._layers[s.label]=new RoiLayer(n,s),this}fromWaterShed(t={}){let e=Object.assign({},this._options,t),n=fromWaterShed.call(this._image,t);this._layers[e.label]=new RoiLayer(n,e)}fromMask(t,e={}){let n=Object.assign({},this._options,e),s=fromMask.call(this._image,t,e);return this._layers[n.label]=new RoiLayer(s,n),this}fromMaskConnectedComponentLabelingAlgorithm(t,e={}){let n=Object.assign({},this._options,e),s=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,e);return this._layers[n.label]=new RoiLayer(s,n),this}getMap(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let e=this.getRois(t);if(e){let n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=e[s].id;return n}throw new Error("ROIs not found")}getRois(t={}){let{label:e=this._options.label,positive:n=!0,negative:s=!0,minSurface:a=0,maxSurface:o=Number.POSITIVE_INFINITY,minWidth:l=0,maxWidth:c=Number.POSITIVE_INFINITY,minHeight:h=0,maxHeight:f=Number.POSITIVE_INFINITY,minRatio:u=0,maxRatio:d=Number.POSITIVE_INFINITY}=t;if(!this._layers[e])throw new Error(`this Roi layer (${e}) does not exist`);const g=this._layers[e].roi,p=[];for(const x of g)(x.id<0&&s||x.id>0&&n)&&x.surface>=a&&x.surface<=o&&x.width>=l&&x.width<=c&&x.height>=h&&x.height<=f&&x.ratio>=u&&x.ratio<=d&&p.push(x);return p}getRoi(t,e={}){const{label:n=this._options.label}=e;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const s=this._layers[n].roi.find(a=>a.id===t);if(!s)throw new Error(`found no Roi with id ${t}`);return s}getMasks(t={}){let e=this.getRois(t),n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=e[s].getMask(t);return n}getAnalysisMasks(t={}){const{analysisProperty:e}=t;let n=`${e}Mask`,s=this.getRois(t);return s.length===0||!s[0][n]?[]:s.map(a=>a[n])}getData(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap.data}paint(t={}){let{labelProperty:e,analysisProperty:n}=t;this._painted||(this._painted=this._image.rgba8());let s=this.getMasks(t);if(e){const a=this.getRois(t);t.labels=a.map(h=>deepValue(h,e));const o=Math.max(...t.labels);let l=!1,c=!1;if(e.includes("surface")?l=!0:/(?:perimeter|min|max|external|width|height|length)/.test(e)&&(c=!0),isFinite(o)){let h="";if(t.unit!=="pixel"&&t.pixelSize&&(c||l)){h=l?`${t.unit}^2`:t.unit;let f=l?"m^2":"m",u=l?t.pixelSize**2:t.pixelSize;const d=Qty.swiftConverter(f,h);t.labels=t.labels.map(g=>d(u*g))}o>50?t.labels=t.labels.map(f=>Math.round(f)+h):o>10?t.labels=t.labels.map(f=>f.toFixed(1)+h):t.labels=t.labels.map(f=>f.toFixed(2)+h)}t.labelsPosition=a.map(h=>[h.meanX,h.meanY])}if(this._painted.paintMasks(s,t),n){let a=this.getAnalysisMasks(t);this._painted.paintMasks(a,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let e=new Image(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(t);for(let s=0;s<n.length;s++){let a=n[s];for(let o=0;o<a.width;o++)for(let l=0;l<a.height;l++)a.getBitXY(o,l)&&e.setBitXY(o+a.position[0],l+a.position[1])}return e}resetPainted(t={}){const{image:e}=t;e?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(t={}){const e=this.getMap(t);return e.mergeRoi(t),this.putMap(e.data,t),this}mergeRois(t,e={}){if(!Array.isArray(t)||t.some(s=>!Number.isInteger(s)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(s=>this.getRoi(s));const n=this.getMap(e);return n.mergeRois(t),this.putMap(n.data,e),this}findCorrespondingRoi(t,e={}){let n=this.getRois(e),s=[];for(let a=0;a<n.length;a++){let o=n[a],l=o.minX,c=o.minY,h=o.points,f=Math.sign(o.id),u=correspondingRoisInformation(l,c,h,t,f);s.push(u)}return s}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function correspondingRoisInformation(r,t,e,n,s){let a={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let o=0;o<e.length;o++){let l=e[o],c=l[0],h=l[1],f=c+r+(h+t)*n.width,u=n.data[f];(u>0||u<0)&&(a.id.includes(u)?a.surface[a.id.indexOf(u)]+=1:(a.id.push(u),a.surface.push(1)))}for(let o=0;o<a.id.length;o++)Math.sign(a.id[o])===s?a.same+=a.surface[o]:a.opposite+=a.surface[o],a.roiSurfaceCovered[o]=a.surface[o]/e.length;return a.total=a.opposite+a.same,a}const objectToString=Object.prototype.toString;class Image{constructor(t,e,n,s){if(arguments.length===1?(s=t,{width:t,height:e,data:n}=s):n&&!n.length&&(s=n,{data:n}=s),t===void 0&&(t=1),e===void 0&&(e=1),s===void 0&&(s={}),typeof s!="object"||s===null)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(e)||e<=0)throw new RangeError("height must be a positive integer");const{kind:a=RGBA}=s;if(typeof a!="string")throw new TypeError("kind must be a string");const o=getKind(a),l=Object.assign({},s);for(const x in o)l[x]===void 0&&(l[x]=o[x]);verifyKindDefinition(l);const{components:c,bitDepth:h,colorModel:f}=l,u=l.alpha+0,d=t*e,g=c+u,p=h===32?Number.MAX_VALUE:2**h-1;if(n===void 0)n=createPixelArray(d,c,u,g,h,p);else{const x=getTheoreticalPixelArraySize(d,g,h);if(n.length!==x)throw new RangeError(`incorrect data size: ${n.length}. Should be ${x}`)}this.width=t,this.height=e,this.data=n,this.size=d,this.components=c,this.alpha=u,this.bitDepth=h,this.maxValue=p,this.colorModel=f,this.channels=g,this.meta=s.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:s.parent||null}),this.position=s.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return objectToString.call(t)==="[object IJSImage]"}static fromCanvas(t){const n=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Image(n.width,n.height,n.data)}static createFrom(t,e){const n=getImageParameters(t);return Object.assign(n,{parent:t,position:[0,0]},e),new Image(n)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new Image(this.width,this.height,t,this)}apply(t){for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++){let s=(e*this.width+n)*this.channels;t.call(this,s)}}}setValueMethods(Image);setBitMethods(Image);setExportMethods(Image);Image.prototype.checkProcessable=checkProcessable;Image.prototype.getRGBAData=getRGBAData;Image.load=load;Image.extendMethod=extendMethod;Image.extendProperty=extendProperty;extend$1(Image);var workerTemplate$1={},worker$1=function(){self.window=self;function r(){this._listeners={}}r.prototype.on=function(e,n){if(this._listeners[e])throw new RangeError("there is already a listener for "+e);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[e]=n},r.prototype._send=function(e,n,s){s===void 0?s=[]:Array.isArray(s)||(s=[s]),self.postMessage({id:e,data:n},s)},r.prototype._trigger=function(e,n){if(!this._listeners[e])throw new Error("event "+e+" is not defined");this._listeners[e].apply(null,n)};var t=new r;self.onmessage=function(e){switch(e.data.action){case"exec":e.data.args.unshift(function(n,s){t._send(e.data.id,n,s)}),t._trigger(e.data.event,e.data.args);break;case"ping":t._send(e.data.id,"pong");break;default:throw new Error("unexpected action: "+e.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function r(t,e){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(e)+`);
`,"(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(r,t){if(typeof r!="string"&&typeof r!="function")throw new TypeError("func argument must be a function");if(t===void 0&&(t={}),typeof t!="object"||t===null)throw new TypeError("options argument must be an object");this._workerCode=r.toString(),t.maxWorkers===void 0||t.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):t.maxWorkers>0?this._numWorkers=Math.min(t.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var e=t.deps;typeof e=="string"&&(e=[e]),Array.isArray(e)||(e=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(e)}WorkerManager.prototype._init=function(r){for(var t=workerTemplate.newWorkerURL(this._workerCode,r),e=0;e<this._numWorkers;e++){var n=new Worker(t);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=e,this._workers.set(n,null)}URL.revokeObjectURL(t)};WorkerManager.prototype._onerror=function(r,t){if(!this._terminated){this._working--,r.running=!1;var e=this._workers.get(r);e&&e[1](t.message),this._workers.set(r,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(r,t){if(!this._terminated){this._working--,r.running=!1;var e=this._workers.get(r);e&&e[0](t.data.data),this._workers.set(r,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var r of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!r.running)for(var t=0;t<this._waiting.length;t++){var e=this._waiting[t];if(!(typeof e[4]=="number"&&e[4]!==r.id)){this._waiting.splice(t,1),r.postMessage({action:"exec",event:e[0],args:e[1]},e[2]),r.running=!0,r.time=Date.now(),this._workers.set(r,e[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var r of this._workers)r[0].terminate(),r[1]&&r[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(r,t){if(this._terminated)throw new Error("Cannot post (terminated)");var e=[];for(var n of this._workers.keys())e.push(this.post(r,t,[],n.id));return Promise.all(e)};WorkerManager.prototype.post=function(r,t,e,n){t===void 0&&(t=[]),e===void 0&&(e=[]),Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);var s=this;return new Promise(function(a,o){if(s._terminated)throw new Error("Cannot post (terminated)");s._waiting.push([r,t,e,[a,o],n]),s._exec()})};var src$1=WorkerManager;const WorkerManager$1=getDefaultExportFromCjs(src$1),defaultOptions$4={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(r,t,e){t=Object.assign({},defaultOptions$4,t);const n=this.manager;return Array.isArray(r)?Promise.all(r.map(function(s){const a=runOnce(n,s,t);return typeof e=="function"&&a.then(e),a})):runOnce(n,r,t)}function runOnce(r,t,e){return r.post("data",[t,e]).then(function(n){for(let s in n)n[s]=new Image(n[s]);return n})}function work(){worker.on("data",function(r,t,e){t=new IJS(t);const n={},s=[],a=t.grey(),o=a.sobelFilter();g("sobel",o);const l=o.level().mask({threshold:e.threshold});g("mask",l);const c=o.getRoiManager();c.fromMask(l);const h=c.getMask(e.roi);g("realMask",h);const f=a.getPixelsGrid({sampling:e.sampling,mask:h}),u=t.getBackground(f.xyS,f.zS,e.regression);g("background",u);const d=t.subtract(u);n.result=d,s.push(d.data.buffer),r(n,s);function g(p,x){e.include.includes(p)&&(n[p]=x,s.push(x.data.buffer))}})}const background={run,work};function extend(r){r.extendMethod("background",background)}let Worker$1=class pt{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if(typeof t!="string")throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,e){let n,s,a={};function o(...l){return n||(this.checkUrl(),s=this.url,n=new WorkerManager$1(e.work,{deps:s}),a.manager=n),e.run.call(a,...l)}o.reset=function(){n&&(n.terminate(),n=new WorkerManager$1(e.work,{deps:s}),a.manager=n)},pt.prototype[t]=o}};extend(Worker$1);var runtime={exports:{}};(function(r){var t=function(e){var n=Object.prototype,s=n.hasOwnProperty,a=Object.defineProperty||function(P,C,Y){P[C]=Y.value},o,l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",h=l.asyncIterator||"@@asyncIterator",f=l.toStringTag||"@@toStringTag";function u(P,C,Y){return Object.defineProperty(P,C,{value:Y,enumerable:!0,configurable:!0,writable:!0}),P[C]}try{u({},"")}catch{u=function(C,Y,j){return C[Y]=j}}function d(P,C,Y,j){var R=C&&C.prototype instanceof b?C:b,N=Object.create(R.prototype),U=new Z(j||[]);return a(N,"_invoke",{value:k(P,Y,U)}),N}e.wrap=d;function g(P,C,Y){try{return{type:"normal",arg:P.call(C,Y)}}catch(j){return{type:"throw",arg:j}}}var p="suspendedStart",x="suspendedYield",y="executing",m="completed",A={};function b(){}function _(){}function M(){}var T={};u(T,c,function(){return this});var D=Object.getPrototypeOf,E=D&&D(D(W([])));E&&E!==n&&s.call(E,c)&&(T=E);var S=M.prototype=b.prototype=Object.create(T);_.prototype=M,a(S,"constructor",{value:M,configurable:!0}),a(M,"constructor",{value:_,configurable:!0}),_.displayName=u(M,f,"GeneratorFunction");function w(P){["next","throw","return"].forEach(function(C){u(P,C,function(Y){return this._invoke(C,Y)})})}e.isGeneratorFunction=function(P){var C=typeof P=="function"&&P.constructor;return C?C===_||(C.displayName||C.name)==="GeneratorFunction":!1},e.mark=function(P){return Object.setPrototypeOf?Object.setPrototypeOf(P,M):(P.__proto__=M,u(P,f,"GeneratorFunction")),P.prototype=Object.create(S),P},e.awrap=function(P){return{__await:P}};function v(P,C){function Y(N,U,z,H){var ee=g(P[N],P,U);if(ee.type==="throw")H(ee.arg);else{var se=ee.arg,ae=se.value;return ae&&typeof ae=="object"&&s.call(ae,"__await")?C.resolve(ae.__await).then(function(he){Y("next",he,z,H)},function(he){Y("throw",he,z,H)}):C.resolve(ae).then(function(he){se.value=he,z(se)},function(he){return Y("throw",he,z,H)})}}var j;function R(N,U){function z(){return new C(function(H,ee){Y(N,U,H,ee)})}return j=j?j.then(z,z):z()}a(this,"_invoke",{value:R})}w(v.prototype),u(v.prototype,h,function(){return this}),e.AsyncIterator=v,e.async=function(P,C,Y,j,R){R===void 0&&(R=Promise);var N=new v(d(P,C,Y,j),R);return e.isGeneratorFunction(C)?N:N.next().then(function(U){return U.done?U.value:N.next()})};function k(P,C,Y){var j=p;return function(N,U){if(j===y)throw new Error("Generator is already running");if(j===m){if(N==="throw")throw U;return G()}for(Y.method=N,Y.arg=U;;){var z=Y.delegate;if(z){var H=I(z,Y);if(H){if(H===A)continue;return H}}if(Y.method==="next")Y.sent=Y._sent=Y.arg;else if(Y.method==="throw"){if(j===p)throw j=m,Y.arg;Y.dispatchException(Y.arg)}else Y.method==="return"&&Y.abrupt("return",Y.arg);j=y;var ee=g(P,C,Y);if(ee.type==="normal"){if(j=Y.done?m:x,ee.arg===A)continue;return{value:ee.arg,done:Y.done}}else ee.type==="throw"&&(j=m,Y.method="throw",Y.arg=ee.arg)}}}function I(P,C){var Y=C.method,j=P.iterator[Y];if(j===o)return C.delegate=null,Y==="throw"&&P.iterator.return&&(C.method="return",C.arg=o,I(P,C),C.method==="throw")||Y!=="return"&&(C.method="throw",C.arg=new TypeError("The iterator does not provide a '"+Y+"' method")),A;var R=g(j,P.iterator,C.arg);if(R.type==="throw")return C.method="throw",C.arg=R.arg,C.delegate=null,A;var N=R.arg;if(!N)return C.method="throw",C.arg=new TypeError("iterator result is not an object"),C.delegate=null,A;if(N.done)C[P.resultName]=N.value,C.next=P.nextLoc,C.method!=="return"&&(C.method="next",C.arg=o);else return N;return C.delegate=null,A}w(S),u(S,f,"Generator"),u(S,c,function(){return this}),u(S,"toString",function(){return"[object Generator]"});function L(P){var C={tryLoc:P[0]};1 in P&&(C.catchLoc=P[1]),2 in P&&(C.finallyLoc=P[2],C.afterLoc=P[3]),this.tryEntries.push(C)}function F(P){var C=P.completion||{};C.type="normal",delete C.arg,P.completion=C}function Z(P){this.tryEntries=[{tryLoc:"root"}],P.forEach(L,this),this.reset(!0)}e.keys=function(P){var C=Object(P),Y=[];for(var j in C)Y.push(j);return Y.reverse(),function R(){for(;Y.length;){var N=Y.pop();if(N in C)return R.value=N,R.done=!1,R}return R.done=!0,R}};function W(P){if(P){var C=P[c];if(C)return C.call(P);if(typeof P.next=="function")return P;if(!isNaN(P.length)){var Y=-1,j=function R(){for(;++Y<P.length;)if(s.call(P,Y))return R.value=P[Y],R.done=!1,R;return R.value=o,R.done=!0,R};return j.next=j}}return{next:G}}e.values=W;function G(){return{value:o,done:!0}}return Z.prototype={constructor:Z,reset:function(P){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(F),!P)for(var C in this)C.charAt(0)==="t"&&s.call(this,C)&&!isNaN(+C.slice(1))&&(this[C]=o)},stop:function(){this.done=!0;var P=this.tryEntries[0],C=P.completion;if(C.type==="throw")throw C.arg;return this.rval},dispatchException:function(P){if(this.done)throw P;var C=this;function Y(H,ee){return N.type="throw",N.arg=P,C.next=H,ee&&(C.method="next",C.arg=o),!!ee}for(var j=this.tryEntries.length-1;j>=0;--j){var R=this.tryEntries[j],N=R.completion;if(R.tryLoc==="root")return Y("end");if(R.tryLoc<=this.prev){var U=s.call(R,"catchLoc"),z=s.call(R,"finallyLoc");if(U&&z){if(this.prev<R.catchLoc)return Y(R.catchLoc,!0);if(this.prev<R.finallyLoc)return Y(R.finallyLoc)}else if(U){if(this.prev<R.catchLoc)return Y(R.catchLoc,!0)}else if(z){if(this.prev<R.finallyLoc)return Y(R.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(P,C){for(var Y=this.tryEntries.length-1;Y>=0;--Y){var j=this.tryEntries[Y];if(j.tryLoc<=this.prev&&s.call(j,"finallyLoc")&&this.prev<j.finallyLoc){var R=j;break}}R&&(P==="break"||P==="continue")&&R.tryLoc<=C&&C<=R.finallyLoc&&(R=null);var N=R?R.completion:{};return N.type=P,N.arg=C,R?(this.method="next",this.next=R.finallyLoc,A):this.complete(N)},complete:function(P,C){if(P.type==="throw")throw P.arg;return P.type==="break"||P.type==="continue"?this.next=P.arg:P.type==="return"?(this.rval=this.arg=P.arg,this.method="return",this.next="end"):P.type==="normal"&&C&&(this.next=C),A},finish:function(P){for(var C=this.tryEntries.length-1;C>=0;--C){var Y=this.tryEntries[C];if(Y.finallyLoc===P)return this.complete(Y.completion,Y.afterLoc),F(Y),A}},catch:function(P){for(var C=this.tryEntries.length-1;C>=0;--C){var Y=this.tryEntries[C];if(Y.tryLoc===P){var j=Y.completion;if(j.type==="throw"){var R=j.arg;F(Y)}return R}}throw new Error("illegal catch attempt")},delegateYield:function(P,C,Y){return this.delegate={iterator:W(P),resultName:C,nextLoc:Y},this.method==="next"&&(this.arg=o),A}},e}(r.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(runtime);var getId$3=(r,t)=>`${r}-${t}-${Math.random().toString(16).slice(3,8)}`;const getId$2=getId$3;let jobCounter=0;var createJob$2=({id:r,action:t,payload:e={}})=>{let n=r;return typeof n>"u"&&(n=getId$2("Job",jobCounter),jobCounter+=1),{id:n,action:t,payload:e}},log$2={};let logging=!1;log$2.logging=logging;log$2.setLogging=r=>{logging=r};log$2.log=(...r)=>logging?console.log.apply(void 0,r):null;const createJob$1=createJob$2,{log:log$1}=log$2,getId$1=getId$3;let schedulerCounter=0;var createScheduler$1=()=>{const r=getId$1("Scheduler",schedulerCounter),t={},e={};let n=[];schedulerCounter+=1;const s=()=>n.length,a=()=>Object.keys(t).length,o=()=>{if(n.length!==0){const u=Object.keys(t);for(let d=0;d<u.length;d+=1)if(typeof e[u[d]]>"u"){n[0](t[u[d]]);break}}},l=(u,d)=>new Promise((g,p)=>{const x=createJob$1({action:u,payload:d});n.push(async y=>{n.shift(),e[y.id]=x;try{g(await y[u].apply(void 0,[...d,x.id]))}catch(m){p(m)}finally{delete e[y.id],o()}}),log$1(`[${r}]: Add ${x.id} to JobQueue`),log$1(`[${r}]: JobQueue length=${n.length}`),o()});return{addWorker:u=>(t[u.id]=u,log$1(`[${r}]: Add ${u.id}`),log$1(`[${r}]: Number of workers=${a()}`),o(),u.id),addJob:async(u,...d)=>{if(a()===0)throw Error(`[${r}]: You need to have at least one worker before adding jobs`);return l(u,d)},terminate:async()=>{Object.keys(t).forEach(async u=>{await t[u].terminate()}),n=[]},getQueueLen:s,getNumWorkers:a}};function isElectron$1(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var isElectron_1=isElectron$1;const isElectron=isElectron_1;var getEnvironment=r=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":isElectron()?t.type="electron":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof commonjsRequire=="function"&&(t.type="node"),typeof r>"u"?t:t[r]};const isBrowser=getEnvironment("type")==="browser",resolveURL=isBrowser?r=>new URL(r,window.location.href).href:r=>r;var resolvePaths$1=r=>{const t={...r};return["corePath","workerPath","langPath"].forEach(e=>{r[e]&&(t[e]=resolveURL(t[e]))}),t},circularize$1=r=>{const t=[],e=[],n=[],s=[],a=[];return r.blocks&&r.blocks.forEach(o=>{o.paragraphs.forEach(l=>{l.lines.forEach(c=>{c.words.forEach(h=>{h.symbols.forEach(f=>{a.push({...f,page:r,block:o,paragraph:l,line:c,word:h})}),s.push({...h,page:r,block:o,paragraph:l,line:c})}),n.push({...c,page:r,block:o,paragraph:l})}),e.push({...l,page:r,block:o})}),t.push({...o,page:r})}),{...r,blocks:t,paragraphs:e,lines:n,words:s,symbols:a}},OEM$2={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const name="tesseract.js",version$1="5.0.3",description="Pure Javascript Multilingual OCR",main="src/index.js",types="src/index.d.ts",unpkg="dist/tesseract.min.js",jsdelivr="dist/tesseract.min.js",scripts={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs","profile:tesseract":"webpack-bundle-analyzer dist/tesseract-stats.json","profile:worker":"webpack-bundle-analyzer dist/worker-stats.json",prepublishOnly:"npm run build",wait:"rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:* test:node:all","test:node":"nyc mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser-tpl":"mocha-headless-chrome -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:detect":"npm run test:browser-tpl -- -f ./tests/detect.test.html","test:browser:recognize":"npm run test:browser-tpl -- -f ./tests/recognize.test.html","test:browser:scheduler":"npm run test:browser-tpl -- -f ./tests/scheduler.test.html","test:browser:FS":"npm run test:browser-tpl -- -f ./tests/FS.test.html",lint:"eslint src","lint:fix":"eslint --fix src",postinstall:"opencollective-postinstall || true"},browser$1={"./src/worker/node/index.js":"./src/worker/browser/index.js"},author="",contributors=["jeromewu"],license="Apache-2.0",devDependencies={"@babel/core":"^7.21.4","@babel/eslint-parser":"^7.21.3","@babel/preset-env":"^7.21.4","@rollup/plugin-commonjs":"^24.1.0",acorn:"^8.8.2","babel-loader":"^9.1.2",buffer:"^6.0.3",cors:"^2.8.5",eslint:"^7.32.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.27.5","expect.js":"^0.3.1",express:"^4.18.2",mocha:"^10.2.0","mocha-headless-chrome":"^4.0.0","npm-run-all":"^4.1.5",nyc:"^15.1.0",rimraf:"^5.0.0",rollup:"^3.20.7","wait-on":"^7.0.1",webpack:"^5.79.0","webpack-bundle-analyzer":"^4.8.0","webpack-cli":"^5.0.1","webpack-dev-middleware":"^6.0.2","rollup-plugin-sourcemaps":"^0.6.3"},dependencies={"bmp-js":"^0.1.0","idb-keyval":"^6.2.0","is-electron":"^2.2.2","is-url":"^1.2.4","node-fetch":"^2.6.9","opencollective-postinstall":"^2.0.3","regenerator-runtime":"^0.13.3","tesseract.js-core":"^5.0.0","wasm-feature-detect":"^1.2.11",zlibjs:"^0.3.1"},overrides={"@rollup/pluginutils":"^5.0.2"},repository={type:"git",url:"https://github.com/naptha/tesseract.js.git"},bugs={url:"https://github.com/naptha/tesseract.js/issues"},homepage="https://github.com/naptha/tesseract.js",collective={type:"opencollective",url:"https://opencollective.com/tesseractjs"},require$$0={name,version:version$1,description,main,types,unpkg,jsdelivr,scripts,browser:browser$1,author,contributors,license,devDependencies,dependencies,overrides,repository,bugs,homepage,collective};var defaultOptions$3={workerBlobURL:!0,logger:()=>{}};const version=require$$0.version,defaultOptions$2=defaultOptions$3;var defaultOptions_1={...defaultOptions$2,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${version}/dist/worker.min.js`},spawnWorker$2=({workerPath:r,workerBlobURL:t})=>{let e;if(Blob&&URL&&t){const n=new Blob([`importScripts("${r}");`],{type:"application/javascript"});e=new Worker(URL.createObjectURL(n))}else e=new Worker(r);return e},terminateWorker$2=r=>{r.terminate()},onMessage$2=(r,t)=>{r.onmessage=({data:e})=>{t(e)}},send$2=async(r,t)=>{r.postMessage(t)};const readFromBlobOrFile=r=>new Promise((t,e)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=({target:{error:{code:s}}})=>{e(Error(`File could not be read! Code=${s}`))},n.readAsArrayBuffer(r)}),loadImage$2=async r=>{let t=r;if(typeof r>"u")return"undefined";if(typeof r=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(r)?t=atob(r.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(r)).arrayBuffer();else if(typeof HTMLElement<"u"&&r instanceof HTMLElement)r.tagName==="IMG"&&(t=await loadImage$2(r.src)),r.tagName==="VIDEO"&&(t=await loadImage$2(r.poster)),r.tagName==="CANVAS"&&await new Promise(e=>{r.toBlob(async n=>{t=await readFromBlobOrFile(n),e()})});else if(typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas){const e=await r.convertToBlob();t=await readFromBlobOrFile(e)}else(r instanceof File||r instanceof Blob)&&(t=await readFromBlobOrFile(r));return new Uint8Array(t)};var loadImage_1=loadImage$2;const defaultOptions$1=defaultOptions_1,spawnWorker$1=spawnWorker$2,terminateWorker$1=terminateWorker$2,onMessage$1=onMessage$2,send$1=send$2,loadImage$1=loadImage_1;var browser={defaultOptions:defaultOptions$1,spawnWorker:spawnWorker$1,terminateWorker:terminateWorker$1,onMessage:onMessage$1,send:send$1,loadImage:loadImage$1};const resolvePaths=resolvePaths$1,circularize=circularize$1,createJob=createJob$2,{log}=log$2,getId=getId$3,OEM$1=OEM$2,{defaultOptions,spawnWorker,terminateWorker,onMessage,loadImage,send}=browser;let workerCounter=0;var createWorker$2=async(r="eng",t=OEM$1.LSTM_ONLY,e={},n={})=>{const s=getId("Worker",workerCounter),{logger:a,errorHandler:o,...l}=resolvePaths({...defaultOptions,...e}),c={},h={},f=typeof r=="string"?r.split("+"):r;let u=t,d=n;const g=[OEM$1.DEFAULT,OEM$1.LSTM_ONLY].includes(t)&&!l.legacyCore;let p,x;const y=new Promise((R,N)=>{x=R,p=N}),m=R=>{p(R.message)};let A=spawnWorker(l);A.onerror=m,workerCounter+=1;const b=(R,N)=>{c[R]=N},_=(R,N)=>{h[R]=N},M=({id:R,action:N,payload:U})=>new Promise((z,H)=>{log(`[${s}]: Start ${R}, action=${N}`),b(N,z),_(N,H),send(A,{workerId:s,jobId:R,action:N,payload:U})}),T=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),D=R=>M(createJob({id:R,action:"load",payload:{options:{lstmOnly:g,corePath:l.corePath,logging:l.logging}}})),E=(R,N,U)=>M(createJob({id:U,action:"FS",payload:{method:"writeFile",args:[R,N]}})),S=(R,N)=>M(createJob({id:N,action:"FS",payload:{method:"readFile",args:[R,{encoding:"utf8"}]}})),w=(R,N)=>M(createJob({id:N,action:"FS",payload:{method:"unlink",args:[R]}})),v=(R,N,U)=>M(createJob({id:U,action:"FS",payload:{method:R,args:N}})),k=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),I=(R,N)=>M(createJob({id:N,action:"loadLanguage",payload:{langs:R,options:{langPath:l.langPath,dataPath:l.dataPath,cachePath:l.cachePath,cacheMethod:l.cacheMethod,gzip:l.gzip,lstmOnly:[OEM$1.LSTM_ONLY,OEM$1.TESSERACT_LSTM_COMBINED].includes(u)&&!l.legacyLang}}})),L=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),F=(R,N,U,z)=>M(createJob({id:z,action:"initialize",payload:{langs:R,oem:N,config:U}})),Z=(R="eng",N,U,z)=>{if(g&&[OEM$1.TESSERACT_ONLY,OEM$1.TESSERACT_LSTM_COMBINED].includes(N))throw Error("Legacy model requested but code missing.");const H=N||u;u=H;const ee=U||d;d=ee;const ae=(typeof R=="string"?R.split("+"):R).filter(he=>!f.includes(he));return f.push(...ae),ae.length>0?I(ae,z).then(()=>F(R,H,ee,z)):F(R,H,ee,z)},W=(R={},N)=>M(createJob({id:N,action:"setParameters",payload:{params:R}})),G=async(R,N={},U={blocks:!0,text:!0,hocr:!0,tsv:!0},z)=>M(createJob({id:z,action:"recognize",payload:{image:await loadImage(R),options:N,output:U}})),P=(R="Tesseract OCR Result",N=!1,U)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),M(createJob({id:U,action:"getPDF",payload:{title:R,textonly:N}}))),C=async(R,N)=>{if(g)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return M(createJob({id:N,action:"detect",payload:{image:await loadImage(R)}}))},Y=async()=>(A!==null&&(terminateWorker(A),A=null),Promise.resolve());onMessage(A,({workerId:R,jobId:N,status:U,action:z,data:H})=>{if(U==="resolve"){log(`[${R}]: Complete ${N}`);let ee=H;z==="recognize"?ee=circularize(H):z==="getPDF"&&(ee=Array.from({...H,length:Object.keys(H).length})),c[z]({jobId:N,data:ee})}else if(U==="reject")if(h[z](H),z==="load"&&p(H),o)o(H);else throw Error(H);else U==="progress"&&a({...H,userJobId:N})});const j={id:s,worker:A,setResolve:b,setReject:_,load:T,writeText:E,readText:S,removeFile:w,FS:v,loadLanguage:k,initialize:L,reinitialize:Z,setParameters:W,recognize:G,getPDF:P,detect:C,terminate:Y};return D().then(()=>I(r)).then(()=>F(r,t,n)).then(()=>x(j)).catch(()=>{}),y};const createWorker$1=createWorker$2,recognize=async(r,t,e)=>{const n=await createWorker$1(t,1,e);return n.recognize(r).finally(async()=>{await n.terminate()})},detect=async(r,t)=>{const e=await createWorker$1("osd",0,t);return e.detect(r).finally(async()=>{await e.terminate()})};var Tesseract$1={recognize,detect},languages$1={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},PSM$1={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const createScheduler=createScheduler$1,createWorker=createWorker$2,Tesseract=Tesseract$1,languages=languages$1,OEM=OEM$2,PSM=PSM$1,{setLogging}=log$2;var src={languages,OEM,PSM,createScheduler,createWorker,setLogging,...Tesseract};const _hoisted_1$1=["data-tip"],_hoisted_2$1={class:"rounded-md"},_hoisted_3$1={class:"avatar relative flex items-center justify-center"},_hoisted_4$1={class:"w-16 rounded"},_hoisted_5$1=["src","alt"],_hoisted_6$1={class:"flex items-center justify-center h-full"},_sfc_main$1={__name:"TrackerArcanistIcon",props:{arcanist:{type:Object,required:!0},pity:{type:Number,required:!0}},setup(r){const t=e=>`images/arcanists/icon/${e}.png`;return(e,n)=>(openBlock(),createElementBlock("div",{class:"tooltip","data-tip":e.$t(r.arcanist.Name)},[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[createBaseVNode("img",{src:t(r.arcanist.Id),alt:r.arcanist.Name},null,8,_hoisted_5$1)]),createBaseVNode("div",{class:normalizeClass(["absolute text-white font-bold w-8 h-6 -right-2 -bottom-2 rounded-md text-sm opacity-90",{"bg-success":r.pity<40,"bg-warning":r.pity>=40&&r.pity<60,"bg-error":r.pity>=60}])},[createBaseVNode("div",_hoisted_6$1,toDisplayString(r.pity),1)],2)])])],8,_hoisted_1$1))}},_withScopeId=r=>(pushScopeId("data-v-ae10cccf"),r=r(),popScopeId(),r),_hoisted_1={class:"responsive-spacer"},_hoisted_2={class:"text-2xl text-white font-bold mb-4 lg:mb-6"},_hoisted_3={class:"text-info text-sm"},_hoisted_4={class:"flex justify-between"},_hoisted_5={class:"space-x-3"},_hoisted_6=["disabled"],_hoisted_7={class:"btn btn-ghost custom-gradient-button btn-sm text-white",onclick:"tutorial.showModal()"},_hoisted_8={onclick:"resetTracker.showModal()",class:"btn btn-ghost custom-gradient-button btn-sm text-white"},_hoisted_9={id:"tutorial",class:"modal"},_hoisted_10={class:"modal-box custom-gradient-gray-blue custom-border hidden-scrollbar"},_hoisted_11=_withScopeId(()=>createBaseVNode("form",{method:"dialog"},[createBaseVNode("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2 text-white"},"✕")],-1)),_hoisted_12={class:"font-bold text-lg text-info"},_hoisted_13={class:"py-4 text-white"},_hoisted_14={href:"https://youtu.be/CNsZ4rGWtyY",target:"_blank",class:"text-blue-500 hover:text-blue-700"},_hoisted_15={class:"text-white"},_hoisted_16={class:"text-white"},_hoisted_17={class:"text-error"},_hoisted_18={class:"text-white"},_hoisted_19={class:"text-white"},_hoisted_20={class:"font-bold text-lg pt-4 text-info"},_hoisted_21={class:"text-white"},_hoisted_22={class:"text-error"},_hoisted_23={class:"text-white"},_hoisted_24={class:"text-error"},_hoisted_25={class:"text-white"},_hoisted_26={class:"text-error"},_hoisted_27={class:"text-error"},_hoisted_28=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star text-yellow-100"},null,-1)),_hoisted_29={class:"text-white"},_hoisted_30={href:"https://i.imgur.com/NgspD1g.png",target:"_blank",class:"text-blue-500 hover:text-blue-700"},_hoisted_31={class:"font-bold text-lg pt-4 text-info"},_hoisted_32={class:"text-white"},_hoisted_33=_withScopeId(()=>createBaseVNode("form",{method:"dialog",class:"modal-backdrop"},[createBaseVNode("button",null,"close")],-1)),_hoisted_34={id:"resetTracker",class:"modal"},_hoisted_35={class:"modal-box custom-gradient-gray-blue flex flex-col justify-center items-center"},_hoisted_36=_withScopeId(()=>createBaseVNode("form",{method:"dialog"},[createBaseVNode("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2 text-white"},"✕")],-1)),_hoisted_37={class:"pb-4 text-white text-center"},_hoisted_38={class:"pb-4 text-white text-center"},_hoisted_39=_withScopeId(()=>createBaseVNode("form",{method:"dialog",class:"modal-backdrop"},[createBaseVNode("button",null,"close")],-1)),_hoisted_40={class:"p-3"},_hoisted_41={class:"text-white text-2xl text-center fa-solid fa-spinner fa-spin-pulse"},_hoisted_42={class:"text-white text-base pl-1"},_hoisted_43={class:"text-info"},_hoisted_44={class:"text-info"},_hoisted_45={class:"text-white font-bold text-xl text-center pt-4"},_hoisted_46={class:"flex flex-col text-white p-4 gap-2 max-w-sm mx-auto"},_hoisted_47={class:"flex justify-between"},_hoisted_48={class:"text"},_hoisted_49={class:"number"},_hoisted_50={class:"flex justify-between"},_hoisted_51={class:"text"},_hoisted_52=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star text-orange-300"},null,-1)),_hoisted_53={class:"number"},_hoisted_54={class:"flex justify-between"},_hoisted_55={class:"text"},_hoisted_56=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star text-yellow-100"},null,-1)),_hoisted_57={class:"number"},_hoisted_58={class:"flex justify-between"},_hoisted_59={class:"text"},_hoisted_60=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star text-orange-300"},null,-1)),_hoisted_61={class:"number"},_hoisted_62={class:"flex justify-between"},_hoisted_63={class:"text"},_hoisted_64=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star text-yellow-100"},null,-1)),_hoisted_65={class:"number"},_hoisted_66={class:"flex justify-between"},_hoisted_67={class:"text"},_hoisted_68=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star text-orange-300"},null,-1)),_hoisted_69={class:"number"},_hoisted_70={key:0,class:"flex flex-col justify-between opacity-95"},_hoisted_71={class:"text-error text-sm"},_hoisted_72={class:"text-error text-sm"},_hoisted_73={class:"number text-sm"},_hoisted_74={class:"w-full items-center custom-gradient-gray-blue rounded border border-blue-800 justify-center px-4 pt-4 pb-3"},_hoisted_75={class:"text text-center pb-4"},_hoisted_76=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star text-orange-300"},null,-1)),_hoisted_77={class:"flex flex-wrap justify-center space-x-8"},_hoisted_78={class:"text text-center text-xl pb-4 pt-10"},_hoisted_79={class:"flex justify-center space-x-2"},_hoisted_80=["onClick"],_hoisted_81={class:"max-w-lg m-auto"},_hoisted_82={class:"col-span-1 sm:col-span-2 flex items-center space-x-5"},_hoisted_83={class:"flex items-center space-x-5"},_hoisted_84={class:"text-white"},_hoisted_85=_withScopeId(()=>createBaseVNode("i",{class:"fa-solid fa-star"},null,-1)),_hoisted_86={class:"col-span-2"},_hoisted_87={class:"text-white"},_sfc_main=defineComponent({__name:"TrackerView",setup(r,{expose:t}){const e=ref(null),n=ref(!1),s=ref(0),a=ref(0),o=ref(""),l=useDataStore().arcanists,c=ref([]),h=ref(!1),f=ref([]),u=computed(()=>{const S=c.value.slice().sort((w,v)=>v.Timestamp-w.Timestamp);return S.map((w,v)=>({PullNumber:S.length-v,ArcanistName:w.ArcanistName,Rarity:w.Rarity,Timestamp:w.Timestamp}))});watch(u,S=>{const w=S.reduce((v,k)=>(v[k.Timestamp]=(v[k.Timestamp]||0)+1,v),{});f.value=Object.entries(w).filter(([,v])=>v!==1&&v!==10).map(([v])=>Number(v)),h.value=f.value.length>0});const d=computed(()=>{const S=u.value.filter(w=>w.Rarity===6).sort((w,v)=>w.PullNumber-v.PullNumber).map(w=>w.PullNumber);return S.map((w,v)=>v===0?w:w-S[v-1])}),g=computed(()=>{const S=u.value.find(w=>w.Rarity===6);return S?u.value.length-S.PullNumber:u.value.length});async function p(S){const k=(await Image.load(await S.arrayBuffer())).blurFilter({radius:1}).grey({algorithm:"average"}),I=[[0,-1,0],[-1,5,-1],[0,-1,0]];return k.convolution(I).gaussianFilter({radius:1}).getCanvas()}const x={"3uma":"Зима","3lonney":"Blonney",uma:"Зима",aliEnT:"aliEn T",Druvis:"Druvis III",korn:"Bkornblume",corn:"Bkornblume",AKnight:"A Knight",THT:"TTT",fennant:"Tennant",Blonnev:"Blonney",Doc:"Door"},y=S=>{const w=S.target.files,v=c.value.reduce((k,I)=>{const{Timestamp:L}=I;return k[L]&&k[L][0]?k[L][0].push(I):k[L]=[[I]],k},{});w&&(n.value=!0,(async()=>{const k=await src.createWorker("eng");for(let F=0;F<w.length;F++){const Z=w[F];if(s.value=F+1,a.value=w.length,Z){const W=await p(Z),G=await k.recognize(W);console.log(G.data.text),o.value=G.data.text;const C=[...l.map(N=>N.Name),...Object.keys(x)].join("|"),Y=new RegExp(`(?<ArcanistName>${C})\\s*(?:\\(.*?\\))?(?<BannerType>.*?)(?<Date>\\d{4}-\\d{2}-\\d{2}\\s*\\d{2}:\\d{2}:\\d{2})`,"i"),j=[],R={};o.value.trim().split(`
`).forEach(N=>{var z,H,ee;const U=N.match(Y);if(U){let se=((z=U.groups)==null?void 0:z.ArcanistName.trim())||"";x[se]&&(se=x[se]);const ae=l.find(q=>q.Name.toLowerCase()===se.toLowerCase()),he=ae?ae.Rarity:0,we=((H=U.groups)==null?void 0:H.BannerType.trim())||"",ge=new Date((((ee=U.groups)==null?void 0:ee.Date)||"").replace(/(\d{4}-\d{2}-\d{2})(\d{2}:\d{2}:\d{2})/,"$1 $2")).getTime(),J={ArcanistName:(ae==null?void 0:ae.Name)||"",Rarity:he,BannerType:we,Timestamp:ge};j.push(J),R[ge]?R[ge].push(J):R[ge]=[J]}}),Object.keys(R).forEach(N=>{const U=R[N];v[N]?v[N].some(H=>H.length===10)||(A(U[0],j[0])&&A(U[U.length-1],j[U.length-1])?v[N].push(U):A(U[U.length-1],j[j.length-1])&&A(U[0],j[j.length-U.length])&&v[N].unshift(U)):v[N]=[U]})}}const I={};Object.keys(v).sort((F,Z)=>Number(Z)-Number(F)).forEach(F=>{if(v[F].length===1)I[F]=v[F][0];else if(v[F].length===2){const Z=v[F][0],W=v[F][1],G=Z.length+W.length;b(Z,W)?I[F]=[...Z]:G<=10?I[F]=[...Z,...W]:I[F]=[...Z.slice(0,10-G),...W]}else if(v[F].length>2){const Z=v[F][0],W=v[F][v[F].length-1],G=Z.length+W.length;b(Z,W)?I[F]=[...Z]:G<=10?I[F]=[...Z,...W]:I[F]=[...Z.slice(0,10-G),...W]}});let L=[];Object.keys(I).sort((F,Z)=>Number(Z)-Number(F)).forEach(F=>{L=[...L,...I[F]]}),await k.terminate(),c.value=L,n.value=!1})())},m=()=>{var S;(S=e.value)==null||S.click()},A=(S,w)=>S.ArcanistName===w.ArcanistName&&S.BannerType===w.BannerType&&S.Rarity===w.Rarity,b=(S,w)=>JSON.stringify(S)===JSON.stringify(w),_=S=>{const w=new Date(S),v=w.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),k=w.toLocaleTimeString("en-GB",{hour12:!1,hour:"2-digit",minute:"2-digit"});return`${v} ${k}`},M=ref([5,6]),T=S=>{M.value.includes(S)?M.value=M.value.filter(w=>w!==S):M.value.push(S)},D=computed(()=>u.value.filter(S=>M.value.includes(S.Rarity)));t({formatDate:_}),watchEffect(()=>{c.value.length>0&&usePullsRecordStore().updatePullsRecord(c.value)}),onMounted(()=>{usePullsRecordStore().data.length>0&&(c.value=[...usePullsRecordStore().data])});const E=()=>{usePullsRecordStore().reset(),window.location.reload()};return(S,w)=>{const v=resolveComponent("i18n-t");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("h2",_hoisted_2,[createTextVNode(toDisplayString(S.$t("summon-tracker"))+" ",1),createBaseVNode("span",_hoisted_3,toDisplayString(S.$t("please-read-tutorial")),1)]),createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createBaseVNode("input",{type:"file",ref_key:"fileInput",ref:e,onChange:y,accept:"image/*",class:"ml-4",style:{display:"none"},multiple:""},null,544),createBaseVNode("button",{onClick:m,disabled:n.value,class:"bg-success hover:bg-green-600 text-white/90 font-bold py-2 px-4 rounded ml-2"},toDisplayString(S.$t("ocr-import")),9,_hoisted_6),createBaseVNode("button",_hoisted_7,toDisplayString(S.$t("tutorial")),1),createBaseVNode("button",_hoisted_8,toDisplayString(S.$t("reset")),1)]),createBaseVNode("dialog",_hoisted_9,[createBaseVNode("div",_hoisted_10,[_hoisted_11,createBaseVNode("h3",_hoisted_12,toDisplayString(S.$t("tutorial")),1),createBaseVNode("p",_hoisted_13,[createTextVNode(toDisplayString(S.$t("video-demonstration-tutorial"))+" ",1),createBaseVNode("a",_hoisted_14,toDisplayString(S.$t("summon-tracker-demo")),1)]),createBaseVNode("p",_hoisted_15,"1. "+toDisplayString(S.$t("take-screenshots-of-your-summon-history")),1),createBaseVNode("p",_hoisted_16,[createTextVNode("2. "),createVNode(v,{keypath:"upload-the-screenshots-to-the-summon-tracker-you-could-upload-multiple-images-at-once"},{highlight:withCtx(()=>[createBaseVNode("span",_hoisted_17,toDisplayString(S.$t("multiple-images")),1)]),_:1})]),createBaseVNode("p",_hoisted_18,"3. "+toDisplayString(S.$t("the-summon-tracker-will-automatically-extract-display-and-save-the-information-from-the-screenshots")),1),createBaseVNode("p",_hoisted_19,"4. "+toDisplayString(S.$t("it-is-advised-to-save-your-screenshots-for-future-usages")),1),createBaseVNode("h3",_hoisted_20,toDisplayString(S.$t("limitations")),1),createBaseVNode("p",_hoisted_21,[createTextVNode("• "),createVNode(v,{keypath:"ocr-import-only-works-with-english-text-consider-changing-your-language-into-english-to-screenshot"},{highlight:withCtx(()=>[createBaseVNode("span",_hoisted_22,toDisplayString(S.$t("english-text")),1)]),_:1})]),createBaseVNode("p",_hoisted_23,[createTextVNode("• "),createVNode(v,{keypath:"images-must-be-clear-or-the-summon-tracker-may-fail-to-read"},{highlight:withCtx(()=>[createBaseVNode("span",_hoisted_24,toDisplayString(S.$t("must-be-clear")),1)]),_:1})]),createBaseVNode("p",_hoisted_25,[createTextVNode("• "),createVNode(v,{keypath:"if-images-take-too-long-to-process-or-fail-to-read-5-arcanists-consider-screenshotting-clearer-images"},{highlight1:withCtx(()=>[createBaseVNode("span",_hoisted_26,toDisplayString(S.$t("take-too-long")),1)]),highlight2:withCtx(()=>[createBaseVNode("span",_hoisted_27,toDisplayString(S.$t("fail-to-read")),1)]),star:withCtx(()=>[_hoisted_28]),_:1})]),createBaseVNode("p",_hoisted_29,[createTextVNode("• "),createVNode(v,{keypath:"this-is-an-example-of-a-good-image"},{highlight:withCtx(()=>[createBaseVNode("a",_hoisted_30,toDisplayString(S.$t("image")),1)]),_:1})]),createBaseVNode("h3",_hoisted_31,toDisplayString(S.$t("bug-reports")),1),createBaseVNode("p",_hoisted_32,[createTextVNode("• "),createVNode(v,{keypath:"if-you-encouter-a-bug-open-your-f12-console-send-the-text-through-bug-reports-or-directly-to-windbow"},{discord:withCtx(()=>[createTextVNode("@windbow")]),_:1})])]),_hoisted_33]),createBaseVNode("dialog",_hoisted_34,[createBaseVNode("div",_hoisted_35,[_hoisted_36,createBaseVNode("p",_hoisted_37,toDisplayString(S.$t("once-you-delete-your-summon-tracker-data-there-is-no-going-back")),1),createBaseVNode("p",_hoisted_38,toDisplayString(S.$t("please-be-certain")),1),createBaseVNode("button",{onClick:E,class:"btn btn-error text-black font-bold py-2 px-4 rounded ml-2"},toDisplayString(S.$t("reset-tracker")),1)]),_hoisted_39])]),createBaseVNode("div",_hoisted_40,[withDirectives(createBaseVNode("i",_hoisted_41,null,512),[[vShow,n.value]]),withDirectives(createBaseVNode("span",_hoisted_42,[createVNode(v,{keypath:"processing-file-number-out-of-numbers-please-wait"},{current:withCtx(()=>[createBaseVNode("span",_hoisted_43,toDisplayString(s.value),1)]),total:withCtx(()=>[createBaseVNode("span",_hoisted_44,toDisplayString(a.value),1)]),_:1})],512),[[vShow,n.value]])]),createBaseVNode("p",_hoisted_45,toDisplayString(S.$t("summon-summary")),1),createBaseVNode("div",_hoisted_46,[createBaseVNode("div",_hoisted_47,[createBaseVNode("div",_hoisted_48,toDisplayString(S.$t("total-summons")),1),createBaseVNode("div",_hoisted_49,toDisplayString(u.value.length),1)]),createBaseVNode("div",_hoisted_50,[createBaseVNode("div",_hoisted_51,[createVNode(v,{keypath:"6-star-summons"},{star:withCtx(()=>[_hoisted_52]),_:1})]),createBaseVNode("div",_hoisted_53,toDisplayString(u.value.filter(k=>k.Rarity===6).length),1)]),createBaseVNode("div",_hoisted_54,[createBaseVNode("div",_hoisted_55,[createVNode(v,{keypath:"5-star-summons"},{star:withCtx(()=>[_hoisted_56]),_:1})]),createBaseVNode("div",_hoisted_57,toDisplayString(u.value.filter(k=>k.Rarity===5).length),1)]),createBaseVNode("div",_hoisted_58,[createBaseVNode("div",_hoisted_59,[createVNode(v,{keypath:"6-star-average"},{star:withCtx(()=>[_hoisted_60]),_:1})]),createBaseVNode("div",_hoisted_61,toDisplayString(u.value.filter(k=>k.Rarity===6).length>0?Math.floor(u.value.length/u.value.filter(k=>k.Rarity===6).length):0),1)]),createBaseVNode("div",_hoisted_62,[createBaseVNode("div",_hoisted_63,[createVNode(v,{keypath:"5-star-average"},{star:withCtx(()=>[_hoisted_64]),_:1})]),createBaseVNode("div",_hoisted_65,toDisplayString(u.value.filter(k=>k.Rarity===5).length>0?Math.floor(u.value.length/u.value.filter(k=>k.Rarity===5).length):0),1)]),createBaseVNode("div",_hoisted_66,[createBaseVNode("div",_hoisted_67,[createVNode(v,{keypath:"current-6-star-pity"},{star:withCtx(()=>[_hoisted_68]),_:1})]),createBaseVNode("div",_hoisted_69,toDisplayString(g.value)+" / 70",1)]),h.value?(openBlock(),createElementBlock("div",_hoisted_70,[createBaseVNode("div",_hoisted_71,toDisplayString(S.$t("import-error")),1),createBaseVNode("div",_hoisted_72,[createVNode(v,{keypath:"wrong-timestamps"},{timestamps:withCtx(()=>[createBaseVNode("span",_hoisted_73,toDisplayString(f.value.map(_).join(", ")),1)]),_:1})])])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_74,[createBaseVNode("div",_hoisted_75,[createVNode(v,{keypath:"recent-6-star-summons"},{star:withCtx(()=>[_hoisted_76]),_:1})]),createBaseVNode("div",_hoisted_77,[(openBlock(!0),createElementBlock(Fragment,null,renderList(u.value.filter(k=>k.Rarity===6),(k,I)=>(openBlock(),createElementBlock("div",{key:`${k.Timestamp}-${k.ArcanistName}`},[createVNode(_sfc_main$1,{class:"py-2",arcanist:unref(l).find(L=>L.Name===k.ArcanistName),pity:d.value[d.value.length-1-I]},null,8,["arcanist","pity"])]))),128))])]),createBaseVNode("div",_hoisted_78,toDisplayString(S.$t("summon-history")),1),createBaseVNode("div",_hoisted_79,[(openBlock(),createElementBlock(Fragment,null,renderList([2,3,4,5,6],k=>createBaseVNode("button",{key:k,class:normalizeClass([{"border-2 border-info":M.value.includes(k)},"p-2 rounded-md"]),onClick:I=>T(k)},[createBaseVNode("i",{class:normalizeClass(["fa-solid fa-star",{"text-orange-300":k===6,"text-yellow-100":k===5,"text-purple-400":k===4,"text-sky-200":k===3,"text-green-200":k===2}])},null,2)],10,_hoisted_80)),64))]),createBaseVNode("div",_hoisted_81,[(openBlock(!0),createElementBlock(Fragment,null,renderList(D.value,(k,I)=>(openBlock(),createElementBlock("div",{key:`${k.Timestamp}-${k.ArcanistName}-${I}`,class:"grid grid-cols-4 sm:grid-cols-5 justify-between items-center p-2 border-b border-gray-200 space-x-5"},[createBaseVNode("div",_hoisted_82,[createBaseVNode("div",_hoisted_83,[createBaseVNode("div",_hoisted_84,toDisplayString(k.PullNumber),1),createVNode(_sfc_main$2,{arcanist:unref(l).find(L=>L.Name===k.ArcanistName)},null,8,["arcanist"]),createBaseVNode("div",{class:normalizeClass(["pullArcanistName ml-2",{"text-orange-300":k.Rarity===6,"text-yellow-100":k.Rarity===5,"text-purple-400":k.Rarity===4,"text-sky-200":k.Rarity===3,"text-green-200":k.Rarity===2}])},toDisplayString(S.$t(k.ArcanistName)),3)])]),createBaseVNode("div",{class:normalizeClass(["text-center",{"text-orange-300":k.Rarity===6,"text-yellow-100":k.Rarity===5,"text-purple-400":k.Rarity===4,"text-sky-200":k.Rarity===3,"text-green-200":k.Rarity===2}])},[createTextVNode(toDisplayString(k.Rarity)+" ",1),_hoisted_85],2),createBaseVNode("div",_hoisted_86,[createBaseVNode("div",_hoisted_87,toDisplayString(_(k.Timestamp)),1)])]))),128))])])}}}),TrackerView=_export_sfc(_sfc_main,[["__scopeId","data-v-ae10cccf"]]);export{TrackerView as default};
